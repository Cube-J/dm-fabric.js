{"version":3,"file":"fabric.js","mappings":"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","sources":["webpack://dm-fabric/./src/fabric.js","webpack://dm-fabric/webpack/bootstrap","webpack://dm-fabric/webpack/runtime/define property getters","webpack://dm-fabric/webpack/runtime/hasOwnProperty shorthand","webpack://dm-fabric/./src/index.js"],"sourcesContent":["/* build: `node build.js modules=ALL exclude=gestures,accessors,erasing requirejs minifier=uglifyjs` */\r\n/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\r\n\r\nvar fabric = fabric || { version: '5.2.1' };\r\nif (typeof exports !== 'undefined') {\r\n  exports.fabric = fabric;\r\n}\r\n/* _AMD_START_ */\r\nelse if (typeof define === 'function' && define.amd) {\r\n  define([], function() { return fabric; });\r\n}\r\n/* _AMD_END_ */\r\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\r\n  if (document instanceof (typeof HTMLDocument !== 'undefined' ? HTMLDocument : Document)) {\r\n    fabric.document = document;\r\n  }\r\n  else {\r\n    fabric.document = document.implementation.createHTMLDocument('');\r\n  }\r\n  fabric.window = window;\r\n}\r\nelse {\r\n  // assume we're running under node.js when document/window are not present\r\n  var jsdom = require('jsdom');\r\n  var virtualWindow = new jsdom.JSDOM(\r\n    decodeURIComponent('%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E'),\r\n    {\r\n      features: {\r\n        FetchExternalResources: ['img']\r\n      },\r\n      resources: 'usable'\r\n    }).window;\r\n  fabric.document = virtualWindow.document;\r\n  fabric.jsdomImplForWrapper = require('jsdom/lib/jsdom/living/generated/utils').implForWrapper;\r\n  fabric.nodeCanvas = require('jsdom/lib/jsdom/utils').Canvas;\r\n  fabric.window = virtualWindow;\r\n  DOMParser = fabric.window.DOMParser;\r\n}\r\n\r\n/**\r\n * True when in environment that supports touch events\r\n * @type boolean\r\n */\r\nfabric.isTouchSupported = 'ontouchstart' in fabric.window || 'ontouchstart' in fabric.document ||\r\n  (fabric.window && fabric.window.navigator && fabric.window.navigator.maxTouchPoints > 0);\r\n\r\n/**\r\n * True when in environment that's probably Node.js\r\n * @type boolean\r\n */\r\nfabric.isLikelyNode = typeof Buffer !== 'undefined' &&\r\n                      typeof window === 'undefined';\r\n\r\n/* _FROM_SVG_START_ */\r\n/**\r\n * Attributes parsed from all SVG elements\r\n * @type array\r\n */\r\nfabric.SHARED_ATTRIBUTES = [\r\n  'display',\r\n  'transform',\r\n  'fill', 'fill-opacity', 'fill-rule',\r\n  'opacity',\r\n  'stroke', 'stroke-dasharray', 'stroke-linecap', 'stroke-dashoffset',\r\n  'stroke-linejoin', 'stroke-miterlimit',\r\n  'stroke-opacity', 'stroke-width',\r\n  'id', 'paint-order', 'vector-effect',\r\n  'instantiated_by_use', 'clip-path',\r\n];\r\n/* _FROM_SVG_END_ */\r\n\r\n/**\r\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\r\n */\r\nfabric.DPI = 96;\r\nfabric.reNum = '(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:[eE][-+]?\\\\d+)?)';\r\nfabric.commaWsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)';\r\nfabric.rePathCommand = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/ig;\r\nfabric.reNonWord = /[ \\n\\.,;!\\?\\-]/;\r\nfabric.fontPaths = { };\r\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\r\nfabric.svgNS = 'http://www.w3.org/2000/svg';\r\n\r\n/**\r\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\r\n * @since 1.7.14\r\n * @type Number\r\n * @default\r\n */\r\nfabric.perfLimitSizeTotal = 2097152;\r\n\r\n/**\r\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\r\n * @since 1.7.14\r\n * @type Number\r\n * @default\r\n */\r\nfabric.maxCacheSideLimit = 4096;\r\n\r\n/**\r\n * Lowest pixel limit for cache canvases, set at 256PX\r\n * @since 1.7.14\r\n * @type Number\r\n * @default\r\n */\r\nfabric.minCacheSideLimit = 256;\r\n\r\n/**\r\n * Cache Object for widths of chars in text rendering.\r\n */\r\nfabric.charWidthsCache = { };\r\n\r\n/**\r\n * if webgl is enabled and available, textureSize will determine the size\r\n * of the canvas backend\r\n * @since 2.0.0\r\n * @type Number\r\n * @default\r\n */\r\nfabric.textureSize = 2048;\r\n\r\n/**\r\n * When 'true', style information is not retained when copy/pasting text, making\r\n * pasted text use destination style.\r\n * Defaults to 'false'.\r\n * @type Boolean\r\n * @default\r\n */\r\nfabric.disableStyleCopyPaste = false;\r\n\r\n/**\r\n * Enable webgl for filtering picture is available\r\n * A filtering backend will be initialized, this will both take memory and\r\n * time since a default 2048x2048 canvas will be created for the gl context\r\n * @since 2.0.0\r\n * @type Boolean\r\n * @default\r\n */\r\nfabric.enableGLFiltering = true;\r\n\r\n/**\r\n * Device Pixel Ratio\r\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\r\n */\r\nfabric.devicePixelRatio = fabric.window.devicePixelRatio ||\r\n                          fabric.window.webkitDevicePixelRatio ||\r\n                          fabric.window.mozDevicePixelRatio ||\r\n                          1;\r\n/**\r\n * Browser-specific constant to adjust CanvasRenderingContext2D.shadowBlur value,\r\n * which is unitless and not rendered equally across browsers.\r\n *\r\n * Values that work quite well (as of October 2017) are:\r\n * - Chrome: 1.5\r\n * - Edge: 1.75\r\n * - Firefox: 0.9\r\n * - Safari: 0.95\r\n *\r\n * @since 2.0.0\r\n * @type Number\r\n * @default 1\r\n */\r\nfabric.browserShadowBlurConstant = 1;\r\n\r\n/**\r\n * This object contains the result of arc to bezier conversion for faster retrieving if the same arc needs to be converted again.\r\n * It was an internal variable, is accessible since version 2.3.4\r\n */\r\nfabric.arcToSegmentsCache = { };\r\n\r\n/**\r\n * This object keeps the results of the boundsOfCurve calculation mapped by the joined arguments necessary to calculate it.\r\n * It does speed up calculation, if you parse and add always the same paths, but in case of heavy usage of freedrawing\r\n * you do not get any speed benefit and you get a big object in memory.\r\n * The object was a private variable before, while now is appended to the lib so that you have access to it and you\r\n * can eventually clear it.\r\n * It was an internal variable, is accessible since version 2.3.4\r\n */\r\nfabric.boundsOfCurveCache = { };\r\n\r\n/**\r\n * If disabled boundsOfCurveCache is not used. For apps that make heavy usage of pencil drawing probably disabling it is better\r\n * @default true\r\n */\r\nfabric.cachesBoundsOfCurve = true;\r\n\r\n/**\r\n * Skip performance testing of setupGLContext and force the use of putImageData that seems to be the one that works best on\r\n * Chrome + old hardware. if your users are experiencing empty images after filtering you may try to force this to true\r\n * this has to be set before instantiating the filtering backend ( before filtering the first image )\r\n * @type Boolean\r\n * @default false\r\n */\r\nfabric.forceGLPutImageData = false;\r\n\r\nfabric.initFilterBackend = function() {\r\n  if (fabric.enableGLFiltering && fabric.isWebglSupported && fabric.isWebglSupported(fabric.textureSize)) {\r\n    console.log('max texture size: ' + fabric.maxTextureSize);\r\n    return (new fabric.WebglFilterBackend({ tileSize: fabric.textureSize }));\r\n  }\r\n  else if (fabric.Canvas2dFilterBackend) {\r\n    return (new fabric.Canvas2dFilterBackend());\r\n  }\r\n};\r\n\r\n\r\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\r\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\r\n  window.fabric = fabric;\r\n}\r\n\r\n\r\n(function() {\r\n\r\n  /**\r\n   * @private\r\n   * @param {String} eventName\r\n   * @param {Function} handler\r\n   */\r\n  function _removeEventListener(eventName, handler) {\r\n    if (!this.__eventListeners[eventName]) {\r\n      return;\r\n    }\r\n    var eventListener = this.__eventListeners[eventName];\r\n    if (handler) {\r\n      eventListener[eventListener.indexOf(handler)] = false;\r\n    }\r\n    else {\r\n      fabric.util.array.fill(eventListener, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Observes specified event\r\n   * @memberOf fabric.Observable\r\n   * @alias on\r\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\r\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\r\n   * @return {Self} thisArg\r\n   * @chainable\r\n   */\r\n  function on(eventName, handler) {\r\n    if (!this.__eventListeners) {\r\n      this.__eventListeners = { };\r\n    }\r\n    // one object with key/value pairs was passed\r\n    if (arguments.length === 1) {\r\n      for (var prop in eventName) {\r\n        this.on(prop, eventName[prop]);\r\n      }\r\n    }\r\n    else {\r\n      if (!this.__eventListeners[eventName]) {\r\n        this.__eventListeners[eventName] = [];\r\n      }\r\n      this.__eventListeners[eventName].push(handler);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  function _once(eventName, handler) {\r\n    var _handler = function () {\r\n      handler.apply(this, arguments);\r\n      this.off(eventName, _handler);\r\n    }.bind(this);\r\n    this.on(eventName, _handler);\r\n  }\r\n\r\n  function once(eventName, handler) {\r\n    // one object with key/value pairs was passed\r\n    if (arguments.length === 1) {\r\n      for (var prop in eventName) {\r\n        _once.call(this, prop, eventName[prop]);\r\n      }\r\n    }\r\n    else {\r\n      _once.call(this, eventName, handler);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stops event observing for a particular event handler. Calling this method\r\n   * without arguments removes all handlers for all events\r\n   * @memberOf fabric.Observable\r\n   * @alias off\r\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\r\n   * @param {Function} handler Function to be deleted from EventListeners\r\n   * @return {Self} thisArg\r\n   * @chainable\r\n   */\r\n  function off(eventName, handler) {\r\n    if (!this.__eventListeners) {\r\n      return this;\r\n    }\r\n\r\n    // remove all key/value pairs (event name -> event handler)\r\n    if (arguments.length === 0) {\r\n      for (eventName in this.__eventListeners) {\r\n        _removeEventListener.call(this, eventName);\r\n      }\r\n    }\r\n    // one object with key/value pairs was passed\r\n    else if (arguments.length === 1 && typeof arguments[0] === 'object') {\r\n      for (var prop in eventName) {\r\n        _removeEventListener.call(this, prop, eventName[prop]);\r\n      }\r\n    }\r\n    else {\r\n      _removeEventListener.call(this, eventName, handler);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Fires event with an optional options object\r\n   * @memberOf fabric.Observable\r\n   * @param {String} eventName Event name to fire\r\n   * @param {Object} [options] Options object\r\n   * @return {Self} thisArg\r\n   * @chainable\r\n   */\r\n  function fire(eventName, options) {\r\n    if (!this.__eventListeners) {\r\n      return this;\r\n    }\r\n\r\n    var listenersForEvent = this.__eventListeners[eventName];\r\n    if (!listenersForEvent) {\r\n      return this;\r\n    }\r\n\r\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\r\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || { });\r\n    }\r\n    this.__eventListeners[eventName] = listenersForEvent.filter(function(value) {\r\n      return value !== false;\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @namespace fabric.Observable\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\r\n   * @see {@link http://fabricjs.com/events|Events demo}\r\n   */\r\n  fabric.Observable = {\r\n    fire: fire,\r\n    on: on,\r\n    once: once,\r\n    off: off,\r\n  };\r\n})();\r\n\r\n\r\n/**\r\n * @namespace fabric.Collection\r\n */\r\nfabric.Collection = {\r\n\r\n  _objects: [],\r\n\r\n  /**\r\n   * Adds objects to collection, Canvas or Group, then renders canvas\r\n   * (if `renderOnAddRemove` is not `false`).\r\n   * in case of Group no changes to bounding box are made.\r\n   * Objects should be instances of (or inherit from) fabric.Object\r\n   * Use of this function is highly discouraged for groups.\r\n   * you can add a bunch of objects with the add method but then you NEED\r\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\r\n   * @param {...fabric.Object} object Zero or more fabric instances\r\n   * @return {Self} thisArg\r\n   * @chainable\r\n   */\r\n  add: function () {\r\n    this._objects.push.apply(this._objects, arguments);\r\n    if (this._onObjectAdded) {\r\n      for (var i = 0, length = arguments.length; i < length; i++) {\r\n        this._onObjectAdded(arguments[i]);\r\n      }\r\n    }\r\n    this.renderOnAddRemove && this.requestRenderAll();\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\r\n   * An object should be an instance of (or inherit from) fabric.Object\r\n   * Use of this function is highly discouraged for groups.\r\n   * you can add a bunch of objects with the insertAt method but then you NEED\r\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\r\n   * @param {Object} object Object to insert\r\n   * @param {Number} index Index to insert object at\r\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\r\n   * @return {Self} thisArg\r\n   * @chainable\r\n   */\r\n  insertAt: function (object, index, nonSplicing) {\r\n    var objects = this._objects;\r\n    if (nonSplicing) {\r\n      objects[index] = object;\r\n    }\r\n    else {\r\n      objects.splice(index, 0, object);\r\n    }\r\n    this._onObjectAdded && this._onObjectAdded(object);\r\n    this.renderOnAddRemove && this.requestRenderAll();\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\r\n   * @param {...fabric.Object} object Zero or more fabric instances\r\n   * @return {Self} thisArg\r\n   * @chainable\r\n   */\r\n  remove: function() {\r\n    var objects = this._objects,\r\n        index, somethingRemoved = false;\r\n\r\n    for (var i = 0, length = arguments.length; i < length; i++) {\r\n      index = objects.indexOf(arguments[i]);\r\n\r\n      // only call onObjectRemoved if an object was actually removed\r\n      if (index !== -1) {\r\n        somethingRemoved = true;\r\n        objects.splice(index, 1);\r\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\r\n      }\r\n    }\r\n\r\n    this.renderOnAddRemove && somethingRemoved && this.requestRenderAll();\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Executes given function for each object in this group\r\n   * @param {Function} callback\r\n   *                   Callback invoked with current object as first argument,\r\n   *                   index - as second and an array of all objects - as third.\r\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\r\n   *                   when no `context` argument is given\r\n   *\r\n   * @param {Object} context Context (aka thisObject)\r\n   * @return {Self} thisArg\r\n   * @chainable\r\n   */\r\n  forEachObject: function(callback, context) {\r\n    var objects = this.getObjects();\r\n    for (var i = 0, len = objects.length; i < len; i++) {\r\n      callback.call(context, objects[i], i, objects);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Returns an array of children objects of this instance\r\n   * Type parameter introduced in 1.3.10\r\n   * since 2.3.5 this method return always a COPY of the array;\r\n   * @param {String} [type] When specified, only objects of this type are returned\r\n   * @return {Array}\r\n   */\r\n  getObjects: function(type) {\r\n    if (typeof type === 'undefined') {\r\n      return this._objects.concat();\r\n    }\r\n    return this._objects.filter(function(o) {\r\n      return o.type === type;\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Returns object at specified index\r\n   * @param {Number} index\r\n   * @return {Self} thisArg\r\n   */\r\n  item: function (index) {\r\n    return this._objects[index];\r\n  },\r\n\r\n  /**\r\n   * Returns true if collection contains no objects\r\n   * @return {Boolean} true if collection is empty\r\n   */\r\n  isEmpty: function () {\r\n    return this._objects.length === 0;\r\n  },\r\n\r\n  /**\r\n   * Returns a size of a collection (i.e: length of an array containing its objects)\r\n   * @return {Number} Collection size\r\n   */\r\n  size: function() {\r\n    return this._objects.length;\r\n  },\r\n\r\n  /**\r\n   * Returns true if collection contains an object\r\n   * @param {Object} object Object to check against\r\n   * @param {Boolean} [deep=false] `true` to check all descendants, `false` to check only `_objects`\r\n   * @return {Boolean} `true` if collection contains an object\r\n   */\r\n  contains: function (object, deep) {\r\n    if (this._objects.indexOf(object) > -1) {\r\n      return true;\r\n    }\r\n    else if (deep) {\r\n      return this._objects.some(function (obj) {\r\n        return typeof obj.contains === 'function' && obj.contains(object, true);\r\n      });\r\n    }\r\n    return false;\r\n  },\r\n\r\n  /**\r\n   * Returns number representation of a collection complexity\r\n   * @return {Number} complexity\r\n   */\r\n  complexity: function () {\r\n    return this._objects.reduce(function (memo, current) {\r\n      memo += current.complexity ? current.complexity() : 0;\r\n      return memo;\r\n    }, 0);\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * @namespace fabric.CommonMethods\r\n */\r\nfabric.CommonMethods = {\r\n\r\n  /**\r\n   * Sets object's properties from options\r\n   * @param {Object} [options] Options object\r\n   */\r\n  _setOptions: function(options) {\r\n    for (var prop in options) {\r\n      this.set(prop, options[prop]);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {Object} [filler] Options object\r\n   * @param {String} [property] property to set the Gradient to\r\n   */\r\n  _initGradient: function(filler, property) {\r\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\r\n      this.set(property, new fabric.Gradient(filler));\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {Object} [filler] Options object\r\n   * @param {String} [property] property to set the Pattern to\r\n   * @param {Function} [callback] callback to invoke after pattern load\r\n   */\r\n  _initPattern: function(filler, property, callback) {\r\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\r\n      this.set(property, new fabric.Pattern(filler, callback));\r\n    }\r\n    else {\r\n      callback && callback();\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  _setObject: function(obj) {\r\n    for (var prop in obj) {\r\n      this._set(prop, obj[prop]);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\r\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\r\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\r\n   * @return {fabric.Object} thisArg\r\n   * @chainable\r\n   */\r\n  set: function(key, value) {\r\n    if (typeof key === 'object') {\r\n      this._setObject(key);\r\n    }\r\n    else {\r\n      this._set(key, value);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  _set: function(key, value) {\r\n    this[key] = value;\r\n  },\r\n\r\n  /**\r\n   * Toggles specified property from `true` to `false` or from `false` to `true`\r\n   * @param {String} property Property to toggle\r\n   * @return {fabric.Object} thisArg\r\n   * @chainable\r\n   */\r\n  toggle: function(property) {\r\n    var value = this.get(property);\r\n    if (typeof value === 'boolean') {\r\n      this.set(property, !value);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Basic getter\r\n   * @param {String} property Property name\r\n   * @return {*} value of a property\r\n   */\r\n  get: function(property) {\r\n    return this[property];\r\n  }\r\n};\r\n\r\n\r\n(function(global) {\r\n\r\n  var sqrt = Math.sqrt,\r\n      atan2 = Math.atan2,\r\n      pow = Math.pow,\r\n      PiBy180 = Math.PI / 180,\r\n      PiBy2 = Math.PI / 2;\r\n\r\n  /**\r\n   * @namespace fabric.util\r\n   */\r\n  fabric.util = {\r\n\r\n    /**\r\n     * Calculate the cos of an angle, avoiding returning floats for known results\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Number} angle the angle in radians or in degree\r\n     * @return {Number}\r\n     */\r\n    cos: function(angle) {\r\n      if (angle === 0) { return 1; }\r\n      if (angle < 0) {\r\n        // cos(a) = cos(-a)\r\n        angle = -angle;\r\n      }\r\n      var angleSlice = angle / PiBy2;\r\n      switch (angleSlice) {\r\n        case 1: case 3: return 0;\r\n        case 2: return -1;\r\n      }\r\n      return Math.cos(angle);\r\n    },\r\n\r\n    /**\r\n     * Calculate the sin of an angle, avoiding returning floats for known results\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Number} angle the angle in radians or in degree\r\n     * @return {Number}\r\n     */\r\n    sin: function(angle) {\r\n      if (angle === 0) { return 0; }\r\n      var angleSlice = angle / PiBy2, sign = 1;\r\n      if (angle < 0) {\r\n        // sin(-a) = -sin(a)\r\n        sign = -1;\r\n      }\r\n      switch (angleSlice) {\r\n        case 1: return sign;\r\n        case 2: return 0;\r\n        case 3: return -sign;\r\n      }\r\n      return Math.sin(angle);\r\n    },\r\n\r\n    /**\r\n     * Removes value from an array.\r\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Array} array\r\n     * @param {*} value\r\n     * @return {Array} original array\r\n     */\r\n    removeFromArray: function(array, value) {\r\n      var idx = array.indexOf(value);\r\n      if (idx !== -1) {\r\n        array.splice(idx, 1);\r\n      }\r\n      return array;\r\n    },\r\n\r\n    /**\r\n     * Returns random number between 2 specified ones.\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Number} min lower limit\r\n     * @param {Number} max upper limit\r\n     * @return {Number} random value (between min and max)\r\n     */\r\n    getRandomInt: function(min, max) {\r\n      return Math.floor(Math.random() * (max - min + 1)) + min;\r\n    },\r\n\r\n    /**\r\n     * Transforms degrees to radians.\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Number} degrees value in degrees\r\n     * @return {Number} value in radians\r\n     */\r\n    degreesToRadians: function(degrees) {\r\n      return degrees * PiBy180;\r\n    },\r\n\r\n    /**\r\n     * Transforms radians to degrees.\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Number} radians value in radians\r\n     * @return {Number} value in degrees\r\n     */\r\n    radiansToDegrees: function(radians) {\r\n      return radians / PiBy180;\r\n    },\r\n\r\n    /**\r\n     * Rotates `point` around `origin` with `radians`\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {fabric.Point} point The point to rotate\r\n     * @param {fabric.Point} origin The origin of the rotation\r\n     * @param {Number} radians The radians of the angle for the rotation\r\n     * @return {fabric.Point} The new rotated point\r\n     */\r\n    rotatePoint: function(point, origin, radians) {\r\n      var newPoint = new fabric.Point(point.x - origin.x, point.y - origin.y),\r\n          v = fabric.util.rotateVector(newPoint, radians);\r\n      return new fabric.Point(v.x, v.y).addEquals(origin);\r\n    },\r\n\r\n    /**\r\n     * Rotates `vector` with `radians`\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Object} vector The vector to rotate (x and y)\r\n     * @param {Number} radians The radians of the angle for the rotation\r\n     * @return {Object} The new rotated point\r\n     */\r\n    rotateVector: function(vector, radians) {\r\n      var sin = fabric.util.sin(radians),\r\n          cos = fabric.util.cos(radians),\r\n          rx = vector.x * cos - vector.y * sin,\r\n          ry = vector.x * sin + vector.y * cos;\r\n      return {\r\n        x: rx,\r\n        y: ry\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Creates a vetor from points represented as a point\r\n     * @static\r\n     * @memberOf fabric.util\r\n     *\r\n     * @typedef {Object} Point\r\n     * @property {number} x\r\n     * @property {number} y\r\n     *\r\n     * @param {Point} from\r\n     * @param {Point} to\r\n     * @returns {Point} vector\r\n     */\r\n    createVector: function (from, to) {\r\n      return new fabric.Point(to.x - from.x, to.y - from.y);\r\n    },\r\n\r\n    /**\r\n     * Calculates angle between 2 vectors using dot product\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Point} a\r\n     * @param {Point} b\r\n     * @returns the angle in radian between the vectors\r\n     */\r\n    calcAngleBetweenVectors: function (a, b) {\r\n      return Math.acos((a.x * b.x + a.y * b.y) / (Math.hypot(a.x, a.y) * Math.hypot(b.x, b.y)));\r\n    },\r\n\r\n    /**\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Point} v\r\n     * @returns {Point} vector representing the unit vector of pointing to the direction of `v`\r\n     */\r\n    getHatVector: function (v) {\r\n      return new fabric.Point(v.x, v.y).multiply(1 / Math.hypot(v.x, v.y));\r\n    },\r\n\r\n    /**\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Point} A\r\n     * @param {Point} B\r\n     * @param {Point} C\r\n     * @returns {{ vector: Point, angle: number }} vector representing the bisector of A and A's angle\r\n     */\r\n    getBisector: function (A, B, C) {\r\n      var AB = fabric.util.createVector(A, B), AC = fabric.util.createVector(A, C);\r\n      var alpha = fabric.util.calcAngleBetweenVectors(AB, AC);\r\n      //  check if alpha is relative to AB->BC\r\n      var ro = fabric.util.calcAngleBetweenVectors(fabric.util.rotateVector(AB, alpha), AC);\r\n      var phi = alpha * (ro === 0 ? 1 : -1) / 2;\r\n      return {\r\n        vector: fabric.util.getHatVector(fabric.util.rotateVector(AB, phi)),\r\n        angle: alpha\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Project stroke width on points returning 2 projections for each point as follows:\r\n     * - `miter`: 2 points corresponding to the outer boundary and the inner boundary of stroke.\r\n     * - `bevel`: 2 points corresponding to the bevel boundaries, tangent to the bisector.\r\n     * - `round`: same as `bevel`\r\n     * Used to calculate object's bounding box\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Point[]} points\r\n     * @param {Object} options\r\n     * @param {number} options.strokeWidth\r\n     * @param {'miter'|'bevel'|'round'} options.strokeLineJoin\r\n     * @param {number} options.strokeMiterLimit https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-miterlimit\r\n     * @param {boolean} options.strokeUniform\r\n     * @param {number} options.scaleX\r\n     * @param {number} options.scaleY\r\n     * @param {boolean} [openPath] whether the shape is open or not, affects the calculations of the first and last points\r\n     * @returns {fabric.Point[]} array of size 2n/4n of all suspected points\r\n     */\r\n    projectStrokeOnPoints: function (points, options, openPath) {\r\n      var coords = [], s = options.strokeWidth / 2,\r\n          strokeUniformScalar = options.strokeUniform ?\r\n            new fabric.Point(1 / options.scaleX, 1 / options.scaleY) : new fabric.Point(1, 1),\r\n          getStrokeHatVector = function (v) {\r\n            var scalar = s / (Math.hypot(v.x, v.y));\r\n            return new fabric.Point(v.x * scalar * strokeUniformScalar.x, v.y * scalar * strokeUniformScalar.y);\r\n          };\r\n      if (points.length <= 1) {return coords;}\r\n      points.forEach(function (p, index) {\r\n        var A = new fabric.Point(p.x, p.y), B, C;\r\n        if (index === 0) {\r\n          C = points[index + 1];\r\n          B = openPath ? getStrokeHatVector(fabric.util.createVector(C, A)).addEquals(A) : points[points.length - 1];\r\n        }\r\n        else if (index === points.length - 1) {\r\n          B = points[index - 1];\r\n          C = openPath ? getStrokeHatVector(fabric.util.createVector(B, A)).addEquals(A) : points[0];\r\n        }\r\n        else {\r\n          B = points[index - 1];\r\n          C = points[index + 1];\r\n        }\r\n        var bisector = fabric.util.getBisector(A, B, C),\r\n            bisectorVector = bisector.vector,\r\n            alpha = bisector.angle,\r\n            scalar,\r\n            miterVector;\r\n        if (options.strokeLineJoin === 'miter') {\r\n          scalar = -s / Math.sin(alpha / 2);\r\n          miterVector = new fabric.Point(\r\n            bisectorVector.x * scalar * strokeUniformScalar.x,\r\n            bisectorVector.y * scalar * strokeUniformScalar.y\r\n          );\r\n          if (Math.hypot(miterVector.x, miterVector.y) / s <= options.strokeMiterLimit) {\r\n            coords.push(A.add(miterVector));\r\n            coords.push(A.subtract(miterVector));\r\n            return;\r\n          }\r\n        }\r\n        scalar = -s * Math.SQRT2;\r\n        miterVector = new fabric.Point(\r\n          bisectorVector.x * scalar * strokeUniformScalar.x,\r\n          bisectorVector.y * scalar * strokeUniformScalar.y\r\n        );\r\n        coords.push(A.add(miterVector));\r\n        coords.push(A.subtract(miterVector));\r\n      });\r\n      return coords;\r\n    },\r\n\r\n    /**\r\n     * Apply transform t to point p\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param  {fabric.Point} p The point to transform\r\n     * @param  {Array} t The transform\r\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\r\n     * @return {fabric.Point} The transformed point\r\n     */\r\n    transformPoint: function(p, t, ignoreOffset) {\r\n      if (ignoreOffset) {\r\n        return new fabric.Point(\r\n          t[0] * p.x + t[2] * p.y,\r\n          t[1] * p.x + t[3] * p.y\r\n        );\r\n      }\r\n      return new fabric.Point(\r\n        t[0] * p.x + t[2] * p.y + t[4],\r\n        t[1] * p.x + t[3] * p.y + t[5]\r\n      );\r\n    },\r\n\r\n    /**\r\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\r\n     * @param {Array} points 4 points array\r\n     * @param {Array} [transform] an array of 6 numbers representing a 2x3 transform matrix\r\n     * @return {Object} Object with left, top, width, height properties\r\n     */\r\n    makeBoundingBoxFromPoints: function(points, transform) {\r\n      if (transform) {\r\n        for (var i = 0; i < points.length; i++) {\r\n          points[i] = fabric.util.transformPoint(points[i], transform);\r\n        }\r\n      }\r\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\r\n          minX = fabric.util.array.min(xPoints),\r\n          maxX = fabric.util.array.max(xPoints),\r\n          width = maxX - minX,\r\n          yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\r\n          minY = fabric.util.array.min(yPoints),\r\n          maxY = fabric.util.array.max(yPoints),\r\n          height = maxY - minY;\r\n\r\n      return {\r\n        left: minX,\r\n        top: minY,\r\n        width: width,\r\n        height: height\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Invert transformation t\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Array} t The transform\r\n     * @return {Array} The inverted transform\r\n     */\r\n    invertTransform: function(t) {\r\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\r\n          r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\r\n          o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\r\n      r[4] = -o.x;\r\n      r[5] = -o.y;\r\n      return r;\r\n    },\r\n\r\n    /**\r\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Number|String} number number to operate on\r\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\r\n     * @return {Number}\r\n     */\r\n    toFixed: function(number, fractionDigits) {\r\n      return parseFloat(Number(number).toFixed(fractionDigits));\r\n    },\r\n\r\n    /**\r\n     * Converts from attribute value to pixel value if applicable.\r\n     * Returns converted pixels or original value not converted.\r\n     * @param {Number|String} value number to operate on\r\n     * @param {Number} fontSize\r\n     * @return {Number|String}\r\n     */\r\n    parseUnit: function(value, fontSize) {\r\n      var unit = /\\D{0,2}$/.exec(value),\r\n          number = parseFloat(value);\r\n      if (!fontSize) {\r\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\r\n      }\r\n      switch (unit[0]) {\r\n        case 'mm':\r\n          return number * fabric.DPI / 25.4;\r\n\r\n        case 'cm':\r\n          return number * fabric.DPI / 2.54;\r\n\r\n        case 'in':\r\n          return number * fabric.DPI;\r\n\r\n        case 'pt':\r\n          return number * fabric.DPI / 72; // or * 4 / 3\r\n\r\n        case 'pc':\r\n          return number * fabric.DPI / 72 * 12; // or * 16\r\n\r\n        case 'em':\r\n          return number * fontSize;\r\n\r\n        default:\r\n          return number;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Function which always returns `false`.\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @return {Boolean}\r\n     */\r\n    falseFunction: function() {\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Returns klass \"Class\" object of given namespace\r\n     * @memberOf fabric.util\r\n     * @param {String} type Type of object (eg. 'circle')\r\n     * @param {String} namespace Namespace to get klass \"Class\" object from\r\n     * @return {Object} klass \"Class\"\r\n     */\r\n    getKlass: function(type, namespace) {\r\n      // capitalize first letter only\r\n      type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));\r\n      return fabric.util.resolveNamespace(namespace)[type];\r\n    },\r\n\r\n    /**\r\n     * Returns array of attributes for given svg that fabric parses\r\n     * @memberOf fabric.util\r\n     * @param {String} type Type of svg element (eg. 'circle')\r\n     * @return {Array} string names of supported attributes\r\n     */\r\n    getSvgAttributes: function(type) {\r\n      var attributes = [\r\n        'instantiated_by_use',\r\n        'style',\r\n        'id',\r\n        'class'\r\n      ];\r\n      switch (type) {\r\n        case 'linearGradient':\r\n          attributes = attributes.concat(['x1', 'y1', 'x2', 'y2', 'gradientUnits', 'gradientTransform']);\r\n          break;\r\n        case 'radialGradient':\r\n          attributes = attributes.concat(['gradientUnits', 'gradientTransform', 'cx', 'cy', 'r', 'fx', 'fy', 'fr']);\r\n          break;\r\n        case 'stop':\r\n          attributes = attributes.concat(['offset', 'stop-color', 'stop-opacity']);\r\n          break;\r\n      }\r\n      return attributes;\r\n    },\r\n\r\n    /**\r\n     * Returns object of given namespace\r\n     * @memberOf fabric.util\r\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\r\n     * @return {Object} Object for given namespace (default fabric)\r\n     */\r\n    resolveNamespace: function(namespace) {\r\n      if (!namespace) {\r\n        return fabric;\r\n      }\r\n\r\n      var parts = namespace.split('.'),\r\n          len = parts.length, i,\r\n          obj = global || fabric.window;\r\n\r\n      for (i = 0; i < len; ++i) {\r\n        obj = obj[parts[i]];\r\n      }\r\n\r\n      return obj;\r\n    },\r\n\r\n    /**\r\n     * Loads image element from given url and passes it to a callback\r\n     * @memberOf fabric.util\r\n     * @param {String} url URL representing an image\r\n     * @param {Function} callback Callback; invoked with loaded image\r\n     * @param {*} [context] Context to invoke callback in\r\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\r\n     */\r\n    loadImage: function(url, callback, context, crossOrigin) {\r\n      if (!url) {\r\n        callback && callback.call(context, url);\r\n        return;\r\n      }\r\n\r\n      var img = fabric.util.createImage();\r\n\r\n      /** @ignore */\r\n      var onLoadCallback = function () {\r\n        callback && callback.call(context, img, false);\r\n        img = img.onload = img.onerror = null;\r\n      };\r\n\r\n      img.onload = onLoadCallback;\r\n      /** @ignore */\r\n      img.onerror = function() {\r\n        fabric.log('Error loading ' + img.src);\r\n        callback && callback.call(context, null, true);\r\n        img = img.onload = img.onerror = null;\r\n      };\r\n\r\n      // data-urls appear to be buggy with crossOrigin\r\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\r\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\r\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\r\n      // crossOrigin null is the same as not set.\r\n      if (url.indexOf('data') !== 0 &&\r\n        crossOrigin !== undefined &&\r\n        crossOrigin !== null) {\r\n        img.crossOrigin = crossOrigin;\r\n      }\r\n\r\n      // IE10 / IE11-Fix: SVG contents from data: URI\r\n      // will only be available if the IMG is present\r\n      // in the DOM (and visible)\r\n      if (url.substring(0,14) === 'data:image/svg') {\r\n        img.onload = null;\r\n        fabric.util.loadImageInDom(img, onLoadCallback);\r\n      }\r\n\r\n      img.src = url;\r\n    },\r\n\r\n    /**\r\n     * Attaches SVG image with data: URL to the dom\r\n     * @memberOf fabric.util\r\n     * @param {Object} img Image object with data:image/svg src\r\n     * @param {Function} callback Callback; invoked with loaded image\r\n     * @return {Object} DOM element (div containing the SVG image)\r\n     */\r\n    loadImageInDom: function(img, onLoadCallback) {\r\n      var div = fabric.document.createElement('div');\r\n      div.style.width = div.style.height = '1px';\r\n      div.style.left = div.style.top = '-100%';\r\n      div.style.position = 'absolute';\r\n      div.appendChild(img);\r\n      fabric.document.querySelector('body').appendChild(div);\r\n      /**\r\n       * Wrap in function to:\r\n       *   1. Call existing callback\r\n       *   2. Cleanup DOM\r\n       */\r\n      img.onload = function () {\r\n        onLoadCallback();\r\n        div.parentNode.removeChild(div);\r\n        div = null;\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Creates corresponding fabric instances from their object representations\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Array} objects Objects to enliven\r\n     * @param {Function} callback Callback to invoke when all objects are created\r\n     * @param {String} namespace Namespace to get klass \"Class\" object from\r\n     * @param {Function} reviver Method for further parsing of object elements,\r\n     * called after each fabric object created.\r\n     */\r\n    enlivenObjects: function(objects, callback, namespace, reviver) {\r\n      objects = objects || [];\r\n\r\n      var enlivenedObjects = [],\r\n          numLoadedObjects = 0,\r\n          numTotalObjects = objects.length;\r\n\r\n      function onLoaded() {\r\n        if (++numLoadedObjects === numTotalObjects) {\r\n          callback && callback(enlivenedObjects.filter(function(obj) {\r\n            // filter out undefined objects (objects that gave error)\r\n            return obj;\r\n          }));\r\n        }\r\n      }\r\n\r\n      if (!numTotalObjects) {\r\n        callback && callback(enlivenedObjects);\r\n        return;\r\n      }\r\n\r\n      objects.forEach(function (o, index) {\r\n        // if sparse array\r\n        if (!o || !o.type) {\r\n          onLoaded();\r\n          return;\r\n        }\r\n        var klass = fabric.util.getKlass(o.type, namespace);\r\n        klass.fromObject(o, function (obj, error) {\r\n          error || (enlivenedObjects[index] = obj);\r\n          reviver && reviver(o, obj, error);\r\n          onLoaded();\r\n        });\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Creates corresponding fabric instances residing in an object, e.g. `clipPath`\r\n     * @see {@link fabric.Object.ENLIVEN_PROPS}\r\n     * @param {Object} object\r\n     * @param {Object} [context] assign enlived props to this object (pass null to skip this)\r\n     * @param {(objects:fabric.Object[]) => void} callback\r\n     */\r\n    enlivenObjectEnlivables: function (object, context, callback) {\r\n      var enlivenProps = fabric.Object.ENLIVEN_PROPS.filter(function (key) { return !!object[key]; });\r\n      fabric.util.enlivenObjects(enlivenProps.map(function (key) { return object[key]; }), function (enlivedProps) {\r\n        var objects = {};\r\n        enlivenProps.forEach(function (key, index) {\r\n          objects[key] = enlivedProps[index];\r\n          context && (context[key] = enlivedProps[index]);\r\n        });\r\n        callback && callback(objects);\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Create and wait for loading of patterns\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Array} patterns Objects to enliven\r\n     * @param {Function} callback Callback to invoke when all objects are created\r\n     * called after each fabric object created.\r\n     */\r\n    enlivenPatterns: function(patterns, callback) {\r\n      patterns = patterns || [];\r\n\r\n      function onLoaded() {\r\n        if (++numLoadedPatterns === numPatterns) {\r\n          callback && callback(enlivenedPatterns);\r\n        }\r\n      }\r\n\r\n      var enlivenedPatterns = [],\r\n          numLoadedPatterns = 0,\r\n          numPatterns = patterns.length;\r\n\r\n      if (!numPatterns) {\r\n        callback && callback(enlivenedPatterns);\r\n        return;\r\n      }\r\n\r\n      patterns.forEach(function (p, index) {\r\n        if (p && p.source) {\r\n          new fabric.Pattern(p, function(pattern) {\r\n            enlivenedPatterns[index] = pattern;\r\n            onLoaded();\r\n          });\r\n        }\r\n        else {\r\n          enlivenedPatterns[index] = p;\r\n          onLoaded();\r\n        }\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Groups SVG elements (usually those retrieved from SVG document)\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Array} elements SVG elements to group\r\n     * @param {Object} [options] Options object\r\n     * @param {String} path Value to set sourcePath to\r\n     * @return {fabric.Object|fabric.Group}\r\n     */\r\n    groupSVGElements: function(elements, options, path) {\r\n      var object;\r\n      if (elements && elements.length === 1) {\r\n        return elements[0];\r\n      }\r\n      if (options) {\r\n        if (options.width && options.height) {\r\n          options.centerPoint = {\r\n            x: options.width / 2,\r\n            y: options.height / 2\r\n          };\r\n        }\r\n        else {\r\n          delete options.width;\r\n          delete options.height;\r\n        }\r\n      }\r\n      object = new fabric.Group(elements, options);\r\n      if (typeof path !== 'undefined') {\r\n        object.sourcePath = path;\r\n      }\r\n      return object;\r\n    },\r\n\r\n    /**\r\n     * Populates an object with properties of another object\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param {Object} source Source object\r\n     * @param {Object} destination Destination object\r\n     * @return {Array} properties Properties names to include\r\n     */\r\n    populateWithProperties: function(source, destination, properties) {\r\n      if (properties && Array.isArray(properties)) {\r\n        for (var i = 0, len = properties.length; i < len; i++) {\r\n          if (properties[i] in source) {\r\n            destination[properties[i]] = source[properties[i]];\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Creates canvas element\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @return {CanvasElement} initialized canvas element\r\n     */\r\n    createCanvasElement: function() {\r\n      return fabric.document.createElement('canvas');\r\n    },\r\n\r\n    /**\r\n     * Creates a canvas element that is a copy of another and is also painted\r\n     * @param {CanvasElement} canvas to copy size and content of\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @return {CanvasElement} initialized canvas element\r\n     */\r\n    copyCanvasElement: function(canvas) {\r\n      var newCanvas = fabric.util.createCanvasElement();\r\n      newCanvas.width = canvas.width;\r\n      newCanvas.height = canvas.height;\r\n      newCanvas.getContext('2d').drawImage(canvas, 0, 0);\r\n      return newCanvas;\r\n    },\r\n\r\n    /**\r\n     * since 2.6.0 moved from canvas instance to utility.\r\n     * @param {CanvasElement} canvasEl to copy size and content of\r\n     * @param {String} format 'jpeg' or 'png', in some browsers 'webp' is ok too\r\n     * @param {Number} quality <= 1 and > 0\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @return {String} data url\r\n     */\r\n    toDataURL: function(canvasEl, format, quality) {\r\n      return canvasEl.toDataURL('image/' + format, quality);\r\n    },\r\n\r\n    /**\r\n     * Creates image element (works on client and node)\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @return {HTMLImageElement} HTML image element\r\n     */\r\n    createImage: function() {\r\n      return fabric.document.createElement('img');\r\n    },\r\n\r\n    /**\r\n     * Multiply matrix A by matrix B to nest transformations\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param  {Array} a First transformMatrix\r\n     * @param  {Array} b Second transformMatrix\r\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\r\n     * @return {Array} The product of the two transform matrices\r\n     */\r\n    multiplyTransformMatrices: function(a, b, is2x2) {\r\n      // Matrix multiply a * b\r\n      return [\r\n        a[0] * b[0] + a[2] * b[1],\r\n        a[1] * b[0] + a[3] * b[1],\r\n        a[0] * b[2] + a[2] * b[3],\r\n        a[1] * b[2] + a[3] * b[3],\r\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\r\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5]\r\n      ];\r\n    },\r\n\r\n    /**\r\n     * Decomposes standard 2x3 matrix into transform components\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param  {Array} a transformMatrix\r\n     * @return {Object} Components of transform\r\n     */\r\n    qrDecompose: function(a) {\r\n      var angle = atan2(a[1], a[0]),\r\n          denom = pow(a[0], 2) + pow(a[1], 2),\r\n          scaleX = sqrt(denom),\r\n          scaleY = (a[0] * a[3] - a[2] * a[1]) / scaleX,\r\n          skewX = atan2(a[0] * a[2] + a[1] * a [3], denom);\r\n      return {\r\n        angle: angle / PiBy180,\r\n        scaleX: scaleX,\r\n        scaleY: scaleY,\r\n        skewX: skewX / PiBy180,\r\n        skewY: 0,\r\n        translateX: a[4],\r\n        translateY: a[5]\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Returns a transform matrix starting from an object of the same kind of\r\n     * the one returned from qrDecompose, useful also if you want to calculate some\r\n     * transformations from an object that is not enlived yet\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param  {Object} options\r\n     * @param  {Number} [options.angle] angle in degrees\r\n     * @return {Number[]} transform matrix\r\n     */\r\n    calcRotateMatrix: function(options) {\r\n      if (!options.angle) {\r\n        return fabric.iMatrix.concat();\r\n      }\r\n      var theta = fabric.util.degreesToRadians(options.angle),\r\n          cos = fabric.util.cos(theta),\r\n          sin = fabric.util.sin(theta);\r\n      return [cos, sin, -sin, cos, 0, 0];\r\n    },\r\n\r\n    /**\r\n     * Returns a transform matrix starting from an object of the same kind of\r\n     * the one returned from qrDecompose, useful also if you want to calculate some\r\n     * transformations from an object that is not enlived yet.\r\n     * is called DimensionsTransformMatrix because those properties are the one that influence\r\n     * the size of the resulting box of the object.\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param  {Object} options\r\n     * @param  {Number} [options.scaleX]\r\n     * @param  {Number} [options.scaleY]\r\n     * @param  {Boolean} [options.flipX]\r\n     * @param  {Boolean} [options.flipY]\r\n     * @param  {Number} [options.skewX]\r\n     * @param  {Number} [options.skewY]\r\n     * @return {Number[]} transform matrix\r\n     */\r\n    calcDimensionsMatrix: function(options) {\r\n      var scaleX = typeof options.scaleX === 'undefined' ? 1 : options.scaleX,\r\n          scaleY = typeof options.scaleY === 'undefined' ? 1 : options.scaleY,\r\n          scaleMatrix = [\r\n            options.flipX ? -scaleX : scaleX,\r\n            0,\r\n            0,\r\n            options.flipY ? -scaleY : scaleY,\r\n            0,\r\n            0],\r\n          multiply = fabric.util.multiplyTransformMatrices,\r\n          degreesToRadians = fabric.util.degreesToRadians;\r\n      if (options.skewX) {\r\n        scaleMatrix = multiply(\r\n          scaleMatrix,\r\n          [1, 0, Math.tan(degreesToRadians(options.skewX)), 1],\r\n          true);\r\n      }\r\n      if (options.skewY) {\r\n        scaleMatrix = multiply(\r\n          scaleMatrix,\r\n          [1, Math.tan(degreesToRadians(options.skewY)), 0, 1],\r\n          true);\r\n      }\r\n      return scaleMatrix;\r\n    },\r\n\r\n    /**\r\n     * Returns a transform matrix starting from an object of the same kind of\r\n     * the one returned from qrDecompose, useful also if you want to calculate some\r\n     * transformations from an object that is not enlived yet\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param  {Object} options\r\n     * @param  {Number} [options.angle]\r\n     * @param  {Number} [options.scaleX]\r\n     * @param  {Number} [options.scaleY]\r\n     * @param  {Boolean} [options.flipX]\r\n     * @param  {Boolean} [options.flipY]\r\n     * @param  {Number} [options.skewX]\r\n     * @param  {Number} [options.skewX]\r\n     * @param  {Number} [options.translateX]\r\n     * @param  {Number} [options.translateY]\r\n     * @return {Number[]} transform matrix\r\n     */\r\n    composeMatrix: function(options) {\r\n      var matrix = [1, 0, 0, 1, options.translateX || 0, options.translateY || 0],\r\n          multiply = fabric.util.multiplyTransformMatrices;\r\n      if (options.angle) {\r\n        matrix = multiply(matrix, fabric.util.calcRotateMatrix(options));\r\n      }\r\n      if (options.scaleX !== 1 || options.scaleY !== 1 ||\r\n          options.skewX || options.skewY || options.flipX || options.flipY) {\r\n        matrix = multiply(matrix, fabric.util.calcDimensionsMatrix(options));\r\n      }\r\n      return matrix;\r\n    },\r\n\r\n    /**\r\n     * reset an object transform state to neutral. Top and left are not accounted for\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param  {fabric.Object} target object to transform\r\n     */\r\n    resetObjectTransform: function (target) {\r\n      target.scaleX = 1;\r\n      target.scaleY = 1;\r\n      target.skewX = 0;\r\n      target.skewY = 0;\r\n      target.flipX = false;\r\n      target.flipY = false;\r\n      target.rotate(0);\r\n    },\r\n\r\n    /**\r\n     * Extract Object transform values\r\n     * @static\r\n     * @memberOf fabric.util\r\n     * @param  {fabric.Object} target object to read from\r\n     * @return {Object} Components of transform\r\n     */\r\n    saveObjectTransform: function (target) {\r\n      return {\r\n        scaleX: target.scaleX,\r\n        scaleY: target.scaleY,\r\n        skewX: target.skewX,\r\n        skewY: target.skewY,\r\n        angle: target.angle,\r\n        left: target.left,\r\n        flipX: target.flipX,\r\n        flipY: target.flipY,\r\n        top: target.top\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Returns true if context has transparent pixel\r\n     * at specified location (taking tolerance into account)\r\n     * @param {CanvasRenderingContext2D} ctx context\r\n     * @param {Number} x x coordinate\r\n     * @param {Number} y y coordinate\r\n     * @param {Number} tolerance Tolerance\r\n     */\r\n    isTransparent: function(ctx, x, y, tolerance) {\r\n\r\n      // If tolerance is > 0 adjust start coords to take into account.\r\n      // If moves off Canvas fix to 0\r\n      if (tolerance > 0) {\r\n        if (x > tolerance) {\r\n          x -= tolerance;\r\n        }\r\n        else {\r\n          x = 0;\r\n        }\r\n        if (y > tolerance) {\r\n          y -= tolerance;\r\n        }\r\n        else {\r\n          y = 0;\r\n        }\r\n      }\r\n\r\n      var _isTransparent = true, i, temp,\r\n          imageData = ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1),\r\n          l = imageData.data.length;\r\n\r\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\r\n      for (i = 3; i < l; i += 4) {\r\n        temp = imageData.data[i];\r\n        _isTransparent = temp <= 0;\r\n        if (_isTransparent === false) {\r\n          break; // Stop if colour found\r\n        }\r\n      }\r\n\r\n      imageData = null;\r\n\r\n      return _isTransparent;\r\n    },\r\n\r\n    /**\r\n     * Parse preserveAspectRatio attribute from element\r\n     * @param {string} attribute to be parsed\r\n     * @return {Object} an object containing align and meetOrSlice attribute\r\n     */\r\n    parsePreserveAspectRatioAttribute: function(attribute) {\r\n      var meetOrSlice = 'meet', alignX = 'Mid', alignY = 'Mid',\r\n          aspectRatioAttrs = attribute.split(' '), align;\r\n\r\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\r\n        meetOrSlice = aspectRatioAttrs.pop();\r\n        if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {\r\n          align = meetOrSlice;\r\n          meetOrSlice = 'meet';\r\n        }\r\n        else if (aspectRatioAttrs.length) {\r\n          align = aspectRatioAttrs.pop();\r\n        }\r\n      }\r\n      //divide align in alignX and alignY\r\n      alignX = align !== 'none' ? align.slice(1, 4) : 'none';\r\n      alignY = align !== 'none' ? align.slice(5, 8) : 'none';\r\n      return {\r\n        meetOrSlice: meetOrSlice,\r\n        alignX: alignX,\r\n        alignY: alignY\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Clear char widths cache for the given font family or all the cache if no\r\n     * fontFamily is specified.\r\n     * Use it if you know you are loading fonts in a lazy way and you are not waiting\r\n     * for custom fonts to load properly when adding text objects to the canvas.\r\n     * If a text object is added when its own font is not loaded yet, you will get wrong\r\n     * measurement and so wrong bounding boxes.\r\n     * After the font cache is cleared, either change the textObject text content or call\r\n     * initDimensions() to trigger a recalculation\r\n     * @memberOf fabric.util\r\n     * @param {String} [fontFamily] font family to clear\r\n     */\r\n    clearFabricFontCache: function(fontFamily) {\r\n      fontFamily = (fontFamily || '').toLowerCase();\r\n      if (!fontFamily) {\r\n        fabric.charWidthsCache = { };\r\n      }\r\n      else if (fabric.charWidthsCache[fontFamily]) {\r\n        delete fabric.charWidthsCache[fontFamily];\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Given current aspect ratio, determines the max width and height that can\r\n     * respect the total allowed area for the cache.\r\n     * @memberOf fabric.util\r\n     * @param {Number} ar aspect ratio\r\n     * @param {Number} maximumArea Maximum area you want to achieve\r\n     * @return {Object.x} Limited dimensions by X\r\n     * @return {Object.y} Limited dimensions by Y\r\n     */\r\n    limitDimsByArea: function(ar, maximumArea) {\r\n      var roughWidth = Math.sqrt(maximumArea * ar),\r\n          perfLimitSizeY = Math.floor(maximumArea / roughWidth);\r\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\r\n    },\r\n\r\n    capValue: function(min, value, max) {\r\n      return Math.max(min, Math.min(value, max));\r\n    },\r\n\r\n    /**\r\n     * Finds the scale for the object source to fit inside the object destination,\r\n     * keeping aspect ratio intact.\r\n     * respect the total allowed area for the cache.\r\n     * @memberOf fabric.util\r\n     * @param {Object | fabric.Object} source\r\n     * @param {Number} source.height natural unscaled height of the object\r\n     * @param {Number} source.width natural unscaled width of the object\r\n     * @param {Object | fabric.Object} destination\r\n     * @param {Number} destination.height natural unscaled height of the object\r\n     * @param {Number} destination.width natural unscaled width of the object\r\n     * @return {Number} scale factor to apply to source to fit into destination\r\n     */\r\n    findScaleToFit: function(source, destination) {\r\n      return Math.min(destination.width / source.width, destination.height / source.height);\r\n    },\r\n\r\n    /**\r\n     * Finds the scale for the object source to cover entirely the object destination,\r\n     * keeping aspect ratio intact.\r\n     * respect the total allowed area for the cache.\r\n     * @memberOf fabric.util\r\n     * @param {Object | fabric.Object} source\r\n     * @param {Number} source.height natural unscaled height of the object\r\n     * @param {Number} source.width natural unscaled width of the object\r\n     * @param {Object | fabric.Object} destination\r\n     * @param {Number} destination.height natural unscaled height of the object\r\n     * @param {Number} destination.width natural unscaled width of the object\r\n     * @return {Number} scale factor to apply to source to cover destination\r\n     */\r\n    findScaleToCover: function(source, destination) {\r\n      return Math.max(destination.width / source.width, destination.height / source.height);\r\n    },\r\n\r\n    /**\r\n     * given an array of 6 number returns something like `\"matrix(...numbers)\"`\r\n     * @memberOf fabric.util\r\n     * @param {Array} transform an array with 6 numbers\r\n     * @return {String} transform matrix for svg\r\n     * @return {Object.y} Limited dimensions by Y\r\n     */\r\n    matrixToSVG: function(transform) {\r\n      return 'matrix(' + transform.map(function(value) {\r\n        return fabric.util.toFixed(value, fabric.Object.NUM_FRACTION_DIGITS);\r\n      }).join(' ') + ')';\r\n    },\r\n\r\n    /**\r\n     * given an object and a transform, apply the inverse transform to the object,\r\n     * this is equivalent to remove from that object that transformation, so that\r\n     * added in a space with the removed transform, the object will be the same as before.\r\n     * Removing from an object a transform that scale by 2 is like scaling it by 1/2.\r\n     * Removing from an object a transfrom that rotate by 30deg is like rotating by 30deg\r\n     * in the opposite direction.\r\n     * This util is used to add objects inside transformed groups or nested groups.\r\n     * @memberOf fabric.util\r\n     * @param {fabric.Object} object the object you want to transform\r\n     * @param {Array} transform the destination transform\r\n     */\r\n    removeTransformFromObject: function(object, transform) {\r\n      var inverted = fabric.util.invertTransform(transform),\r\n          finalTransform = fabric.util.multiplyTransformMatrices(inverted, object.calcOwnMatrix());\r\n      fabric.util.applyTransformToObject(object, finalTransform);\r\n    },\r\n\r\n    /**\r\n     * given an object and a transform, apply the transform to the object.\r\n     * this is equivalent to change the space where the object is drawn.\r\n     * Adding to an object a transform that scale by 2 is like scaling it by 2.\r\n     * This is used when removing an object from an active selection for example.\r\n     * @memberOf fabric.util\r\n     * @param {fabric.Object} object the object you want to transform\r\n     * @param {Array} transform the destination transform\r\n     */\r\n    addTransformToObject: function(object, transform) {\r\n      fabric.util.applyTransformToObject(\r\n        object,\r\n        fabric.util.multiplyTransformMatrices(transform, object.calcOwnMatrix())\r\n      );\r\n    },\r\n\r\n    /**\r\n     * discard an object transform state and apply the one from the matrix.\r\n     * @memberOf fabric.util\r\n     * @param {fabric.Object} object the object you want to transform\r\n     * @param {Array} transform the destination transform\r\n     */\r\n    applyTransformToObject: function(object, transform) {\r\n      var options = fabric.util.qrDecompose(transform),\r\n          center = new fabric.Point(options.translateX, options.translateY);\r\n      object.flipX = false;\r\n      object.flipY = false;\r\n      object.set('scaleX', options.scaleX);\r\n      object.set('scaleY', options.scaleY);\r\n      object.skewX = options.skewX;\r\n      object.skewY = options.skewY;\r\n      object.angle = options.angle;\r\n      object.setPositionByOrigin(center, 'center', 'center');\r\n    },\r\n\r\n    /**\r\n     * given a width and height, return the size of the bounding box\r\n     * that can contains the box with width/height with applied transform\r\n     * described in options.\r\n     * Use to calculate the boxes around objects for controls.\r\n     * @memberOf fabric.util\r\n     * @param {Number} width\r\n     * @param {Number} height\r\n     * @param {Object} options\r\n     * @param {Number} options.scaleX\r\n     * @param {Number} options.scaleY\r\n     * @param {Number} options.skewX\r\n     * @param {Number} options.skewY\r\n     * @return {Object.x} width of containing\r\n     * @return {Object.y} height of containing\r\n     */\r\n    sizeAfterTransform: function(width, height, options) {\r\n      var dimX = width / 2, dimY = height / 2,\r\n          points = [\r\n            {\r\n              x: -dimX,\r\n              y: -dimY\r\n            },\r\n            {\r\n              x: dimX,\r\n              y: -dimY\r\n            },\r\n            {\r\n              x: -dimX,\r\n              y: dimY\r\n            },\r\n            {\r\n              x: dimX,\r\n              y: dimY\r\n            }],\r\n          transformMatrix = fabric.util.calcDimensionsMatrix(options),\r\n          bbox = fabric.util.makeBoundingBoxFromPoints(points, transformMatrix);\r\n      return {\r\n        x: bbox.width,\r\n        y: bbox.height,\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Merges 2 clip paths into one visually equal clip path\r\n     *\r\n     * **IMPORTANT**:\\\r\n     * Does **NOT** clone the arguments, clone them proir if necessary.\r\n     *\r\n     * Creates a wrapper (group) that contains one clip path and is clipped by the other so content is kept where both overlap.\r\n     * Use this method if both the clip paths may have nested clip paths of their own, so assigning one to the other's clip path property is not possible.\r\n     *\r\n     * In order to handle the `inverted` property we follow logic described in the following cases:\\\r\n     * **(1)** both clip paths are inverted - the clip paths pass the inverted prop to the wrapper and loose it themselves.\\\r\n     * **(2)** one is inverted and the other isn't - the wrapper shouldn't become inverted and the inverted clip path must clip the non inverted one to produce an identical visual effect.\\\r\n     * **(3)** both clip paths are not inverted - wrapper and clip paths remain unchanged.\r\n     *\r\n     * @memberOf fabric.util\r\n     * @param {fabric.Object} c1\r\n     * @param {fabric.Object} c2\r\n     * @returns {fabric.Object} merged clip path\r\n     */\r\n    mergeClipPaths: function (c1, c2) {\r\n      var a = c1, b = c2;\r\n      if (a.inverted && !b.inverted) {\r\n        //  case (2)\r\n        a = c2;\r\n        b = c1;\r\n      }\r\n      //  `b` becomes `a`'s clip path so we transform `b` to `a` coordinate plane\r\n      fabric.util.applyTransformToObject(\r\n        b,\r\n        fabric.util.multiplyTransformMatrices(\r\n          fabric.util.invertTransform(a.calcTransformMatrix()),\r\n          b.calcTransformMatrix()\r\n        )\r\n      );\r\n      //  assign the `inverted` prop to the wrapping group\r\n      var inverted = a.inverted && b.inverted;\r\n      if (inverted) {\r\n        //  case (1)\r\n        a.inverted = b.inverted = false;\r\n      }\r\n      return new fabric.Group([a], { clipPath: b, inverted: inverted });\r\n    },\r\n  };\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function() {\r\n  var _join = Array.prototype.join,\r\n      commandLengths = {\r\n        m: 2,\r\n        l: 2,\r\n        h: 1,\r\n        v: 1,\r\n        c: 6,\r\n        s: 4,\r\n        q: 4,\r\n        t: 2,\r\n        a: 7\r\n      },\r\n      repeatedCommands = {\r\n        m: 'l',\r\n        M: 'L'\r\n      };\r\n  function segmentToBezier(th2, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY) {\r\n    var costh2 = fabric.util.cos(th2),\r\n        sinth2 = fabric.util.sin(th2),\r\n        costh3 = fabric.util.cos(th3),\r\n        sinth3 = fabric.util.sin(th3),\r\n        toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\r\n        toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\r\n        cp1X = fromX + mT * ( -cosTh * rx * sinth2 - sinTh * ry * costh2),\r\n        cp1Y = fromY + mT * ( -sinTh * rx * sinth2 + cosTh * ry * costh2),\r\n        cp2X = toX + mT * ( cosTh * rx * sinth3 + sinTh * ry * costh3),\r\n        cp2Y = toY + mT * ( sinTh * rx * sinth3 - cosTh * ry * costh3);\r\n\r\n    return ['C',\r\n      cp1X, cp1Y,\r\n      cp2X, cp2Y,\r\n      toX, toY\r\n    ];\r\n  }\r\n\r\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\r\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\r\n   * http://mozilla.org/MPL/2.0/\r\n   */\r\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\r\n    var PI = Math.PI, th = rotateX * PI / 180,\r\n        sinTh = fabric.util.sin(th),\r\n        cosTh = fabric.util.cos(th),\r\n        fromX = 0, fromY = 0;\r\n\r\n    rx = Math.abs(rx);\r\n    ry = Math.abs(ry);\r\n\r\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\r\n        py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\r\n        rx2 = rx * rx, ry2 = ry * ry, py2 = py * py, px2 = px * px,\r\n        pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\r\n        root = 0;\r\n\r\n    if (pl < 0) {\r\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\r\n      rx *= s;\r\n      ry *= s;\r\n    }\r\n    else {\r\n      root = (large === sweep ? -1.0 : 1.0) *\r\n              Math.sqrt( pl / (rx2 * py2 + ry2 * px2));\r\n    }\r\n\r\n    var cx = root * rx * py / ry,\r\n        cy = -root * ry * px / rx,\r\n        cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\r\n        cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\r\n        mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\r\n        dtheta = calcVectorAngle((px - cx) / rx, (py - cy) / ry, (-px - cx) / rx, (-py - cy) / ry);\r\n\r\n    if (sweep === 0 && dtheta > 0) {\r\n      dtheta -= 2 * PI;\r\n    }\r\n    else if (sweep === 1 && dtheta < 0) {\r\n      dtheta += 2 * PI;\r\n    }\r\n\r\n    // Convert into cubic bezier segments <= 90deg\r\n    var segments = Math.ceil(Math.abs(dtheta / PI * 2)),\r\n        result = [], mDelta = dtheta / segments,\r\n        mT = 8 / 3 * Math.sin(mDelta / 4) * Math.sin(mDelta / 4) / Math.sin(mDelta / 2),\r\n        th3 = mTheta + mDelta;\r\n\r\n    for (var i = 0; i < segments; i++) {\r\n      result[i] = segmentToBezier(mTheta, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY);\r\n      fromX = result[i][5];\r\n      fromY = result[i][6];\r\n      mTheta = th3;\r\n      th3 += mDelta;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /*\r\n   * Private\r\n   */\r\n  function calcVectorAngle(ux, uy, vx, vy) {\r\n    var ta = Math.atan2(uy, ux),\r\n        tb = Math.atan2(vy, vx);\r\n    if (tb >= ta) {\r\n      return tb - ta;\r\n    }\r\n    else {\r\n      return 2 * Math.PI - (ta - tb);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate bounding box of a beziercurve\r\n   * @param {Number} x0 starting point\r\n   * @param {Number} y0\r\n   * @param {Number} x1 first control point\r\n   * @param {Number} y1\r\n   * @param {Number} x2 secondo control point\r\n   * @param {Number} y2\r\n   * @param {Number} x3 end of bezier\r\n   * @param {Number} y3\r\n   */\r\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\r\n  // TODO: can we normalize this with the starting points set at 0 and then translated the bbox?\r\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\r\n    var argsString;\r\n    if (fabric.cachesBoundsOfCurve) {\r\n      argsString = _join.call(arguments);\r\n      if (fabric.boundsOfCurveCache[argsString]) {\r\n        return fabric.boundsOfCurveCache[argsString];\r\n      }\r\n    }\r\n\r\n    var sqrt = Math.sqrt,\r\n        min = Math.min, max = Math.max,\r\n        abs = Math.abs, tvalues = [],\r\n        bounds = [[], []],\r\n        a, b, c, t, t1, t2, b2ac, sqrtb2ac;\r\n\r\n    b = 6 * x0 - 12 * x1 + 6 * x2;\r\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\r\n    c = 3 * x1 - 3 * x0;\r\n\r\n    for (var i = 0; i < 2; ++i) {\r\n      if (i > 0) {\r\n        b = 6 * y0 - 12 * y1 + 6 * y2;\r\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\r\n        c = 3 * y1 - 3 * y0;\r\n      }\r\n\r\n      if (abs(a) < 1e-12) {\r\n        if (abs(b) < 1e-12) {\r\n          continue;\r\n        }\r\n        t = -c / b;\r\n        if (0 < t && t < 1) {\r\n          tvalues.push(t);\r\n        }\r\n        continue;\r\n      }\r\n      b2ac = b * b - 4 * c * a;\r\n      if (b2ac < 0) {\r\n        continue;\r\n      }\r\n      sqrtb2ac = sqrt(b2ac);\r\n      t1 = (-b + sqrtb2ac) / (2 * a);\r\n      if (0 < t1 && t1 < 1) {\r\n        tvalues.push(t1);\r\n      }\r\n      t2 = (-b - sqrtb2ac) / (2 * a);\r\n      if (0 < t2 && t2 < 1) {\r\n        tvalues.push(t2);\r\n      }\r\n    }\r\n\r\n    var x, y, j = tvalues.length, jlen = j, mt;\r\n    while (j--) {\r\n      t = tvalues[j];\r\n      mt = 1 - t;\r\n      x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\r\n      bounds[0][j] = x;\r\n\r\n      y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\r\n      bounds[1][j] = y;\r\n    }\r\n\r\n    bounds[0][jlen] = x0;\r\n    bounds[1][jlen] = y0;\r\n    bounds[0][jlen + 1] = x3;\r\n    bounds[1][jlen + 1] = y3;\r\n    var result = [\r\n      {\r\n        x: min.apply(null, bounds[0]),\r\n        y: min.apply(null, bounds[1])\r\n      },\r\n      {\r\n        x: max.apply(null, bounds[0]),\r\n        y: max.apply(null, bounds[1])\r\n      }\r\n    ];\r\n    if (fabric.cachesBoundsOfCurve) {\r\n      fabric.boundsOfCurveCache[argsString] = result;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Converts arc to a bunch of bezier curves\r\n   * @param {Number} fx starting point x\r\n   * @param {Number} fy starting point y\r\n   * @param {Array} coords Arc command\r\n   */\r\n  function fromArcToBeziers(fx, fy, coords) {\r\n    var rx = coords[1],\r\n        ry = coords[2],\r\n        rot = coords[3],\r\n        large = coords[4],\r\n        sweep = coords[5],\r\n        tx = coords[6],\r\n        ty = coords[7],\r\n        segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\r\n\r\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\r\n      segsNorm[i][1] += fx;\r\n      segsNorm[i][2] += fy;\r\n      segsNorm[i][3] += fx;\r\n      segsNorm[i][4] += fy;\r\n      segsNorm[i][5] += fx;\r\n      segsNorm[i][6] += fy;\r\n    }\r\n    return segsNorm;\r\n  };\r\n\r\n  /**\r\n   * This function take a parsed SVG path and make it simpler for fabricJS logic.\r\n   * simplification consist of: only UPPERCASE absolute commands ( relative converted to absolute )\r\n   * S converted in C, T converted in Q, A converted in C.\r\n   * @param {Array} path the array of commands of a parsed svg path for fabric.Path\r\n   * @return {Array} the simplified array of commands of a parsed svg path for fabric.Path\r\n   */\r\n  function makePathSimpler(path) {\r\n    // x and y represent the last point of the path. the previous command point.\r\n    // we add them to each relative command to make it an absolute comment.\r\n    // we also swap the v V h H with L, because are easier to transform.\r\n    var x = 0, y = 0, len = path.length,\r\n        // x1 and y1 represent the last point of the subpath. the subpath is started with\r\n        // m or M command. When a z or Z command is drawn, x and y need to be resetted to\r\n        // the last x1 and y1.\r\n        x1 = 0, y1 = 0, current, i, converted,\r\n        // previous will host the letter of the previous command, to handle S and T.\r\n        // controlX and controlY will host the previous reflected control point\r\n        destinationPath = [], previous, controlX, controlY;\r\n    for (i = 0; i < len; ++i) {\r\n      converted = false;\r\n      current = path[i].slice(0);\r\n      switch (current[0]) { // first letter\r\n        case 'l': // lineto, relative\r\n          current[0] = 'L';\r\n          current[1] += x;\r\n          current[2] += y;\r\n          // falls through\r\n        case 'L':\r\n          x = current[1];\r\n          y = current[2];\r\n          break;\r\n        case 'h': // horizontal lineto, relative\r\n          current[1] += x;\r\n          // falls through\r\n        case 'H':\r\n          current[0] = 'L';\r\n          current[2] = y;\r\n          x = current[1];\r\n          break;\r\n        case 'v': // vertical lineto, relative\r\n          current[1] += y;\r\n          // falls through\r\n        case 'V':\r\n          current[0] = 'L';\r\n          y = current[1];\r\n          current[1] = x;\r\n          current[2] = y;\r\n          break;\r\n        case 'm': // moveTo, relative\r\n          current[0] = 'M';\r\n          current[1] += x;\r\n          current[2] += y;\r\n          // falls through\r\n        case 'M':\r\n          x = current[1];\r\n          y = current[2];\r\n          x1 = current[1];\r\n          y1 = current[2];\r\n          break;\r\n        case 'c': // bezierCurveTo, relative\r\n          current[0] = 'C';\r\n          current[1] += x;\r\n          current[2] += y;\r\n          current[3] += x;\r\n          current[4] += y;\r\n          current[5] += x;\r\n          current[6] += y;\r\n          // falls through\r\n        case 'C':\r\n          controlX = current[3];\r\n          controlY = current[4];\r\n          x = current[5];\r\n          y = current[6];\r\n          break;\r\n        case 's': // shorthand cubic bezierCurveTo, relative\r\n          current[0] = 'S';\r\n          current[1] += x;\r\n          current[2] += y;\r\n          current[3] += x;\r\n          current[4] += y;\r\n          // falls through\r\n        case 'S':\r\n          // would be sScC but since we are swapping sSc for C, we check just that.\r\n          if (previous === 'C') {\r\n            // calculate reflection of previous control points\r\n            controlX = 2 * x - controlX;\r\n            controlY = 2 * y - controlY;\r\n          }\r\n          else {\r\n            // If there is no previous command or if the previous command was not a C, c, S, or s,\r\n            // the control point is coincident with the current point\r\n            controlX = x;\r\n            controlY = y;\r\n          }\r\n          x = current[3];\r\n          y = current[4];\r\n          current[0] = 'C';\r\n          current[5] = current[3];\r\n          current[6] = current[4];\r\n          current[3] = current[1];\r\n          current[4] = current[2];\r\n          current[1] = controlX;\r\n          current[2] = controlY;\r\n          // current[3] and current[4] are NOW the second control point.\r\n          // we keep it for the next reflection.\r\n          controlX = current[3];\r\n          controlY = current[4];\r\n          break;\r\n        case 'q': // quadraticCurveTo, relative\r\n          current[0] = 'Q';\r\n          current[1] += x;\r\n          current[2] += y;\r\n          current[3] += x;\r\n          current[4] += y;\r\n          // falls through\r\n        case 'Q':\r\n          controlX = current[1];\r\n          controlY = current[2];\r\n          x = current[3];\r\n          y = current[4];\r\n          break;\r\n        case 't': // shorthand quadraticCurveTo, relative\r\n          current[0] = 'T';\r\n          current[1] += x;\r\n          current[2] += y;\r\n          // falls through\r\n        case 'T':\r\n          if (previous === 'Q') {\r\n            // calculate reflection of previous control point\r\n            controlX = 2 * x - controlX;\r\n            controlY = 2 * y - controlY;\r\n          }\r\n          else {\r\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\r\n            // assume the control point is coincident with the current point\r\n            controlX = x;\r\n            controlY = y;\r\n          }\r\n          current[0] = 'Q';\r\n          x = current[1];\r\n          y = current[2];\r\n          current[1] = controlX;\r\n          current[2] = controlY;\r\n          current[3] = x;\r\n          current[4] = y;\r\n          break;\r\n        case 'a':\r\n          current[0] = 'A';\r\n          current[6] += x;\r\n          current[7] += y;\r\n          // falls through\r\n        case 'A':\r\n          converted = true;\r\n          destinationPath = destinationPath.concat(fromArcToBeziers(x, y, current));\r\n          x = current[6];\r\n          y = current[7];\r\n          break;\r\n        case 'z':\r\n        case 'Z':\r\n          x = x1;\r\n          y = y1;\r\n          break;\r\n        default:\r\n      }\r\n      if (!converted) {\r\n        destinationPath.push(current);\r\n      }\r\n      previous = current[0];\r\n    }\r\n    return destinationPath;\r\n  };\r\n\r\n  /**\r\n   * Calc length from point x1,y1 to x2,y2\r\n   * @param {Number} x1 starting point x\r\n   * @param {Number} y1 starting point y\r\n   * @param {Number} x2 starting point x\r\n   * @param {Number} y2 starting point y\r\n   * @return {Number} length of segment\r\n   */\r\n  function calcLineLength(x1, y1, x2, y2) {\r\n    return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\r\n  }\r\n\r\n  // functions for the Cubic beizer\r\n  // taken from: https://github.com/konvajs/konva/blob/7.0.5/src/shapes/Path.ts#L350\r\n  function CB1(t) {\r\n    return t * t * t;\r\n  }\r\n  function CB2(t) {\r\n    return 3 * t * t * (1 - t);\r\n  }\r\n  function CB3(t) {\r\n    return 3 * t * (1 - t) * (1 - t);\r\n  }\r\n  function CB4(t) {\r\n    return (1 - t) * (1 - t) * (1 - t);\r\n  }\r\n\r\n  function getPointOnCubicBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\r\n    return function(pct) {\r\n      var c1 = CB1(pct), c2 = CB2(pct), c3 = CB3(pct), c4 = CB4(pct);\r\n      return {\r\n        x: p4x * c1 + p3x * c2 + p2x * c3 + p1x * c4,\r\n        y: p4y * c1 + p3y * c2 + p2y * c3 + p1y * c4\r\n      };\r\n    };\r\n  }\r\n\r\n  function getTangentCubicIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\r\n    return function (pct) {\r\n      var invT = 1 - pct,\r\n          tangentX = (3 * invT * invT * (p2x - p1x)) + (6 * invT * pct * (p3x - p2x)) +\r\n          (3 * pct * pct * (p4x - p3x)),\r\n          tangentY = (3 * invT * invT * (p2y - p1y)) + (6 * invT * pct * (p3y - p2y)) +\r\n          (3 * pct * pct * (p4y - p3y));\r\n      return Math.atan2(tangentY, tangentX);\r\n    };\r\n  }\r\n\r\n  function QB1(t) {\r\n    return t * t;\r\n  }\r\n\r\n  function QB2(t) {\r\n    return 2 * t * (1 - t);\r\n  }\r\n\r\n  function QB3(t) {\r\n    return (1 - t) * (1 - t);\r\n  }\r\n\r\n  function getPointOnQuadraticBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\r\n    return function(pct) {\r\n      var c1 = QB1(pct), c2 = QB2(pct), c3 = QB3(pct);\r\n      return {\r\n        x: p3x * c1 + p2x * c2 + p1x * c3,\r\n        y: p3y * c1 + p2y * c2 + p1y * c3\r\n      };\r\n    };\r\n  }\r\n\r\n  function getTangentQuadraticIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\r\n    return function (pct) {\r\n      var invT = 1 - pct,\r\n          tangentX = (2 * invT * (p2x - p1x)) + (2 * pct * (p3x - p2x)),\r\n          tangentY = (2 * invT * (p2y - p1y)) + (2 * pct * (p3y - p2y));\r\n      return Math.atan2(tangentY, tangentX);\r\n    };\r\n  }\r\n\r\n\r\n  // this will run over a path segment ( a cubic or quadratic segment) and approximate it\r\n  // with 100 segemnts. This will good enough to calculate the length of the curve\r\n  function pathIterator(iterator, x1, y1) {\r\n    var tempP = { x: x1, y: y1 }, p, tmpLen = 0, perc;\r\n    for (perc = 1; perc <= 100; perc += 1) {\r\n      p = iterator(perc / 100);\r\n      tmpLen += calcLineLength(tempP.x, tempP.y, p.x, p.y);\r\n      tempP = p;\r\n    }\r\n    return tmpLen;\r\n  }\r\n\r\n  /**\r\n   * Given a pathInfo, and a distance in pixels, find the percentage from 0 to 1\r\n   * that correspond to that pixels run over the path.\r\n   * The percentage will be then used to find the correct point on the canvas for the path.\r\n   * @param {Array} segInfo fabricJS collection of information on a parsed path\r\n   * @param {Number} distance from starting point, in pixels.\r\n   * @return {Object} info object with x and y ( the point on canvas ) and angle, the tangent on that point;\r\n   */\r\n  function findPercentageForDistance(segInfo, distance) {\r\n    var perc = 0, tmpLen = 0, iterator = segInfo.iterator, tempP = { x: segInfo.x, y: segInfo.y },\r\n        p, nextLen, nextStep = 0.01, angleFinder = segInfo.angleFinder, lastPerc;\r\n    // nextStep > 0.0001 covers 0.00015625 that 1/64th of 1/100\r\n    // the path\r\n    while (tmpLen < distance && nextStep > 0.0001) {\r\n      p = iterator(perc);\r\n      lastPerc = perc;\r\n      nextLen = calcLineLength(tempP.x, tempP.y, p.x, p.y);\r\n      // compare tmpLen each cycle with distance, decide next perc to test.\r\n      if ((nextLen + tmpLen) > distance) {\r\n        // we discard this step and we make smaller steps.\r\n        perc -= nextStep;\r\n        nextStep /= 2;\r\n      }\r\n      else {\r\n        tempP = p;\r\n        perc += nextStep;\r\n        tmpLen += nextLen;\r\n      }\r\n    }\r\n    p.angle = angleFinder(lastPerc);\r\n    return p;\r\n  }\r\n\r\n  /**\r\n   * Run over a parsed and simplifed path and extrac some informations.\r\n   * informations are length of each command and starting point\r\n   * @param {Array} path fabricJS parsed path commands\r\n   * @return {Array} path commands informations\r\n   */\r\n  function getPathSegmentsInfo(path) {\r\n    var totalLength = 0, len = path.length, current,\r\n        //x2 and y2 are the coords of segment start\r\n        //x1 and y1 are the coords of the current point\r\n        x1 = 0, y1 = 0, x2 = 0, y2 = 0, info = [], iterator, tempInfo, angleFinder;\r\n    for (var i = 0; i < len; i++) {\r\n      current = path[i];\r\n      tempInfo = {\r\n        x: x1,\r\n        y: y1,\r\n        command: current[0],\r\n      };\r\n      switch (current[0]) { //first letter\r\n        case 'M':\r\n          tempInfo.length = 0;\r\n          x2 = x1 = current[1];\r\n          y2 = y1 = current[2];\r\n          break;\r\n        case 'L':\r\n          tempInfo.length = calcLineLength(x1, y1, current[1], current[2]);\r\n          x1 = current[1];\r\n          y1 = current[2];\r\n          break;\r\n        case 'C':\r\n          iterator = getPointOnCubicBezierIterator(\r\n            x1,\r\n            y1,\r\n            current[1],\r\n            current[2],\r\n            current[3],\r\n            current[4],\r\n            current[5],\r\n            current[6]\r\n          );\r\n          angleFinder = getTangentCubicIterator(\r\n            x1,\r\n            y1,\r\n            current[1],\r\n            current[2],\r\n            current[3],\r\n            current[4],\r\n            current[5],\r\n            current[6]\r\n          );\r\n          tempInfo.iterator = iterator;\r\n          tempInfo.angleFinder = angleFinder;\r\n          tempInfo.length = pathIterator(iterator, x1, y1);\r\n          x1 = current[5];\r\n          y1 = current[6];\r\n          break;\r\n        case 'Q':\r\n          iterator = getPointOnQuadraticBezierIterator(\r\n            x1,\r\n            y1,\r\n            current[1],\r\n            current[2],\r\n            current[3],\r\n            current[4]\r\n          );\r\n          angleFinder = getTangentQuadraticIterator(\r\n            x1,\r\n            y1,\r\n            current[1],\r\n            current[2],\r\n            current[3],\r\n            current[4]\r\n          );\r\n          tempInfo.iterator = iterator;\r\n          tempInfo.angleFinder = angleFinder;\r\n          tempInfo.length = pathIterator(iterator, x1, y1);\r\n          x1 = current[3];\r\n          y1 = current[4];\r\n          break;\r\n        case 'Z':\r\n        case 'z':\r\n          // we add those in order to ease calculations later\r\n          tempInfo.destX = x2;\r\n          tempInfo.destY = y2;\r\n          tempInfo.length = calcLineLength(x1, y1, x2, y2);\r\n          x1 = x2;\r\n          y1 = y2;\r\n          break;\r\n      }\r\n      totalLength += tempInfo.length;\r\n      info.push(tempInfo);\r\n    }\r\n    info.push({ length: totalLength, x: x1, y: y1 });\r\n    return info;\r\n  }\r\n\r\n  function getPointOnPath(path, distance, infos) {\r\n    if (!infos) {\r\n      infos = getPathSegmentsInfo(path);\r\n    }\r\n    var i = 0;\r\n    while ((distance - infos[i].length > 0) && i < (infos.length - 2)) {\r\n      distance -= infos[i].length;\r\n      i++;\r\n    }\r\n    // var distance = infos[infos.length - 1] * perc;\r\n    var segInfo = infos[i], segPercent = distance / segInfo.length,\r\n        command = segInfo.command, segment = path[i], info;\r\n\r\n    switch (command) {\r\n      case 'M':\r\n        return { x: segInfo.x, y: segInfo.y, angle: 0 };\r\n      case 'Z':\r\n      case 'z':\r\n        info = new fabric.Point(segInfo.x, segInfo.y).lerp(\r\n          new fabric.Point(segInfo.destX, segInfo.destY),\r\n          segPercent\r\n        );\r\n        info.angle = Math.atan2(segInfo.destY - segInfo.y, segInfo.destX - segInfo.x);\r\n        return info;\r\n      case 'L':\r\n        info = new fabric.Point(segInfo.x, segInfo.y).lerp(\r\n          new fabric.Point(segment[1], segment[2]),\r\n          segPercent\r\n        );\r\n        info.angle = Math.atan2(segment[2] - segInfo.y, segment[1] - segInfo.x);\r\n        return info;\r\n      case 'C':\r\n        return findPercentageForDistance(segInfo, distance);\r\n      case 'Q':\r\n        return findPercentageForDistance(segInfo, distance);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {string} pathString\r\n   * @return {(string|number)[][]} An array of SVG path commands\r\n   * @example <caption>Usage</caption>\r\n   * parsePath('M 3 4 Q 3 5 2 1 4 0 Q 9 12 2 1 4 0') === [\r\n   *   ['M', 3, 4],\r\n   *   ['Q', 3, 5, 2, 1, 4, 0],\r\n   *   ['Q', 9, 12, 2, 1, 4, 0],\r\n   * ];\r\n   *\r\n   */\r\n  function parsePath(pathString) {\r\n    var result = [],\r\n        coords = [],\r\n        currentPath,\r\n        parsed,\r\n        re = fabric.rePathCommand,\r\n        rNumber = '[-+]?(?:\\\\d*\\\\.\\\\d+|\\\\d+\\\\.?)(?:[eE][-+]?\\\\d+)?\\\\s*',\r\n        rNumberCommaWsp = '(' + rNumber + ')' + fabric.commaWsp,\r\n        rFlagCommaWsp = '([01])' + fabric.commaWsp + '?',\r\n        rArcSeq = rNumberCommaWsp + '?' + rNumberCommaWsp + '?' + rNumberCommaWsp + rFlagCommaWsp + rFlagCommaWsp +\r\n          rNumberCommaWsp + '?(' + rNumber + ')',\r\n        regArcArgumentSequence = new RegExp(rArcSeq, 'g'),\r\n        match,\r\n        coordsStr,\r\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\r\n        path;\r\n    if (!pathString || !pathString.match) {\r\n      return result;\r\n    }\r\n    path = pathString.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\r\n\r\n    for (var i = 0, coordsParsed, len = path.length; i < len; i++) {\r\n      currentPath = path[i];\r\n\r\n      coordsStr = currentPath.slice(1).trim();\r\n      coords.length = 0;\r\n\r\n      var command = currentPath.charAt(0);\r\n      coordsParsed = [command];\r\n\r\n      if (command.toLowerCase() === 'a') {\r\n        // arcs have special flags that apparently don't require spaces so handle special\r\n        for (var args; (args = regArcArgumentSequence.exec(coordsStr));) {\r\n          for (var j = 1; j < args.length; j++) {\r\n            coords.push(args[j]);\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        while ((match = re.exec(coordsStr))) {\r\n          coords.push(match[0]);\r\n        }\r\n      }\r\n\r\n      for (var j = 0, jlen = coords.length; j < jlen; j++) {\r\n        parsed = parseFloat(coords[j]);\r\n        if (!isNaN(parsed)) {\r\n          coordsParsed.push(parsed);\r\n        }\r\n      }\r\n\r\n      var commandLength = commandLengths[command.toLowerCase()],\r\n          repeatedCommand = repeatedCommands[command] || command;\r\n\r\n      if (coordsParsed.length - 1 > commandLength) {\r\n        for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {\r\n          result.push([command].concat(coordsParsed.slice(k, k + commandLength)));\r\n          command = repeatedCommand;\r\n        }\r\n      }\r\n      else {\r\n        result.push(coordsParsed);\r\n      }\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  /**\r\n   *\r\n   * Converts points to a smooth SVG path\r\n   * @param {{ x: number,y: number }[]} points Array of points\r\n   * @param {number} [correction] Apply a correction to the path (usually we use `width / 1000`). If value is undefined 0 is used as the correction value.\r\n   * @return {(string|number)[][]} An array of SVG path commands\r\n   */\r\n  function getSmoothPathFromPoints(points, correction) {\r\n    var path = [], i,\r\n        p1 = new fabric.Point(points[0].x, points[0].y),\r\n        p2 = new fabric.Point(points[1].x, points[1].y),\r\n        len = points.length, multSignX = 1, multSignY = 0, manyPoints = len > 2;\r\n    correction = correction || 0;\r\n\r\n    if (manyPoints) {\r\n      multSignX = points[2].x < p2.x ? -1 : points[2].x === p2.x ? 0 : 1;\r\n      multSignY = points[2].y < p2.y ? -1 : points[2].y === p2.y ? 0 : 1;\r\n    }\r\n    path.push(['M', p1.x - multSignX * correction, p1.y - multSignY * correction]);\r\n    for (i = 1; i < len; i++) {\r\n      if (!p1.eq(p2)) {\r\n        var midPoint = p1.midPointFrom(p2);\r\n        // p1 is our bezier control point\r\n        // midpoint is our endpoint\r\n        // start point is p(i-1) value.\r\n        path.push(['Q', p1.x, p1.y, midPoint.x, midPoint.y]);\r\n      }\r\n      p1 = points[i];\r\n      if ((i + 1) < points.length) {\r\n        p2 = points[i + 1];\r\n      }\r\n    }\r\n    if (manyPoints) {\r\n      multSignX = p1.x > points[i - 2].x ? 1 : p1.x === points[i - 2].x ? 0 : -1;\r\n      multSignY = p1.y > points[i - 2].y ? 1 : p1.y === points[i - 2].y ? 0 : -1;\r\n    }\r\n    path.push(['L', p1.x + multSignX * correction, p1.y + multSignY * correction]);\r\n    return path;\r\n  }\r\n  /**\r\n   * Transform a path by transforming each segment.\r\n   * it has to be a simplified path or it won't work.\r\n   * WARNING: this depends from pathOffset for correct operation\r\n   * @param {Array} path fabricJS parsed and simplified path commands\r\n   * @param {Array} transform matrix that represent the transformation\r\n   * @param {Object} [pathOffset] the fabric.Path pathOffset\r\n   * @param {Number} pathOffset.x\r\n   * @param {Number} pathOffset.y\r\n   * @returns {Array} the transformed path\r\n   */\r\n  function transformPath(path, transform, pathOffset) {\r\n    if (pathOffset) {\r\n      transform = fabric.util.multiplyTransformMatrices(\r\n        transform,\r\n        [1, 0, 0, 1, -pathOffset.x, -pathOffset.y]\r\n      );\r\n    }\r\n    return path.map(function(pathSegment) {\r\n      var newSegment = pathSegment.slice(0), point = {};\r\n      for (var i = 1; i < pathSegment.length - 1; i += 2) {\r\n        point.x = pathSegment[i];\r\n        point.y = pathSegment[i + 1];\r\n        point = fabric.util.transformPoint(point, transform);\r\n        newSegment[i] = point.x;\r\n        newSegment[i + 1] = point.y;\r\n      }\r\n      return newSegment;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Join path commands to go back to svg format\r\n   * @param {Array} pathData fabricJS parsed path commands\r\n   * @return {String} joined path 'M 0 0 L 20 30'\r\n   */\r\n  fabric.util.joinPath = function(pathData) {\r\n    return pathData.map(function (segment) { return segment.join(' '); }).join(' ');\r\n  };\r\n  fabric.util.parsePath = parsePath;\r\n  fabric.util.makePathSimpler = makePathSimpler;\r\n  fabric.util.getSmoothPathFromPoints = getSmoothPathFromPoints;\r\n  fabric.util.getPathSegmentsInfo = getPathSegmentsInfo;\r\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\r\n  fabric.util.getPointOnPath = getPointOnPath;\r\n  fabric.util.transformPath = transformPath;\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  var slice = Array.prototype.slice;\r\n\r\n  /**\r\n   * Invokes method on all items in a given array\r\n   * @memberOf fabric.util.array\r\n   * @param {Array} array Array to iterate over\r\n   * @param {String} method Name of a method to invoke\r\n   * @return {Array}\r\n   */\r\n  function invoke(array, method) {\r\n    var args = slice.call(arguments, 2), result = [];\r\n    for (var i = 0, len = array.length; i < len; i++) {\r\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Finds maximum value in array (not necessarily \"first\" one)\r\n   * @memberOf fabric.util.array\r\n   * @param {Array} array Array to iterate over\r\n   * @param {String} byProperty\r\n   * @return {*}\r\n   */\r\n  function max(array, byProperty) {\r\n    return find(array, byProperty, function(value1, value2) {\r\n      return value1 >= value2;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Finds minimum value in array (not necessarily \"first\" one)\r\n   * @memberOf fabric.util.array\r\n   * @param {Array} array Array to iterate over\r\n   * @param {String} byProperty\r\n   * @return {*}\r\n   */\r\n  function min(array, byProperty) {\r\n    return find(array, byProperty, function(value1, value2) {\r\n      return value1 < value2;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function fill(array, value) {\r\n    var k = array.length;\r\n    while (k--) {\r\n      array[k] = value;\r\n    }\r\n    return array;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function find(array, byProperty, condition) {\r\n    if (!array || array.length === 0) {\r\n      return;\r\n    }\r\n\r\n    var i = array.length - 1,\r\n        result = byProperty ? array[i][byProperty] : array[i];\r\n    if (byProperty) {\r\n      while (i--) {\r\n        if (condition(array[i][byProperty], result)) {\r\n          result = array[i][byProperty];\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      while (i--) {\r\n        if (condition(array[i], result)) {\r\n          result = array[i];\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @namespace fabric.util.array\r\n   */\r\n  fabric.util.array = {\r\n    fill: fill,\r\n    invoke: invoke,\r\n    min: min,\r\n    max: max\r\n  };\r\n\r\n})();\r\n\r\n\r\n(function() {\r\n  /**\r\n   * Copies all enumerable properties of one js object to another\r\n   * this does not and cannot compete with generic utils.\r\n   * Does not clone or extend fabric.Object subclasses.\r\n   * This is mostly for internal use and has extra handling for fabricJS objects\r\n   * it skips the canvas and group properties in deep cloning.\r\n   * @memberOf fabric.util.object\r\n   * @param {Object} destination Where to copy to\r\n   * @param {Object} source Where to copy from\r\n   * @param {Boolean} [deep] Whether to extend nested objects\r\n   * @return {Object}\r\n   */\r\n\r\n  function extend(destination, source, deep) {\r\n    // JScript DontEnum bug is not taken care of\r\n    // the deep clone is for internal use, is not meant to avoid\r\n    // javascript traps or cloning html element or self referenced objects.\r\n    if (deep) {\r\n      if (!fabric.isLikelyNode && source instanceof Element) {\r\n        // avoid cloning deep images, canvases,\r\n        destination = source;\r\n      }\r\n      else if (source instanceof Array) {\r\n        destination = [];\r\n        for (var i = 0, len = source.length; i < len; i++) {\r\n          destination[i] = extend({ }, source[i], deep);\r\n        }\r\n      }\r\n      else if (source && typeof source === 'object') {\r\n        for (var property in source) {\r\n          if (property === 'canvas' || property === 'group') {\r\n            // we do not want to clone this props at all.\r\n            // we want to keep the keys in the copy\r\n            destination[property] = null;\r\n          }\r\n          else if (source.hasOwnProperty(property)) {\r\n            destination[property] = extend({ }, source[property], deep);\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        // this sounds odd for an extend but is ok for recursive use\r\n        destination = source;\r\n      }\r\n    }\r\n    else {\r\n      for (var property in source) {\r\n        destination[property] = source[property];\r\n      }\r\n    }\r\n    return destination;\r\n  }\r\n\r\n  /**\r\n   * Creates an empty object and copies all enumerable properties of another object to it\r\n   * This method is mostly for internal use, and not intended for duplicating shapes in canvas. \r\n   * @memberOf fabric.util.object\r\n   * @param {Object} object Object to clone\r\n   * @param {Boolean} [deep] Whether to clone nested objects\r\n   * @return {Object}\r\n   */\r\n\r\n  //TODO: this function return an empty object if you try to clone null\r\n  function clone(object, deep) {\r\n    return extend({ }, object, deep);\r\n  }\r\n\r\n  /** @namespace fabric.util.object */\r\n  fabric.util.object = {\r\n    extend: extend,\r\n    clone: clone\r\n  };\r\n  fabric.util.object.extend(fabric.util, fabric.Observable);\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  /**\r\n   * Camelizes a string\r\n   * @memberOf fabric.util.string\r\n   * @param {String} string String to camelize\r\n   * @return {String} Camelized version of a string\r\n   */\r\n  function camelize(string) {\r\n    return string.replace(/-+(.)?/g, function(match, character) {\r\n      return character ? character.toUpperCase() : '';\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Capitalizes a string\r\n   * @memberOf fabric.util.string\r\n   * @param {String} string String to capitalize\r\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\r\n   * and other letters stay untouched, if false first letter is capitalized\r\n   * and other letters are converted to lowercase.\r\n   * @return {String} Capitalized version of a string\r\n   */\r\n  function capitalize(string, firstLetterOnly) {\r\n    return string.charAt(0).toUpperCase() +\r\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());\r\n  }\r\n\r\n  /**\r\n   * Escapes XML in a string\r\n   * @memberOf fabric.util.string\r\n   * @param {String} string String to escape\r\n   * @return {String} Escaped version of a string\r\n   */\r\n  function escapeXml(string) {\r\n    return string.replace(/&/g, '&amp;')\r\n      .replace(/\"/g, '&quot;')\r\n      .replace(/'/g, '&apos;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;');\r\n  }\r\n\r\n  /**\r\n   * Divide a string in the user perceived single units\r\n   * @memberOf fabric.util.string\r\n   * @param {String} textstring String to escape\r\n   * @return {Array} array containing the graphemes\r\n   */\r\n  function graphemeSplit(textstring) {\r\n    var i = 0, chr, graphemes = [];\r\n    for (i = 0, chr; i < textstring.length; i++) {\r\n      if ((chr = getWholeChar(textstring, i)) === false) {\r\n        continue;\r\n      }\r\n      graphemes.push(chr);\r\n    }\r\n    return graphemes;\r\n  }\r\n\r\n  // taken from mdn in the charAt doc page.\r\n  function getWholeChar(str, i) {\r\n    var code = str.charCodeAt(i);\r\n\r\n    if (isNaN(code)) {\r\n      return ''; // Position not found\r\n    }\r\n    if (code < 0xD800 || code > 0xDFFF) {\r\n      return str.charAt(i);\r\n    }\r\n\r\n    // High surrogate (could change last hex to 0xDB7F to treat high private\r\n    // surrogates as single characters)\r\n    if (0xD800 <= code && code <= 0xDBFF) {\r\n      if (str.length <= (i + 1)) {\r\n        throw 'High surrogate without following low surrogate';\r\n      }\r\n      var next = str.charCodeAt(i + 1);\r\n      if (0xDC00 > next || next > 0xDFFF) {\r\n        throw 'High surrogate without following low surrogate';\r\n      }\r\n      return str.charAt(i) + str.charAt(i + 1);\r\n    }\r\n    // Low surrogate (0xDC00 <= code && code <= 0xDFFF)\r\n    if (i === 0) {\r\n      throw 'Low surrogate without preceding high surrogate';\r\n    }\r\n    var prev = str.charCodeAt(i - 1);\r\n\r\n    // (could change last hex to 0xDB7F to treat high private\r\n    // surrogates as single characters)\r\n    if (0xD800 > prev || prev > 0xDBFF) {\r\n      throw 'Low surrogate without preceding high surrogate';\r\n    }\r\n    // We can pass over low surrogates now as the second component\r\n    // in a pair which we have already processed\r\n    return false;\r\n  }\r\n\r\n\r\n  /**\r\n   * String utilities\r\n   * @namespace fabric.util.string\r\n   */\r\n  fabric.util.string = {\r\n    camelize: camelize,\r\n    capitalize: capitalize,\r\n    escapeXml: escapeXml,\r\n    graphemeSplit: graphemeSplit\r\n  };\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  var slice = Array.prototype.slice, emptyFunction = function() { },\r\n\r\n      IS_DONTENUM_BUGGY = (function() {\r\n        for (var p in { toString: 1 }) {\r\n          if (p === 'toString') {\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      })(),\r\n\r\n      /** @ignore */\r\n      addMethods = function(klass, source, parent) {\r\n        for (var property in source) {\r\n\r\n          if (property in klass.prototype &&\r\n              typeof klass.prototype[property] === 'function' &&\r\n              (source[property] + '').indexOf('callSuper') > -1) {\r\n\r\n            klass.prototype[property] = (function(property) {\r\n              return function() {\r\n\r\n                var superclass = this.constructor.superclass;\r\n                this.constructor.superclass = parent;\r\n                var returnValue = source[property].apply(this, arguments);\r\n                this.constructor.superclass = superclass;\r\n\r\n                if (property !== 'initialize') {\r\n                  return returnValue;\r\n                }\r\n              };\r\n            })(property);\r\n          }\r\n          else {\r\n            klass.prototype[property] = source[property];\r\n          }\r\n\r\n          if (IS_DONTENUM_BUGGY) {\r\n            if (source.toString !== Object.prototype.toString) {\r\n              klass.prototype.toString = source.toString;\r\n            }\r\n            if (source.valueOf !== Object.prototype.valueOf) {\r\n              klass.prototype.valueOf = source.valueOf;\r\n            }\r\n          }\r\n        }\r\n      };\r\n\r\n  function Subclass() { }\r\n\r\n  function callSuper(methodName) {\r\n    var parentMethod = null,\r\n        _this = this;\r\n\r\n    // climb prototype chain to find method not equal to callee's method\r\n    while (_this.constructor.superclass) {\r\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\r\n      if (_this[methodName] !== superClassMethod) {\r\n        parentMethod = superClassMethod;\r\n        break;\r\n      }\r\n      // eslint-disable-next-line\r\n      _this = _this.constructor.superclass.prototype;\r\n    }\r\n\r\n    if (!parentMethod) {\r\n      return console.log('tried to callSuper ' + methodName + ', method not found in prototype chain', this);\r\n    }\r\n\r\n    return (arguments.length > 1)\r\n      ? parentMethod.apply(this, slice.call(arguments, 1))\r\n      : parentMethod.call(this);\r\n  }\r\n\r\n  /**\r\n   * Helper for creation of \"classes\".\r\n   * @memberOf fabric.util\r\n   * @param {Function} [parent] optional \"Class\" to inherit from\r\n   * @param {Object} [properties] Properties shared by all instances of this class\r\n   *                  (be careful modifying objects defined here as this would affect all instances)\r\n   */\r\n  function createClass() {\r\n    var parent = null,\r\n        properties = slice.call(arguments, 0);\r\n\r\n    if (typeof properties[0] === 'function') {\r\n      parent = properties.shift();\r\n    }\r\n    function klass() {\r\n      this.initialize.apply(this, arguments);\r\n    }\r\n\r\n    klass.superclass = parent;\r\n    klass.subclasses = [];\r\n\r\n    if (parent) {\r\n      Subclass.prototype = parent.prototype;\r\n      klass.prototype = new Subclass();\r\n      parent.subclasses.push(klass);\r\n    }\r\n    for (var i = 0, length = properties.length; i < length; i++) {\r\n      addMethods(klass, properties[i], parent);\r\n    }\r\n    if (!klass.prototype.initialize) {\r\n      klass.prototype.initialize = emptyFunction;\r\n    }\r\n    klass.prototype.constructor = klass;\r\n    klass.prototype.callSuper = callSuper;\r\n    return klass;\r\n  }\r\n\r\n  fabric.util.createClass = createClass;\r\n})();\r\n\r\n\r\n(function () {\r\n  // since ie11 can use addEventListener but they do not support options, i need to check\r\n  var couldUseAttachEvent = !!fabric.document.createElement('div').attachEvent,\r\n      touchEvents = ['touchstart', 'touchmove', 'touchend'];\r\n  /**\r\n   * Adds an event listener to an element\r\n   * @function\r\n   * @memberOf fabric.util\r\n   * @param {HTMLElement} element\r\n   * @param {String} eventName\r\n   * @param {Function} handler\r\n   */\r\n  fabric.util.addListener = function(element, eventName, handler, options) {\r\n    element && element.addEventListener(eventName, handler, couldUseAttachEvent ? false : options);\r\n  };\r\n\r\n  /**\r\n   * Removes an event listener from an element\r\n   * @function\r\n   * @memberOf fabric.util\r\n   * @param {HTMLElement} element\r\n   * @param {String} eventName\r\n   * @param {Function} handler\r\n   */\r\n  fabric.util.removeListener = function(element, eventName, handler, options) {\r\n    element && element.removeEventListener(eventName, handler, couldUseAttachEvent ? false : options);\r\n  };\r\n\r\n  function getTouchInfo(event) {\r\n    var touchProp = event.changedTouches;\r\n    if (touchProp && touchProp[0]) {\r\n      return touchProp[0];\r\n    }\r\n    return event;\r\n  }\r\n\r\n  fabric.util.getPointer = function(event) {\r\n    var element = event.target,\r\n        scroll = fabric.util.getScrollLeftTop(element),\r\n        _evt = getTouchInfo(event);\r\n    return {\r\n      x: _evt.clientX + scroll.left,\r\n      y: _evt.clientY + scroll.top\r\n    };\r\n  };\r\n\r\n  fabric.util.isTouchEvent = function(event) {\r\n    return touchEvents.indexOf(event.type) > -1 || event.pointerType === 'touch';\r\n  };\r\n})();\r\n\r\n\r\n(function () {\r\n\r\n  /**\r\n   * Cross-browser wrapper for setting element's style\r\n   * @memberOf fabric.util\r\n   * @param {HTMLElement} element\r\n   * @param {Object} styles\r\n   * @return {HTMLElement} Element that was passed as a first argument\r\n   */\r\n  function setStyle(element, styles) {\r\n    var elementStyle = element.style;\r\n    if (!elementStyle) {\r\n      return element;\r\n    }\r\n    if (typeof styles === 'string') {\r\n      element.style.cssText += ';' + styles;\r\n      return styles.indexOf('opacity') > -1\r\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\r\n        : element;\r\n    }\r\n    for (var property in styles) {\r\n      if (property === 'opacity') {\r\n        setOpacity(element, styles[property]);\r\n      }\r\n      else {\r\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\r\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\r\n          : property;\r\n        elementStyle[normalizedProperty] = styles[property];\r\n      }\r\n    }\r\n    return element;\r\n  }\r\n\r\n  var parseEl = fabric.document.createElement('div'),\r\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\r\n      supportsFilters = typeof parseEl.style.filter === 'string',\r\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\r\n\r\n      /** @ignore */\r\n      setOpacity = function (element) { return element; };\r\n\r\n  if (supportsOpacity) {\r\n    /** @ignore */\r\n    setOpacity = function(element, value) {\r\n      element.style.opacity = value;\r\n      return element;\r\n    };\r\n  }\r\n  else if (supportsFilters) {\r\n    /** @ignore */\r\n    setOpacity = function(element, value) {\r\n      var es = element.style;\r\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\r\n        es.zoom = 1;\r\n      }\r\n      if (reOpacity.test(es.filter)) {\r\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\r\n        es.filter = es.filter.replace(reOpacity, value);\r\n      }\r\n      else {\r\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\r\n      }\r\n      return element;\r\n    };\r\n  }\r\n\r\n  fabric.util.setStyle = setStyle;\r\n\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  var _slice = Array.prototype.slice;\r\n\r\n  /**\r\n   * Takes id and returns an element with that id (if one exists in a document)\r\n   * @memberOf fabric.util\r\n   * @param {String|HTMLElement} id\r\n   * @return {HTMLElement|null}\r\n   */\r\n  function getById(id) {\r\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\r\n  }\r\n\r\n  var sliceCanConvertNodelists,\r\n      /**\r\n       * Converts an array-like object (e.g. arguments or NodeList) to an array\r\n       * @memberOf fabric.util\r\n       * @param {Object} arrayLike\r\n       * @return {Array}\r\n       */\r\n      toArray = function(arrayLike) {\r\n        return _slice.call(arrayLike, 0);\r\n      };\r\n\r\n  try {\r\n    sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\r\n  }\r\n  catch (err) { }\r\n\r\n  if (!sliceCanConvertNodelists) {\r\n    toArray = function(arrayLike) {\r\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\r\n      while (i--) {\r\n        arr[i] = arrayLike[i];\r\n      }\r\n      return arr;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Creates specified element with specified attributes\r\n   * @memberOf fabric.util\r\n   * @param {String} tagName Type of an element to create\r\n   * @param {Object} [attributes] Attributes to set on an element\r\n   * @return {HTMLElement} Newly created element\r\n   */\r\n  function makeElement(tagName, attributes) {\r\n    var el = fabric.document.createElement(tagName);\r\n    for (var prop in attributes) {\r\n      if (prop === 'class') {\r\n        el.className = attributes[prop];\r\n      }\r\n      else if (prop === 'for') {\r\n        el.htmlFor = attributes[prop];\r\n      }\r\n      else {\r\n        el.setAttribute(prop, attributes[prop]);\r\n      }\r\n    }\r\n    return el;\r\n  }\r\n\r\n  /**\r\n   * Adds class to an element\r\n   * @memberOf fabric.util\r\n   * @param {HTMLElement} element Element to add class to\r\n   * @param {String} className Class to add to an element\r\n   */\r\n  function addClass(element, className) {\r\n    if (element && (' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\r\n      element.className += (element.className ? ' ' : '') + className;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Wraps element with another element\r\n   * @memberOf fabric.util\r\n   * @param {HTMLElement} element Element to wrap\r\n   * @param {HTMLElement|String} wrapper Element to wrap with\r\n   * @param {Object} [attributes] Attributes to set on a wrapper\r\n   * @return {HTMLElement} wrapper\r\n   */\r\n  function wrapElement(element, wrapper, attributes) {\r\n    if (typeof wrapper === 'string') {\r\n      wrapper = makeElement(wrapper, attributes);\r\n    }\r\n    if (element.parentNode) {\r\n      element.parentNode.replaceChild(wrapper, element);\r\n    }\r\n    wrapper.appendChild(element);\r\n    return wrapper;\r\n  }\r\n\r\n  /**\r\n   * Returns element scroll offsets\r\n   * @memberOf fabric.util\r\n   * @param {HTMLElement} element Element to operate on\r\n   * @return {Object} Object with left/top values\r\n   */\r\n  function getScrollLeftTop(element) {\r\n\r\n    var left = 0,\r\n        top = 0,\r\n        docElement = fabric.document.documentElement,\r\n        body = fabric.document.body || {\r\n          scrollLeft: 0, scrollTop: 0\r\n        };\r\n\r\n    // While loop checks (and then sets element to) .parentNode OR .host\r\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\r\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\r\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\r\n    while (element && (element.parentNode || element.host)) {\r\n\r\n      // Set element to element parent, or 'host' in case of ShadowDOM\r\n      element = element.parentNode || element.host;\r\n\r\n      if (element === fabric.document) {\r\n        left = body.scrollLeft || docElement.scrollLeft || 0;\r\n        top = body.scrollTop ||  docElement.scrollTop || 0;\r\n      }\r\n      else {\r\n        left += element.scrollLeft || 0;\r\n        top += element.scrollTop || 0;\r\n      }\r\n\r\n      if (element.nodeType === 1 && element.style.position === 'fixed') {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return { left: left, top: top };\r\n  }\r\n\r\n  /**\r\n   * Returns offset for a given element\r\n   * @function\r\n   * @memberOf fabric.util\r\n   * @param {HTMLElement} element Element to get offset for\r\n   * @return {Object} Object with \"left\" and \"top\" properties\r\n   */\r\n  function getElementOffset(element) {\r\n    var docElem,\r\n        doc = element && element.ownerDocument,\r\n        box = { left: 0, top: 0 },\r\n        offset = { left: 0, top: 0 },\r\n        scrollLeftTop,\r\n        offsetAttributes = {\r\n          borderLeftWidth: 'left',\r\n          borderTopWidth:  'top',\r\n          paddingLeft:     'left',\r\n          paddingTop:      'top'\r\n        };\r\n\r\n    if (!doc) {\r\n      return offset;\r\n    }\r\n\r\n    for (var attr in offsetAttributes) {\r\n      offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;\r\n    }\r\n\r\n    docElem = doc.documentElement;\r\n    if ( typeof element.getBoundingClientRect !== 'undefined' ) {\r\n      box = element.getBoundingClientRect();\r\n    }\r\n\r\n    scrollLeftTop = getScrollLeftTop(element);\r\n\r\n    return {\r\n      left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\r\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Returns style attribute value of a given element\r\n   * @memberOf fabric.util\r\n   * @param {HTMLElement} element Element to get style attribute for\r\n   * @param {String} attr Style attribute to get for element\r\n   * @return {String} Style attribute value of the given element.\r\n   */\r\n  var getElementStyle;\r\n  if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {\r\n    getElementStyle = function(element, attr) {\r\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\r\n      return style ? style[attr] : undefined;\r\n    };\r\n  }\r\n  else {\r\n    getElementStyle = function(element, attr) {\r\n      var value = element.style[attr];\r\n      if (!value && element.currentStyle) {\r\n        value = element.currentStyle[attr];\r\n      }\r\n      return value;\r\n    };\r\n  }\r\n\r\n  (function () {\r\n    var style = fabric.document.documentElement.style,\r\n        selectProp = 'userSelect' in style\r\n          ? 'userSelect'\r\n          : 'MozUserSelect' in style\r\n            ? 'MozUserSelect'\r\n            : 'WebkitUserSelect' in style\r\n              ? 'WebkitUserSelect'\r\n              : 'KhtmlUserSelect' in style\r\n                ? 'KhtmlUserSelect'\r\n                : '';\r\n\r\n    /**\r\n     * Makes element unselectable\r\n     * @memberOf fabric.util\r\n     * @param {HTMLElement} element Element to make unselectable\r\n     * @return {HTMLElement} Element that was passed in\r\n     */\r\n    function makeElementUnselectable(element) {\r\n      if (typeof element.onselectstart !== 'undefined') {\r\n        element.onselectstart = fabric.util.falseFunction;\r\n      }\r\n      if (selectProp) {\r\n        element.style[selectProp] = 'none';\r\n      }\r\n      else if (typeof element.unselectable === 'string') {\r\n        element.unselectable = 'on';\r\n      }\r\n      return element;\r\n    }\r\n\r\n    /**\r\n     * Makes element selectable\r\n     * @memberOf fabric.util\r\n     * @param {HTMLElement} element Element to make selectable\r\n     * @return {HTMLElement} Element that was passed in\r\n     */\r\n    function makeElementSelectable(element) {\r\n      if (typeof element.onselectstart !== 'undefined') {\r\n        element.onselectstart = null;\r\n      }\r\n      if (selectProp) {\r\n        element.style[selectProp] = '';\r\n      }\r\n      else if (typeof element.unselectable === 'string') {\r\n        element.unselectable = '';\r\n      }\r\n      return element;\r\n    }\r\n\r\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\r\n    fabric.util.makeElementSelectable = makeElementSelectable;\r\n  })();\r\n\r\n  function getNodeCanvas(element) {\r\n    var impl = fabric.jsdomImplForWrapper(element);\r\n    return impl._canvas || impl._image;\r\n  };\r\n\r\n  function cleanUpJsdomNode(element) {\r\n    if (!fabric.isLikelyNode) {\r\n      return;\r\n    }\r\n    var impl = fabric.jsdomImplForWrapper(element);\r\n    if (impl) {\r\n      impl._image = null;\r\n      impl._canvas = null;\r\n      // unsure if necessary\r\n      impl._currentSrc = null;\r\n      impl._attributes = null;\r\n      impl._classList = null;\r\n    }\r\n  }\r\n\r\n  function setImageSmoothing(ctx, value) {\r\n    ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled\r\n      || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;\r\n    ctx.imageSmoothingEnabled = value;\r\n  }\r\n\r\n  /**\r\n   * setImageSmoothing sets the context imageSmoothingEnabled property.\r\n   * Used by canvas and by ImageObject.\r\n   * @memberOf fabric.util\r\n   * @since 4.0.0\r\n   * @param {HTMLRenderingContext2D} ctx to set on\r\n   * @param {Boolean} value true or false\r\n   */\r\n  fabric.util.setImageSmoothing = setImageSmoothing;\r\n  fabric.util.getById = getById;\r\n  fabric.util.toArray = toArray;\r\n  fabric.util.addClass = addClass;\r\n  fabric.util.makeElement = makeElement;\r\n  fabric.util.wrapElement = wrapElement;\r\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\r\n  fabric.util.getElementOffset = getElementOffset;\r\n  fabric.util.getNodeCanvas = getNodeCanvas;\r\n  fabric.util.cleanUpJsdomNode = cleanUpJsdomNode;\r\n\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  function addParamToUrl(url, param) {\r\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\r\n  }\r\n\r\n  function emptyFn() { }\r\n\r\n  /**\r\n   * Cross-browser abstraction for sending XMLHttpRequest\r\n   * @memberOf fabric.util\r\n   * @param {String} url URL to send XMLHttpRequest to\r\n   * @param {Object} [options] Options object\r\n   * @param {String} [options.method=\"GET\"]\r\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\r\n   * @param {String} [options.body] body to send with POST or PUT request\r\n   * @param {Function} options.onComplete Callback to invoke when request is completed\r\n   * @return {XMLHttpRequest} request\r\n   */\r\n  function request(url, options) {\r\n    options || (options = { });\r\n\r\n    var method = options.method ? options.method.toUpperCase() : 'GET',\r\n        onComplete = options.onComplete || function() { },\r\n        xhr = new fabric.window.XMLHttpRequest(),\r\n        body = options.body || options.parameters;\r\n\r\n    /** @ignore */\r\n    xhr.onreadystatechange = function() {\r\n      if (xhr.readyState === 4) {\r\n        onComplete(xhr);\r\n        xhr.onreadystatechange = emptyFn;\r\n      }\r\n    };\r\n\r\n    if (method === 'GET') {\r\n      body = null;\r\n      if (typeof options.parameters === 'string') {\r\n        url = addParamToUrl(url, options.parameters);\r\n      }\r\n    }\r\n\r\n    xhr.open(method, url, true);\r\n\r\n    if (method === 'POST' || method === 'PUT') {\r\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n    }\r\n\r\n    xhr.send(body);\r\n    return xhr;\r\n  }\r\n\r\n  fabric.util.request = request;\r\n})();\r\n\r\n\r\n/**\r\n * Wrapper around `console.log` (when available)\r\n * @param {*} [values] Values to log\r\n */\r\nfabric.log = console.log;\r\n\r\n/**\r\n * Wrapper around `console.warn` (when available)\r\n * @param {*} [values] Values to log as a warning\r\n */\r\nfabric.warn = console.warn;\r\n\r\n\r\n(function () {\r\n\r\n  var extend = fabric.util.object.extend,\r\n      clone = fabric.util.object.clone;\r\n\r\n  /**\r\n   * @typedef {Object} AnimationOptions\r\n   * Animation of a value or list of values.\r\n   * When using lists, think of something like this:\r\n   * fabric.util.animate({\r\n   *   startValue: [1, 2, 3],\r\n   *   endValue: [2, 4, 6],\r\n   *   onChange: function([a, b, c]) {\r\n   *     canvas.zoomToPoint({x: b, y: c}, a)\r\n   *     canvas.renderAll()\r\n   *   }\r\n   * });\r\n   * @example\r\n   * @property {Function} [onChange] Callback; invoked on every value change\r\n   * @property {Function} [onComplete] Callback; invoked when value change is completed\r\n   * @example\r\n   * // Note: startValue, endValue, and byValue must match the type\r\n   * var animationOptions = { startValue: 0, endValue: 1, byValue: 0.25 }\r\n   * var animationOptions = { startValue: [0, 1], endValue: [1, 2], byValue: [0.25, 0.25] }\r\n   * @property {number | number[]} [startValue=0] Starting value\r\n   * @property {number | number[]} [endValue=100] Ending value\r\n   * @property {number | number[]} [byValue=100] Value to modify the property by\r\n   * @property {Function} [easing] Easing function\r\n   * @property {Number} [duration=500] Duration of change (in ms)\r\n   * @property {Function} [abort] Additional function with logic. If returns true, animation aborts.\r\n   *\r\n   * @typedef {() => void} CancelFunction\r\n   *\r\n   * @typedef {Object} AnimationCurrentState\r\n   * @property {number | number[]} currentValue value in range [`startValue`, `endValue`]\r\n   * @property {number} completionRate value in range [0, 1]\r\n   * @property {number} durationRate value in range [0, 1]\r\n   *\r\n   * @typedef {(AnimationOptions & AnimationCurrentState & { cancel: CancelFunction }} AnimationContext\r\n   */\r\n\r\n  /**\r\n   * Array holding all running animations\r\n   * @memberof fabric\r\n   * @type {AnimationContext[]}\r\n   */\r\n  var RUNNING_ANIMATIONS = [];\r\n  fabric.util.object.extend(RUNNING_ANIMATIONS, {\r\n\r\n    /**\r\n     * cancel all running animations at the next requestAnimFrame\r\n     * @returns {AnimationContext[]}\r\n     */\r\n    cancelAll: function () {\r\n      var animations = this.splice(0);\r\n      animations.forEach(function (animation) {\r\n        animation.cancel();\r\n      });\r\n      return animations;\r\n    },\r\n\r\n    /**\r\n     * cancel all running animations attached to canvas at the next requestAnimFrame\r\n     * @param {fabric.Canvas} canvas\r\n     * @returns {AnimationContext[]}\r\n     */\r\n    cancelByCanvas: function (canvas) {\r\n      if (!canvas) {\r\n        return [];\r\n      }\r\n      var cancelled = this.filter(function (animation) {\r\n        return typeof animation.target === 'object' && animation.target.canvas === canvas;\r\n      });\r\n      cancelled.forEach(function (animation) {\r\n        animation.cancel();\r\n      });\r\n      return cancelled;\r\n    },\r\n\r\n    /**\r\n     * cancel all running animations for target at the next requestAnimFrame\r\n     * @param {*} target\r\n     * @returns {AnimationContext[]}\r\n     */\r\n    cancelByTarget: function (target) {\r\n      var cancelled = this.findAnimationsByTarget(target);\r\n      cancelled.forEach(function (animation) {\r\n        animation.cancel();\r\n      });\r\n      return cancelled;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param {CancelFunction} cancelFunc the function returned by animate\r\n     * @returns {number}\r\n     */\r\n    findAnimationIndex: function (cancelFunc) {\r\n      return this.indexOf(this.findAnimation(cancelFunc));\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param {CancelFunction} cancelFunc the function returned by animate\r\n     * @returns {AnimationContext | undefined} animation's options object\r\n     */\r\n    findAnimation: function (cancelFunc) {\r\n      return this.find(function (animation) {\r\n        return animation.cancel === cancelFunc;\r\n      });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param {*} target the object that is assigned to the target property of the animation context\r\n     * @returns {AnimationContext[]} array of animation options object associated with target\r\n     */\r\n    findAnimationsByTarget: function (target) {\r\n      if (!target) {\r\n        return [];\r\n      }\r\n      return this.filter(function (animation) {\r\n        return animation.target === target;\r\n      });\r\n    }\r\n  });\r\n\r\n  function noop() {\r\n    return false;\r\n  }\r\n\r\n  function defaultEasing(t, b, c, d) {\r\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\r\n  }\r\n\r\n  /**\r\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\r\n   * @memberOf fabric.util\r\n   * @param {AnimationOptions} [options] Animation options\r\n   * @example\r\n   * // Note: startValue, endValue, and byValue must match the type\r\n   * fabric.util.animate({ startValue: 0, endValue: 1, byValue: 0.25 })\r\n   * fabric.util.animate({ startValue: [0, 1], endValue: [1, 2], byValue: [0.25, 0.25] })\r\n   * @returns {CancelFunction} cancel function\r\n   */\r\n  function animate(options) {\r\n    options || (options = {});\r\n    var cancel = false,\r\n        context,\r\n        removeFromRegistry = function () {\r\n          var index = fabric.runningAnimations.indexOf(context);\r\n          return index > -1 && fabric.runningAnimations.splice(index, 1)[0];\r\n        };\r\n\r\n    context = extend(clone(options), {\r\n      cancel: function () {\r\n        cancel = true;\r\n        return removeFromRegistry();\r\n      },\r\n      currentValue: 'startValue' in options ? options.startValue : 0,\r\n      completionRate: 0,\r\n      durationRate: 0\r\n    });\r\n    fabric.runningAnimations.push(context);\r\n\r\n    requestAnimFrame(function(timestamp) {\r\n      var start = timestamp || +new Date(),\r\n          duration = options.duration || 500,\r\n          finish = start + duration, time,\r\n          onChange = options.onChange || noop,\r\n          abort = options.abort || noop,\r\n          onComplete = options.onComplete || noop,\r\n          easing = options.easing || defaultEasing,\r\n          isMany = 'startValue' in options ? options.startValue.length > 0 : false,\r\n          startValue = 'startValue' in options ? options.startValue : 0,\r\n          endValue = 'endValue' in options ? options.endValue : 100,\r\n          byValue = options.byValue || (isMany ? startValue.map(function(value, i) {\r\n            return endValue[i] - startValue[i];\r\n          }) : endValue - startValue);\r\n\r\n      options.onStart && options.onStart();\r\n\r\n      (function tick(ticktime) {\r\n        time = ticktime || +new Date();\r\n        var currentTime = time > finish ? duration : (time - start),\r\n            timePerc = currentTime / duration,\r\n            current = isMany ? startValue.map(function(_value, i) {\r\n              return easing(currentTime, startValue[i], byValue[i], duration);\r\n            }) : easing(currentTime, startValue, byValue, duration),\r\n            valuePerc = isMany ? Math.abs((current[0] - startValue[0]) / byValue[0])\r\n              : Math.abs((current - startValue) / byValue);\r\n        //  update context\r\n        context.currentValue = isMany ? current.slice() : current;\r\n        context.completionRate = valuePerc;\r\n        context.durationRate = timePerc;\r\n        if (cancel) {\r\n          return;\r\n        }\r\n        if (abort(current, valuePerc, timePerc)) {\r\n          removeFromRegistry();\r\n          return;\r\n        }\r\n        if (time > finish) {\r\n          //  update context\r\n          context.currentValue = isMany ? endValue.slice() : endValue;\r\n          context.completionRate = 1;\r\n          context.durationRate = 1;\r\n          //  execute callbacks\r\n          onChange(isMany ? endValue.slice() : endValue, 1, 1);\r\n          onComplete(endValue, 1, 1);\r\n          removeFromRegistry();\r\n          return;\r\n        }\r\n        else {\r\n          onChange(current, valuePerc, timePerc);\r\n          requestAnimFrame(tick);\r\n        }\r\n      })(start);\r\n    });\r\n\r\n    return context.cancel;\r\n  }\r\n\r\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\r\n                          fabric.window.webkitRequestAnimationFrame ||\r\n                          fabric.window.mozRequestAnimationFrame    ||\r\n                          fabric.window.oRequestAnimationFrame      ||\r\n                          fabric.window.msRequestAnimationFrame     ||\r\n                          function(callback) {\r\n                            return fabric.window.setTimeout(callback, 1000 / 60);\r\n                          };\r\n\r\n  var _cancelAnimFrame = fabric.window.cancelAnimationFrame || fabric.window.clearTimeout;\r\n\r\n  /**\r\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\r\n   * @memberOf fabric.util\r\n   * @param {Function} callback Callback to invoke\r\n   * @param {DOMElement} element optional Element to associate with animation\r\n   */\r\n  function requestAnimFrame() {\r\n    return _requestAnimFrame.apply(fabric.window, arguments);\r\n  }\r\n\r\n  function cancelAnimFrame() {\r\n    return _cancelAnimFrame.apply(fabric.window, arguments);\r\n  }\r\n\r\n  fabric.util.animate = animate;\r\n  fabric.util.requestAnimFrame = requestAnimFrame;\r\n  fabric.util.cancelAnimFrame = cancelAnimFrame;\r\n  fabric.runningAnimations = RUNNING_ANIMATIONS;\r\n})();\r\n\r\n\r\n(function() {\r\n  // Calculate an in-between color. Returns a \"rgba()\" string.\r\n  // Credit: Edwin Martin <edwin@bitstorm.org>\r\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\r\n  function calculateColor(begin, end, pos) {\r\n    var color = 'rgba('\r\n        + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','\r\n        + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','\r\n        + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);\r\n\r\n    color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\r\n    color += ')';\r\n    return color;\r\n  }\r\n\r\n  /**\r\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\r\n   * @memberOf fabric.util\r\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\r\n   * @param {String} toColor The starting color in hex or rgb(a) format.\r\n   * @param {Number} [duration] Duration of change (in ms).\r\n   * @param {Object} [options] Animation options\r\n   * @param {Function} [options.onChange] Callback; invoked on every value change\r\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\r\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\r\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\r\n   * @returns {Function} abort function\r\n   */\r\n  function animateColor(fromColor, toColor, duration, options) {\r\n    var startColor = new fabric.Color(fromColor).getSource(),\r\n        endColor = new fabric.Color(toColor).getSource(),\r\n        originalOnComplete = options.onComplete,\r\n        originalOnChange = options.onChange;\r\n    options = options || {};\r\n\r\n    return fabric.util.animate(fabric.util.object.extend(options, {\r\n      duration: duration || 500,\r\n      startValue: startColor,\r\n      endValue: endColor,\r\n      byValue: endColor,\r\n      easing: function (currentTime, startValue, byValue, duration) {\r\n        var posValue = options.colorEasing\r\n          ? options.colorEasing(currentTime, duration)\r\n          : 1 - Math.cos(currentTime / duration * (Math.PI / 2));\r\n        return calculateColor(startValue, byValue, posValue);\r\n      },\r\n      // has to take in account for color restoring;\r\n      onComplete: function(current, valuePerc, timePerc) {\r\n        if (originalOnComplete) {\r\n          return originalOnComplete(\r\n            calculateColor(endColor, endColor, 0),\r\n            valuePerc,\r\n            timePerc\r\n          );\r\n        }\r\n      },\r\n      onChange: function(current, valuePerc, timePerc) {\r\n        if (originalOnChange) {\r\n          if (Array.isArray(current)) {\r\n            return originalOnChange(\r\n              calculateColor(current, current, 0),\r\n              valuePerc,\r\n              timePerc\r\n            );\r\n          }\r\n          originalOnChange(current, valuePerc, timePerc);\r\n        }\r\n      }\r\n    }));\r\n  }\r\n\r\n  fabric.util.animateColor = animateColor;\r\n\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  function normalize(a, c, p, s) {\r\n    if (a < Math.abs(c)) {\r\n      a = c;\r\n      s = p / 4;\r\n    }\r\n    else {\r\n      //handle the 0/0 case:\r\n      if (c === 0 && a === 0) {\r\n        s = p / (2 * Math.PI) * Math.asin(1);\r\n      }\r\n      else {\r\n        s = p / (2 * Math.PI) * Math.asin(c / a);\r\n      }\r\n    }\r\n    return { a: a, c: c, p: p, s: s };\r\n  }\r\n\r\n  function elastic(opts, t, d) {\r\n    return opts.a *\r\n      Math.pow(2, 10 * (t -= 1)) *\r\n      Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );\r\n  }\r\n\r\n  /**\r\n   * Cubic easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutCubic(t, b, c, d) {\r\n    return c * ((t = t / d - 1) * t * t + 1) + b;\r\n  }\r\n\r\n  /**\r\n   * Cubic easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutCubic(t, b, c, d) {\r\n    t /= d / 2;\r\n    if (t < 1) {\r\n      return c / 2 * t * t * t + b;\r\n    }\r\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\r\n  }\r\n\r\n  /**\r\n   * Quartic easing in\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInQuart(t, b, c, d) {\r\n    return c * (t /= d) * t * t * t + b;\r\n  }\r\n\r\n  /**\r\n   * Quartic easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutQuart(t, b, c, d) {\r\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\r\n  }\r\n\r\n  /**\r\n   * Quartic easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutQuart(t, b, c, d) {\r\n    t /= d / 2;\r\n    if (t < 1) {\r\n      return c / 2 * t * t * t * t + b;\r\n    }\r\n    return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\r\n  }\r\n\r\n  /**\r\n   * Quintic easing in\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInQuint(t, b, c, d) {\r\n    return c * (t /= d) * t * t * t * t + b;\r\n  }\r\n\r\n  /**\r\n   * Quintic easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutQuint(t, b, c, d) {\r\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\r\n  }\r\n\r\n  /**\r\n   * Quintic easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutQuint(t, b, c, d) {\r\n    t /= d / 2;\r\n    if (t < 1) {\r\n      return c / 2 * t * t * t * t * t + b;\r\n    }\r\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\r\n  }\r\n\r\n  /**\r\n   * Sinusoidal easing in\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInSine(t, b, c, d) {\r\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\r\n  }\r\n\r\n  /**\r\n   * Sinusoidal easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutSine(t, b, c, d) {\r\n    return c * Math.sin(t / d * (Math.PI / 2)) + b;\r\n  }\r\n\r\n  /**\r\n   * Sinusoidal easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutSine(t, b, c, d) {\r\n    return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\r\n  }\r\n\r\n  /**\r\n   * Exponential easing in\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInExpo(t, b, c, d) {\r\n    return (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\r\n  }\r\n\r\n  /**\r\n   * Exponential easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutExpo(t, b, c, d) {\r\n    return (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\r\n  }\r\n\r\n  /**\r\n   * Exponential easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutExpo(t, b, c, d) {\r\n    if (t === 0) {\r\n      return b;\r\n    }\r\n    if (t === d) {\r\n      return b + c;\r\n    }\r\n    t /= d / 2;\r\n    if (t < 1) {\r\n      return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\r\n    }\r\n    return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\r\n  }\r\n\r\n  /**\r\n   * Circular easing in\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInCirc(t, b, c, d) {\r\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\r\n  }\r\n\r\n  /**\r\n   * Circular easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutCirc(t, b, c, d) {\r\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\r\n  }\r\n\r\n  /**\r\n   * Circular easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutCirc(t, b, c, d) {\r\n    t /= d / 2;\r\n    if (t < 1) {\r\n      return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\r\n    }\r\n    return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\r\n  }\r\n\r\n  /**\r\n   * Elastic easing in\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInElastic(t, b, c, d) {\r\n    var s = 1.70158, p = 0, a = c;\r\n    if (t === 0) {\r\n      return b;\r\n    }\r\n    t /= d;\r\n    if (t === 1) {\r\n      return b + c;\r\n    }\r\n    if (!p) {\r\n      p = d * 0.3;\r\n    }\r\n    var opts = normalize(a, c, p, s);\r\n    return -elastic(opts, t, d) + b;\r\n  }\r\n\r\n  /**\r\n   * Elastic easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutElastic(t, b, c, d) {\r\n    var s = 1.70158, p = 0, a = c;\r\n    if (t === 0) {\r\n      return b;\r\n    }\r\n    t /= d;\r\n    if (t === 1) {\r\n      return b + c;\r\n    }\r\n    if (!p) {\r\n      p = d * 0.3;\r\n    }\r\n    var opts = normalize(a, c, p, s);\r\n    return opts.a * Math.pow(2, -10 * t) * Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) + opts.c + b;\r\n  }\r\n\r\n  /**\r\n   * Elastic easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutElastic(t, b, c, d) {\r\n    var s = 1.70158, p = 0, a = c;\r\n    if (t === 0) {\r\n      return b;\r\n    }\r\n    t /= d / 2;\r\n    if (t === 2) {\r\n      return b + c;\r\n    }\r\n    if (!p) {\r\n      p = d * (0.3 * 1.5);\r\n    }\r\n    var opts = normalize(a, c, p, s);\r\n    if (t < 1) {\r\n      return -0.5 * elastic(opts, t, d) + b;\r\n    }\r\n    return opts.a * Math.pow(2, -10 * (t -= 1)) *\r\n      Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) * 0.5 + opts.c + b;\r\n  }\r\n\r\n  /**\r\n   * Backwards easing in\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInBack(t, b, c, d, s) {\r\n    if (s === undefined) {\r\n      s = 1.70158;\r\n    }\r\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\r\n  }\r\n\r\n  /**\r\n   * Backwards easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutBack(t, b, c, d, s) {\r\n    if (s === undefined) {\r\n      s = 1.70158;\r\n    }\r\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\r\n  }\r\n\r\n  /**\r\n   * Backwards easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutBack(t, b, c, d, s) {\r\n    if (s === undefined) {\r\n      s = 1.70158;\r\n    }\r\n    t /= d / 2;\r\n    if (t < 1) {\r\n      return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\r\n    }\r\n    return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\r\n  }\r\n\r\n  /**\r\n   * Bouncing easing in\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInBounce(t, b, c, d) {\r\n    return c - easeOutBounce (d - t, 0, c, d) + b;\r\n  }\r\n\r\n  /**\r\n   * Bouncing easing out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeOutBounce(t, b, c, d) {\r\n    if ((t /= d) < (1 / 2.75)) {\r\n      return c * (7.5625 * t * t) + b;\r\n    }\r\n    else if (t < (2 / 2.75)) {\r\n      return c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\r\n    }\r\n    else if (t < (2.5 / 2.75)) {\r\n      return c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\r\n    }\r\n    else {\r\n      return c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bouncing easing in and out\r\n   * @memberOf fabric.util.ease\r\n   */\r\n  function easeInOutBounce(t, b, c, d) {\r\n    if (t < d / 2) {\r\n      return easeInBounce (t * 2, 0, c, d) * 0.5 + b;\r\n    }\r\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\r\n  }\r\n\r\n  /**\r\n   * Easing functions\r\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\r\n   * @namespace fabric.util.ease\r\n   */\r\n  fabric.util.ease = {\r\n\r\n    /**\r\n     * Quadratic easing in\r\n     * @memberOf fabric.util.ease\r\n     */\r\n    easeInQuad: function(t, b, c, d) {\r\n      return c * (t /= d) * t + b;\r\n    },\r\n\r\n    /**\r\n     * Quadratic easing out\r\n     * @memberOf fabric.util.ease\r\n     */\r\n    easeOutQuad: function(t, b, c, d) {\r\n      return -c * (t /= d) * (t - 2) + b;\r\n    },\r\n\r\n    /**\r\n     * Quadratic easing in and out\r\n     * @memberOf fabric.util.ease\r\n     */\r\n    easeInOutQuad: function(t, b, c, d) {\r\n      t /= (d / 2);\r\n      if (t < 1) {\r\n        return c / 2 * t * t + b;\r\n      }\r\n      return -c / 2 * ((--t) * (t - 2) - 1) + b;\r\n    },\r\n\r\n    /**\r\n     * Cubic easing in\r\n     * @memberOf fabric.util.ease\r\n     */\r\n    easeInCubic: function(t, b, c, d) {\r\n      return c * (t /= d) * t * t + b;\r\n    },\r\n\r\n    easeOutCubic: easeOutCubic,\r\n    easeInOutCubic: easeInOutCubic,\r\n    easeInQuart: easeInQuart,\r\n    easeOutQuart: easeOutQuart,\r\n    easeInOutQuart: easeInOutQuart,\r\n    easeInQuint: easeInQuint,\r\n    easeOutQuint: easeOutQuint,\r\n    easeInOutQuint: easeInOutQuint,\r\n    easeInSine: easeInSine,\r\n    easeOutSine: easeOutSine,\r\n    easeInOutSine: easeInOutSine,\r\n    easeInExpo: easeInExpo,\r\n    easeOutExpo: easeOutExpo,\r\n    easeInOutExpo: easeInOutExpo,\r\n    easeInCirc: easeInCirc,\r\n    easeOutCirc: easeOutCirc,\r\n    easeInOutCirc: easeInOutCirc,\r\n    easeInElastic: easeInElastic,\r\n    easeOutElastic: easeOutElastic,\r\n    easeInOutElastic: easeInOutElastic,\r\n    easeInBack: easeInBack,\r\n    easeOutBack: easeOutBack,\r\n    easeInOutBack: easeInOutBack,\r\n    easeInBounce: easeInBounce,\r\n    easeOutBounce: easeOutBounce,\r\n    easeInOutBounce: easeInOutBounce\r\n  };\r\n\r\n})();\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  /**\r\n   * @name fabric\r\n   * @namespace\r\n   */\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      extend = fabric.util.object.extend,\r\n      clone = fabric.util.object.clone,\r\n      toFixed = fabric.util.toFixed,\r\n      parseUnit = fabric.util.parseUnit,\r\n      multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\r\n\r\n      svgValidTagNames = ['path', 'circle', 'polygon', 'polyline', 'ellipse', 'rect', 'line',\r\n        'image', 'text'],\r\n      svgViewBoxElements = ['symbol', 'image', 'marker', 'pattern', 'view', 'svg'],\r\n      svgInvalidAncestors = ['pattern', 'defs', 'symbol', 'metadata', 'clipPath', 'mask', 'desc'],\r\n      svgValidParents = ['symbol', 'g', 'a', 'svg', 'clipPath', 'defs'],\r\n\r\n      attributesMap = {\r\n        cx:                   'left',\r\n        x:                    'left',\r\n        r:                    'radius',\r\n        cy:                   'top',\r\n        y:                    'top',\r\n        display:              'visible',\r\n        visibility:           'visible',\r\n        transform:            'transformMatrix',\r\n        'fill-opacity':       'fillOpacity',\r\n        'fill-rule':          'fillRule',\r\n        'font-family':        'fontFamily',\r\n        'font-size':          'fontSize',\r\n        'font-style':         'fontStyle',\r\n        'font-weight':        'fontWeight',\r\n        'letter-spacing':     'charSpacing',\r\n        'paint-order':        'paintFirst',\r\n        'stroke-dasharray':   'strokeDashArray',\r\n        'stroke-dashoffset':  'strokeDashOffset',\r\n        'stroke-linecap':     'strokeLineCap',\r\n        'stroke-linejoin':    'strokeLineJoin',\r\n        'stroke-miterlimit':  'strokeMiterLimit',\r\n        'stroke-opacity':     'strokeOpacity',\r\n        'stroke-width':       'strokeWidth',\r\n        'text-decoration':    'textDecoration',\r\n        'text-anchor':        'textAnchor',\r\n        opacity:              'opacity',\r\n        'clip-path':          'clipPath',\r\n        'clip-rule':          'clipRule',\r\n        'vector-effect':      'strokeUniform',\r\n        'image-rendering':    'imageSmoothing',\r\n      },\r\n\r\n      colorAttributes = {\r\n        stroke: 'strokeOpacity',\r\n        fill:   'fillOpacity'\r\n      },\r\n\r\n      fSize = 'font-size', cPath = 'clip-path';\r\n\r\n  fabric.svgValidTagNamesRegEx = getSvgRegex(svgValidTagNames);\r\n  fabric.svgViewBoxElementsRegEx = getSvgRegex(svgViewBoxElements);\r\n  fabric.svgInvalidAncestorsRegEx = getSvgRegex(svgInvalidAncestors);\r\n  fabric.svgValidParentsRegEx = getSvgRegex(svgValidParents);\r\n\r\n  fabric.cssRules = { };\r\n  fabric.gradientDefs = { };\r\n  fabric.clipPaths = { };\r\n\r\n  function normalizeAttr(attr) {\r\n    // transform attribute names\r\n    if (attr in attributesMap) {\r\n      return attributesMap[attr];\r\n    }\r\n    return attr;\r\n  }\r\n\r\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\r\n    var isArray = Array.isArray(value), parsed;\r\n\r\n    if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\r\n      value = '';\r\n    }\r\n    else if (attr === 'strokeUniform') {\r\n      return (value === 'non-scaling-stroke');\r\n    }\r\n    else if (attr === 'strokeDashArray') {\r\n      if (value === 'none') {\r\n        value = null;\r\n      }\r\n      else {\r\n        value = value.replace(/,/g, ' ').split(/\\s+/).map(parseFloat);\r\n      }\r\n    }\r\n    else if (attr === 'transformMatrix') {\r\n      if (parentAttributes && parentAttributes.transformMatrix) {\r\n        value = multiplyTransformMatrices(\r\n          parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));\r\n      }\r\n      else {\r\n        value = fabric.parseTransformAttribute(value);\r\n      }\r\n    }\r\n    else if (attr === 'visible') {\r\n      value = value !== 'none' && value !== 'hidden';\r\n      // display=none on parent element always takes precedence over child element\r\n      if (parentAttributes && parentAttributes.visible === false) {\r\n        value = false;\r\n      }\r\n    }\r\n    else if (attr === 'opacity') {\r\n      value = parseFloat(value);\r\n      if (parentAttributes && typeof parentAttributes.opacity !== 'undefined') {\r\n        value *= parentAttributes.opacity;\r\n      }\r\n    }\r\n    else if (attr === 'textAnchor' /* text-anchor */) {\r\n      value = value === 'start' ? 'left' : value === 'end' ? 'right' : 'center';\r\n    }\r\n    else if (attr === 'charSpacing') {\r\n      // parseUnit returns px and we convert it to em\r\n      parsed = parseUnit(value, fontSize) / fontSize * 1000;\r\n    }\r\n    else if (attr === 'paintFirst') {\r\n      var fillIndex = value.indexOf('fill');\r\n      var strokeIndex = value.indexOf('stroke');\r\n      var value = 'fill';\r\n      if (fillIndex > -1 && strokeIndex > -1 && strokeIndex < fillIndex) {\r\n        value = 'stroke';\r\n      }\r\n      else if (fillIndex === -1 && strokeIndex > -1) {\r\n        value = 'stroke';\r\n      }\r\n    }\r\n    else if (attr === 'href' || attr === 'xlink:href' || attr === 'font') {\r\n      return value;\r\n    }\r\n    else if (attr === 'imageSmoothing') {\r\n      return (value === 'optimizeQuality');\r\n    }\r\n    else {\r\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\r\n    }\r\n\r\n    return (!isArray && isNaN(parsed) ? value : parsed);\r\n  }\r\n\r\n  /**\r\n    * @private\r\n    */\r\n  function getSvgRegex(arr) {\r\n    return new RegExp('^(' + arr.join('|') + ')\\\\b', 'i');\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {Object} attributes Array of attributes to parse\r\n   */\r\n  function _setStrokeFillOpacity(attributes) {\r\n    for (var attr in colorAttributes) {\r\n\r\n      if (typeof attributes[colorAttributes[attr]] === 'undefined' || attributes[attr] === '') {\r\n        continue;\r\n      }\r\n\r\n      if (typeof attributes[attr] === 'undefined') {\r\n        if (!fabric.Object.prototype[attr]) {\r\n          continue;\r\n        }\r\n        attributes[attr] = fabric.Object.prototype[attr];\r\n      }\r\n\r\n      if (attributes[attr].indexOf('url(') === 0) {\r\n        continue;\r\n      }\r\n\r\n      var color = new fabric.Color(attributes[attr]);\r\n      attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();\r\n    }\r\n    return attributes;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function _getMultipleNodes(doc, nodeNames) {\r\n    var nodeName, nodeArray = [], nodeList, i, len;\r\n    for (i = 0, len = nodeNames.length; i < len; i++) {\r\n      nodeName = nodeNames[i];\r\n      nodeList = doc.getElementsByTagName(nodeName);\r\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\r\n    }\r\n    return nodeArray;\r\n  }\r\n\r\n  /**\r\n   * Parses \"transform\" attribute, returning an array of values\r\n   * @static\r\n   * @function\r\n   * @memberOf fabric\r\n   * @param {String} attributeValue String containing attribute value\r\n   * @return {Array} Array of 6 elements representing transformation matrix\r\n   */\r\n  fabric.parseTransformAttribute = (function() {\r\n    function rotateMatrix(matrix, args) {\r\n      var cos = fabric.util.cos(args[0]), sin = fabric.util.sin(args[0]),\r\n          x = 0, y = 0;\r\n      if (args.length === 3) {\r\n        x = args[1];\r\n        y = args[2];\r\n      }\r\n\r\n      matrix[0] = cos;\r\n      matrix[1] = sin;\r\n      matrix[2] = -sin;\r\n      matrix[3] = cos;\r\n      matrix[4] = x - (cos * x - sin * y);\r\n      matrix[5] = y - (sin * x + cos * y);\r\n    }\r\n\r\n    function scaleMatrix(matrix, args) {\r\n      var multiplierX = args[0],\r\n          multiplierY = (args.length === 2) ? args[1] : args[0];\r\n\r\n      matrix[0] = multiplierX;\r\n      matrix[3] = multiplierY;\r\n    }\r\n\r\n    function skewMatrix(matrix, args, pos) {\r\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\r\n    }\r\n\r\n    function translateMatrix(matrix, args) {\r\n      matrix[4] = args[0];\r\n      if (args.length === 2) {\r\n        matrix[5] = args[1];\r\n      }\r\n    }\r\n\r\n    // identity matrix\r\n    var iMatrix = fabric.iMatrix,\r\n\r\n        // == begin transform regexp\r\n        number = fabric.reNum,\r\n\r\n        commaWsp = fabric.commaWsp,\r\n\r\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\r\n\r\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\r\n\r\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\r\n                    commaWsp + '(' + number + ')' +\r\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\r\n\r\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\r\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\r\n\r\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\r\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\r\n\r\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\r\n                  '(' + number + ')' + commaWsp +\r\n                  '(' + number + ')' + commaWsp +\r\n                  '(' + number + ')' + commaWsp +\r\n                  '(' + number + ')' + commaWsp +\r\n                  '(' + number + ')' + commaWsp +\r\n                  '(' + number + ')' +\r\n                  '\\\\s*\\\\))',\r\n\r\n        transform = '(?:' +\r\n                    matrix + '|' +\r\n                    translate + '|' +\r\n                    scale + '|' +\r\n                    rotate + '|' +\r\n                    skewX + '|' +\r\n                    skewY +\r\n                    ')',\r\n\r\n        transforms = '(?:' + transform + '(?:' + commaWsp + '*' + transform + ')*' + ')',\r\n\r\n        transformList = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\r\n\r\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\r\n        reTransformList = new RegExp(transformList),\r\n        // == end transform regexp\r\n\r\n        reTransform = new RegExp(transform, 'g');\r\n\r\n    return function(attributeValue) {\r\n\r\n      // start with identity matrix\r\n      var matrix = iMatrix.concat(),\r\n          matrices = [];\r\n\r\n      // return if no argument was given or\r\n      // an argument does not match transform attribute regexp\r\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\r\n        return matrix;\r\n      }\r\n\r\n      attributeValue.replace(reTransform, function(match) {\r\n\r\n        var m = new RegExp(transform).exec(match).filter(function (match) {\r\n              // match !== '' && match != null\r\n              return (!!match);\r\n            }),\r\n            operation = m[1],\r\n            args = m.slice(2).map(parseFloat);\r\n\r\n        switch (operation) {\r\n          case 'translate':\r\n            translateMatrix(matrix, args);\r\n            break;\r\n          case 'rotate':\r\n            args[0] = fabric.util.degreesToRadians(args[0]);\r\n            rotateMatrix(matrix, args);\r\n            break;\r\n          case 'scale':\r\n            scaleMatrix(matrix, args);\r\n            break;\r\n          case 'skewX':\r\n            skewMatrix(matrix, args, 2);\r\n            break;\r\n          case 'skewY':\r\n            skewMatrix(matrix, args, 1);\r\n            break;\r\n          case 'matrix':\r\n            matrix = args;\r\n            break;\r\n        }\r\n\r\n        // snapshot current matrix into matrices array\r\n        matrices.push(matrix.concat());\r\n        // reset\r\n        matrix = iMatrix.concat();\r\n      });\r\n\r\n      var combinedMatrix = matrices[0];\r\n      while (matrices.length > 1) {\r\n        matrices.shift();\r\n        combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);\r\n      }\r\n      return combinedMatrix;\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function parseStyleString(style, oStyle) {\r\n    var attr, value;\r\n    style.replace(/;\\s*$/, '').split(';').forEach(function (chunk) {\r\n      var pair = chunk.split(':');\r\n\r\n      attr = pair[0].trim().toLowerCase();\r\n      value =  pair[1].trim();\r\n\r\n      oStyle[attr] = value;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function parseStyleObject(style, oStyle) {\r\n    var attr, value;\r\n    for (var prop in style) {\r\n      if (typeof style[prop] === 'undefined') {\r\n        continue;\r\n      }\r\n\r\n      attr = prop.toLowerCase();\r\n      value = style[prop];\r\n\r\n      oStyle[attr] = value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function getGlobalStylesForElement(element, svgUid) {\r\n    var styles = { };\r\n    for (var rule in fabric.cssRules[svgUid]) {\r\n      if (elementMatchesRule(element, rule.split(' '))) {\r\n        for (var property in fabric.cssRules[svgUid][rule]) {\r\n          styles[property] = fabric.cssRules[svgUid][rule][property];\r\n        }\r\n      }\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function elementMatchesRule(element, selectors) {\r\n    var firstMatching, parentMatching = true;\r\n    //start from rightmost selector.\r\n    firstMatching = selectorMatches(element, selectors.pop());\r\n    if (firstMatching && selectors.length) {\r\n      parentMatching = doesSomeParentMatch(element, selectors);\r\n    }\r\n    return firstMatching && parentMatching && (selectors.length === 0);\r\n  }\r\n\r\n  function doesSomeParentMatch(element, selectors) {\r\n    var selector, parentMatching = true;\r\n    while (element.parentNode && element.parentNode.nodeType === 1 && selectors.length) {\r\n      if (parentMatching) {\r\n        selector = selectors.pop();\r\n      }\r\n      element = element.parentNode;\r\n      parentMatching = selectorMatches(element, selector);\r\n    }\r\n    return selectors.length === 0;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function selectorMatches(element, selector) {\r\n    var nodeName = element.nodeName,\r\n        classNames = element.getAttribute('class'),\r\n        id = element.getAttribute('id'), matcher, i;\r\n    // i check if a selector matches slicing away part from it.\r\n    // if i get empty string i should match\r\n    matcher = new RegExp('^' + nodeName, 'i');\r\n    selector = selector.replace(matcher, '');\r\n    if (id && selector.length) {\r\n      matcher = new RegExp('#' + id + '(?![a-zA-Z\\\\-]+)', 'i');\r\n      selector = selector.replace(matcher, '');\r\n    }\r\n    if (classNames && selector.length) {\r\n      classNames = classNames.split(' ');\r\n      for (i = classNames.length; i--;) {\r\n        matcher = new RegExp('\\\\.' + classNames[i] + '(?![a-zA-Z\\\\-]+)', 'i');\r\n        selector = selector.replace(matcher, '');\r\n      }\r\n    }\r\n    return selector.length === 0;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * to support IE8 missing getElementById on SVGdocument and on node xmlDOM\r\n   */\r\n  function elementById(doc, id) {\r\n    var el;\r\n    doc.getElementById && (el = doc.getElementById(id));\r\n    if (el) {\r\n      return el;\r\n    }\r\n    var node, i, len, nodelist = doc.getElementsByTagName('*');\r\n    for (i = 0, len = nodelist.length; i < len; i++) {\r\n      node = nodelist[i];\r\n      if (id === node.getAttribute('id')) {\r\n        return node;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function parseUseDirectives(doc) {\r\n    var nodelist = _getMultipleNodes(doc, ['use', 'svg:use']), i = 0;\r\n    while (nodelist.length && i < nodelist.length) {\r\n      var el = nodelist[i],\r\n          xlinkAttribute = el.getAttribute('xlink:href') || el.getAttribute('href');\r\n\r\n      if (xlinkAttribute === null) {\r\n        return;\r\n      }\r\n\r\n      var xlink = xlinkAttribute.slice(1),\r\n          x = el.getAttribute('x') || 0,\r\n          y = el.getAttribute('y') || 0,\r\n          el2 = elementById(doc, xlink).cloneNode(true),\r\n          currentTrans = (el2.getAttribute('transform') || '') + ' translate(' + x + ', ' + y + ')',\r\n          parentNode,\r\n          oldLength = nodelist.length, attr,\r\n          j,\r\n          attrs,\r\n          len,\r\n          namespace = fabric.svgNS;\r\n\r\n      applyViewboxTransform(el2);\r\n      if (/^svg$/i.test(el2.nodeName)) {\r\n        var el3 = el2.ownerDocument.createElementNS(namespace, 'g');\r\n        for (j = 0, attrs = el2.attributes, len = attrs.length; j < len; j++) {\r\n          attr = attrs.item(j);\r\n          el3.setAttributeNS(namespace, attr.nodeName, attr.nodeValue);\r\n        }\r\n        // el2.firstChild != null\r\n        while (el2.firstChild) {\r\n          el3.appendChild(el2.firstChild);\r\n        }\r\n        el2 = el3;\r\n      }\r\n\r\n      for (j = 0, attrs = el.attributes, len = attrs.length; j < len; j++) {\r\n        attr = attrs.item(j);\r\n        if (attr.nodeName === 'x' || attr.nodeName === 'y' ||\r\n          attr.nodeName === 'xlink:href' || attr.nodeName === 'href') {\r\n          continue;\r\n        }\r\n\r\n        if (attr.nodeName === 'transform') {\r\n          currentTrans = attr.nodeValue + ' ' + currentTrans;\r\n        }\r\n        else {\r\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\r\n        }\r\n      }\r\n\r\n      el2.setAttribute('transform', currentTrans);\r\n      el2.setAttribute('instantiated_by_use', '1');\r\n      el2.removeAttribute('id');\r\n      parentNode = el.parentNode;\r\n      parentNode.replaceChild(el2, el);\r\n      // some browsers do not shorten nodelist after replaceChild (IE8)\r\n      if (nodelist.length === oldLength) {\r\n        i++;\r\n      }\r\n    }\r\n  }\r\n\r\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\r\n  // matches, e.g.: +14.56e-12, etc.\r\n  var reViewBoxAttrValue = new RegExp(\r\n    '^' +\r\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\r\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\r\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\r\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*' +\r\n    '$'\r\n  );\r\n\r\n  /**\r\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\r\n   */\r\n  function applyViewboxTransform(element) {\r\n    if (!fabric.svgViewBoxElementsRegEx.test(element.nodeName)) {\r\n      return {};\r\n    }\r\n    var viewBoxAttr = element.getAttribute('viewBox'),\r\n        scaleX = 1,\r\n        scaleY = 1,\r\n        minX = 0,\r\n        minY = 0,\r\n        viewBoxWidth, viewBoxHeight, matrix, el,\r\n        widthAttr = element.getAttribute('width'),\r\n        heightAttr = element.getAttribute('height'),\r\n        x = element.getAttribute('x') || 0,\r\n        y = element.getAttribute('y') || 0,\r\n        preserveAspectRatio = element.getAttribute('preserveAspectRatio') || '',\r\n        missingViewBox = (!viewBoxAttr || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))),\r\n        missingDimAttr = (!widthAttr || !heightAttr || widthAttr === '100%' || heightAttr === '100%'),\r\n        toBeParsed = missingViewBox && missingDimAttr,\r\n        parsedDim = { }, translateMatrix = '', widthDiff = 0, heightDiff = 0;\r\n\r\n    parsedDim.width = 0;\r\n    parsedDim.height = 0;\r\n    parsedDim.toBeParsed = toBeParsed;\r\n\r\n    if (missingViewBox) {\r\n      if (((x || y) && element.parentNode && element.parentNode.nodeName !== '#document')) {\r\n        translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\r\n        matrix = (element.getAttribute('transform') || '') + translateMatrix;\r\n        element.setAttribute('transform', matrix);\r\n        element.removeAttribute('x');\r\n        element.removeAttribute('y');\r\n      }\r\n    }\r\n\r\n    if (toBeParsed) {\r\n      return parsedDim;\r\n    }\r\n\r\n    if (missingViewBox) {\r\n      parsedDim.width = parseUnit(widthAttr);\r\n      parsedDim.height = parseUnit(heightAttr);\r\n      // set a transform for elements that have x y and are inner(only) SVGs\r\n      return parsedDim;\r\n    }\r\n    minX = -parseFloat(viewBoxAttr[1]);\r\n    minY = -parseFloat(viewBoxAttr[2]);\r\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\r\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\r\n    parsedDim.minX = minX;\r\n    parsedDim.minY = minY;\r\n    parsedDim.viewBoxWidth = viewBoxWidth;\r\n    parsedDim.viewBoxHeight = viewBoxHeight;\r\n    if (!missingDimAttr) {\r\n      parsedDim.width = parseUnit(widthAttr);\r\n      parsedDim.height = parseUnit(heightAttr);\r\n      scaleX = parsedDim.width / viewBoxWidth;\r\n      scaleY = parsedDim.height / viewBoxHeight;\r\n    }\r\n    else {\r\n      parsedDim.width = viewBoxWidth;\r\n      parsedDim.height = viewBoxHeight;\r\n    }\r\n\r\n    // default is to preserve aspect ratio\r\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);\r\n    if (preserveAspectRatio.alignX !== 'none') {\r\n      //translate all container for the effect of Mid, Min, Max\r\n      if (preserveAspectRatio.meetOrSlice === 'meet') {\r\n        scaleY = scaleX = (scaleX > scaleY ? scaleY : scaleX);\r\n        // calculate additional translation to move the viewbox\r\n      }\r\n      if (preserveAspectRatio.meetOrSlice === 'slice') {\r\n        scaleY = scaleX = (scaleX > scaleY ? scaleX : scaleY);\r\n        // calculate additional translation to move the viewbox\r\n      }\r\n      widthDiff = parsedDim.width - viewBoxWidth * scaleX;\r\n      heightDiff = parsedDim.height - viewBoxHeight * scaleX;\r\n      if (preserveAspectRatio.alignX === 'Mid') {\r\n        widthDiff /= 2;\r\n      }\r\n      if (preserveAspectRatio.alignY === 'Mid') {\r\n        heightDiff /= 2;\r\n      }\r\n      if (preserveAspectRatio.alignX === 'Min') {\r\n        widthDiff = 0;\r\n      }\r\n      if (preserveAspectRatio.alignY === 'Min') {\r\n        heightDiff = 0;\r\n      }\r\n    }\r\n\r\n    if (scaleX === 1 && scaleY === 1 && minX === 0 && minY === 0 && x === 0 && y === 0) {\r\n      return parsedDim;\r\n    }\r\n    if ((x || y) && element.parentNode.nodeName !== '#document') {\r\n      translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\r\n    }\r\n\r\n    matrix = translateMatrix + ' matrix(' + scaleX +\r\n                  ' 0' +\r\n                  ' 0 ' +\r\n                  scaleY + ' ' +\r\n                  (minX * scaleX + widthDiff) + ' ' +\r\n                  (minY * scaleY + heightDiff) + ') ';\r\n    // seems unused.\r\n    // parsedDim.viewboxTransform = fabric.parseTransformAttribute(matrix);\r\n    if (element.nodeName === 'svg') {\r\n      el = element.ownerDocument.createElementNS(fabric.svgNS, 'g');\r\n      // element.firstChild != null\r\n      while (element.firstChild) {\r\n        el.appendChild(element.firstChild);\r\n      }\r\n      element.appendChild(el);\r\n    }\r\n    else {\r\n      el = element;\r\n      el.removeAttribute('x');\r\n      el.removeAttribute('y');\r\n      matrix = el.getAttribute('transform') + matrix;\r\n    }\r\n    el.setAttribute('transform', matrix);\r\n    return parsedDim;\r\n  }\r\n\r\n  function hasAncestorWithNodeName(element, nodeName) {\r\n    while (element && (element = element.parentNode)) {\r\n      if (element.nodeName && nodeName.test(element.nodeName.replace('svg:', ''))\r\n        && !element.getAttribute('instantiated_by_use')) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\r\n   * @static\r\n   * @function\r\n   * @memberOf fabric\r\n   * @param {SVGDocument} doc SVG document to parse\r\n   * @param {Function} callback Callback to call when parsing is finished;\r\n   * It's being passed an array of elements (parsed from a document).\r\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\r\n   * @param {Object} [parsingOptions] options for parsing document\r\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\r\n   */\r\n  fabric.parseSVGDocument = function(doc, callback, reviver, parsingOptions) {\r\n    if (!doc) {\r\n      return;\r\n    }\r\n\r\n    parseUseDirectives(doc);\r\n\r\n    var svgUid =  fabric.Object.__uid++, i, len,\r\n        options = applyViewboxTransform(doc),\r\n        descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\r\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\r\n    options.svgUid = svgUid;\r\n\r\n    if (descendants.length === 0 && fabric.isLikelyNode) {\r\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\r\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\r\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\r\n      var arr = [];\r\n      for (i = 0, len = descendants.length; i < len; i++) {\r\n        arr[i] = descendants[i];\r\n      }\r\n      descendants = arr;\r\n    }\r\n\r\n    var elements = descendants.filter(function(el) {\r\n      applyViewboxTransform(el);\r\n      return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', '')) &&\r\n            !hasAncestorWithNodeName(el, fabric.svgInvalidAncestorsRegEx); // http://www.w3.org/TR/SVG/struct.html#DefsElement\r\n    });\r\n    if (!elements || (elements && !elements.length)) {\r\n      callback && callback([], {});\r\n      return;\r\n    }\r\n    var clipPaths = { };\r\n    descendants.filter(function(el) {\r\n      return el.nodeName.replace('svg:', '') === 'clipPath';\r\n    }).forEach(function(el) {\r\n      var id = el.getAttribute('id');\r\n      clipPaths[id] = fabric.util.toArray(el.getElementsByTagName('*')).filter(function(el) {\r\n        return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', ''));\r\n      });\r\n    });\r\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\r\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\r\n    fabric.clipPaths[svgUid] = clipPaths;\r\n    // Precedence of rules:   style > class > attribute\r\n    fabric.parseElements(elements, function(instances, elements) {\r\n      if (callback) {\r\n        callback(instances, options, elements, descendants);\r\n        delete fabric.gradientDefs[svgUid];\r\n        delete fabric.cssRules[svgUid];\r\n        delete fabric.clipPaths[svgUid];\r\n      }\r\n    }, clone(options), reviver, parsingOptions);\r\n  };\r\n\r\n  function recursivelyParseGradientsXlink(doc, gradient) {\r\n    var gradientsAttrs = ['gradientTransform', 'x1', 'x2', 'y1', 'y2', 'gradientUnits', 'cx', 'cy', 'r', 'fx', 'fy'],\r\n        xlinkAttr = 'xlink:href',\r\n        xLink = gradient.getAttribute(xlinkAttr).slice(1),\r\n        referencedGradient = elementById(doc, xLink);\r\n    if (referencedGradient && referencedGradient.getAttribute(xlinkAttr)) {\r\n      recursivelyParseGradientsXlink(doc, referencedGradient);\r\n    }\r\n    gradientsAttrs.forEach(function(attr) {\r\n      if (referencedGradient && !gradient.hasAttribute(attr) && referencedGradient.hasAttribute(attr)) {\r\n        gradient.setAttribute(attr, referencedGradient.getAttribute(attr));\r\n      }\r\n    });\r\n    if (!gradient.children.length) {\r\n      var referenceClone = referencedGradient.cloneNode(true);\r\n      while (referenceClone.firstChild) {\r\n        gradient.appendChild(referenceClone.firstChild);\r\n      }\r\n    }\r\n    gradient.removeAttribute(xlinkAttr);\r\n  }\r\n\r\n  var reFontDeclaration = new RegExp(\r\n    '(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*' +\r\n    '(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(' +\r\n      fabric.reNum +\r\n    '(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|' + fabric.reNum + '))?\\\\s+(.*)');\r\n\r\n  extend(fabric, {\r\n    /**\r\n     * Parses a short font declaration, building adding its properties to a style object\r\n     * @static\r\n     * @function\r\n     * @memberOf fabric\r\n     * @param {String} value font declaration\r\n     * @param {Object} oStyle definition\r\n     */\r\n    parseFontDeclaration: function(value, oStyle) {\r\n      var match = value.match(reFontDeclaration);\r\n\r\n      if (!match) {\r\n        return;\r\n      }\r\n      var fontStyle = match[1],\r\n          // font variant is not used\r\n          // fontVariant = match[2],\r\n          fontWeight = match[3],\r\n          fontSize = match[4],\r\n          lineHeight = match[5],\r\n          fontFamily = match[6];\r\n\r\n      if (fontStyle) {\r\n        oStyle.fontStyle = fontStyle;\r\n      }\r\n      if (fontWeight) {\r\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);\r\n      }\r\n      if (fontSize) {\r\n        oStyle.fontSize = parseUnit(fontSize);\r\n      }\r\n      if (fontFamily) {\r\n        oStyle.fontFamily = fontFamily;\r\n      }\r\n      if (lineHeight) {\r\n        oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Parses an SVG document, returning all of the gradient declarations found in it\r\n     * @static\r\n     * @function\r\n     * @memberOf fabric\r\n     * @param {SVGDocument} doc SVG document to parse\r\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\r\n     */\r\n    getGradientDefs: function(doc) {\r\n      var tagArray = [\r\n            'linearGradient',\r\n            'radialGradient',\r\n            'svg:linearGradient',\r\n            'svg:radialGradient'],\r\n          elList = _getMultipleNodes(doc, tagArray),\r\n          el, j = 0, gradientDefs = { };\r\n      j = elList.length;\r\n      while (j--) {\r\n        el = elList[j];\r\n        if (el.getAttribute('xlink:href')) {\r\n          recursivelyParseGradientsXlink(doc, el);\r\n        }\r\n        gradientDefs[el.getAttribute('id')] = el;\r\n      }\r\n      return gradientDefs;\r\n    },\r\n\r\n    /**\r\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\r\n     * Parses parent \"g\" nodes recursively upwards.\r\n     * @static\r\n     * @memberOf fabric\r\n     * @param {DOMElement} element Element to parse\r\n     * @param {Array} attributes Array of attributes to parse\r\n     * @return {Object} object containing parsed attributes' names/values\r\n     */\r\n    parseAttributes: function(element, attributes, svgUid) {\r\n\r\n      if (!element) {\r\n        return;\r\n      }\r\n\r\n      var value,\r\n          parentAttributes = { },\r\n          fontSize, parentFontSize;\r\n\r\n      if (typeof svgUid === 'undefined') {\r\n        svgUid = element.getAttribute('svgUid');\r\n      }\r\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\r\n      if (element.parentNode && fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)) {\r\n        parentAttributes = fabric.parseAttributes(element.parentNode, attributes, svgUid);\r\n      }\r\n\r\n      var ownAttributes = attributes.reduce(function(memo, attr) {\r\n        value = element.getAttribute(attr);\r\n        if (value) { // eslint-disable-line\r\n          memo[attr] = value;\r\n        }\r\n        return memo;\r\n      }, { });\r\n      // add values parsed from style, which take precedence over attributes\r\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\r\n      var cssAttrs = extend(\r\n        getGlobalStylesForElement(element, svgUid),\r\n        fabric.parseStyleAttribute(element)\r\n      );\r\n      ownAttributes = extend(\r\n        ownAttributes,\r\n        cssAttrs\r\n      );\r\n      if (cssAttrs[cPath]) {\r\n        element.setAttribute(cPath, cssAttrs[cPath]);\r\n      }\r\n      fontSize = parentFontSize = parentAttributes.fontSize || fabric.Text.DEFAULT_SVG_FONT_SIZE;\r\n      if (ownAttributes[fSize]) {\r\n        // looks like the minimum should be 9px when dealing with ems. this is what looks like in browsers.\r\n        ownAttributes[fSize] = fontSize = parseUnit(ownAttributes[fSize], parentFontSize);\r\n      }\r\n\r\n      var normalizedAttr, normalizedValue, normalizedStyle = {};\r\n      for (var attr in ownAttributes) {\r\n        normalizedAttr = normalizeAttr(attr);\r\n        normalizedValue = normalizeValue(normalizedAttr, ownAttributes[attr], parentAttributes, fontSize);\r\n        normalizedStyle[normalizedAttr] = normalizedValue;\r\n      }\r\n      if (normalizedStyle && normalizedStyle.font) {\r\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\r\n      }\r\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\r\n      return fabric.svgValidParentsRegEx.test(element.nodeName) ? mergedAttrs : _setStrokeFillOpacity(mergedAttrs);\r\n    },\r\n\r\n    /**\r\n     * Transforms an array of svg elements to corresponding fabric.* instances\r\n     * @static\r\n     * @memberOf fabric\r\n     * @param {Array} elements Array of elements to parse\r\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\r\n     * @param {Object} [options] Options object\r\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\r\n     */\r\n    parseElements: function(elements, callback, options, reviver, parsingOptions) {\r\n      new fabric.ElementsParser(elements, callback, options, reviver, parsingOptions).parse();\r\n    },\r\n\r\n    /**\r\n     * Parses \"style\" attribute, retuning an object with values\r\n     * @static\r\n     * @memberOf fabric\r\n     * @param {SVGElement} element Element to parse\r\n     * @return {Object} Objects with values parsed from style attribute of an element\r\n     */\r\n    parseStyleAttribute: function(element) {\r\n      var oStyle = { },\r\n          style = element.getAttribute('style');\r\n\r\n      if (!style) {\r\n        return oStyle;\r\n      }\r\n\r\n      if (typeof style === 'string') {\r\n        parseStyleString(style, oStyle);\r\n      }\r\n      else {\r\n        parseStyleObject(style, oStyle);\r\n      }\r\n\r\n      return oStyle;\r\n    },\r\n\r\n    /**\r\n     * Parses \"points\" attribute, returning an array of values\r\n     * @static\r\n     * @memberOf fabric\r\n     * @param {String} points points attribute string\r\n     * @return {Array} array of points\r\n     */\r\n    parsePointsAttribute: function(points) {\r\n\r\n      // points attribute is required and must not be empty\r\n      if (!points) {\r\n        return null;\r\n      }\r\n\r\n      // replace commas with whitespace and remove bookending whitespace\r\n      points = points.replace(/,/g, ' ').trim();\r\n\r\n      points = points.split(/\\s+/);\r\n      var parsedPoints = [], i, len;\r\n\r\n      for (i = 0, len = points.length; i < len; i += 2) {\r\n        parsedPoints.push({\r\n          x: parseFloat(points[i]),\r\n          y: parseFloat(points[i + 1])\r\n        });\r\n      }\r\n\r\n      // odd number of points is an error\r\n      // if (parsedPoints.length % 2 !== 0) {\r\n      //   return null;\r\n      // }\r\n\r\n      return parsedPoints;\r\n    },\r\n\r\n    /**\r\n     * Returns CSS rules for a given SVG document\r\n     * @static\r\n     * @function\r\n     * @memberOf fabric\r\n     * @param {SVGDocument} doc SVG document to parse\r\n     * @return {Object} CSS rules of this document\r\n     */\r\n    getCSSRules: function(doc) {\r\n      var styles = doc.getElementsByTagName('style'), i, len,\r\n          allRules = { }, rules;\r\n\r\n      // very crude parsing of style contents\r\n      for (i = 0, len = styles.length; i < len; i++) {\r\n        var styleContents = styles[i].textContent;\r\n\r\n        // remove comments\r\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\r\n        if (styleContents.trim() === '') {\r\n          continue;\r\n        }\r\n        // recovers all the rule in this form `body { style code... }`\r\n        // rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\r\n        rules = styleContents.split('}');\r\n        // remove empty rules.\r\n        rules = rules.filter(function(rule) { return rule.trim(); });\r\n        // at this point we have hopefully an array of rules `body { style code... `\r\n        // eslint-disable-next-line no-loop-func\r\n        rules.forEach(function(rule) {\r\n\r\n          var match = rule.split('{'),\r\n              ruleObj = { }, declaration = match[1].trim(),\r\n              propertyValuePairs = declaration.split(';').filter(function(pair) { return pair.trim(); });\r\n\r\n          for (i = 0, len = propertyValuePairs.length; i < len; i++) {\r\n            var pair = propertyValuePairs[i].split(':'),\r\n                property = pair[0].trim(),\r\n                value = pair[1].trim();\r\n            ruleObj[property] = value;\r\n          }\r\n          rule = match[0].trim();\r\n          rule.split(',').forEach(function(_rule) {\r\n            _rule = _rule.replace(/^svg/i, '').trim();\r\n            if (_rule === '') {\r\n              return;\r\n            }\r\n            if (allRules[_rule]) {\r\n              fabric.util.object.extend(allRules[_rule], ruleObj);\r\n            }\r\n            else {\r\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\r\n            }\r\n          });\r\n        });\r\n      }\r\n      return allRules;\r\n    },\r\n\r\n    /**\r\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\r\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\r\n     * @memberOf fabric\r\n     * @param {String} url\r\n     * @param {Function} callback\r\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\r\n     * @param {Object} [options] Object containing options for parsing\r\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\r\n     */\r\n    loadSVGFromURL: function(url, callback, reviver, options) {\r\n\r\n      url = url.replace(/^\\n\\s*/, '').trim();\r\n      new fabric.util.request(url, {\r\n        method: 'get',\r\n        onComplete: onComplete\r\n      });\r\n\r\n      function onComplete(r) {\r\n\r\n        var xml = r.responseXML;\r\n        if (!xml || !xml.documentElement) {\r\n          callback && callback(null);\r\n          return false;\r\n        }\r\n\r\n        fabric.parseSVGDocument(xml.documentElement, function (results, _options, elements, allElements) {\r\n          callback && callback(results, _options, elements, allElements);\r\n        }, reviver, options);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\r\n     * @memberOf fabric\r\n     * @param {String} string\r\n     * @param {Function} callback\r\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\r\n     * @param {Object} [options] Object containing options for parsing\r\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\r\n     */\r\n    loadSVGFromString: function(string, callback, reviver, options) {\r\n      var parser = new fabric.window.DOMParser(),\r\n          doc = parser.parseFromString(string.trim(), 'text/xml');\r\n      fabric.parseSVGDocument(doc.documentElement, function (results, _options, elements, allElements) {\r\n        callback(results, _options, elements, allElements);\r\n      }, reviver, options);\r\n    }\r\n  });\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\nfabric.ElementsParser = function(elements, callback, options, reviver, parsingOptions, doc) {\r\n  this.elements = elements;\r\n  this.callback = callback;\r\n  this.options = options;\r\n  this.reviver = reviver;\r\n  this.svgUid = (options && options.svgUid) || 0;\r\n  this.parsingOptions = parsingOptions;\r\n  this.regexUrl = /^url\\(['\"]?#([^'\"]+)['\"]?\\)/g;\r\n  this.doc = doc;\r\n};\r\n\r\n(function(proto) {\r\n  proto.parse = function() {\r\n    this.instances = new Array(this.elements.length);\r\n    this.numElements = this.elements.length;\r\n    this.createObjects();\r\n  };\r\n\r\n  proto.createObjects = function() {\r\n    var _this = this;\r\n    this.elements.forEach(function(element, i) {\r\n      element.setAttribute('svgUid', _this.svgUid);\r\n      _this.createObject(element, i);\r\n    });\r\n  };\r\n\r\n  proto.findTag = function(el) {\r\n    return fabric[fabric.util.string.capitalize(el.tagName.replace('svg:', ''))];\r\n  };\r\n\r\n  proto.createObject = function(el, index) {\r\n    var klass = this.findTag(el);\r\n    if (klass && klass.fromElement) {\r\n      try {\r\n        klass.fromElement(el, this.createCallback(index, el), this.options);\r\n      }\r\n      catch (err) {\r\n        fabric.log(err);\r\n      }\r\n    }\r\n    else {\r\n      this.checkIfDone();\r\n    }\r\n  };\r\n\r\n  proto.createCallback = function(index, el) {\r\n    var _this = this;\r\n    return function(obj) {\r\n      var _options;\r\n      _this.resolveGradient(obj, el, 'fill');\r\n      _this.resolveGradient(obj, el, 'stroke');\r\n      if (obj instanceof fabric.Image && obj._originalElement) {\r\n        _options = obj.parsePreserveAspectRatioAttribute(el);\r\n      }\r\n      obj._removeTransformMatrix(_options);\r\n      _this.resolveClipPath(obj, el);\r\n      _this.reviver && _this.reviver(el, obj);\r\n      _this.instances[index] = obj;\r\n      _this.checkIfDone();\r\n    };\r\n  };\r\n\r\n  proto.extractPropertyDefinition = function(obj, property, storage) {\r\n    var value = obj[property], regex = this.regexUrl;\r\n    if (!regex.test(value)) {\r\n      return;\r\n    }\r\n    regex.lastIndex = 0;\r\n    var id = regex.exec(value)[1];\r\n    regex.lastIndex = 0;\r\n    return fabric[storage][this.svgUid][id];\r\n  };\r\n\r\n  proto.resolveGradient = function(obj, el, property) {\r\n    var gradientDef = this.extractPropertyDefinition(obj, property, 'gradientDefs');\r\n    if (gradientDef) {\r\n      var opacityAttr = el.getAttribute(property + '-opacity');\r\n      var gradient = fabric.Gradient.fromElement(gradientDef, obj, opacityAttr, this.options);\r\n      obj.set(property, gradient);\r\n    }\r\n  };\r\n\r\n  proto.createClipPathCallback = function(obj, container) {\r\n    return function(_newObj) {\r\n      _newObj._removeTransformMatrix();\r\n      _newObj.fillRule = _newObj.clipRule;\r\n      container.push(_newObj);\r\n    };\r\n  };\r\n\r\n  proto.resolveClipPath = function(obj, usingElement) {\r\n    var clipPath = this.extractPropertyDefinition(obj, 'clipPath', 'clipPaths'),\r\n        element, klass, objTransformInv, container, gTransform, options;\r\n    if (clipPath) {\r\n      container = [];\r\n      objTransformInv = fabric.util.invertTransform(obj.calcTransformMatrix());\r\n      // move the clipPath tag as sibling to the real element that is using it\r\n      var clipPathTag = clipPath[0].parentNode;\r\n      var clipPathOwner = usingElement;\r\n      while (clipPathOwner.parentNode && clipPathOwner.getAttribute('clip-path') !== obj.clipPath) {\r\n        clipPathOwner = clipPathOwner.parentNode;\r\n      }\r\n      clipPathOwner.parentNode.appendChild(clipPathTag);\r\n      for (var i = 0; i < clipPath.length; i++) {\r\n        element = clipPath[i];\r\n        klass = this.findTag(element);\r\n        klass.fromElement(\r\n          element,\r\n          this.createClipPathCallback(obj, container),\r\n          this.options\r\n        );\r\n      }\r\n      if (container.length === 1) {\r\n        clipPath = container[0];\r\n      }\r\n      else {\r\n        clipPath = new fabric.Group(container);\r\n      }\r\n      gTransform = fabric.util.multiplyTransformMatrices(\r\n        objTransformInv,\r\n        clipPath.calcTransformMatrix()\r\n      );\r\n      if (clipPath.clipPath) {\r\n        this.resolveClipPath(clipPath, clipPathOwner);\r\n      }\r\n      var options = fabric.util.qrDecompose(gTransform);\r\n      clipPath.flipX = false;\r\n      clipPath.flipY = false;\r\n      clipPath.set('scaleX', options.scaleX);\r\n      clipPath.set('scaleY', options.scaleY);\r\n      clipPath.angle = options.angle;\r\n      clipPath.skewX = options.skewX;\r\n      clipPath.skewY = 0;\r\n      clipPath.setPositionByOrigin({ x: options.translateX, y: options.translateY }, 'center', 'center');\r\n      obj.clipPath = clipPath;\r\n    }\r\n    else {\r\n      // if clip-path does not resolve to any element, delete the property.\r\n      delete obj.clipPath;\r\n    }\r\n  };\r\n\r\n  proto.checkIfDone = function() {\r\n    if (--this.numElements === 0) {\r\n      this.instances = this.instances.filter(function(el) {\r\n        // eslint-disable-next-line no-eq-null, eqeqeq\r\n        return el != null;\r\n      });\r\n      this.callback(this.instances, this.elements);\r\n    }\r\n  };\r\n})(fabric.ElementsParser.prototype);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\r\n\r\n  var fabric = global.fabric || (global.fabric = { });\r\n\r\n  if (fabric.Point) {\r\n    fabric.warn('fabric.Point is already defined');\r\n    return;\r\n  }\r\n\r\n  fabric.Point = Point;\r\n\r\n  /**\r\n   * Point class\r\n   * @class fabric.Point\r\n   * @memberOf fabric\r\n   * @constructor\r\n   * @param {Number} x\r\n   * @param {Number} y\r\n   * @return {fabric.Point} thisArg\r\n   */\r\n  function Point(x, y) {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n  Point.prototype = /** @lends fabric.Point.prototype */ {\r\n\r\n    type: 'point',\r\n\r\n    constructor: Point,\r\n\r\n    /**\r\n     * Adds another point to this one and returns another one\r\n     * @param {fabric.Point} that\r\n     * @return {fabric.Point} new Point instance with added values\r\n     */\r\n    add: function (that) {\r\n      return new Point(this.x + that.x, this.y + that.y);\r\n    },\r\n\r\n    /**\r\n     * Adds another point to this one\r\n     * @param {fabric.Point} that\r\n     * @return {fabric.Point} thisArg\r\n     * @chainable\r\n     */\r\n    addEquals: function (that) {\r\n      this.x += that.x;\r\n      this.y += that.y;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Adds value to this point and returns a new one\r\n     * @param {Number} scalar\r\n     * @return {fabric.Point} new Point with added value\r\n     */\r\n    scalarAdd: function (scalar) {\r\n      return new Point(this.x + scalar, this.y + scalar);\r\n    },\r\n\r\n    /**\r\n     * Adds value to this point\r\n     * @param {Number} scalar\r\n     * @return {fabric.Point} thisArg\r\n     * @chainable\r\n     */\r\n    scalarAddEquals: function (scalar) {\r\n      this.x += scalar;\r\n      this.y += scalar;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Subtracts another point from this point and returns a new one\r\n     * @param {fabric.Point} that\r\n     * @return {fabric.Point} new Point object with subtracted values\r\n     */\r\n    subtract: function (that) {\r\n      return new Point(this.x - that.x, this.y - that.y);\r\n    },\r\n\r\n    /**\r\n     * Subtracts another point from this point\r\n     * @param {fabric.Point} that\r\n     * @return {fabric.Point} thisArg\r\n     * @chainable\r\n     */\r\n    subtractEquals: function (that) {\r\n      this.x -= that.x;\r\n      this.y -= that.y;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Subtracts value from this point and returns a new one\r\n     * @param {Number} scalar\r\n     * @return {fabric.Point}\r\n     */\r\n    scalarSubtract: function (scalar) {\r\n      return new Point(this.x - scalar, this.y - scalar);\r\n    },\r\n\r\n    /**\r\n     * Subtracts value from this point\r\n     * @param {Number} scalar\r\n     * @return {fabric.Point} thisArg\r\n     * @chainable\r\n     */\r\n    scalarSubtractEquals: function (scalar) {\r\n      this.x -= scalar;\r\n      this.y -= scalar;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Multiplies this point by a value and returns a new one\r\n     * TODO: rename in scalarMultiply in 2.0\r\n     * @param {Number} scalar\r\n     * @return {fabric.Point}\r\n     */\r\n    multiply: function (scalar) {\r\n      return new Point(this.x * scalar, this.y * scalar);\r\n    },\r\n\r\n    /**\r\n     * Multiplies this point by a value\r\n     * TODO: rename in scalarMultiplyEquals in 2.0\r\n     * @param {Number} scalar\r\n     * @return {fabric.Point} thisArg\r\n     * @chainable\r\n     */\r\n    multiplyEquals: function (scalar) {\r\n      this.x *= scalar;\r\n      this.y *= scalar;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Divides this point by a value and returns a new one\r\n     * TODO: rename in scalarDivide in 2.0\r\n     * @param {Number} scalar\r\n     * @return {fabric.Point}\r\n     */\r\n    divide: function (scalar) {\r\n      return new Point(this.x / scalar, this.y / scalar);\r\n    },\r\n\r\n    /**\r\n     * Divides this point by a value\r\n     * TODO: rename in scalarDivideEquals in 2.0\r\n     * @param {Number} scalar\r\n     * @return {fabric.Point} thisArg\r\n     * @chainable\r\n     */\r\n    divideEquals: function (scalar) {\r\n      this.x /= scalar;\r\n      this.y /= scalar;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns true if this point is equal to another one\r\n     * @param {fabric.Point} that\r\n     * @return {Boolean}\r\n     */\r\n    eq: function (that) {\r\n      return (this.x === that.x && this.y === that.y);\r\n    },\r\n\r\n    /**\r\n     * Returns true if this point is less than another one\r\n     * @param {fabric.Point} that\r\n     * @return {Boolean}\r\n     */\r\n    lt: function (that) {\r\n      return (this.x < that.x && this.y < that.y);\r\n    },\r\n\r\n    /**\r\n     * Returns true if this point is less than or equal to another one\r\n     * @param {fabric.Point} that\r\n     * @return {Boolean}\r\n     */\r\n    lte: function (that) {\r\n      return (this.x <= that.x && this.y <= that.y);\r\n    },\r\n\r\n    /**\r\n\r\n     * Returns true if this point is greater another one\r\n     * @param {fabric.Point} that\r\n     * @return {Boolean}\r\n     */\r\n    gt: function (that) {\r\n      return (this.x > that.x && this.y > that.y);\r\n    },\r\n\r\n    /**\r\n     * Returns true if this point is greater than or equal to another one\r\n     * @param {fabric.Point} that\r\n     * @return {Boolean}\r\n     */\r\n    gte: function (that) {\r\n      return (this.x >= that.x && this.y >= that.y);\r\n    },\r\n\r\n    /**\r\n     * Returns new point which is the result of linear interpolation with this one and another one\r\n     * @param {fabric.Point} that\r\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\r\n     * @return {fabric.Point}\r\n     */\r\n    lerp: function (that, t) {\r\n      if (typeof t === 'undefined') {\r\n        t = 0.5;\r\n      }\r\n      t = Math.max(Math.min(1, t), 0);\r\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\r\n    },\r\n\r\n    /**\r\n     * Returns distance from this point and another one\r\n     * @param {fabric.Point} that\r\n     * @return {Number}\r\n     */\r\n    distanceFrom: function (that) {\r\n      var dx = this.x - that.x,\r\n          dy = this.y - that.y;\r\n      return Math.sqrt(dx * dx + dy * dy);\r\n    },\r\n\r\n    /**\r\n     * Returns the point between this point and another one\r\n     * @param {fabric.Point} that\r\n     * @return {fabric.Point}\r\n     */\r\n    midPointFrom: function (that) {\r\n      return this.lerp(that);\r\n    },\r\n\r\n    /**\r\n     * Returns a new point which is the min of this and another one\r\n     * @param {fabric.Point} that\r\n     * @return {fabric.Point}\r\n     */\r\n    min: function (that) {\r\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\r\n    },\r\n\r\n    /**\r\n     * Returns a new point which is the max of this and another one\r\n     * @param {fabric.Point} that\r\n     * @return {fabric.Point}\r\n     */\r\n    max: function (that) {\r\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\r\n    },\r\n\r\n    /**\r\n     * Returns string representation of this point\r\n     * @return {String}\r\n     */\r\n    toString: function () {\r\n      return this.x + ',' + this.y;\r\n    },\r\n\r\n    /**\r\n     * Sets x/y of this point\r\n     * @param {Number} x\r\n     * @param {Number} y\r\n     * @chainable\r\n     */\r\n    setXY: function (x, y) {\r\n      this.x = x;\r\n      this.y = y;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Sets x of this point\r\n     * @param {Number} x\r\n     * @chainable\r\n     */\r\n    setX: function (x) {\r\n      this.x = x;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Sets y of this point\r\n     * @param {Number} y\r\n     * @chainable\r\n     */\r\n    setY: function (y) {\r\n      this.y = y;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Sets x/y of this point from another point\r\n     * @param {fabric.Point} that\r\n     * @chainable\r\n     */\r\n    setFromPoint: function (that) {\r\n      this.x = that.x;\r\n      this.y = that.y;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Swaps x/y of this point and another point\r\n     * @param {fabric.Point} that\r\n     */\r\n    swap: function (that) {\r\n      var x = this.x,\r\n          y = this.y;\r\n      this.x = that.x;\r\n      this.y = that.y;\r\n      that.x = x;\r\n      that.y = y;\r\n    },\r\n\r\n    /**\r\n     * return a cloned instance of the point\r\n     * @return {fabric.Point}\r\n     */\r\n    clone: function () {\r\n      return new Point(this.x, this.y);\r\n    }\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\r\n  var fabric = global.fabric || (global.fabric = { });\r\n\r\n  if (fabric.Intersection) {\r\n    fabric.warn('fabric.Intersection is already defined');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Intersection class\r\n   * @class fabric.Intersection\r\n   * @memberOf fabric\r\n   * @constructor\r\n   */\r\n  function Intersection(status) {\r\n    this.status = status;\r\n    this.points = [];\r\n  }\r\n\r\n  fabric.Intersection = Intersection;\r\n\r\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\r\n\r\n    constructor: Intersection,\r\n\r\n    /**\r\n     * Appends a point to intersection\r\n     * @param {fabric.Point} point\r\n     * @return {fabric.Intersection} thisArg\r\n     * @chainable\r\n     */\r\n    appendPoint: function (point) {\r\n      this.points.push(point);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Appends points to intersection\r\n     * @param {Array} points\r\n     * @return {fabric.Intersection} thisArg\r\n     * @chainable\r\n     */\r\n    appendPoints: function (points) {\r\n      this.points = this.points.concat(points);\r\n      return this;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Checks if one line intersects another\r\n   * TODO: rename in intersectSegmentSegment\r\n   * @static\r\n   * @param {fabric.Point} a1\r\n   * @param {fabric.Point} a2\r\n   * @param {fabric.Point} b1\r\n   * @param {fabric.Point} b2\r\n   * @return {fabric.Intersection}\r\n   */\r\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\r\n    var result,\r\n        uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\r\n        ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\r\n        uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\r\n    if (uB !== 0) {\r\n      var ua = uaT / uB,\r\n          ub = ubT / uB;\r\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\r\n        result = new Intersection('Intersection');\r\n        result.appendPoint(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\r\n      }\r\n      else {\r\n        result = new Intersection();\r\n      }\r\n    }\r\n    else {\r\n      if (uaT === 0 || ubT === 0) {\r\n        result = new Intersection('Coincident');\r\n      }\r\n      else {\r\n        result = new Intersection('Parallel');\r\n      }\r\n    }\r\n    return result;\r\n  };\r\n\r\n  /**\r\n   * Checks if line intersects polygon\r\n   * TODO: rename in intersectSegmentPolygon\r\n   * fix detection of coincident\r\n   * @static\r\n   * @param {fabric.Point} a1\r\n   * @param {fabric.Point} a2\r\n   * @param {Array} points\r\n   * @return {fabric.Intersection}\r\n   */\r\n  fabric.Intersection.intersectLinePolygon = function(a1, a2, points) {\r\n    var result = new Intersection(),\r\n        length = points.length,\r\n        b1, b2, inter, i;\r\n\r\n    for (i = 0; i < length; i++) {\r\n      b1 = points[i];\r\n      b2 = points[(i + 1) % length];\r\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\r\n\r\n      result.appendPoints(inter.points);\r\n    }\r\n    if (result.points.length > 0) {\r\n      result.status = 'Intersection';\r\n    }\r\n    return result;\r\n  };\r\n\r\n  /**\r\n   * Checks if polygon intersects another polygon\r\n   * @static\r\n   * @param {Array} points1\r\n   * @param {Array} points2\r\n   * @return {fabric.Intersection}\r\n   */\r\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\r\n    var result = new Intersection(),\r\n        length = points1.length, i;\r\n\r\n    for (i = 0; i < length; i++) {\r\n      var a1 = points1[i],\r\n          a2 = points1[(i + 1) % length],\r\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\r\n\r\n      result.appendPoints(inter.points);\r\n    }\r\n    if (result.points.length > 0) {\r\n      result.status = 'Intersection';\r\n    }\r\n    return result;\r\n  };\r\n\r\n  /**\r\n   * Checks if polygon intersects rectangle\r\n   * @static\r\n   * @param {Array} points\r\n   * @param {fabric.Point} r1\r\n   * @param {fabric.Point} r2\r\n   * @return {fabric.Intersection}\r\n   */\r\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\r\n    var min = r1.min(r2),\r\n        max = r1.max(r2),\r\n        topRight = new fabric.Point(max.x, min.y),\r\n        bottomLeft = new fabric.Point(min.x, max.y),\r\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\r\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\r\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\r\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\r\n        result = new Intersection();\r\n\r\n    result.appendPoints(inter1.points);\r\n    result.appendPoints(inter2.points);\r\n    result.appendPoints(inter3.points);\r\n    result.appendPoints(inter4.points);\r\n\r\n    if (result.points.length > 0) {\r\n      result.status = 'Intersection';\r\n    }\r\n    return result;\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { });\r\n\r\n  if (fabric.Color) {\r\n    fabric.warn('fabric.Color is already defined.');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Color class\r\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\r\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\r\n   *\r\n   * @class fabric.Color\r\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\r\n   * @return {fabric.Color} thisArg\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\r\n   */\r\n  function Color(color) {\r\n    if (!color) {\r\n      this.setSource([0, 0, 0, 1]);\r\n    }\r\n    else {\r\n      this._tryParsingColor(color);\r\n    }\r\n  }\r\n\r\n  fabric.Color = Color;\r\n\r\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\r\n\r\n    /**\r\n     * @private\r\n     * @param {String|Array} color Color value to parse\r\n     */\r\n    _tryParsingColor: function(color) {\r\n      var source;\r\n\r\n      if (color in Color.colorNameMap) {\r\n        color = Color.colorNameMap[color];\r\n      }\r\n\r\n      if (color === 'transparent') {\r\n        source = [255, 255, 255, 0];\r\n      }\r\n\r\n      if (!source) {\r\n        source = Color.sourceFromHex(color);\r\n      }\r\n      if (!source) {\r\n        source = Color.sourceFromRgb(color);\r\n      }\r\n      if (!source) {\r\n        source = Color.sourceFromHsl(color);\r\n      }\r\n      if (!source) {\r\n        //if color is not recognize let's make black as canvas does\r\n        source = [0, 0, 0, 1];\r\n      }\r\n      if (source) {\r\n        this.setSource(source);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\r\n     * @private\r\n     * @param {Number} r Red color value\r\n     * @param {Number} g Green color value\r\n     * @param {Number} b Blue color value\r\n     * @return {Array} Hsl color\r\n     */\r\n    _rgbToHsl: function(r, g, b) {\r\n      r /= 255; g /= 255; b /= 255;\r\n\r\n      var h, s, l,\r\n          max = fabric.util.array.max([r, g, b]),\r\n          min = fabric.util.array.min([r, g, b]);\r\n\r\n      l = (max + min) / 2;\r\n\r\n      if (max === min) {\r\n        h = s = 0; // achromatic\r\n      }\r\n      else {\r\n        var d = max - min;\r\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n        switch (max) {\r\n          case r:\r\n            h = (g - b) / d + (g < b ? 6 : 0);\r\n            break;\r\n          case g:\r\n            h = (b - r) / d + 2;\r\n            break;\r\n          case b:\r\n            h = (r - g) / d + 4;\r\n            break;\r\n        }\r\n        h /= 6;\r\n      }\r\n\r\n      return [\r\n        Math.round(h * 360),\r\n        Math.round(s * 100),\r\n        Math.round(l * 100)\r\n      ];\r\n    },\r\n\r\n    /**\r\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\r\n     * @return {Array}\r\n     */\r\n    getSource: function() {\r\n      return this._source;\r\n    },\r\n\r\n    /**\r\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\r\n     * @param {Array} source\r\n     */\r\n    setSource: function(source) {\r\n      this._source = source;\r\n    },\r\n\r\n    /**\r\n     * Returns color representation in RGB format\r\n     * @return {String} ex: rgb(0-255,0-255,0-255)\r\n     */\r\n    toRgb: function() {\r\n      var source = this.getSource();\r\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\r\n    },\r\n\r\n    /**\r\n     * Returns color representation in RGBA format\r\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\r\n     */\r\n    toRgba: function() {\r\n      var source = this.getSource();\r\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\r\n    },\r\n\r\n    /**\r\n     * Returns color representation in HSL format\r\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\r\n     */\r\n    toHsl: function() {\r\n      var source = this.getSource(),\r\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\r\n\r\n      return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';\r\n    },\r\n\r\n    /**\r\n     * Returns color representation in HSLA format\r\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\r\n     */\r\n    toHsla: function() {\r\n      var source = this.getSource(),\r\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\r\n\r\n      return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';\r\n    },\r\n\r\n    /**\r\n     * Returns color representation in HEX format\r\n     * @return {String} ex: FF5555\r\n     */\r\n    toHex: function() {\r\n      var source = this.getSource(), r, g, b;\r\n\r\n      r = source[0].toString(16);\r\n      r = (r.length === 1) ? ('0' + r) : r;\r\n\r\n      g = source[1].toString(16);\r\n      g = (g.length === 1) ? ('0' + g) : g;\r\n\r\n      b = source[2].toString(16);\r\n      b = (b.length === 1) ? ('0' + b) : b;\r\n\r\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\r\n    },\r\n\r\n    /**\r\n     * Returns color representation in HEXA format\r\n     * @return {String} ex: FF5555CC\r\n     */\r\n    toHexa: function() {\r\n      var source = this.getSource(), a;\r\n\r\n      a = Math.round(source[3] * 255);\r\n      a = a.toString(16);\r\n      a = (a.length === 1) ? ('0' + a) : a;\r\n\r\n      return this.toHex() + a.toUpperCase();\r\n    },\r\n\r\n    /**\r\n     * Gets value of alpha channel for this color\r\n     * @return {Number} 0-1\r\n     */\r\n    getAlpha: function() {\r\n      return this.getSource()[3];\r\n    },\r\n\r\n    /**\r\n     * Sets value of alpha channel for this color\r\n     * @param {Number} alpha Alpha value 0-1\r\n     * @return {fabric.Color} thisArg\r\n     */\r\n    setAlpha: function(alpha) {\r\n      var source = this.getSource();\r\n      source[3] = alpha;\r\n      this.setSource(source);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Transforms color to its grayscale representation\r\n     * @return {fabric.Color} thisArg\r\n     */\r\n    toGrayscale: function() {\r\n      var source = this.getSource(),\r\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\r\n          currentAlpha = source[3];\r\n      this.setSource([average, average, average, currentAlpha]);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Transforms color to its black and white representation\r\n     * @param {Number} threshold\r\n     * @return {fabric.Color} thisArg\r\n     */\r\n    toBlackWhite: function(threshold) {\r\n      var source = this.getSource(),\r\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\r\n          currentAlpha = source[3];\r\n\r\n      threshold = threshold || 127;\r\n\r\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\r\n      this.setSource([average, average, average, currentAlpha]);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Overlays color with another color\r\n     * @param {String|fabric.Color} otherColor\r\n     * @return {fabric.Color} thisArg\r\n     */\r\n    overlayWith: function(otherColor) {\r\n      if (!(otherColor instanceof Color)) {\r\n        otherColor = new Color(otherColor);\r\n      }\r\n\r\n      var result = [],\r\n          alpha = this.getAlpha(),\r\n          otherAlpha = 0.5,\r\n          source = this.getSource(),\r\n          otherSource = otherColor.getSource(), i;\r\n\r\n      for (i = 0; i < 3; i++) {\r\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\r\n      }\r\n\r\n      result[3] = alpha;\r\n      this.setSource(result);\r\n      return this;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\r\n   * @static\r\n   * @field\r\n   * @memberOf fabric.Color\r\n   */\r\n  // eslint-disable-next-line max-len\r\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/i;\r\n\r\n  /**\r\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\r\n   * @static\r\n   * @field\r\n   * @memberOf fabric.Color\r\n   */\r\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/i;\r\n\r\n  /**\r\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\r\n   * @static\r\n   * @field\r\n   * @memberOf fabric.Color\r\n   */\r\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\r\n\r\n  /**\r\n   * Map of the 148 color names with HEX code\r\n   * @static\r\n   * @field\r\n   * @memberOf fabric.Color\r\n   * @see: https://www.w3.org/TR/css3-color/#svg-color\r\n   */\r\n  fabric.Color.colorNameMap = {\r\n    aliceblue:            '#F0F8FF',\r\n    antiquewhite:         '#FAEBD7',\r\n    aqua:                 '#00FFFF',\r\n    aquamarine:           '#7FFFD4',\r\n    azure:                '#F0FFFF',\r\n    beige:                '#F5F5DC',\r\n    bisque:               '#FFE4C4',\r\n    black:                '#000000',\r\n    blanchedalmond:       '#FFEBCD',\r\n    blue:                 '#0000FF',\r\n    blueviolet:           '#8A2BE2',\r\n    brown:                '#A52A2A',\r\n    burlywood:            '#DEB887',\r\n    cadetblue:            '#5F9EA0',\r\n    chartreuse:           '#7FFF00',\r\n    chocolate:            '#D2691E',\r\n    coral:                '#FF7F50',\r\n    cornflowerblue:       '#6495ED',\r\n    cornsilk:             '#FFF8DC',\r\n    crimson:              '#DC143C',\r\n    cyan:                 '#00FFFF',\r\n    darkblue:             '#00008B',\r\n    darkcyan:             '#008B8B',\r\n    darkgoldenrod:        '#B8860B',\r\n    darkgray:             '#A9A9A9',\r\n    darkgrey:             '#A9A9A9',\r\n    darkgreen:            '#006400',\r\n    darkkhaki:            '#BDB76B',\r\n    darkmagenta:          '#8B008B',\r\n    darkolivegreen:       '#556B2F',\r\n    darkorange:           '#FF8C00',\r\n    darkorchid:           '#9932CC',\r\n    darkred:              '#8B0000',\r\n    darksalmon:           '#E9967A',\r\n    darkseagreen:         '#8FBC8F',\r\n    darkslateblue:        '#483D8B',\r\n    darkslategray:        '#2F4F4F',\r\n    darkslategrey:        '#2F4F4F',\r\n    darkturquoise:        '#00CED1',\r\n    darkviolet:           '#9400D3',\r\n    deeppink:             '#FF1493',\r\n    deepskyblue:          '#00BFFF',\r\n    dimgray:              '#696969',\r\n    dimgrey:              '#696969',\r\n    dodgerblue:           '#1E90FF',\r\n    firebrick:            '#B22222',\r\n    floralwhite:          '#FFFAF0',\r\n    forestgreen:          '#228B22',\r\n    fuchsia:              '#FF00FF',\r\n    gainsboro:            '#DCDCDC',\r\n    ghostwhite:           '#F8F8FF',\r\n    gold:                 '#FFD700',\r\n    goldenrod:            '#DAA520',\r\n    gray:                 '#808080',\r\n    grey:                 '#808080',\r\n    green:                '#008000',\r\n    greenyellow:          '#ADFF2F',\r\n    honeydew:             '#F0FFF0',\r\n    hotpink:              '#FF69B4',\r\n    indianred:            '#CD5C5C',\r\n    indigo:               '#4B0082',\r\n    ivory:                '#FFFFF0',\r\n    khaki:                '#F0E68C',\r\n    lavender:             '#E6E6FA',\r\n    lavenderblush:        '#FFF0F5',\r\n    lawngreen:            '#7CFC00',\r\n    lemonchiffon:         '#FFFACD',\r\n    lightblue:            '#ADD8E6',\r\n    lightcoral:           '#F08080',\r\n    lightcyan:            '#E0FFFF',\r\n    lightgoldenrodyellow: '#FAFAD2',\r\n    lightgray:            '#D3D3D3',\r\n    lightgrey:            '#D3D3D3',\r\n    lightgreen:           '#90EE90',\r\n    lightpink:            '#FFB6C1',\r\n    lightsalmon:          '#FFA07A',\r\n    lightseagreen:        '#20B2AA',\r\n    lightskyblue:         '#87CEFA',\r\n    lightslategray:       '#778899',\r\n    lightslategrey:       '#778899',\r\n    lightsteelblue:       '#B0C4DE',\r\n    lightyellow:          '#FFFFE0',\r\n    lime:                 '#00FF00',\r\n    limegreen:            '#32CD32',\r\n    linen:                '#FAF0E6',\r\n    magenta:              '#FF00FF',\r\n    maroon:               '#800000',\r\n    mediumaquamarine:     '#66CDAA',\r\n    mediumblue:           '#0000CD',\r\n    mediumorchid:         '#BA55D3',\r\n    mediumpurple:         '#9370DB',\r\n    mediumseagreen:       '#3CB371',\r\n    mediumslateblue:      '#7B68EE',\r\n    mediumspringgreen:    '#00FA9A',\r\n    mediumturquoise:      '#48D1CC',\r\n    mediumvioletred:      '#C71585',\r\n    midnightblue:         '#191970',\r\n    mintcream:            '#F5FFFA',\r\n    mistyrose:            '#FFE4E1',\r\n    moccasin:             '#FFE4B5',\r\n    navajowhite:          '#FFDEAD',\r\n    navy:                 '#000080',\r\n    oldlace:              '#FDF5E6',\r\n    olive:                '#808000',\r\n    olivedrab:            '#6B8E23',\r\n    orange:               '#FFA500',\r\n    orangered:            '#FF4500',\r\n    orchid:               '#DA70D6',\r\n    palegoldenrod:        '#EEE8AA',\r\n    palegreen:            '#98FB98',\r\n    paleturquoise:        '#AFEEEE',\r\n    palevioletred:        '#DB7093',\r\n    papayawhip:           '#FFEFD5',\r\n    peachpuff:            '#FFDAB9',\r\n    peru:                 '#CD853F',\r\n    pink:                 '#FFC0CB',\r\n    plum:                 '#DDA0DD',\r\n    powderblue:           '#B0E0E6',\r\n    purple:               '#800080',\r\n    rebeccapurple:        '#663399',\r\n    red:                  '#FF0000',\r\n    rosybrown:            '#BC8F8F',\r\n    royalblue:            '#4169E1',\r\n    saddlebrown:          '#8B4513',\r\n    salmon:               '#FA8072',\r\n    sandybrown:           '#F4A460',\r\n    seagreen:             '#2E8B57',\r\n    seashell:             '#FFF5EE',\r\n    sienna:               '#A0522D',\r\n    silver:               '#C0C0C0',\r\n    skyblue:              '#87CEEB',\r\n    slateblue:            '#6A5ACD',\r\n    slategray:            '#708090',\r\n    slategrey:            '#708090',\r\n    snow:                 '#FFFAFA',\r\n    springgreen:          '#00FF7F',\r\n    steelblue:            '#4682B4',\r\n    tan:                  '#D2B48C',\r\n    teal:                 '#008080',\r\n    thistle:              '#D8BFD8',\r\n    tomato:               '#FF6347',\r\n    turquoise:            '#40E0D0',\r\n    violet:               '#EE82EE',\r\n    wheat:                '#F5DEB3',\r\n    white:                '#FFFFFF',\r\n    whitesmoke:           '#F5F5F5',\r\n    yellow:               '#FFFF00',\r\n    yellowgreen:          '#9ACD32'\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   * @param {Number} p\r\n   * @param {Number} q\r\n   * @param {Number} t\r\n   * @return {Number}\r\n   */\r\n  function hue2rgb(p, q, t) {\r\n    if (t < 0) {\r\n      t += 1;\r\n    }\r\n    if (t > 1) {\r\n      t -= 1;\r\n    }\r\n    if (t < 1 / 6) {\r\n      return p + (q - p) * 6 * t;\r\n    }\r\n    if (t < 1 / 2) {\r\n      return q;\r\n    }\r\n    if (t < 2 / 3) {\r\n      return p + (q - p) * (2 / 3 - t) * 6;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  /**\r\n   * Returns new color object, when given a color in RGB format\r\n   * @memberOf fabric.Color\r\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\r\n   * @return {fabric.Color}\r\n   */\r\n  fabric.Color.fromRgb = function(color) {\r\n    return Color.fromSource(Color.sourceFromRgb(color));\r\n  };\r\n\r\n  /**\r\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\r\n   * @memberOf fabric.Color\r\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\r\n   * @return {Array} source\r\n   */\r\n  fabric.Color.sourceFromRgb = function(color) {\r\n    var match = color.match(Color.reRGBa);\r\n    if (match) {\r\n      var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),\r\n          g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),\r\n          b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);\r\n\r\n      return [\r\n        parseInt(r, 10),\r\n        parseInt(g, 10),\r\n        parseInt(b, 10),\r\n        match[4] ? parseFloat(match[4]) : 1\r\n      ];\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Returns new color object, when given a color in RGBA format\r\n   * @static\r\n   * @function\r\n   * @memberOf fabric.Color\r\n   * @param {String} color\r\n   * @return {fabric.Color}\r\n   */\r\n  fabric.Color.fromRgba = Color.fromRgb;\r\n\r\n  /**\r\n   * Returns new color object, when given a color in HSL format\r\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\r\n   * @memberOf fabric.Color\r\n   * @return {fabric.Color}\r\n   */\r\n  fabric.Color.fromHsl = function(color) {\r\n    return Color.fromSource(Color.sourceFromHsl(color));\r\n  };\r\n\r\n  /**\r\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\r\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\r\n   * @memberOf fabric.Color\r\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\r\n   * @return {Array} source\r\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\r\n   */\r\n  fabric.Color.sourceFromHsl = function(color) {\r\n    var match = color.match(Color.reHSLa);\r\n    if (!match) {\r\n      return;\r\n    }\r\n\r\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\r\n        s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\r\n        l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\r\n        r, g, b;\r\n\r\n    if (s === 0) {\r\n      r = g = b = l;\r\n    }\r\n    else {\r\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\r\n          p = l * 2 - q;\r\n\r\n      r = hue2rgb(p, q, h + 1 / 3);\r\n      g = hue2rgb(p, q, h);\r\n      b = hue2rgb(p, q, h - 1 / 3);\r\n    }\r\n\r\n    return [\r\n      Math.round(r * 255),\r\n      Math.round(g * 255),\r\n      Math.round(b * 255),\r\n      match[4] ? parseFloat(match[4]) : 1\r\n    ];\r\n  };\r\n\r\n  /**\r\n   * Returns new color object, when given a color in HSLA format\r\n   * @static\r\n   * @function\r\n   * @memberOf fabric.Color\r\n   * @param {String} color\r\n   * @return {fabric.Color}\r\n   */\r\n  fabric.Color.fromHsla = Color.fromHsl;\r\n\r\n  /**\r\n   * Returns new color object, when given a color in HEX format\r\n   * @static\r\n   * @memberOf fabric.Color\r\n   * @param {String} color Color value ex: FF5555\r\n   * @return {fabric.Color}\r\n   */\r\n  fabric.Color.fromHex = function(color) {\r\n    return Color.fromSource(Color.sourceFromHex(color));\r\n  };\r\n\r\n  /**\r\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\r\n   * @static\r\n   * @memberOf fabric.Color\r\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\r\n   * @return {Array} source\r\n   */\r\n  fabric.Color.sourceFromHex = function(color) {\r\n    if (color.match(Color.reHex)) {\r\n      var value = color.slice(color.indexOf('#') + 1),\r\n          isShortNotation = (value.length === 3 || value.length === 4),\r\n          isRGBa = (value.length === 8 || value.length === 4),\r\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\r\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\r\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6),\r\n          a = isRGBa ? (isShortNotation ? (value.charAt(3) + value.charAt(3)) : value.substring(6, 8)) : 'FF';\r\n\r\n      return [\r\n        parseInt(r, 16),\r\n        parseInt(g, 16),\r\n        parseInt(b, 16),\r\n        parseFloat((parseInt(a, 16) / 255).toFixed(2))\r\n      ];\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\r\n   * @static\r\n   * @memberOf fabric.Color\r\n   * @param {Array} source\r\n   * @return {fabric.Color}\r\n   */\r\n  fabric.Color.fromSource = function(source) {\r\n    var oColor = new Color();\r\n    oColor.setSource(source);\r\n    return oColor;\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      scaleMap = ['e', 'se', 's', 'sw', 'w', 'nw', 'n', 'ne', 'e'],\r\n      skewMap = ['ns', 'nesw', 'ew', 'nwse'],\r\n      controls = {},\r\n      LEFT = 'left', TOP = 'top', RIGHT = 'right', BOTTOM = 'bottom', CENTER = 'center',\r\n      opposite = {\r\n        top: BOTTOM,\r\n        bottom: TOP,\r\n        left: RIGHT,\r\n        right: LEFT,\r\n        center: CENTER,\r\n      }, radiansToDegrees = fabric.util.radiansToDegrees,\r\n      sign = (Math.sign || function(x) { return ((x > 0) - (x < 0)) || +x; });\r\n\r\n  /**\r\n   * Combine control position and object angle to find the control direction compared\r\n   * to the object center.\r\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\r\n   * @param {fabric.Control} control the control class\r\n   * @return {Number} 0 - 7 a quadrant number\r\n   */\r\n  function findCornerQuadrant(fabricObject, control) {\r\n    var cornerAngle = fabricObject.angle + radiansToDegrees(Math.atan2(control.y, control.x)) + 360;\r\n    return Math.round((cornerAngle % 360) / 45);\r\n  }\r\n\r\n  function fireEvent(eventName, options) {\r\n    var target = options.transform.target,\r\n        canvas = target.canvas,\r\n        canvasOptions = fabric.util.object.clone(options);\r\n    canvasOptions.target = target;\r\n    canvas && canvas.fire('object:' + eventName, canvasOptions);\r\n    target.fire(eventName, options);\r\n  }\r\n\r\n  /**\r\n   * Inspect event and fabricObject properties to understand if the scaling action\r\n   * @param {Event} eventData from the user action\r\n   * @param {fabric.Object} fabricObject the fabric object about to scale\r\n   * @return {Boolean} true if scale is proportional\r\n   */\r\n  function scaleIsProportional(eventData, fabricObject) {\r\n    var canvas = fabricObject.canvas, uniScaleKey = canvas.uniScaleKey,\r\n        uniformIsToggled = eventData[uniScaleKey];\r\n    return (canvas.uniformScaling && !uniformIsToggled) ||\r\n    (!canvas.uniformScaling && uniformIsToggled);\r\n  }\r\n\r\n  /**\r\n   * Checks if transform is centered\r\n   * @param {Object} transform transform data\r\n   * @return {Boolean} true if transform is centered\r\n   */\r\n  function isTransformCentered(transform) {\r\n    return transform.originX === CENTER && transform.originY === CENTER;\r\n  }\r\n\r\n  /**\r\n   * Inspect fabricObject to understand if the current scaling action is allowed\r\n   * @param {fabric.Object} fabricObject the fabric object about to scale\r\n   * @param {String} by 'x' or 'y' or ''\r\n   * @param {Boolean} scaleProportionally true if we are trying to scale proportionally\r\n   * @return {Boolean} true if scaling is not allowed at current conditions\r\n   */\r\n  function scalingIsForbidden(fabricObject, by, scaleProportionally) {\r\n    var lockX = fabricObject.lockScalingX, lockY = fabricObject.lockScalingY;\r\n    if (lockX && lockY) {\r\n      return true;\r\n    }\r\n    if (!by && (lockX || lockY) && scaleProportionally) {\r\n      return true;\r\n    }\r\n    if (lockX && by === 'x') {\r\n      return true;\r\n    }\r\n    if (lockY && by === 'y') {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * return the correct cursor style for the scale action\r\n   * @param {Event} eventData the javascript event that is causing the scale\r\n   * @param {fabric.Control} control the control that is interested in the action\r\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\r\n   * @return {String} a valid css string for the cursor\r\n   */\r\n  function scaleCursorStyleHandler(eventData, control, fabricObject) {\r\n    var notAllowed = 'not-allowed',\r\n        scaleProportionally = scaleIsProportional(eventData, fabricObject),\r\n        by = '';\r\n    if (control.x !== 0 && control.y === 0) {\r\n      by = 'x';\r\n    }\r\n    else if (control.x === 0 && control.y !== 0) {\r\n      by = 'y';\r\n    }\r\n    if (scalingIsForbidden(fabricObject, by, scaleProportionally)) {\r\n      return notAllowed;\r\n    }\r\n    var n = findCornerQuadrant(fabricObject, control);\r\n    return scaleMap[n] + '-resize';\r\n  }\r\n\r\n  /**\r\n   * return the correct cursor style for the skew action\r\n   * @param {Event} eventData the javascript event that is causing the scale\r\n   * @param {fabric.Control} control the control that is interested in the action\r\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\r\n   * @return {String} a valid css string for the cursor\r\n   */\r\n  function skewCursorStyleHandler(eventData, control, fabricObject) {\r\n    var notAllowed = 'not-allowed';\r\n    if (control.x !== 0 && fabricObject.lockSkewingY) {\r\n      return notAllowed;\r\n    }\r\n    if (control.y !== 0 && fabricObject.lockSkewingX) {\r\n      return notAllowed;\r\n    }\r\n    var n = findCornerQuadrant(fabricObject, control) % 4;\r\n    return skewMap[n] + '-resize';\r\n  }\r\n\r\n  /**\r\n   * Combine skew and scale style handlers to cover fabric standard use case\r\n   * @param {Event} eventData the javascript event that is causing the scale\r\n   * @param {fabric.Control} control the control that is interested in the action\r\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\r\n   * @return {String} a valid css string for the cursor\r\n   */\r\n  function scaleSkewCursorStyleHandler(eventData, control, fabricObject) {\r\n    if (eventData[fabricObject.canvas.altActionKey]) {\r\n      return controls.skewCursorStyleHandler(eventData, control, fabricObject);\r\n    }\r\n    return controls.scaleCursorStyleHandler(eventData, control, fabricObject);\r\n  }\r\n\r\n  /**\r\n   * Inspect event, control and fabricObject to return the correct action name\r\n   * @param {Event} eventData the javascript event that is causing the scale\r\n   * @param {fabric.Control} control the control that is interested in the action\r\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\r\n   * @return {String} an action name\r\n   */\r\n  function scaleOrSkewActionName(eventData, control, fabricObject) {\r\n    var isAlternative = eventData[fabricObject.canvas.altActionKey];\r\n    if (control.x === 0) {\r\n      // then is scaleY or skewX\r\n      return isAlternative ? 'skewX' : 'scaleY';\r\n    }\r\n    if (control.y === 0) {\r\n      // then is scaleY or skewX\r\n      return isAlternative ? 'skewY' : 'scaleX';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the correct style for the control that is used for rotation.\r\n   * this function is very simple and it just take care of not-allowed or standard cursor\r\n   * @param {Event} eventData the javascript event that is causing the scale\r\n   * @param {fabric.Control} control the control that is interested in the action\r\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\r\n   * @return {String} a valid css string for the cursor\r\n   */\r\n  function rotationStyleHandler(eventData, control, fabricObject) {\r\n    if (fabricObject.lockRotation) {\r\n      return 'not-allowed';\r\n    }\r\n    return control.cursorStyle;\r\n  }\r\n\r\n  function commonEventInfo(eventData, transform, x, y) {\r\n    return {\r\n      e: eventData,\r\n      transform: transform,\r\n      pointer: {\r\n        x: x,\r\n        y: y,\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Wrap an action handler with saving/restoring object position on the transform.\r\n   * this is the code that permits to objects to keep their position while transforming.\r\n   * @param {Function} actionHandler the function to wrap\r\n   * @return {Function} a function with an action handler signature\r\n   */\r\n  function wrapWithFixedAnchor(actionHandler) {\r\n    return function(eventData, transform, x, y) {\r\n      var target = transform.target, centerPoint = target.getCenterPoint(),\r\n          constraint = target.translateToOriginPoint(centerPoint, transform.originX, transform.originY),\r\n          actionPerformed = actionHandler(eventData, transform, x, y);\r\n      target.setPositionByOrigin(constraint, transform.originX, transform.originY);\r\n      return actionPerformed;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Wrap an action handler with firing an event if the action is performed\r\n   * @param {Function} actionHandler the function to wrap\r\n   * @return {Function} a function with an action handler signature\r\n   */\r\n  function wrapWithFireEvent(eventName, actionHandler) {\r\n    return function(eventData, transform, x, y) {\r\n      var actionPerformed = actionHandler(eventData, transform, x, y);\r\n      if (actionPerformed) {\r\n        fireEvent(eventName, commonEventInfo(eventData, transform, x, y));\r\n      }\r\n      return actionPerformed;\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Transforms a point described by x and y in a distance from the top left corner of the object\r\n   * bounding box.\r\n   * @param {Object} transform\r\n   * @param {String} originX\r\n   * @param {String} originY\r\n   * @param {number} x\r\n   * @param {number} y\r\n   * @return {Fabric.Point} the normalized point\r\n   */\r\n  function getLocalPoint(transform, originX, originY, x, y) {\r\n    var target = transform.target,\r\n        control = target.controls[transform.corner],\r\n        zoom = target.canvas.getZoom(),\r\n        padding = target.padding / zoom,\r\n        localPoint = target.toLocalPoint(new fabric.Point(x, y), originX, originY);\r\n    if (localPoint.x >= padding) {\r\n      localPoint.x -= padding;\r\n    }\r\n    if (localPoint.x <= -padding) {\r\n      localPoint.x += padding;\r\n    }\r\n    if (localPoint.y >= padding) {\r\n      localPoint.y -= padding;\r\n    }\r\n    if (localPoint.y <= padding) {\r\n      localPoint.y += padding;\r\n    }\r\n    localPoint.x -= control.offsetX;\r\n    localPoint.y -= control.offsetY;\r\n    return localPoint;\r\n  }\r\n\r\n  /**\r\n   * Detect if the fabric object is flipped on one side.\r\n   * @param {fabric.Object} target\r\n   * @return {Boolean} true if one flip, but not two.\r\n   */\r\n  function targetHasOneFlip(target) {\r\n    return target.flipX !== target.flipY;\r\n  }\r\n\r\n  /**\r\n   * Utility function to compensate the scale factor when skew is applied on both axes\r\n   * @private\r\n   */\r\n  function compensateScaleForSkew(target, oppositeSkew, scaleToCompensate, axis, reference) {\r\n    if (target[oppositeSkew] !== 0) {\r\n      var newDim = target._getTransformedDimensions()[axis];\r\n      var newValue = reference / newDim * target[scaleToCompensate];\r\n      target.set(scaleToCompensate, newValue);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Action handler for skewing on the X axis\r\n   * @private\r\n   */\r\n  function skewObjectX(eventData, transform, x, y) {\r\n    var target = transform.target,\r\n        // find how big the object would be, if there was no skewX. takes in account scaling\r\n        dimNoSkew = target._getTransformedDimensions(0, target.skewY),\r\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\r\n        // the mouse is in the center of the object, and we want it to stay there.\r\n        // so the object will grow twice as much as the mouse.\r\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\r\n        totalSkewSize = Math.abs(localPoint.x * 2) - dimNoSkew.x,\r\n        currentSkew = target.skewX, newSkew;\r\n    if (totalSkewSize < 2) {\r\n      // let's make it easy to go back to position 0.\r\n      newSkew = 0;\r\n    }\r\n    else {\r\n      newSkew = radiansToDegrees(\r\n        Math.atan2((totalSkewSize / target.scaleX), (dimNoSkew.y / target.scaleY))\r\n      );\r\n      // now we have to find the sign of the skew.\r\n      // it mostly depend on the origin of transformation.\r\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\r\n        newSkew = -newSkew;\r\n      }\r\n      if (transform.originX === RIGHT && transform.originY === TOP) {\r\n        newSkew = -newSkew;\r\n      }\r\n      if (targetHasOneFlip(target)) {\r\n        newSkew = -newSkew;\r\n      }\r\n    }\r\n    var hasSkewed = currentSkew !== newSkew;\r\n    if (hasSkewed) {\r\n      var dimBeforeSkewing = target._getTransformedDimensions().y;\r\n      target.set('skewX', newSkew);\r\n      compensateScaleForSkew(target, 'skewY', 'scaleY', 'y', dimBeforeSkewing);\r\n    }\r\n    return hasSkewed;\r\n  }\r\n\r\n  /**\r\n   * Action handler for skewing on the Y axis\r\n   * @private\r\n   */\r\n  function skewObjectY(eventData, transform, x, y) {\r\n    var target = transform.target,\r\n        // find how big the object would be, if there was no skewX. takes in account scaling\r\n        dimNoSkew = target._getTransformedDimensions(target.skewX, 0),\r\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\r\n        // the mouse is in the center of the object, and we want it to stay there.\r\n        // so the object will grow twice as much as the mouse.\r\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\r\n        totalSkewSize = Math.abs(localPoint.y * 2) - dimNoSkew.y,\r\n        currentSkew = target.skewY, newSkew;\r\n    if (totalSkewSize < 2) {\r\n      // let's make it easy to go back to position 0.\r\n      newSkew = 0;\r\n    }\r\n    else {\r\n      newSkew = radiansToDegrees(\r\n        Math.atan2((totalSkewSize / target.scaleY), (dimNoSkew.x / target.scaleX))\r\n      );\r\n      // now we have to find the sign of the skew.\r\n      // it mostly depend on the origin of transformation.\r\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\r\n        newSkew = -newSkew;\r\n      }\r\n      if (transform.originX === RIGHT && transform.originY === TOP) {\r\n        newSkew = -newSkew;\r\n      }\r\n      if (targetHasOneFlip(target)) {\r\n        newSkew = -newSkew;\r\n      }\r\n    }\r\n    var hasSkewed = currentSkew !== newSkew;\r\n    if (hasSkewed) {\r\n      var dimBeforeSkewing = target._getTransformedDimensions().x;\r\n      target.set('skewY', newSkew);\r\n      compensateScaleForSkew(target, 'skewX', 'scaleX', 'x', dimBeforeSkewing);\r\n    }\r\n    return hasSkewed;\r\n  }\r\n\r\n  /**\r\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\r\n   * skew direction and determine the correct transform origin for the anchor point\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   */\r\n  function skewHandlerX(eventData, transform, x, y) {\r\n    // step1 figure out and change transform origin.\r\n    // if skewX > 0 and originY bottom we anchor on right\r\n    // if skewX > 0 and originY top we anchor on left\r\n    // if skewX < 0 and originY bottom we anchor on left\r\n    // if skewX < 0 and originY top we anchor on right\r\n    // if skewX is 0, we look for mouse position to understand where are we going.\r\n    var target = transform.target, currentSkew = target.skewX, originX, originY = transform.originY;\r\n    if (target.lockSkewingX) {\r\n      return false;\r\n    }\r\n    if (currentSkew === 0) {\r\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\r\n      if (localPointFromCenter.x > 0) {\r\n        // we are pulling right, anchor left;\r\n        originX = LEFT;\r\n      }\r\n      else {\r\n        // we are pulling right, anchor right\r\n        originX = RIGHT;\r\n      }\r\n    }\r\n    else {\r\n      if (currentSkew > 0) {\r\n        originX = originY === TOP ? LEFT : RIGHT;\r\n      }\r\n      if (currentSkew < 0) {\r\n        originX = originY === TOP ? RIGHT : LEFT;\r\n      }\r\n      // is the object flipped on one side only? swap the origin.\r\n      if (targetHasOneFlip(target)) {\r\n        originX = originX === LEFT ? RIGHT : LEFT;\r\n      }\r\n    }\r\n\r\n    // once we have the origin, we find the anchor point\r\n    transform.originX = originX;\r\n    var finalHandler = wrapWithFireEvent('skewing', wrapWithFixedAnchor(skewObjectX));\r\n    return finalHandler(eventData, transform, x, y);\r\n  }\r\n\r\n  /**\r\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\r\n   * skew direction and determine the correct transform origin for the anchor point\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   */\r\n  function skewHandlerY(eventData, transform, x, y) {\r\n    // step1 figure out and change transform origin.\r\n    // if skewY > 0 and originX left we anchor on top\r\n    // if skewY > 0 and originX right we anchor on bottom\r\n    // if skewY < 0 and originX left we anchor on bottom\r\n    // if skewY < 0 and originX right we anchor on top\r\n    // if skewY is 0, we look for mouse position to understand where are we going.\r\n    var target = transform.target, currentSkew = target.skewY, originY, originX = transform.originX;\r\n    if (target.lockSkewingY) {\r\n      return false;\r\n    }\r\n    if (currentSkew === 0) {\r\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\r\n      if (localPointFromCenter.y > 0) {\r\n        // we are pulling down, anchor up;\r\n        originY = TOP;\r\n      }\r\n      else {\r\n        // we are pulling up, anchor down\r\n        originY = BOTTOM;\r\n      }\r\n    }\r\n    else {\r\n      if (currentSkew > 0) {\r\n        originY = originX === LEFT ? TOP : BOTTOM;\r\n      }\r\n      if (currentSkew < 0) {\r\n        originY = originX === LEFT ? BOTTOM : TOP;\r\n      }\r\n      // is the object flipped on one side only? swap the origin.\r\n      if (targetHasOneFlip(target)) {\r\n        originY = originY === TOP ? BOTTOM : TOP;\r\n      }\r\n    }\r\n\r\n    // once we have the origin, we find the anchor point\r\n    transform.originY = originY;\r\n    var finalHandler = wrapWithFireEvent('skewing', wrapWithFixedAnchor(skewObjectY));\r\n    return finalHandler(eventData, transform, x, y);\r\n  }\r\n\r\n  /**\r\n   * Action handler for rotation and snapping, without anchor point.\r\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   * @private\r\n   */\r\n  function rotationWithSnapping(eventData, transform, x, y) {\r\n    var t = transform,\r\n        target = t.target,\r\n        pivotPoint = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY);\r\n\r\n    if (target.lockRotation) {\r\n      return false;\r\n    }\r\n\r\n    var lastAngle = Math.atan2(t.ey - pivotPoint.y, t.ex - pivotPoint.x),\r\n        curAngle = Math.atan2(y - pivotPoint.y, x - pivotPoint.x),\r\n        angle = radiansToDegrees(curAngle - lastAngle + t.theta),\r\n        hasRotated = true;\r\n\r\n    if (target.snapAngle > 0) {\r\n      var snapAngle  = target.snapAngle,\r\n          snapThreshold  = target.snapThreshold || snapAngle,\r\n          rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\r\n          leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\r\n\r\n      if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\r\n        angle = leftAngleLocked;\r\n      }\r\n      else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\r\n        angle = rightAngleLocked;\r\n      }\r\n    }\r\n\r\n    // normalize angle to positive value\r\n    if (angle < 0) {\r\n      angle = 360 + angle;\r\n    }\r\n    angle %= 360;\r\n\r\n    hasRotated = target.angle !== angle;\r\n    target.angle = angle;\r\n    return hasRotated;\r\n  }\r\n\r\n  /**\r\n   * Basic scaling logic, reused with different constrain for scaling X,Y, freely or equally.\r\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @param {Object} options additional information for scaling\r\n   * @param {String} options.by 'x', 'y', 'equally' or '' to indicate type of scaling\r\n   * @return {Boolean} true if some change happened\r\n   * @private\r\n   */\r\n  function scaleObject(eventData, transform, x, y, options) {\r\n    options = options || {};\r\n    var target = transform.target,\r\n        lockScalingX = target.lockScalingX, lockScalingY = target.lockScalingY,\r\n        by = options.by, newPoint, scaleX, scaleY, dim,\r\n        scaleProportionally = scaleIsProportional(eventData, target),\r\n        forbidScaling = scalingIsForbidden(target, by, scaleProportionally),\r\n        signX, signY, gestureScale = transform.gestureScale;\r\n\r\n    if (forbidScaling) {\r\n      return false;\r\n    }\r\n    if (gestureScale) {\r\n      scaleX = transform.scaleX * gestureScale;\r\n      scaleY = transform.scaleY * gestureScale;\r\n    }\r\n    else {\r\n      newPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y);\r\n      // use of sign: We use sign to detect change of direction of an action. sign usually change when\r\n      // we cross the origin point with the mouse. So a scale flip for example. There is an issue when scaling\r\n      // by center and scaling using one middle control ( default: mr, mt, ml, mb), the mouse movement can easily\r\n      // cross many time the origin point and flip the object. so we need a way to filter out the noise.\r\n      // This ternary here should be ok to filter out X scaling when we want Y only and vice versa.\r\n      signX = by !== 'y' ? sign(newPoint.x) : 1;\r\n      signY = by !== 'x' ? sign(newPoint.y) : 1;\r\n      if (!transform.signX) {\r\n        transform.signX = signX;\r\n      }\r\n      if (!transform.signY) {\r\n        transform.signY = signY;\r\n      }\r\n\r\n      if (target.lockScalingFlip &&\r\n        (transform.signX !== signX || transform.signY !== signY)\r\n      ) {\r\n        return false;\r\n      }\r\n\r\n      dim = target._getTransformedDimensions();\r\n      // missing detection of flip and logic to switch the origin\r\n      if (scaleProportionally && !by) {\r\n        // uniform scaling\r\n        var distance = Math.abs(newPoint.x) + Math.abs(newPoint.y),\r\n            original = transform.original,\r\n            originalDistance = Math.abs(dim.x * original.scaleX / target.scaleX) +\r\n              Math.abs(dim.y * original.scaleY / target.scaleY),\r\n            scale = distance / originalDistance;\r\n        scaleX = original.scaleX * scale;\r\n        scaleY = original.scaleY * scale;\r\n      }\r\n      else {\r\n        scaleX = Math.abs(newPoint.x * target.scaleX / dim.x);\r\n        scaleY = Math.abs(newPoint.y * target.scaleY / dim.y);\r\n      }\r\n      // if we are scaling by center, we need to double the scale\r\n      if (isTransformCentered(transform)) {\r\n        scaleX *= 2;\r\n        scaleY *= 2;\r\n      }\r\n      if (transform.signX !== signX && by !== 'y') {\r\n        transform.originX = opposite[transform.originX];\r\n        scaleX *= -1;\r\n        transform.signX = signX;\r\n      }\r\n      if (transform.signY !== signY && by !== 'x') {\r\n        transform.originY = opposite[transform.originY];\r\n        scaleY *= -1;\r\n        transform.signY = signY;\r\n      }\r\n    }\r\n    // minScale is taken are in the setter.\r\n    var oldScaleX = target.scaleX, oldScaleY = target.scaleY;\r\n    if (!by) {\r\n      !lockScalingX && target.set('scaleX', scaleX);\r\n      !lockScalingY && target.set('scaleY', scaleY);\r\n    }\r\n    else {\r\n      // forbidden cases already handled on top here.\r\n      by === 'x' && target.set('scaleX', scaleX);\r\n      by === 'y' && target.set('scaleY', scaleY);\r\n    }\r\n    return oldScaleX !== target.scaleX || oldScaleY !== target.scaleY;\r\n  }\r\n\r\n  /**\r\n   * Generic scaling logic, to scale from corners either equally or freely.\r\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   */\r\n  function scaleObjectFromCorner(eventData, transform, x, y) {\r\n    return scaleObject(eventData, transform, x, y);\r\n  }\r\n\r\n  /**\r\n   * Scaling logic for the X axis.\r\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   */\r\n  function scaleObjectX(eventData, transform, x, y) {\r\n    return scaleObject(eventData, transform, x, y , { by: 'x' });\r\n  }\r\n\r\n  /**\r\n   * Scaling logic for the Y axis.\r\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   */\r\n  function scaleObjectY(eventData, transform, x, y) {\r\n    return scaleObject(eventData, transform, x, y , { by: 'y' });\r\n  }\r\n\r\n  /**\r\n   * Composed action handler to either scale Y or skew X\r\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   */\r\n  function scalingYOrSkewingX(eventData, transform, x, y) {\r\n    // ok some safety needed here.\r\n    if (eventData[transform.target.canvas.altActionKey]) {\r\n      return controls.skewHandlerX(eventData, transform, x, y);\r\n    }\r\n    return controls.scalingY(eventData, transform, x, y);\r\n  }\r\n\r\n  /**\r\n   * Composed action handler to either scale X or skew Y\r\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   */\r\n  function scalingXOrSkewingY(eventData, transform, x, y) {\r\n    // ok some safety needed here.\r\n    if (eventData[transform.target.canvas.altActionKey]) {\r\n      return controls.skewHandlerY(eventData, transform, x, y);\r\n    }\r\n    return controls.scalingX(eventData, transform, x, y);\r\n  }\r\n\r\n  /**\r\n   * Action handler to change textbox width\r\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if some change happened\r\n   */\r\n  function changeWidth(eventData, transform, x, y) {\r\n    var target = transform.target, localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\r\n        strokePadding = target.strokeWidth / (target.strokeUniform ? target.scaleX : 1),\r\n        multiplier = isTransformCentered(transform) ? 2 : 1,\r\n        oldWidth = target.width,\r\n        newWidth = Math.abs(localPoint.x * multiplier / target.scaleX) - strokePadding;\r\n    target.set('width', Math.max(newWidth, 0));\r\n    return oldWidth !== newWidth;\r\n  }\r\n\r\n  /**\r\n   * Action handler\r\n   * @private\r\n   * @param {Event} eventData javascript event that is doing the transform\r\n   * @param {Object} transform javascript object containing a series of information around the current transform\r\n   * @param {number} x current mouse x position, canvas normalized\r\n   * @param {number} y current mouse y position, canvas normalized\r\n   * @return {Boolean} true if the translation occurred\r\n   */\r\n  function dragHandler(eventData, transform, x, y) {\r\n    var target = transform.target,\r\n        newLeft = x - transform.offsetX,\r\n        newTop = y - transform.offsetY,\r\n        moveX = !target.get('lockMovementX') && target.left !== newLeft,\r\n        moveY = !target.get('lockMovementY') && target.top !== newTop;\r\n    moveX && target.set('left', newLeft);\r\n    moveY && target.set('top', newTop);\r\n    if (moveX || moveY) {\r\n      fireEvent('moving', commonEventInfo(eventData, transform, x, y));\r\n    }\r\n    return moveX || moveY;\r\n  }\r\n\r\n  controls.scaleCursorStyleHandler = scaleCursorStyleHandler;\r\n  controls.skewCursorStyleHandler = skewCursorStyleHandler;\r\n  controls.scaleSkewCursorStyleHandler = scaleSkewCursorStyleHandler;\r\n  controls.rotationWithSnapping = wrapWithFireEvent('rotating', wrapWithFixedAnchor(rotationWithSnapping));\r\n  controls.scalingEqually = wrapWithFireEvent('scaling', wrapWithFixedAnchor( scaleObjectFromCorner));\r\n  controls.scalingX = wrapWithFireEvent('scaling', wrapWithFixedAnchor(scaleObjectX));\r\n  controls.scalingY = wrapWithFireEvent('scaling', wrapWithFixedAnchor(scaleObjectY));\r\n  controls.scalingYOrSkewingX = scalingYOrSkewingX;\r\n  controls.scalingXOrSkewingY = scalingXOrSkewingY;\r\n  controls.changeWidth = wrapWithFireEvent('resizing', wrapWithFixedAnchor(changeWidth));\r\n  controls.skewHandlerX = skewHandlerX;\r\n  controls.skewHandlerY = skewHandlerY;\r\n  controls.dragHandler = dragHandler;\r\n  controls.scaleOrSkewActionName = scaleOrSkewActionName;\r\n  controls.rotationStyleHandler = rotationStyleHandler;\r\n  controls.fireEvent = fireEvent;\r\n  controls.wrapWithFixedAnchor = wrapWithFixedAnchor;\r\n  controls.wrapWithFireEvent = wrapWithFireEvent;\r\n  controls.getLocalPoint = getLocalPoint;\r\n  fabric.controlsUtils = controls;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      degreesToRadians = fabric.util.degreesToRadians,\r\n      controls = fabric.controlsUtils;\r\n\r\n  /**\r\n   * Render a round control, as per fabric features.\r\n   * This function is written to respect object properties like transparentCorners, cornerSize\r\n   * cornerColor, cornerStrokeColor\r\n   * plus the addition of offsetY and offsetX.\r\n   * @param {CanvasRenderingContext2D} ctx context to render on\r\n   * @param {Number} left x coordinate where the control center should be\r\n   * @param {Number} top y coordinate where the control center should be\r\n   * @param {Object} styleOverride override for fabric.Object controls style\r\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\r\n   */\r\n  function renderCircleControl (ctx, left, top, styleOverride, fabricObject) {\r\n    styleOverride = styleOverride || {};\r\n    var xSize = this.sizeX || styleOverride.cornerSize || fabricObject.cornerSize,\r\n        ySize = this.sizeY || styleOverride.cornerSize || fabricObject.cornerSize,\r\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\r\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\r\n        methodName = transparentCorners ? 'stroke' : 'fill',\r\n        stroke = !transparentCorners && (styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor),\r\n        myLeft = left,\r\n        myTop = top, size;\r\n    ctx.save();\r\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\r\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\r\n    // as soon as fabric react v5, remove ie11, use proper ellipse code.\r\n    if (xSize > ySize) {\r\n      size = xSize;\r\n      ctx.scale(1.0, ySize / xSize);\r\n      myTop = top * xSize / ySize;\r\n    }\r\n    else if (ySize > xSize) {\r\n      size = ySize;\r\n      ctx.scale(xSize / ySize, 1.0);\r\n      myLeft = left * ySize / xSize;\r\n    }\r\n    else {\r\n      size = xSize;\r\n    }\r\n    // this is still wrong\r\n    ctx.lineWidth = 1;\r\n    ctx.beginPath();\r\n    ctx.arc(myLeft, myTop, size / 2, 0, 2 * Math.PI, false);\r\n    ctx[methodName]();\r\n    if (stroke) {\r\n      ctx.stroke();\r\n    }\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Render a square control, as per fabric features.\r\n   * This function is written to respect object properties like transparentCorners, cornerSize\r\n   * cornerColor, cornerStrokeColor\r\n   * plus the addition of offsetY and offsetX.\r\n   * @param {CanvasRenderingContext2D} ctx context to render on\r\n   * @param {Number} left x coordinate where the control center should be\r\n   * @param {Number} top y coordinate where the control center should be\r\n   * @param {Object} styleOverride override for fabric.Object controls style\r\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\r\n   */\r\n  function renderSquareControl(ctx, left, top, styleOverride, fabricObject) {\r\n    styleOverride = styleOverride || {};\r\n    var xSize = this.sizeX || styleOverride.cornerSize || fabricObject.cornerSize,\r\n        ySize = this.sizeY || styleOverride.cornerSize || fabricObject.cornerSize,\r\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\r\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\r\n        methodName = transparentCorners ? 'stroke' : 'fill',\r\n        stroke = !transparentCorners && (\r\n          styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor\r\n        ), xSizeBy2 = xSize / 2, ySizeBy2 = ySize / 2;\r\n    ctx.save();\r\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\r\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\r\n    // this is still wrong\r\n    ctx.lineWidth = 1;\r\n    ctx.translate(left, top);\r\n    ctx.rotate(degreesToRadians(fabricObject.angle));\r\n    // this does not work, and fixed with ( && ) does not make sense.\r\n    // to have real transparent corners we need the controls on upperCanvas\r\n    // transparentCorners || ctx.clearRect(-xSizeBy2, -ySizeBy2, xSize, ySize);\r\n    ctx[methodName + 'Rect'](-xSizeBy2, -ySizeBy2, xSize, ySize);\r\n    if (stroke) {\r\n      ctx.strokeRect(-xSizeBy2, -ySizeBy2, xSize, ySize);\r\n    }\r\n    ctx.restore();\r\n  }\r\n\r\n  controls.renderCircleControl = renderCircleControl;\r\n  controls.renderSquareControl = renderSquareControl;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { });\r\n\r\n  function Control(options) {\r\n    for (var i in options) {\r\n      this[i] = options[i];\r\n    }\r\n  }\r\n\r\n  fabric.Control = Control;\r\n\r\n  fabric.Control.prototype = /** @lends fabric.Control.prototype */ {\r\n\r\n    /**\r\n     * keep track of control visibility.\r\n     * mainly for backward compatibility.\r\n     * if you do not want to see a control, you can remove it\r\n     * from the controlset.\r\n     * @type {Boolean}\r\n     * @default true\r\n     */\r\n    visible: true,\r\n\r\n    /**\r\n     * Name of the action that the control will likely execute.\r\n     * This is optional. FabricJS uses to identify what the user is doing for some\r\n     * extra optimizations. If you are writing a custom control and you want to know\r\n     * somewhere else in the code what is going on, you can use this string here.\r\n     * you can also provide a custom getActionName if your control run multiple actions\r\n     * depending on some external state.\r\n     * default to scale since is the most common, used on 4 corners by default\r\n     * @type {String}\r\n     * @default 'scale'\r\n     */\r\n    actionName: 'scale',\r\n\r\n    /**\r\n     * Drawing angle of the control.\r\n     * NOT used for now, but name marked as needed for internal logic\r\n     * example: to reuse the same drawing function for different rotated controls\r\n     * @type {Number}\r\n     * @default 0\r\n     */\r\n    angle: 0,\r\n\r\n    /**\r\n     * Relative position of the control. X\r\n     * 0,0 is the center of the Object, while -0.5 (left) or 0.5 (right) are the extremities\r\n     * of the bounding box.\r\n     * @type {Number}\r\n     * @default 0\r\n     */\r\n    x: 0,\r\n\r\n    /**\r\n     * Relative position of the control. Y\r\n     * 0,0 is the center of the Object, while -0.5 (top) or 0.5 (bottom) are the extremities\r\n     * of the bounding box.\r\n     * @type {Number}\r\n     * @default 0\r\n     */\r\n    y: 0,\r\n\r\n    /**\r\n     * Horizontal offset of the control from the defined position. In pixels\r\n     * Positive offset moves the control to the right, negative to the left.\r\n     * It used when you want to have position of control that does not scale with\r\n     * the bounding box. Example: rotation control is placed at x:0, y: 0.5 on\r\n     * the boundindbox, with an offset of 30 pixels vertically. Those 30 pixels will\r\n     * stay 30 pixels no matter how the object is big. Another example is having 2\r\n     * controls in the corner, that stay in the same position when the object scale.\r\n     * of the bounding box.\r\n     * @type {Number}\r\n     * @default 0\r\n     */\r\n    offsetX: 0,\r\n\r\n    /**\r\n     * Vertical offset of the control from the defined position. In pixels\r\n     * Positive offset moves the control to the bottom, negative to the top.\r\n     * @type {Number}\r\n     * @default 0\r\n     */\r\n    offsetY: 0,\r\n\r\n    /**\r\n     * Sets the length of the control. If null, defaults to object's cornerSize.\r\n     * Expects both sizeX and sizeY to be set when set.\r\n     * @type {?Number}\r\n     * @default null\r\n     */\r\n    sizeX: null,\r\n\r\n    /**\r\n     * Sets the height of the control. If null, defaults to object's cornerSize.\r\n     * Expects both sizeX and sizeY to be set when set.\r\n     * @type {?Number}\r\n     * @default null\r\n     */\r\n    sizeY: null,\r\n\r\n    /**\r\n     * Sets the length of the touch area of the control. If null, defaults to object's touchCornerSize.\r\n     * Expects both touchSizeX and touchSizeY to be set when set.\r\n     * @type {?Number}\r\n     * @default null\r\n     */\r\n    touchSizeX: null,\r\n\r\n    /**\r\n     * Sets the height of the touch area of the control. If null, defaults to object's touchCornerSize.\r\n     * Expects both touchSizeX and touchSizeY to be set when set.\r\n     * @type {?Number}\r\n     * @default null\r\n     */\r\n    touchSizeY: null,\r\n\r\n    /**\r\n     * Css cursor style to display when the control is hovered.\r\n     * if the method `cursorStyleHandler` is provided, this property is ignored.\r\n     * @type {String}\r\n     * @default 'crosshair'\r\n     */\r\n    cursorStyle: 'crosshair',\r\n\r\n    /**\r\n     * If controls has an offsetY or offsetX, draw a line that connects\r\n     * the control to the bounding box\r\n     * @type {Boolean}\r\n     * @default false\r\n     */\r\n    withConnection: false,\r\n\r\n    /**\r\n     * The control actionHandler, provide one to handle action ( control being moved )\r\n     * @param {Event} eventData the native mouse event\r\n     * @param {Object} transformData properties of the current transform\r\n     * @param {Number} x x position of the cursor\r\n     * @param {Number} y y position of the cursor\r\n     * @return {Boolean} true if the action/event modified the object\r\n     */\r\n    actionHandler: function(/* eventData, transformData, x, y */) { },\r\n\r\n    /**\r\n     * The control handler for mouse down, provide one to handle mouse down on control\r\n     * @param {Event} eventData the native mouse event\r\n     * @param {Object} transformData properties of the current transform\r\n     * @param {Number} x x position of the cursor\r\n     * @param {Number} y y position of the cursor\r\n     * @return {Boolean} true if the action/event modified the object\r\n     */\r\n    mouseDownHandler: function(/* eventData, transformData, x, y */) { },\r\n\r\n    /**\r\n     * The control mouseUpHandler, provide one to handle an effect on mouse up.\r\n     * @param {Event} eventData the native mouse event\r\n     * @param {Object} transformData properties of the current transform\r\n     * @param {Number} x x position of the cursor\r\n     * @param {Number} y y position of the cursor\r\n     * @return {Boolean} true if the action/event modified the object\r\n     */\r\n    mouseUpHandler: function(/* eventData, transformData, x, y */) { },\r\n\r\n    /**\r\n     * Returns control actionHandler\r\n     * @param {Event} eventData the native mouse event\r\n     * @param {fabric.Object} fabricObject on which the control is displayed\r\n     * @param {fabric.Control} control control for which the action handler is being asked\r\n     * @return {Function} the action handler\r\n     */\r\n    getActionHandler: function(/* eventData, fabricObject, control */) {\r\n      return this.actionHandler;\r\n    },\r\n\r\n    /**\r\n     * Returns control mouseDown handler\r\n     * @param {Event} eventData the native mouse event\r\n     * @param {fabric.Object} fabricObject on which the control is displayed\r\n     * @param {fabric.Control} control control for which the action handler is being asked\r\n     * @return {Function} the action handler\r\n     */\r\n    getMouseDownHandler: function(/* eventData, fabricObject, control */) {\r\n      return this.mouseDownHandler;\r\n    },\r\n\r\n    /**\r\n     * Returns control mouseUp handler\r\n     * @param {Event} eventData the native mouse event\r\n     * @param {fabric.Object} fabricObject on which the control is displayed\r\n     * @param {fabric.Control} control control for which the action handler is being asked\r\n     * @return {Function} the action handler\r\n     */\r\n    getMouseUpHandler: function(/* eventData, fabricObject, control */) {\r\n      return this.mouseUpHandler;\r\n    },\r\n\r\n    /**\r\n     * Returns control cursorStyle for css using cursorStyle. If you need a more elaborate\r\n     * function you can pass one in the constructor\r\n     * the cursorStyle property\r\n     * @param {Event} eventData the native mouse event\r\n     * @param {fabric.Control} control the current control ( likely this)\r\n     * @param {fabric.Object} object on which the control is displayed\r\n     * @return {String}\r\n     */\r\n    cursorStyleHandler: function(eventData, control /* fabricObject */) {\r\n      return control.cursorStyle;\r\n    },\r\n\r\n    /**\r\n     * Returns the action name. The basic implementation just return the actionName property.\r\n     * @param {Event} eventData the native mouse event\r\n     * @param {fabric.Control} control the current control ( likely this)\r\n     * @param {fabric.Object} object on which the control is displayed\r\n     * @return {String}\r\n     */\r\n    getActionName: function(eventData, control /* fabricObject */) {\r\n      return control.actionName;\r\n    },\r\n\r\n    /**\r\n     * Returns controls visibility\r\n     * @param {fabric.Object} object on which the control is displayed\r\n     * @param {String} controlKey key where the control is memorized on the\r\n     * @return {Boolean}\r\n     */\r\n    getVisibility: function(fabricObject, controlKey) {\r\n      var objectVisibility = fabricObject._controlsVisibility;\r\n      if (objectVisibility && typeof objectVisibility[controlKey] !== 'undefined') {\r\n        return objectVisibility[controlKey];\r\n      }\r\n      return this.visible;\r\n    },\r\n\r\n    /**\r\n     * Sets controls visibility\r\n     * @param {Boolean} visibility for the object\r\n     * @return {Void}\r\n     */\r\n    setVisibility: function(visibility /* name, fabricObject */) {\r\n      this.visible = visibility;\r\n    },\r\n\r\n\r\n    positionHandler: function(dim, finalMatrix /*, fabricObject, currentControl */) {\r\n      var point = fabric.util.transformPoint({\r\n        x: this.x * dim.x + this.offsetX,\r\n        y: this.y * dim.y + this.offsetY }, finalMatrix);\r\n      return point;\r\n    },\r\n\r\n    /**\r\n     * Returns the coords for this control based on object values.\r\n     * @param {Number} objectAngle angle from the fabric object holding the control\r\n     * @param {Number} objectCornerSize cornerSize from the fabric object holding the control (or touchCornerSize if\r\n     *   isTouch is true)\r\n     * @param {Number} centerX x coordinate where the control center should be\r\n     * @param {Number} centerY y coordinate where the control center should be\r\n     * @param {boolean} isTouch true if touch corner, false if normal corner\r\n     */\r\n    calcCornerCoords: function(objectAngle, objectCornerSize, centerX, centerY, isTouch) {\r\n      var cosHalfOffset,\r\n          sinHalfOffset,\r\n          cosHalfOffsetComp,\r\n          sinHalfOffsetComp,\r\n          xSize = (isTouch) ? this.touchSizeX : this.sizeX,\r\n          ySize = (isTouch) ? this.touchSizeY : this.sizeY;\r\n      if (xSize && ySize && xSize !== ySize) {\r\n        // handle rectangular corners\r\n        var controlTriangleAngle = Math.atan2(ySize, xSize);\r\n        var cornerHypotenuse = Math.sqrt(xSize * xSize + ySize * ySize) / 2;\r\n        var newTheta = controlTriangleAngle - fabric.util.degreesToRadians(objectAngle);\r\n        var newThetaComp = Math.PI / 2 - controlTriangleAngle - fabric.util.degreesToRadians(objectAngle);\r\n        cosHalfOffset = cornerHypotenuse * fabric.util.cos(newTheta);\r\n        sinHalfOffset = cornerHypotenuse * fabric.util.sin(newTheta);\r\n        // use complementary angle for two corners\r\n        cosHalfOffsetComp = cornerHypotenuse * fabric.util.cos(newThetaComp);\r\n        sinHalfOffsetComp = cornerHypotenuse * fabric.util.sin(newThetaComp);\r\n      }\r\n      else {\r\n        // handle square corners\r\n        // use default object corner size unless size is defined\r\n        var cornerSize = (xSize && ySize) ? xSize : objectCornerSize;\r\n        /* 0.7071067812 stands for sqrt(2)/2 */\r\n        cornerHypotenuse = cornerSize * 0.7071067812;\r\n        // complementary angles are equal since they're both 45 degrees\r\n        var newTheta = fabric.util.degreesToRadians(45 - objectAngle);\r\n        cosHalfOffset = cosHalfOffsetComp = cornerHypotenuse * fabric.util.cos(newTheta);\r\n        sinHalfOffset = sinHalfOffsetComp = cornerHypotenuse * fabric.util.sin(newTheta);\r\n      }\r\n\r\n      return {\r\n        tl: {\r\n          x: centerX - sinHalfOffsetComp,\r\n          y: centerY - cosHalfOffsetComp,\r\n        },\r\n        tr: {\r\n          x: centerX + cosHalfOffset,\r\n          y: centerY - sinHalfOffset,\r\n        },\r\n        bl: {\r\n          x: centerX - cosHalfOffset,\r\n          y: centerY + sinHalfOffset,\r\n        },\r\n        br: {\r\n          x: centerX + sinHalfOffsetComp,\r\n          y: centerY + cosHalfOffsetComp,\r\n        },\r\n      };\r\n    },\r\n\r\n    /**\r\n    * Render function for the control.\r\n    * When this function runs the context is unscaled. unrotate. Just retina scaled.\r\n    * all the functions will have to translate to the point left,top before starting Drawing\r\n    * if they want to draw a control where the position is detected.\r\n    * left and top are the result of the positionHandler function\r\n    * @param {RenderingContext2D} ctx the context where the control will be drawn\r\n    * @param {Number} left position of the canvas where we are about to render the control.\r\n    * @param {Number} top position of the canvas where we are about to render the control.\r\n    * @param {Object} styleOverride\r\n    * @param {fabric.Object} fabricObject the object where the control is about to be rendered\r\n    */\r\n    render: function(ctx, left, top, styleOverride, fabricObject) {\r\n      styleOverride = styleOverride || {};\r\n      switch (styleOverride.cornerStyle || fabricObject.cornerStyle) {\r\n        case 'circle':\r\n          fabric.controlsUtils.renderCircleControl.call(this, ctx, left, top, styleOverride, fabricObject);\r\n          break;\r\n        default:\r\n          fabric.controlsUtils.renderSquareControl.call(this, ctx, left, top, styleOverride, fabricObject);\r\n      }\r\n    },\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function() {\r\n\r\n  /* _FROM_SVG_START_ */\r\n  function getColorStop(el, multiplier) {\r\n    var style = el.getAttribute('style'),\r\n        offset = el.getAttribute('offset') || 0,\r\n        color, colorAlpha, opacity, i;\r\n\r\n    // convert percents to absolute values\r\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\r\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\r\n    if (style) {\r\n      var keyValuePairs = style.split(/\\s*;\\s*/);\r\n\r\n      if (keyValuePairs[keyValuePairs.length - 1] === '') {\r\n        keyValuePairs.pop();\r\n      }\r\n\r\n      for (i = keyValuePairs.length; i--; ) {\r\n\r\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\r\n            key = split[0].trim(),\r\n            value = split[1].trim();\r\n\r\n        if (key === 'stop-color') {\r\n          color = value;\r\n        }\r\n        else if (key === 'stop-opacity') {\r\n          opacity = value;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!color) {\r\n      color = el.getAttribute('stop-color') || 'rgb(0,0,0)';\r\n    }\r\n    if (!opacity) {\r\n      opacity = el.getAttribute('stop-opacity');\r\n    }\r\n\r\n    color = new fabric.Color(color);\r\n    colorAlpha = color.getAlpha();\r\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\r\n    opacity *= colorAlpha * multiplier;\r\n\r\n    return {\r\n      offset: offset,\r\n      color: color.toRgb(),\r\n      opacity: opacity\r\n    };\r\n  }\r\n\r\n  function getLinearCoords(el) {\r\n    return {\r\n      x1: el.getAttribute('x1') || 0,\r\n      y1: el.getAttribute('y1') || 0,\r\n      x2: el.getAttribute('x2') || '100%',\r\n      y2: el.getAttribute('y2') || 0\r\n    };\r\n  }\r\n\r\n  function getRadialCoords(el) {\r\n    return {\r\n      x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',\r\n      y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',\r\n      r1: 0,\r\n      x2: el.getAttribute('cx') || '50%',\r\n      y2: el.getAttribute('cy') || '50%',\r\n      r2: el.getAttribute('r') || '50%'\r\n    };\r\n  }\r\n  /* _FROM_SVG_END_ */\r\n\r\n  var clone = fabric.util.object.clone;\r\n\r\n  /**\r\n   * Gradient class\r\n   * @class fabric.Gradient\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\r\n   * @see {@link fabric.Gradient#initialize} for constructor definition\r\n   */\r\n  fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {\r\n\r\n    /**\r\n     * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\r\n     * @type Number\r\n     * @default 0\r\n     */\r\n    offsetX: 0,\r\n\r\n    /**\r\n     * Vertical offset for aligning gradients coming from SVG when outside pathgroups\r\n     * @type Number\r\n     * @default 0\r\n     */\r\n    offsetY: 0,\r\n\r\n    /**\r\n     * A transform matrix to apply to the gradient before painting.\r\n     * Imported from svg gradients, is not applied with the current transform in the center.\r\n     * Before this transform is applied, the origin point is at the top left corner of the object\r\n     * plus the addition of offsetY and offsetX.\r\n     * @type Number[]\r\n     * @default null\r\n     */\r\n    gradientTransform: null,\r\n\r\n    /**\r\n     * coordinates units for coords.\r\n     * If `pixels`, the number of coords are in the same unit of width / height.\r\n     * If set as `percentage` the coords are still a number, but 1 means 100% of width\r\n     * for the X and 100% of the height for the y. It can be bigger than 1 and negative.\r\n     * allowed values pixels or percentage.\r\n     * @type String\r\n     * @default 'pixels'\r\n     */\r\n    gradientUnits: 'pixels',\r\n\r\n    /**\r\n     * Gradient type linear or radial\r\n     * @type String\r\n     * @default 'pixels'\r\n     */\r\n    type: 'linear',\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} options Options object with type, coords, gradientUnits and colorStops\r\n     * @param {Object} [options.type] gradient type linear or radial\r\n     * @param {Object} [options.gradientUnits] gradient units\r\n     * @param {Object} [options.offsetX] SVG import compatibility\r\n     * @param {Object} [options.offsetY] SVG import compatibility\r\n     * @param {Object[]} options.colorStops contains the colorstops.\r\n     * @param {Object} options.coords contains the coords of the gradient\r\n     * @param {Number} [options.coords.x1] X coordiante of the first point for linear or of the focal point for radial\r\n     * @param {Number} [options.coords.y1] Y coordiante of the first point for linear or of the focal point for radial\r\n     * @param {Number} [options.coords.x2] X coordiante of the second point for linear or of the center point for radial\r\n     * @param {Number} [options.coords.y2] Y coordiante of the second point for linear or of the center point for radial\r\n     * @param {Number} [options.coords.r1] only for radial gradient, radius of the inner circle\r\n     * @param {Number} [options.coords.r2] only for radial gradient, radius of the external circle\r\n     * @return {fabric.Gradient} thisArg\r\n     */\r\n    initialize: function(options) {\r\n      options || (options = { });\r\n      options.coords || (options.coords = { });\r\n\r\n      var coords, _this = this;\r\n\r\n      // sets everything, then coords and colorstops get sets again\r\n      Object.keys(options).forEach(function(option) {\r\n        _this[option] = options[option];\r\n      });\r\n\r\n      if (this.id) {\r\n        this.id += '_' + fabric.Object.__uid++;\r\n      }\r\n      else {\r\n        this.id = fabric.Object.__uid++;\r\n      }\r\n\r\n      coords = {\r\n        x1: options.coords.x1 || 0,\r\n        y1: options.coords.y1 || 0,\r\n        x2: options.coords.x2 || 0,\r\n        y2: options.coords.y2 || 0\r\n      };\r\n\r\n      if (this.type === 'radial') {\r\n        coords.r1 = options.coords.r1 || 0;\r\n        coords.r2 = options.coords.r2 || 0;\r\n      }\r\n\r\n      this.coords = coords;\r\n      this.colorStops = options.colorStops.slice();\r\n    },\r\n\r\n    /**\r\n     * Adds another colorStop\r\n     * @param {Object} colorStop Object with offset and color\r\n     * @return {fabric.Gradient} thisArg\r\n     */\r\n    addColorStop: function(colorStops) {\r\n      for (var position in colorStops) {\r\n        var color = new fabric.Color(colorStops[position]);\r\n        this.colorStops.push({\r\n          offset: parseFloat(position),\r\n          color: color.toRgb(),\r\n          opacity: color.getAlpha()\r\n        });\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of a gradient\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object}\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      var object = {\r\n        type: this.type,\r\n        coords: this.coords,\r\n        colorStops: this.colorStops,\r\n        offsetX: this.offsetX,\r\n        offsetY: this.offsetY,\r\n        gradientUnits: this.gradientUnits,\r\n        gradientTransform: this.gradientTransform ? this.gradientTransform.concat() : this.gradientTransform\r\n      };\r\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\r\n\r\n      return object;\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns SVG representation of an gradient\r\n     * @param {Object} object Object to create a gradient for\r\n     * @return {String} SVG representation of an gradient (linear/radial)\r\n     */\r\n    toSVG: function(object, options) {\r\n      var coords = clone(this.coords, true), i, len, options = options || {},\r\n          markup, commonAttributes, colorStops = clone(this.colorStops, true),\r\n          needsSwap = coords.r1 > coords.r2,\r\n          transform = this.gradientTransform ? this.gradientTransform.concat() : fabric.iMatrix.concat(),\r\n          offsetX = -this.offsetX, offsetY = -this.offsetY,\r\n          withViewport = !!options.additionalTransform,\r\n          gradientUnits = this.gradientUnits === 'pixels' ? 'userSpaceOnUse' : 'objectBoundingBox';\r\n      // colorStops must be sorted ascending\r\n      colorStops.sort(function(a, b) {\r\n        return a.offset - b.offset;\r\n      });\r\n\r\n      if (gradientUnits === 'objectBoundingBox') {\r\n        offsetX /= object.width;\r\n        offsetY /= object.height;\r\n      }\r\n      else {\r\n        offsetX += object.width / 2;\r\n        offsetY += object.height / 2;\r\n      }\r\n      if (object.type === 'path' && this.gradientUnits !== 'percentage') {\r\n        offsetX -= object.pathOffset.x;\r\n        offsetY -= object.pathOffset.y;\r\n      }\r\n\r\n\r\n      transform[4] -= offsetX;\r\n      transform[5] -= offsetY;\r\n\r\n      commonAttributes = 'id=\"SVGID_' + this.id +\r\n                     '\" gradientUnits=\"' + gradientUnits + '\"';\r\n      commonAttributes += ' gradientTransform=\"' + (withViewport ?\r\n        options.additionalTransform + ' ' : '') + fabric.util.matrixToSVG(transform) + '\" ';\r\n\r\n      if (this.type === 'linear') {\r\n        markup = [\r\n          '<linearGradient ',\r\n          commonAttributes,\r\n          ' x1=\"', coords.x1,\r\n          '\" y1=\"', coords.y1,\r\n          '\" x2=\"', coords.x2,\r\n          '\" y2=\"', coords.y2,\r\n          '\">\\n'\r\n        ];\r\n      }\r\n      else if (this.type === 'radial') {\r\n        // svg radial gradient has just 1 radius. the biggest.\r\n        markup = [\r\n          '<radialGradient ',\r\n          commonAttributes,\r\n          ' cx=\"', needsSwap ? coords.x1 : coords.x2,\r\n          '\" cy=\"', needsSwap ? coords.y1 : coords.y2,\r\n          '\" r=\"', needsSwap ? coords.r1 : coords.r2,\r\n          '\" fx=\"', needsSwap ? coords.x2 : coords.x1,\r\n          '\" fy=\"', needsSwap ? coords.y2 : coords.y1,\r\n          '\">\\n'\r\n        ];\r\n      }\r\n\r\n      if (this.type === 'radial') {\r\n        if (needsSwap) {\r\n          // svg goes from internal to external radius. if radius are inverted, swap color stops.\r\n          colorStops = colorStops.concat();\r\n          colorStops.reverse();\r\n          for (i = 0, len = colorStops.length; i < len; i++) {\r\n            colorStops[i].offset = 1 - colorStops[i].offset;\r\n          }\r\n        }\r\n        var minRadius = Math.min(coords.r1, coords.r2);\r\n        if (minRadius > 0) {\r\n          // i have to shift all colorStops and add new one in 0.\r\n          var maxRadius = Math.max(coords.r1, coords.r2),\r\n              percentageShift = minRadius / maxRadius;\r\n          for (i = 0, len = colorStops.length; i < len; i++) {\r\n            colorStops[i].offset += percentageShift * (1 - colorStops[i].offset);\r\n          }\r\n        }\r\n      }\r\n\r\n      for (i = 0, len = colorStops.length; i < len; i++) {\r\n        var colorStop = colorStops[i];\r\n        markup.push(\r\n          '<stop ',\r\n          'offset=\"', (colorStop.offset * 100) + '%',\r\n          '\" style=\"stop-color:', colorStop.color,\r\n          (typeof colorStop.opacity !== 'undefined' ? ';stop-opacity: ' + colorStop.opacity : ';'),\r\n          '\"/>\\n'\r\n        );\r\n      }\r\n\r\n      markup.push((this.type === 'linear' ? '</linearGradient>\\n' : '</radialGradient>\\n'));\r\n\r\n      return markup.join('');\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n    /**\r\n     * Returns an instance of CanvasGradient\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @return {CanvasGradient}\r\n     */\r\n    toLive: function(ctx) {\r\n      var gradient, coords = fabric.util.object.clone(this.coords), i, len;\r\n\r\n      if (!this.type) {\r\n        return;\r\n      }\r\n\r\n      if (this.type === 'linear') {\r\n        gradient = ctx.createLinearGradient(\r\n          coords.x1, coords.y1, coords.x2, coords.y2);\r\n      }\r\n      else if (this.type === 'radial') {\r\n        gradient = ctx.createRadialGradient(\r\n          coords.x1, coords.y1, coords.r1, coords.x2, coords.y2, coords.r2);\r\n      }\r\n\r\n      for (i = 0, len = this.colorStops.length; i < len; i++) {\r\n        var color = this.colorStops[i].color,\r\n            opacity = this.colorStops[i].opacity,\r\n            offset = this.colorStops[i].offset;\r\n\r\n        if (typeof opacity !== 'undefined') {\r\n          color = new fabric.Color(color).setAlpha(opacity).toRgba();\r\n        }\r\n        gradient.addColorStop(offset, color);\r\n      }\r\n\r\n      return gradient;\r\n    }\r\n  });\r\n\r\n  fabric.util.object.extend(fabric.Gradient, {\r\n\r\n    /* _FROM_SVG_START_ */\r\n    /**\r\n     * Returns {@link fabric.Gradient} instance from an SVG element\r\n     * @static\r\n     * @memberOf fabric.Gradient\r\n     * @param {SVGGradientElement} el SVG gradient element\r\n     * @param {fabric.Object} instance\r\n     * @param {String} opacityAttr A fill-opacity or stroke-opacity attribute to multiply to each stop's opacity.\r\n     * @param {Object} svgOptions an object containing the size of the SVG in order to parse correctly gradients\r\n     * that uses gradientUnits as 'userSpaceOnUse' and percentages.\r\n     * @param {Object.number} viewBoxWidth width part of the viewBox attribute on svg\r\n     * @param {Object.number} viewBoxHeight height part of the viewBox attribute on svg\r\n     * @param {Object.number} width width part of the svg tag if viewBox is not specified\r\n     * @param {Object.number} height height part of the svg tag if viewBox is not specified\r\n     * @return {fabric.Gradient} Gradient instance\r\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\r\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\r\n     */\r\n    fromElement: function(el, instance, opacityAttr, svgOptions) {\r\n      /**\r\n       *  @example:\r\n       *\r\n       *  <linearGradient id=\"linearGrad1\">\r\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\r\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\r\n       *  </linearGradient>\r\n       *\r\n       *  OR\r\n       *\r\n       *  <linearGradient id=\"linearGrad2\">\r\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\r\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\r\n       *  </linearGradient>\r\n       *\r\n       *  OR\r\n       *\r\n       *  <radialGradient id=\"radialGrad1\">\r\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\r\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\r\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\r\n       *  </radialGradient>\r\n       *\r\n       *  OR\r\n       *\r\n       *  <radialGradient id=\"radialGrad2\">\r\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\r\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\r\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\r\n       *  </radialGradient>\r\n       *\r\n       */\r\n\r\n      var multiplier = parseFloat(opacityAttr) / (/%$/.test(opacityAttr) ? 100 : 1);\r\n      multiplier = multiplier < 0 ? 0 : multiplier > 1 ? 1 : multiplier;\r\n      if (isNaN(multiplier)) {\r\n        multiplier = 1;\r\n      }\r\n\r\n      var colorStopEls = el.getElementsByTagName('stop'),\r\n          type,\r\n          gradientUnits = el.getAttribute('gradientUnits') === 'userSpaceOnUse' ?\r\n            'pixels' : 'percentage',\r\n          gradientTransform = el.getAttribute('gradientTransform') || '',\r\n          colorStops = [],\r\n          coords, i, offsetX = 0, offsetY = 0,\r\n          transformMatrix;\r\n      if (el.nodeName === 'linearGradient' || el.nodeName === 'LINEARGRADIENT') {\r\n        type = 'linear';\r\n        coords = getLinearCoords(el);\r\n      }\r\n      else {\r\n        type = 'radial';\r\n        coords = getRadialCoords(el);\r\n      }\r\n\r\n      for (i = colorStopEls.length; i--; ) {\r\n        colorStops.push(getColorStop(colorStopEls[i], multiplier));\r\n      }\r\n\r\n      transformMatrix = fabric.parseTransformAttribute(gradientTransform);\r\n\r\n      __convertPercentUnitsToValues(instance, coords, svgOptions, gradientUnits);\r\n\r\n      if (gradientUnits === 'pixels') {\r\n        offsetX = -instance.left;\r\n        offsetY = -instance.top;\r\n      }\r\n\r\n      var gradient = new fabric.Gradient({\r\n        id: el.getAttribute('id'),\r\n        type: type,\r\n        coords: coords,\r\n        colorStops: colorStops,\r\n        gradientUnits: gradientUnits,\r\n        gradientTransform: transformMatrix,\r\n        offsetX: offsetX,\r\n        offsetY: offsetY,\r\n      });\r\n\r\n      return gradient;\r\n    }\r\n    /* _FROM_SVG_END_ */\r\n  });\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function __convertPercentUnitsToValues(instance, options, svgOptions, gradientUnits) {\r\n    var propValue, finalValue;\r\n    Object.keys(options).forEach(function(prop) {\r\n      propValue = options[prop];\r\n      if (propValue === 'Infinity') {\r\n        finalValue = 1;\r\n      }\r\n      else if (propValue === '-Infinity') {\r\n        finalValue = 0;\r\n      }\r\n      else {\r\n        finalValue = parseFloat(options[prop], 10);\r\n        if (typeof propValue === 'string' && /^(\\d+\\.\\d+)%|(\\d+)%$/.test(propValue)) {\r\n          finalValue *= 0.01;\r\n          if (gradientUnits === 'pixels') {\r\n            // then we need to fix those percentages here in svg parsing\r\n            if (prop === 'x1' || prop === 'x2' || prop === 'r2') {\r\n              finalValue *= svgOptions.viewBoxWidth || svgOptions.width;\r\n            }\r\n            if (prop === 'y1' || prop === 'y2') {\r\n              finalValue *= svgOptions.viewBoxHeight || svgOptions.height;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      options[prop] = finalValue;\r\n    });\r\n  }\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  'use strict';\r\n\r\n  var toFixed = fabric.util.toFixed;\r\n\r\n  /**\r\n   * Pattern class\r\n   * @class fabric.Pattern\r\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\r\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\r\n   * @see {@link fabric.Pattern#initialize} for constructor definition\r\n   */\r\n\r\n\r\n  fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {\r\n\r\n    /**\r\n     * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\r\n     * @type String\r\n     * @default\r\n     */\r\n    repeat: 'repeat',\r\n\r\n    /**\r\n     * Pattern horizontal offset from object's left/top corner\r\n     * @type Number\r\n     * @default\r\n     */\r\n    offsetX: 0,\r\n\r\n    /**\r\n     * Pattern vertical offset from object's left/top corner\r\n     * @type Number\r\n     * @default\r\n     */\r\n    offsetY: 0,\r\n\r\n    /**\r\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\r\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\r\n     * @type String\r\n     * @default\r\n     */\r\n    crossOrigin: '',\r\n\r\n    /**\r\n     * transform matrix to change the pattern, imported from svgs.\r\n     * @type Array\r\n     * @default\r\n     */\r\n    patternTransform: null,\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} [options] Options object\r\n     * @param {Function} [callback] function to invoke after callback init.\r\n     * @return {fabric.Pattern} thisArg\r\n     */\r\n    initialize: function(options, callback) {\r\n      options || (options = { });\r\n\r\n      this.id = fabric.Object.__uid++;\r\n      this.setOptions(options);\r\n      if (!options.source || (options.source && typeof options.source !== 'string')) {\r\n        callback && callback(this);\r\n        return;\r\n      }\r\n      else {\r\n        // img src string\r\n        var _this = this;\r\n        this.source = fabric.util.createImage();\r\n        fabric.util.loadImage(options.source, function(img, isError) {\r\n          _this.source = img;\r\n          callback && callback(_this, isError);\r\n        }, null, this.crossOrigin);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of a pattern\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} Object representation of a pattern instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\r\n          source, object;\r\n\r\n      // <img> element\r\n      if (typeof this.source.src === 'string') {\r\n        source = this.source.src;\r\n      }\r\n      // <canvas> element\r\n      else if (typeof this.source === 'object' && this.source.toDataURL) {\r\n        source = this.source.toDataURL();\r\n      }\r\n\r\n      object = {\r\n        type: 'pattern',\r\n        source: source,\r\n        repeat: this.repeat,\r\n        crossOrigin: this.crossOrigin,\r\n        offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\r\n        offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\r\n        patternTransform: this.patternTransform ? this.patternTransform.concat() : null\r\n      };\r\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\r\n\r\n      return object;\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns SVG representation of a pattern\r\n     * @param {fabric.Object} object\r\n     * @return {String} SVG representation of a pattern\r\n     */\r\n    toSVG: function(object) {\r\n      var patternSource = typeof this.source === 'function' ? this.source() : this.source,\r\n          patternWidth = patternSource.width / object.width,\r\n          patternHeight = patternSource.height / object.height,\r\n          patternOffsetX = this.offsetX / object.width,\r\n          patternOffsetY = this.offsetY / object.height,\r\n          patternImgSrc = '';\r\n      if (this.repeat === 'repeat-x' || this.repeat === 'no-repeat') {\r\n        patternHeight = 1;\r\n        if (patternOffsetY) {\r\n          patternHeight += Math.abs(patternOffsetY);\r\n        }\r\n      }\r\n      if (this.repeat === 'repeat-y' || this.repeat === 'no-repeat') {\r\n        patternWidth = 1;\r\n        if (patternOffsetX) {\r\n          patternWidth += Math.abs(patternOffsetX);\r\n        }\r\n\r\n      }\r\n      if (patternSource.src) {\r\n        patternImgSrc = patternSource.src;\r\n      }\r\n      else if (patternSource.toDataURL) {\r\n        patternImgSrc = patternSource.toDataURL();\r\n      }\r\n\r\n      return '<pattern id=\"SVGID_' + this.id +\r\n                    '\" x=\"' + patternOffsetX +\r\n                    '\" y=\"' + patternOffsetY +\r\n                    '\" width=\"' + patternWidth +\r\n                    '\" height=\"' + patternHeight + '\">\\n' +\r\n               '<image x=\"0\" y=\"0\"' +\r\n                      ' width=\"' + patternSource.width +\r\n                      '\" height=\"' + patternSource.height +\r\n                      '\" xlink:href=\"' + patternImgSrc +\r\n               '\"></image>\\n' +\r\n             '</pattern>\\n';\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n    setOptions: function(options) {\r\n      for (var prop in options) {\r\n        this[prop] = options[prop];\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Returns an instance of CanvasPattern\r\n     * @param {CanvasRenderingContext2D} ctx Context to create pattern\r\n     * @return {CanvasPattern}\r\n     */\r\n    toLive: function(ctx) {\r\n      var source = this.source;\r\n      // if the image failed to load, return, and allow rest to continue loading\r\n      if (!source) {\r\n        return '';\r\n      }\r\n\r\n      // if an image\r\n      if (typeof source.src !== 'undefined') {\r\n        if (!source.complete) {\r\n          return '';\r\n        }\r\n        if (source.naturalWidth === 0 || source.naturalHeight === 0) {\r\n          return '';\r\n        }\r\n      }\r\n      return ctx.createPattern(source, this.repeat);\r\n    }\r\n  });\r\n})();\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      toFixed = fabric.util.toFixed;\r\n\r\n  if (fabric.Shadow) {\r\n    fabric.warn('fabric.Shadow is already defined.');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Shadow class\r\n   * @class fabric.Shadow\r\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\r\n   * @see {@link fabric.Shadow#initialize} for constructor definition\r\n   */\r\n  fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {\r\n\r\n    /**\r\n     * Shadow color\r\n     * @type String\r\n     * @default\r\n     */\r\n    color: 'rgb(0,0,0)',\r\n\r\n    /**\r\n     * Shadow blur\r\n     * @type Number\r\n     */\r\n    blur: 0,\r\n\r\n    /**\r\n     * Shadow horizontal offset\r\n     * @type Number\r\n     * @default\r\n     */\r\n    offsetX: 0,\r\n\r\n    /**\r\n     * Shadow vertical offset\r\n     * @type Number\r\n     * @default\r\n     */\r\n    offsetY: 0,\r\n\r\n    /**\r\n     * Whether the shadow should affect stroke operations\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    affectStroke: false,\r\n\r\n    /**\r\n     * Indicates whether toObject should include default values\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    includeDefaultValues: true,\r\n\r\n    /**\r\n     * When `false`, the shadow will scale with the object.\r\n     * When `true`, the shadow's offsetX, offsetY, and blur will not be affected by the object's scale.\r\n     * default to false\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    nonScaling: false,\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetY properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px\")\r\n     * @return {fabric.Shadow} thisArg\r\n     */\r\n    initialize: function(options) {\r\n\r\n      if (typeof options === 'string') {\r\n        options = this._parseShadow(options);\r\n      }\r\n\r\n      for (var prop in options) {\r\n        this[prop] = options[prop];\r\n      }\r\n\r\n      this.id = fabric.Object.__uid++;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} shadow Shadow value to parse\r\n     * @return {Object} Shadow object with color, offsetX, offsetY and blur\r\n     */\r\n    _parseShadow: function(shadow) {\r\n      var shadowStr = shadow.trim(),\r\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\r\n          color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';\r\n\r\n      return {\r\n        color: color.trim(),\r\n        offsetX: parseFloat(offsetsAndBlur[1], 10) || 0,\r\n        offsetY: parseFloat(offsetsAndBlur[2], 10) || 0,\r\n        blur: parseFloat(offsetsAndBlur[3], 10) || 0\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Returns a string representation of an instance\r\n     * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\r\n     * @return {String} Returns CSS3 text-shadow declaration\r\n     */\r\n    toString: function() {\r\n      return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns SVG representation of a shadow\r\n     * @param {fabric.Object} object\r\n     * @return {String} SVG representation of a shadow\r\n     */\r\n    toSVG: function(object) {\r\n      var fBoxX = 40, fBoxY = 40, NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\r\n          offset = fabric.util.rotateVector(\r\n            { x: this.offsetX, y: this.offsetY },\r\n            fabric.util.degreesToRadians(-object.angle)),\r\n          BLUR_BOX = 20, color = new fabric.Color(this.color);\r\n\r\n      if (object.width && object.height) {\r\n        //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\r\n        // we add some extra space to filter box to contain the blur ( 20 )\r\n        fBoxX = toFixed((Math.abs(offset.x) + this.blur) / object.width, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\r\n        fBoxY = toFixed((Math.abs(offset.y) + this.blur) / object.height, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\r\n      }\r\n      if (object.flipX) {\r\n        offset.x *= -1;\r\n      }\r\n      if (object.flipY) {\r\n        offset.y *= -1;\r\n      }\r\n\r\n      return (\r\n        '<filter id=\"SVGID_' + this.id + '\" y=\"-' + fBoxY + '%\" height=\"' + (100 + 2 * fBoxY) + '%\" ' +\r\n          'x=\"-' + fBoxX + '%\" width=\"' + (100 + 2 * fBoxX) + '%\" ' + '>\\n' +\r\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\r\n            toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) + '\"></feGaussianBlur>\\n' +\r\n          '\\t<feOffset dx=\"' + toFixed(offset.x, NUM_FRACTION_DIGITS) +\r\n          '\" dy=\"' + toFixed(offset.y, NUM_FRACTION_DIGITS) + '\" result=\"oBlur\" ></feOffset>\\n' +\r\n          '\\t<feFlood flood-color=\"' + color.toRgb() + '\" flood-opacity=\"' + color.getAlpha() + '\"/>\\n' +\r\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\r\n          '\\t<feMerge>\\n' +\r\n            '\\t\\t<feMergeNode></feMergeNode>\\n' +\r\n            '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\r\n          '\\t</feMerge>\\n' +\r\n        '</filter>\\n');\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n    /**\r\n     * Returns object representation of a shadow\r\n     * @return {Object} Object representation of a shadow instance\r\n     */\r\n    toObject: function() {\r\n      if (this.includeDefaultValues) {\r\n        return {\r\n          color: this.color,\r\n          blur: this.blur,\r\n          offsetX: this.offsetX,\r\n          offsetY: this.offsetY,\r\n          affectStroke: this.affectStroke,\r\n          nonScaling: this.nonScaling\r\n        };\r\n      }\r\n      var obj = { }, proto = fabric.Shadow.prototype;\r\n\r\n      ['color', 'blur', 'offsetX', 'offsetY', 'affectStroke', 'nonScaling'].forEach(function(prop) {\r\n        if (this[prop] !== proto[prop]) {\r\n          obj[prop] = this[prop];\r\n        }\r\n      }, this);\r\n\r\n      return obj;\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\r\n   * @static\r\n   * @field\r\n   * @memberOf fabric.Shadow\r\n   */\r\n  // eslint-disable-next-line max-len\r\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?(\\d+(?:\\.\\d*)?(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function () {\r\n\r\n  'use strict';\r\n\r\n  if (fabric.StaticCanvas) {\r\n    fabric.warn('fabric.StaticCanvas is already defined.');\r\n    return;\r\n  }\r\n\r\n  // aliases for faster resolution\r\n  var extend = fabric.util.object.extend,\r\n      getElementOffset = fabric.util.getElementOffset,\r\n      removeFromArray = fabric.util.removeFromArray,\r\n      toFixed = fabric.util.toFixed,\r\n      transformPoint = fabric.util.transformPoint,\r\n      invertTransform = fabric.util.invertTransform,\r\n      getNodeCanvas = fabric.util.getNodeCanvas,\r\n      createCanvasElement = fabric.util.createCanvasElement,\r\n\r\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\r\n\r\n  /**\r\n   * Static canvas class\r\n   * @class fabric.StaticCanvas\r\n   * @mixes fabric.Collection\r\n   * @mixes fabric.Observable\r\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\r\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\r\n   * @fires before:render\r\n   * @fires after:render\r\n   * @fires canvas:cleared\r\n   * @fires object:added\r\n   * @fires object:removed\r\n   */\r\n  fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.StaticCanvas.prototype */ {\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\r\n     * @param {Object} [options] Options object\r\n     * @return {Object} thisArg\r\n     */\r\n    initialize: function(el, options) {\r\n      options || (options = { });\r\n      this.renderAndResetBound = this.renderAndReset.bind(this);\r\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\r\n      this._initStatic(el, options);\r\n    },\r\n\r\n    /**\r\n     * Background color of canvas instance.\r\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\r\n     * @type {(String|fabric.Pattern)}\r\n     * @default\r\n     */\r\n    backgroundColor: '',\r\n\r\n    /**\r\n     * Background image of canvas instance.\r\n     * since 2.4.0 image caching is active, please when putting an image as background, add to the\r\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\r\n     * vale. As an alternative you can disable image objectCaching\r\n     * @type fabric.Image\r\n     * @default\r\n     */\r\n    backgroundImage: null,\r\n\r\n    /**\r\n     * Overlay color of canvas instance.\r\n     * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\r\n     * @since 1.3.9\r\n     * @type {(String|fabric.Pattern)}\r\n     * @default\r\n     */\r\n    overlayColor: '',\r\n\r\n    /**\r\n     * Overlay image of canvas instance.\r\n     * since 2.4.0 image caching is active, please when putting an image as overlay, add to the\r\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\r\n     * vale. As an alternative you can disable image objectCaching\r\n     * @type fabric.Image\r\n     * @default\r\n     */\r\n    overlayImage: null,\r\n\r\n    /**\r\n     * Indicates whether toObject/toDatalessObject should include default values\r\n     * if set to false, takes precedence over the object value.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    includeDefaultValues: true,\r\n\r\n    /**\r\n     * Indicates whether objects' state should be saved\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    stateful: false,\r\n\r\n    /**\r\n     * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove},\r\n     * {@link fabric.StaticCanvas.moveTo}, {@link fabric.StaticCanvas.clear} and many more, should also re-render canvas.\r\n     * Disabling this option will not give a performance boost when adding/removing a lot of objects to/from canvas at once\r\n     * since the renders are quequed and executed one per frame.\r\n     * Disabling is suggested anyway and managing the renders of the app manually is not a big effort ( canvas.requestRenderAll() )\r\n     * Left default to true to do not break documentation and old app, fiddles.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    renderOnAddRemove: true,\r\n\r\n    /**\r\n     * Indicates whether object controls (borders/controls) are rendered above overlay image\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    controlsAboveOverlay: false,\r\n\r\n    /**\r\n     * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    allowTouchScrolling: false,\r\n\r\n    /**\r\n     * Indicates whether this canvas will use image smoothing, this is on by default in browsers\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    imageSmoothingEnabled: true,\r\n\r\n    /**\r\n     * The transformation (a Canvas 2D API transform matrix) which focuses the viewport\r\n     * @type Array\r\n     * @example <caption>Default transform</caption>\r\n     * canvas.viewportTransform = [1, 0, 0, 1, 0, 0];\r\n     * @example <caption>Scale by 70% and translate toward bottom-right by 50, without skewing</caption>\r\n     * canvas.viewportTransform = [0.7, 0, 0, 0.7, 50, 50];\r\n     * @default\r\n     */\r\n    viewportTransform: fabric.iMatrix.concat(),\r\n\r\n    /**\r\n     * if set to false background image is not affected by viewport transform\r\n     * @since 1.6.3\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    backgroundVpt: true,\r\n\r\n    /**\r\n     * if set to false overlya image is not affected by viewport transform\r\n     * @since 1.6.3\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    overlayVpt: true,\r\n\r\n    /**\r\n     * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    enableRetinaScaling: true,\r\n\r\n    /**\r\n     * Describe canvas element extension over design\r\n     * properties are tl,tr,bl,br.\r\n     * if canvas is not zoomed/panned those points are the four corner of canvas\r\n     * if canvas is viewportTransformed you those points indicate the extension\r\n     * of canvas element in plain untrasformed coordinates\r\n     * The coordinates get updated with @method calcViewportBoundaries.\r\n     * @memberOf fabric.StaticCanvas.prototype\r\n     */\r\n    vptCoords: { },\r\n\r\n    /**\r\n     * Based on vptCoords and object.aCoords, skip rendering of objects that\r\n     * are not included in current viewport.\r\n     * May greatly help in applications with crowded canvas and use of zoom/pan\r\n     * If One of the corner of the bounding box of the object is on the canvas\r\n     * the objects get rendered.\r\n     * @memberOf fabric.StaticCanvas.prototype\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    skipOffscreen: true,\r\n\r\n    /**\r\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\r\n     * the clipPath object gets used when the canvas has rendered, and the context is placed in the\r\n     * top left corner of the canvas.\r\n     * clipPath will clip away controls, if you do not want this to happen use controlsAboveOverlay = true\r\n     * @type fabric.Object\r\n     */\r\n    clipPath: undefined,\r\n\r\n    /**\r\n     * @private\r\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\r\n     * @param {Object} [options] Options object\r\n     */\r\n    _initStatic: function(el, options) {\r\n      var cb = this.requestRenderAllBound;\r\n      this._objects = [];\r\n      this._createLowerCanvas(el);\r\n      this._initOptions(options);\r\n      // only initialize retina scaling once\r\n      if (!this.interactive) {\r\n        this._initRetinaScaling();\r\n      }\r\n\r\n      if (options.overlayImage) {\r\n        this.setOverlayImage(options.overlayImage, cb);\r\n      }\r\n      if (options.backgroundImage) {\r\n        this.setBackgroundImage(options.backgroundImage, cb);\r\n      }\r\n      if (options.backgroundColor) {\r\n        this.setBackgroundColor(options.backgroundColor, cb);\r\n      }\r\n      if (options.overlayColor) {\r\n        this.setOverlayColor(options.overlayColor, cb);\r\n      }\r\n      this.calcOffset();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _isRetinaScaling: function() {\r\n      return (fabric.devicePixelRatio > 1 && this.enableRetinaScaling);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @return {Number} retinaScaling if applied, otherwise 1;\r\n     */\r\n    getRetinaScaling: function() {\r\n      return this._isRetinaScaling() ? Math.max(1, fabric.devicePixelRatio) : 1;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _initRetinaScaling: function() {\r\n      if (!this._isRetinaScaling()) {\r\n        return;\r\n      }\r\n      var scaleRatio = fabric.devicePixelRatio;\r\n      this.__initRetinaScaling(scaleRatio, this.lowerCanvasEl, this.contextContainer);\r\n      if (this.upperCanvasEl) {\r\n        this.__initRetinaScaling(scaleRatio, this.upperCanvasEl, this.contextTop);\r\n      }\r\n    },\r\n\r\n    __initRetinaScaling: function(scaleRatio, canvas, context) {\r\n      canvas.setAttribute('width', this.width * scaleRatio);\r\n      canvas.setAttribute('height', this.height * scaleRatio);\r\n      context.scale(scaleRatio, scaleRatio);\r\n    },\r\n\r\n\r\n    /**\r\n     * Calculates canvas element offset relative to the document\r\n     * This method is also attached as \"resize\" event handler of window\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable\r\n     */\r\n    calcOffset: function () {\r\n      this._offset = getElementOffset(this.lowerCanvasEl);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\r\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\r\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\r\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\r\n     * @example <caption>Normal overlayImage with left/top = 0</caption>\r\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\r\n     *   // Needed to position overlayImage at 0/0\r\n     *   originX: 'left',\r\n     *   originY: 'top'\r\n     * });\r\n     * @example <caption>overlayImage with different properties</caption>\r\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\r\n     *   opacity: 0.5,\r\n     *   angle: 45,\r\n     *   left: 400,\r\n     *   top: 400,\r\n     *   originX: 'left',\r\n     *   originY: 'top'\r\n     * });\r\n     * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\r\n     * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img, isError) {\r\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\r\n     *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\r\n     * });\r\n     * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\r\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\r\n     *   width: canvas.width,\r\n     *   height: canvas.height,\r\n     *   // Needed to position overlayImage at 0/0\r\n     *   originX: 'left',\r\n     *   originY: 'top'\r\n     * });\r\n     * @example <caption>overlayImage loaded from cross-origin</caption>\r\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\r\n     *   opacity: 0.5,\r\n     *   angle: 45,\r\n     *   left: 400,\r\n     *   top: 400,\r\n     *   originX: 'left',\r\n     *   originY: 'top',\r\n     *   crossOrigin: 'anonymous'\r\n     * });\r\n     */\r\n    setOverlayImage: function (image, callback, options) {\r\n      return this.__setBgOverlayImage('overlayImage', image, callback, options);\r\n    },\r\n\r\n    /**\r\n     * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\r\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\r\n     * @param {Function} callback Callback to invoke when image is loaded and set as background\r\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     * @see {@link http://jsfiddle.net/djnr8o7a/28/|jsFiddle demo}\r\n     * @example <caption>Normal backgroundImage with left/top = 0</caption>\r\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\r\n     *   // Needed to position backgroundImage at 0/0\r\n     *   originX: 'left',\r\n     *   originY: 'top'\r\n     * });\r\n     * @example <caption>backgroundImage with different properties</caption>\r\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\r\n     *   opacity: 0.5,\r\n     *   angle: 45,\r\n     *   left: 400,\r\n     *   top: 400,\r\n     *   originX: 'left',\r\n     *   originY: 'top'\r\n     * });\r\n     * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\r\n     * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img, isError) {\r\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\r\n     *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\r\n     * });\r\n     * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\r\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\r\n     *   width: canvas.width,\r\n     *   height: canvas.height,\r\n     *   // Needed to position backgroundImage at 0/0\r\n     *   originX: 'left',\r\n     *   originY: 'top'\r\n     * });\r\n     * @example <caption>backgroundImage loaded from cross-origin</caption>\r\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\r\n     *   opacity: 0.5,\r\n     *   angle: 45,\r\n     *   left: 400,\r\n     *   top: 400,\r\n     *   originX: 'left',\r\n     *   originY: 'top',\r\n     *   crossOrigin: 'anonymous'\r\n     * });\r\n     */\r\n    // TODO: fix stretched examples\r\n    setBackgroundImage: function (image, callback, options) {\r\n      return this.__setBgOverlayImage('backgroundImage', image, callback, options);\r\n    },\r\n\r\n    /**\r\n     * Sets {@link fabric.StaticCanvas#overlayColor|foreground color} for this canvas\r\n     * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set foreground color to\r\n     * @param {Function} callback Callback to invoke when foreground color is set\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\r\n     * @example <caption>Normal overlayColor - color value</caption>\r\n     * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\r\n     * @example <caption>fabric.Pattern used as overlayColor</caption>\r\n     * canvas.setOverlayColor({\r\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\r\n     * }, canvas.renderAll.bind(canvas));\r\n     * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\r\n     * canvas.setOverlayColor({\r\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\r\n     *   repeat: 'repeat',\r\n     *   offsetX: 200,\r\n     *   offsetY: 100\r\n     * }, canvas.renderAll.bind(canvas));\r\n     */\r\n    setOverlayColor: function(overlayColor, callback) {\r\n      return this.__setBgOverlayColor('overlayColor', overlayColor, callback);\r\n    },\r\n\r\n    /**\r\n     * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\r\n     * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\r\n     * @param {Function} callback Callback to invoke when background color is set\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\r\n     * @example <caption>Normal backgroundColor - color value</caption>\r\n     * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\r\n     * @example <caption>fabric.Pattern used as backgroundColor</caption>\r\n     * canvas.setBackgroundColor({\r\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\r\n     * }, canvas.renderAll.bind(canvas));\r\n     * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\r\n     * canvas.setBackgroundColor({\r\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\r\n     *   repeat: 'repeat',\r\n     *   offsetX: 200,\r\n     *   offsetY: 100\r\n     * }, canvas.renderAll.bind(canvas));\r\n     */\r\n    setBackgroundColor: function(backgroundColor, callback) {\r\n      return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\r\n     * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\r\n     * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\r\n     * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay. The first argument is the created image, the second argument is a flag indicating whether an error occurred or not.\r\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\r\n     */\r\n    __setBgOverlayImage: function(property, image, callback, options) {\r\n      if (typeof image === 'string') {\r\n        fabric.util.loadImage(image, function(img, isError) {\r\n          if (img) {\r\n            var instance = new fabric.Image(img, options);\r\n            this[property] = instance;\r\n            instance.canvas = this;\r\n          }\r\n          callback && callback(img, isError);\r\n        }, this, options && options.crossOrigin);\r\n      }\r\n      else {\r\n        options && image.setOptions(options);\r\n        this[property] = image;\r\n        image && (image.canvas = this);\r\n        callback && callback(image, false);\r\n      }\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\r\n     * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\r\n     * @param {(Object|String|null)} color Object with pattern information, color value or null\r\n     * @param {Function} [callback] Callback is invoked when color is set\r\n     */\r\n    __setBgOverlayColor: function(property, color, callback) {\r\n      this[property] = color;\r\n      this._initGradient(color, property);\r\n      this._initPattern(color, property, callback);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _createCanvasElement: function() {\r\n      var element = createCanvasElement();\r\n      if (!element) {\r\n        throw CANVAS_INIT_ERROR;\r\n      }\r\n      if (!element.style) {\r\n        element.style = { };\r\n      }\r\n      if (typeof element.getContext === 'undefined') {\r\n        throw CANVAS_INIT_ERROR;\r\n      }\r\n      return element;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} [options] Options object\r\n     */\r\n    _initOptions: function (options) {\r\n      var lowerCanvasEl = this.lowerCanvasEl;\r\n      this._setOptions(options);\r\n\r\n      this.width = this.width || parseInt(lowerCanvasEl.width, 10) || 0;\r\n      this.height = this.height || parseInt(lowerCanvasEl.height, 10) || 0;\r\n\r\n      if (!this.lowerCanvasEl.style) {\r\n        return;\r\n      }\r\n\r\n      lowerCanvasEl.width = this.width;\r\n      lowerCanvasEl.height = this.height;\r\n\r\n      lowerCanvasEl.style.width = this.width + 'px';\r\n      lowerCanvasEl.style.height = this.height + 'px';\r\n\r\n      this.viewportTransform = this.viewportTransform.slice();\r\n    },\r\n\r\n    /**\r\n     * Creates a bottom canvas\r\n     * @private\r\n     * @param {HTMLElement} [canvasEl]\r\n     */\r\n    _createLowerCanvas: function (canvasEl) {\r\n      // canvasEl === 'HTMLCanvasElement' does not work on jsdom/node\r\n      if (canvasEl && canvasEl.getContext) {\r\n        this.lowerCanvasEl = canvasEl;\r\n      }\r\n      else {\r\n        this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();\r\n      }\r\n\r\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\r\n      this._originalCanvasStyle = this.lowerCanvasEl.style;\r\n      if (this.interactive) {\r\n        this._applyCanvasStyle(this.lowerCanvasEl);\r\n      }\r\n\r\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\r\n    },\r\n\r\n    /**\r\n     * Returns canvas width (in px)\r\n     * @return {Number}\r\n     */\r\n    getWidth: function () {\r\n      return this.width;\r\n    },\r\n\r\n    /**\r\n     * Returns canvas height (in px)\r\n     * @return {Number}\r\n     */\r\n    getHeight: function () {\r\n      return this.height;\r\n    },\r\n\r\n    /**\r\n     * Sets width of this canvas instance\r\n     * @param {Number|String} value                         Value to set width to\r\n     * @param {Object}        [options]                     Options object\r\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\r\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    setWidth: function (value, options) {\r\n      return this.setDimensions({ width: value }, options);\r\n    },\r\n\r\n    /**\r\n     * Sets height of this canvas instance\r\n     * @param {Number|String} value                         Value to set height to\r\n     * @param {Object}        [options]                     Options object\r\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\r\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    setHeight: function (value, options) {\r\n      return this.setDimensions({ height: value }, options);\r\n    },\r\n\r\n    /**\r\n     * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\r\n     * @param {Object}        dimensions                    Object with width/height properties\r\n     * @param {Number|String} [dimensions.width]            Width of canvas element\r\n     * @param {Number|String} [dimensions.height]           Height of canvas element\r\n     * @param {Object}        [options]                     Options object\r\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\r\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    setDimensions: function (dimensions, options) {\r\n      var cssValue;\r\n\r\n      options = options || {};\r\n\r\n      for (var prop in dimensions) {\r\n        cssValue = dimensions[prop];\r\n\r\n        if (!options.cssOnly) {\r\n          this._setBackstoreDimension(prop, dimensions[prop]);\r\n          cssValue += 'px';\r\n          this.hasLostContext = true;\r\n        }\r\n\r\n        if (!options.backstoreOnly) {\r\n          this._setCssDimension(prop, cssValue);\r\n        }\r\n      }\r\n      if (this._isCurrentlyDrawing) {\r\n        this.freeDrawingBrush && this.freeDrawingBrush._setBrushStyles(this.contextTop);\r\n      }\r\n      this._initRetinaScaling();\r\n      this.calcOffset();\r\n\r\n      if (!options.cssOnly) {\r\n        this.requestRenderAll();\r\n      }\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Helper for setting width/height\r\n     * @private\r\n     * @param {String} prop property (width|height)\r\n     * @param {Number} value value to set property to\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    _setBackstoreDimension: function (prop, value) {\r\n      this.lowerCanvasEl[prop] = value;\r\n\r\n      if (this.upperCanvasEl) {\r\n        this.upperCanvasEl[prop] = value;\r\n      }\r\n\r\n      if (this.cacheCanvasEl) {\r\n        this.cacheCanvasEl[prop] = value;\r\n      }\r\n\r\n      this[prop] = value;\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Helper for setting css width/height\r\n     * @private\r\n     * @param {String} prop property (width|height)\r\n     * @param {String} value value to set property to\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    _setCssDimension: function (prop, value) {\r\n      this.lowerCanvasEl.style[prop] = value;\r\n\r\n      if (this.upperCanvasEl) {\r\n        this.upperCanvasEl.style[prop] = value;\r\n      }\r\n\r\n      if (this.wrapperEl) {\r\n        this.wrapperEl.style[prop] = value;\r\n      }\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns canvas zoom level\r\n     * @return {Number}\r\n     */\r\n    getZoom: function () {\r\n      return this.viewportTransform[0];\r\n    },\r\n\r\n    /**\r\n     * Sets viewport transformation of this canvas instance\r\n     * @param {Array} vpt a Canvas 2D API transform matrix\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    setViewportTransform: function (vpt) {\r\n      var activeObject = this._activeObject,\r\n          backgroundObject = this.backgroundImage,\r\n          overlayObject = this.overlayImage,\r\n          object, i, len;\r\n      this.viewportTransform = vpt;\r\n      for (i = 0, len = this._objects.length; i < len; i++) {\r\n        object = this._objects[i];\r\n        object.group || object.setCoords(true);\r\n      }\r\n      if (activeObject) {\r\n        activeObject.setCoords();\r\n      }\r\n      if (backgroundObject) {\r\n        backgroundObject.setCoords(true);\r\n      }\r\n      if (overlayObject) {\r\n        overlayObject.setCoords(true);\r\n      }\r\n      this.calcViewportBoundaries();\r\n      this.renderOnAddRemove && this.requestRenderAll();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Sets zoom level of this canvas instance, the zoom centered around point\r\n     * meaning that following zoom to point with the same point will have the visual\r\n     * effect of the zoom originating from that point. The point won't move.\r\n     * It has nothing to do with canvas center or visual center of the viewport.\r\n     * @param {fabric.Point} point to zoom with respect to\r\n     * @param {Number} value to set zoom to, less than 1 zooms out\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    zoomToPoint: function (point, value) {\r\n      // TODO: just change the scale, preserve other transformations\r\n      var before = point, vpt = this.viewportTransform.slice(0);\r\n      point = transformPoint(point, invertTransform(this.viewportTransform));\r\n      vpt[0] = value;\r\n      vpt[3] = value;\r\n      var after = transformPoint(point, vpt);\r\n      vpt[4] += before.x - after.x;\r\n      vpt[5] += before.y - after.y;\r\n      return this.setViewportTransform(vpt);\r\n    },\r\n\r\n    /**\r\n     * Sets zoom level of this canvas instance\r\n     * @param {Number} value to set zoom to, less than 1 zooms out\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    setZoom: function (value) {\r\n      this.zoomToPoint(new fabric.Point(0, 0), value);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Pan viewport so as to place point at top left corner of canvas\r\n     * @param {fabric.Point} point to move to\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    absolutePan: function (point) {\r\n      var vpt = this.viewportTransform.slice(0);\r\n      vpt[4] = -point.x;\r\n      vpt[5] = -point.y;\r\n      return this.setViewportTransform(vpt);\r\n    },\r\n\r\n    /**\r\n     * Pans viewpoint relatively\r\n     * @param {fabric.Point} point (position vector) to move by\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable true\r\n     */\r\n    relativePan: function (point) {\r\n      return this.absolutePan(new fabric.Point(\r\n        -point.x - this.viewportTransform[4],\r\n        -point.y - this.viewportTransform[5]\r\n      ));\r\n    },\r\n\r\n    /**\r\n     * Returns &lt;canvas> element corresponding to this instance\r\n     * @return {HTMLCanvasElement}\r\n     */\r\n    getElement: function () {\r\n      return this.lowerCanvasEl;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {fabric.Object} obj Object that was added\r\n     */\r\n    _onObjectAdded: function(obj) {\r\n      this.stateful && obj.setupState();\r\n      obj._set('canvas', this);\r\n      obj.setCoords();\r\n      this.fire('object:added', { target: obj });\r\n      obj.fire('added');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {fabric.Object} obj Object that was removed\r\n     */\r\n    _onObjectRemoved: function(obj) {\r\n      this.fire('object:removed', { target: obj });\r\n      obj.fire('removed');\r\n      delete obj.canvas;\r\n    },\r\n\r\n    /**\r\n     * Clears specified context of canvas element\r\n     * @param {CanvasRenderingContext2D} ctx Context to clear\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    clearContext: function(ctx) {\r\n      ctx.clearRect(0, 0, this.width, this.height);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns context of canvas where objects are drawn\r\n     * @return {CanvasRenderingContext2D}\r\n     */\r\n    getContext: function () {\r\n      return this.contextContainer;\r\n    },\r\n\r\n    /**\r\n     * Clears all contexts (background, main, top) of an instance\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    clear: function () {\r\n      this.remove.apply(this, this.getObjects());\r\n      this.backgroundImage = null;\r\n      this.overlayImage = null;\r\n      this.backgroundColor = '';\r\n      this.overlayColor = '';\r\n      if (this._hasITextHandlers) {\r\n        this.off('mouse:up', this._mouseUpITextHandler);\r\n        this._iTextInstances = null;\r\n        this._hasITextHandlers = false;\r\n      }\r\n      this.clearContext(this.contextContainer);\r\n      this.fire('canvas:cleared');\r\n      this.renderOnAddRemove && this.requestRenderAll();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Renders the canvas\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable\r\n     */\r\n    renderAll: function () {\r\n      var canvasToDrawOn = this.contextContainer;\r\n      this.renderCanvas(canvasToDrawOn, this._objects);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Function created to be instance bound at initialization\r\n     * used in requestAnimationFrame rendering\r\n     * Let the fabricJS call it. If you call it manually you could have more\r\n     * animationFrame stacking on to of each other\r\n     * for an imperative rendering, use canvas.renderAll\r\n     * @private\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable\r\n     */\r\n    renderAndReset: function() {\r\n      this.isRendering = 0;\r\n      this.renderAll();\r\n    },\r\n\r\n    /**\r\n     * Append a renderAll request to next animation frame.\r\n     * unless one is already in progress, in that case nothing is done\r\n     * a boolean flag will avoid appending more.\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable\r\n     */\r\n    requestRenderAll: function () {\r\n      if (!this.isRendering) {\r\n        this.isRendering = fabric.util.requestAnimFrame(this.renderAndResetBound);\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Calculate the position of the 4 corner of canvas with current viewportTransform.\r\n     * helps to determinate when an object is in the current rendering viewport using\r\n     * object absolute coordinates ( aCoords )\r\n     * @return {Object} points.tl\r\n     * @chainable\r\n     */\r\n    calcViewportBoundaries: function() {\r\n      var points = { }, width = this.width, height = this.height,\r\n          iVpt = invertTransform(this.viewportTransform);\r\n      points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\r\n      points.br = transformPoint({ x: width, y: height }, iVpt);\r\n      points.tr = new fabric.Point(points.br.x, points.tl.y);\r\n      points.bl = new fabric.Point(points.tl.x, points.br.y);\r\n      this.vptCoords = points;\r\n      return points;\r\n    },\r\n\r\n    cancelRequestedRender: function() {\r\n      if (this.isRendering) {\r\n        fabric.util.cancelAnimFrame(this.isRendering);\r\n        this.isRendering = 0;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Renders background, objects, overlay and controls.\r\n     * @param {CanvasRenderingContext2D} ctx\r\n     * @param {Array} objects to render\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable\r\n     */\r\n    renderCanvas: function(ctx, objects) {\r\n      var v = this.viewportTransform, path = this.clipPath;\r\n      this.cancelRequestedRender();\r\n      this.calcViewportBoundaries();\r\n      this.clearContext(ctx);\r\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothingEnabled);\r\n      this.fire('before:render', { ctx: ctx, });\r\n      this._renderBackground(ctx);\r\n\r\n      ctx.save();\r\n      //apply viewport transform once for all rendering process\r\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\r\n      this._renderObjects(ctx, objects);\r\n      ctx.restore();\r\n      if (!this.controlsAboveOverlay && this.interactive) {\r\n        this.drawControls(ctx);\r\n      }\r\n      if (path) {\r\n        path.canvas = this;\r\n        // needed to setup a couple of variables\r\n        path.shouldCache();\r\n        path._transformDone = true;\r\n        path.renderCache({ forClipping: true });\r\n        this.drawClipPathOnCanvas(ctx);\r\n      }\r\n      this._renderOverlay(ctx);\r\n      if (this.controlsAboveOverlay && this.interactive) {\r\n        this.drawControls(ctx);\r\n      }\r\n      this.fire('after:render', { ctx: ctx, });\r\n    },\r\n\r\n    /**\r\n     * Paint the cached clipPath on the lowerCanvasEl\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    drawClipPathOnCanvas: function(ctx) {\r\n      var v = this.viewportTransform, path = this.clipPath;\r\n      ctx.save();\r\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\r\n      // DEBUG: uncomment this line, comment the following\r\n      // ctx.globalAlpha = 0.4;\r\n      ctx.globalCompositeOperation = 'destination-in';\r\n      path.transform(ctx);\r\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\r\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {Array} objects to render\r\n     */\r\n    _renderObjects: function(ctx, objects) {\r\n      var i, len;\r\n      for (i = 0, len = objects.length; i < len; ++i) {\r\n        objects[i] && objects[i].render(ctx);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {string} property 'background' or 'overlay'\r\n     */\r\n    _renderBackgroundOrOverlay: function(ctx, property) {\r\n      var fill = this[property + 'Color'], object = this[property + 'Image'],\r\n          v = this.viewportTransform, needsVpt = this[property + 'Vpt'];\r\n      if (!fill && !object) {\r\n        return;\r\n      }\r\n      if (fill) {\r\n        ctx.save();\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, 0);\r\n        ctx.lineTo(this.width, 0);\r\n        ctx.lineTo(this.width, this.height);\r\n        ctx.lineTo(0, this.height);\r\n        ctx.closePath();\r\n        ctx.fillStyle = fill.toLive\r\n          ? fill.toLive(ctx, this)\r\n          : fill;\r\n        if (needsVpt) {\r\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\r\n        }\r\n        ctx.transform(1, 0, 0, 1, fill.offsetX || 0, fill.offsetY || 0);\r\n        var m = fill.gradientTransform || fill.patternTransform;\r\n        m && ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\r\n        ctx.fill();\r\n        ctx.restore();\r\n      }\r\n      if (object) {\r\n        ctx.save();\r\n        if (needsVpt) {\r\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\r\n        }\r\n        object.render(ctx);\r\n        ctx.restore();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderBackground: function(ctx) {\r\n      this._renderBackgroundOrOverlay(ctx, 'background');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderOverlay: function(ctx) {\r\n      this._renderBackgroundOrOverlay(ctx, 'overlay');\r\n    },\r\n\r\n    /**\r\n     * Returns coordinates of a center of canvas.\r\n     * Returned value is an object with top and left properties\r\n     * @return {Object} object with \"top\" and \"left\" number values\r\n     * @deprecated migrate to `getCenterPoint`\r\n     */\r\n    getCenter: function () {\r\n      return {\r\n        top: this.height / 2,\r\n        left: this.width / 2\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Returns coordinates of a center of canvas.\r\n     * @return {fabric.Point} \r\n     */\r\n    getCenterPoint: function () {\r\n      return new fabric.Point(this.width / 2, this.height / 2);\r\n    },\r\n\r\n    /**\r\n     * Centers object horizontally in the canvas\r\n     * @param {fabric.Object} object Object to center horizontally\r\n     * @return {fabric.Canvas} thisArg\r\n     */\r\n    centerObjectH: function (object) {\r\n      return this._centerObject(object, new fabric.Point(this.getCenterPoint().x, object.getCenterPoint().y));\r\n    },\r\n\r\n    /**\r\n     * Centers object vertically in the canvas\r\n     * @param {fabric.Object} object Object to center vertically\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    centerObjectV: function (object) {\r\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenterPoint().y));\r\n    },\r\n\r\n    /**\r\n     * Centers object vertically and horizontally in the canvas\r\n     * @param {fabric.Object} object Object to center vertically and horizontally\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    centerObject: function(object) {\r\n      var center = this.getCenterPoint();\r\n      return this._centerObject(object, center);\r\n    },\r\n\r\n    /**\r\n     * Centers object vertically and horizontally in the viewport\r\n     * @param {fabric.Object} object Object to center vertically and horizontally\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    viewportCenterObject: function(object) {\r\n      var vpCenter = this.getVpCenter();\r\n      return this._centerObject(object, vpCenter);\r\n    },\r\n\r\n    /**\r\n     * Centers object horizontally in the viewport, object.top is unchanged\r\n     * @param {fabric.Object} object Object to center vertically and horizontally\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    viewportCenterObjectH: function(object) {\r\n      var vpCenter = this.getVpCenter();\r\n      this._centerObject(object, new fabric.Point(vpCenter.x, object.getCenterPoint().y));\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Centers object Vertically in the viewport, object.top is unchanged\r\n     * @param {fabric.Object} object Object to center vertically and horizontally\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    viewportCenterObjectV: function(object) {\r\n      var vpCenter = this.getVpCenter();\r\n\r\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, vpCenter.y));\r\n    },\r\n\r\n    /**\r\n     * Calculate the point in canvas that correspond to the center of actual viewport.\r\n     * @return {fabric.Point} vpCenter, viewport center\r\n     * @chainable\r\n     */\r\n    getVpCenter: function() {\r\n      var center = this.getCenterPoint(),\r\n          iVpt = invertTransform(this.viewportTransform);\r\n      return transformPoint(center, iVpt);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {fabric.Object} object Object to center\r\n     * @param {fabric.Point} center Center point\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    _centerObject: function(object, center) {\r\n      object.setPositionByOrigin(center, 'center', 'center');\r\n      object.setCoords();\r\n      this.renderOnAddRemove && this.requestRenderAll();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns dataless JSON representation of canvas\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {String} json string\r\n     */\r\n    toDatalessJSON: function (propertiesToInclude) {\r\n      return this.toDatalessObject(propertiesToInclude);\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of canvas\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toObject: function (propertiesToInclude) {\r\n      return this._toObjectMethod('toObject', propertiesToInclude);\r\n    },\r\n\r\n    /**\r\n     * Returns dataless object representation of canvas\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toDatalessObject: function (propertiesToInclude) {\r\n      return this._toObjectMethod('toDatalessObject', propertiesToInclude);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _toObjectMethod: function (methodName, propertiesToInclude) {\r\n\r\n      var clipPath = this.clipPath, data = {\r\n        version: fabric.version,\r\n        objects: this._toObjects(methodName, propertiesToInclude),\r\n      };\r\n      if (clipPath && !clipPath.excludeFromExport) {\r\n        data.clipPath = this._toObject(this.clipPath, methodName, propertiesToInclude);\r\n      }\r\n      extend(data, this.__serializeBgOverlay(methodName, propertiesToInclude));\r\n\r\n      fabric.util.populateWithProperties(this, data, propertiesToInclude);\r\n\r\n      return data;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _toObjects: function(methodName, propertiesToInclude) {\r\n      return this._objects.filter(function(object) {\r\n        return !object.excludeFromExport;\r\n      }).map(function(instance) {\r\n        return this._toObject(instance, methodName, propertiesToInclude);\r\n      }, this);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _toObject: function(instance, methodName, propertiesToInclude) {\r\n      var originalValue;\r\n\r\n      if (!this.includeDefaultValues) {\r\n        originalValue = instance.includeDefaultValues;\r\n        instance.includeDefaultValues = false;\r\n      }\r\n\r\n      var object = instance[methodName](propertiesToInclude);\r\n      if (!this.includeDefaultValues) {\r\n        instance.includeDefaultValues = originalValue;\r\n      }\r\n      return object;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    __serializeBgOverlay: function(methodName, propertiesToInclude) {\r\n      var data = {}, bgImage = this.backgroundImage, overlayImage = this.overlayImage,\r\n          bgColor = this.backgroundColor, overlayColor = this.overlayColor;\r\n\r\n      if (bgColor && bgColor.toObject) {\r\n        if (!bgColor.excludeFromExport) {\r\n          data.background = bgColor.toObject(propertiesToInclude);\r\n        }\r\n      }\r\n      else if (bgColor) {\r\n        data.background = bgColor;\r\n      }\r\n\r\n      if (overlayColor && overlayColor.toObject) {\r\n        if (!overlayColor.excludeFromExport) {\r\n          data.overlay = overlayColor.toObject(propertiesToInclude);\r\n        }\r\n      }\r\n      else if (overlayColor) {\r\n        data.overlay = overlayColor;\r\n      }\r\n\r\n      if (bgImage && !bgImage.excludeFromExport) {\r\n        data.backgroundImage = this._toObject(bgImage, methodName, propertiesToInclude);\r\n      }\r\n      if (overlayImage && !overlayImage.excludeFromExport) {\r\n        data.overlayImage = this._toObject(overlayImage, methodName, propertiesToInclude);\r\n      }\r\n\r\n      return data;\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\r\n     * a zoomed canvas will then produce zoomed SVG output.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    svgViewportTransformation: true,\r\n\r\n    /**\r\n     * Returns SVG representation of canvas\r\n     * @function\r\n     * @param {Object} [options] Options object for SVG output\r\n     * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\r\n     * @param {Object} [options.viewBox] SVG viewbox object\r\n     * @param {Number} [options.viewBox.x] x-coordinate of viewbox\r\n     * @param {Number} [options.viewBox.y] y-coordinate of viewbox\r\n     * @param {Number} [options.viewBox.width] Width of viewbox\r\n     * @param {Number} [options.viewBox.height] Height of viewbox\r\n     * @param {String} [options.encoding=UTF-8] Encoding of SVG output\r\n     * @param {String} [options.width] desired width of svg with or without units\r\n     * @param {String} [options.height] desired height of svg with or without units\r\n     * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\r\n     * @return {String} SVG string\r\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\r\n     * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\r\n     * @example <caption>Normal SVG output</caption>\r\n     * var svg = canvas.toSVG();\r\n     * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\r\n     * var svg = canvas.toSVG({suppressPreamble: true});\r\n     * @example <caption>SVG output with viewBox attribute</caption>\r\n     * var svg = canvas.toSVG({\r\n     *   viewBox: {\r\n     *     x: 100,\r\n     *     y: 100,\r\n     *     width: 200,\r\n     *     height: 300\r\n     *   }\r\n     * });\r\n     * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\r\n     * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\r\n     * @example <caption>Modify SVG output with reviver function</caption>\r\n     * var svg = canvas.toSVG(null, function(svg) {\r\n     *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\r\n     * });\r\n     */\r\n    toSVG: function(options, reviver) {\r\n      options || (options = { });\r\n      options.reviver = reviver;\r\n      var markup = [];\r\n\r\n      this._setSVGPreamble(markup, options);\r\n      this._setSVGHeader(markup, options);\r\n      if (this.clipPath) {\r\n        markup.push('<g clip-path=\"url(#' + this.clipPath.clipPathId + ')\" >\\n');\r\n      }\r\n      this._setSVGBgOverlayColor(markup, 'background');\r\n      this._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);\r\n      this._setSVGObjects(markup, reviver);\r\n      if (this.clipPath) {\r\n        markup.push('</g>\\n');\r\n      }\r\n      this._setSVGBgOverlayColor(markup, 'overlay');\r\n      this._setSVGBgOverlayImage(markup, 'overlayImage', reviver);\r\n\r\n      markup.push('</svg>');\r\n\r\n      return markup.join('');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setSVGPreamble: function(markup, options) {\r\n      if (options.suppressPreamble) {\r\n        return;\r\n      }\r\n      markup.push(\r\n        '<?xml version=\"1.0\" encoding=\"', (options.encoding || 'UTF-8'), '\" standalone=\"no\" ?>\\n',\r\n        '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\r\n        '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\r\n      );\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setSVGHeader: function(markup, options) {\r\n      var width = options.width || this.width,\r\n          height = options.height || this.height,\r\n          vpt, viewBox = 'viewBox=\"0 0 ' + this.width + ' ' + this.height + '\" ',\r\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\r\n\r\n      if (options.viewBox) {\r\n        viewBox = 'viewBox=\"' +\r\n                options.viewBox.x + ' ' +\r\n                options.viewBox.y + ' ' +\r\n                options.viewBox.width + ' ' +\r\n                options.viewBox.height + '\" ';\r\n      }\r\n      else {\r\n        if (this.svgViewportTransformation) {\r\n          vpt = this.viewportTransform;\r\n          viewBox = 'viewBox=\"' +\r\n                  toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\r\n                  toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) + ' ' +\r\n                  toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\r\n                  toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) + '\" ';\r\n        }\r\n      }\r\n\r\n      markup.push(\r\n        '<svg ',\r\n        'xmlns=\"http://www.w3.org/2000/svg\" ',\r\n        'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\r\n        'version=\"1.1\" ',\r\n        'width=\"', width, '\" ',\r\n        'height=\"', height, '\" ',\r\n        viewBox,\r\n        'xml:space=\"preserve\">\\n',\r\n        '<desc>Created with Fabric.js ', fabric.version, '</desc>\\n',\r\n        '<defs>\\n',\r\n        this.createSVGFontFacesMarkup(),\r\n        this.createSVGRefElementsMarkup(),\r\n        this.createSVGClipPathMarkup(options),\r\n        '</defs>\\n'\r\n      );\r\n    },\r\n\r\n    createSVGClipPathMarkup: function(options) {\r\n      var clipPath = this.clipPath;\r\n      if (clipPath) {\r\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\r\n        return  '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\r\n          this.clipPath.toClipPathSVG(options.reviver) +\r\n          '</clipPath>\\n';\r\n      }\r\n      return '';\r\n    },\r\n\r\n    /**\r\n     * Creates markup containing SVG referenced elements like patterns, gradients etc.\r\n     * @return {String}\r\n     */\r\n    createSVGRefElementsMarkup: function() {\r\n      var _this = this,\r\n          markup = ['background', 'overlay'].map(function(prop) {\r\n            var fill = _this[prop + 'Color'];\r\n            if (fill && fill.toLive) {\r\n              var shouldTransform = _this[prop + 'Vpt'], vpt = _this.viewportTransform,\r\n                  object = {\r\n                    width: _this.width / (shouldTransform ? vpt[0] : 1),\r\n                    height: _this.height / (shouldTransform ? vpt[3] : 1)\r\n                  };\r\n              return fill.toSVG(\r\n                object,\r\n                { additionalTransform: shouldTransform ? fabric.util.matrixToSVG(vpt) : '' }\r\n              );\r\n            }\r\n          });\r\n      return markup.join('');\r\n    },\r\n\r\n    /**\r\n     * Creates markup containing SVG font faces,\r\n     * font URLs for font faces must be collected by developers\r\n     * and are not extracted from the DOM by fabricjs\r\n     * @param {Array} objects Array of fabric objects\r\n     * @return {String}\r\n     */\r\n    createSVGFontFacesMarkup: function() {\r\n      var markup = '', fontList = { }, obj, fontFamily,\r\n          style, row, rowIndex, _char, charIndex, i, len,\r\n          fontPaths = fabric.fontPaths, objects = [];\r\n\r\n      this._objects.forEach(function add(object) {\r\n        objects.push(object);\r\n        if (object._objects) {\r\n          object._objects.forEach(add);\r\n        }\r\n      });\r\n\r\n      for (i = 0, len = objects.length; i < len; i++) {\r\n        obj = objects[i];\r\n        fontFamily = obj.fontFamily;\r\n        if (obj.type.indexOf('text') === -1 || fontList[fontFamily] || !fontPaths[fontFamily]) {\r\n          continue;\r\n        }\r\n        fontList[fontFamily] = true;\r\n        if (!obj.styles) {\r\n          continue;\r\n        }\r\n        style = obj.styles;\r\n        for (rowIndex in style) {\r\n          row = style[rowIndex];\r\n          for (charIndex in row) {\r\n            _char = row[charIndex];\r\n            fontFamily = _char.fontFamily;\r\n            if (!fontList[fontFamily] && fontPaths[fontFamily]) {\r\n              fontList[fontFamily] = true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      for (var j in fontList) {\r\n        markup += [\r\n          '\\t\\t@font-face {\\n',\r\n          '\\t\\t\\tfont-family: \\'', j, '\\';\\n',\r\n          '\\t\\t\\tsrc: url(\\'', fontPaths[j], '\\');\\n',\r\n          '\\t\\t}\\n'\r\n        ].join('');\r\n      }\r\n\r\n      if (markup) {\r\n        markup = [\r\n          '\\t<style type=\"text/css\">',\r\n          '<![CDATA[\\n',\r\n          markup,\r\n          ']]>',\r\n          '</style>\\n'\r\n        ].join('');\r\n      }\r\n\r\n      return markup;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setSVGObjects: function(markup, reviver) {\r\n      var instance, i, len, objects = this._objects;\r\n      for (i = 0, len = objects.length; i < len; i++) {\r\n        instance = objects[i];\r\n        if (instance.excludeFromExport) {\r\n          continue;\r\n        }\r\n        this._setSVGObject(markup, instance, reviver);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setSVGObject: function(markup, instance, reviver) {\r\n      markup.push(instance.toSVG(reviver));\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setSVGBgOverlayImage: function(markup, property, reviver) {\r\n      if (this[property] && !this[property].excludeFromExport && this[property].toSVG) {\r\n        markup.push(this[property].toSVG(reviver));\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setSVGBgOverlayColor: function(markup, property) {\r\n      var filler = this[property + 'Color'], vpt = this.viewportTransform, finalWidth = this.width,\r\n          finalHeight = this.height;\r\n      if (!filler) {\r\n        return;\r\n      }\r\n      if (filler.toLive) {\r\n        var repeat = filler.repeat, iVpt = fabric.util.invertTransform(vpt), shouldInvert = this[property + 'Vpt'],\r\n            additionalTransform = shouldInvert ? fabric.util.matrixToSVG(iVpt) : '';\r\n        markup.push(\r\n          '<rect transform=\"' + additionalTransform + ' translate(', finalWidth / 2, ',', finalHeight / 2, ')\"',\r\n          ' x=\"', filler.offsetX - finalWidth / 2,\r\n          '\" y=\"', filler.offsetY - finalHeight / 2, '\" ',\r\n          'width=\"',\r\n          (repeat === 'repeat-y' || repeat === 'no-repeat'\r\n            ? filler.source.width\r\n            : finalWidth ),\r\n          '\" height=\"',\r\n          (repeat === 'repeat-x' || repeat === 'no-repeat'\r\n            ? filler.source.height\r\n            : finalHeight),\r\n          '\" fill=\"url(#SVGID_' + filler.id + ')\"',\r\n          '></rect>\\n'\r\n        );\r\n      }\r\n      else {\r\n        markup.push(\r\n          '<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ',\r\n          'fill=\"', filler, '\"',\r\n          '></rect>\\n'\r\n        );\r\n      }\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n    /**\r\n     * Moves an object or the objects of a multiple selection\r\n     * to the bottom of the stack of drawn objects\r\n     * @param {fabric.Object} object Object to send to back\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    sendToBack: function (object) {\r\n      if (!object) {\r\n        return this;\r\n      }\r\n      var activeSelection = this._activeObject,\r\n          i, obj, objs;\r\n      if (object === activeSelection && object.type === 'activeSelection') {\r\n        objs = activeSelection._objects;\r\n        for (i = objs.length; i--;) {\r\n          obj = objs[i];\r\n          removeFromArray(this._objects, obj);\r\n          this._objects.unshift(obj);\r\n        }\r\n      }\r\n      else {\r\n        removeFromArray(this._objects, object);\r\n        this._objects.unshift(object);\r\n      }\r\n      this.renderOnAddRemove && this.requestRenderAll();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Moves an object or the objects of a multiple selection\r\n     * to the top of the stack of drawn objects\r\n     * @param {fabric.Object} object Object to send\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    bringToFront: function (object) {\r\n      if (!object) {\r\n        return this;\r\n      }\r\n      var activeSelection = this._activeObject,\r\n          i, obj, objs;\r\n      if (object === activeSelection && object.type === 'activeSelection') {\r\n        objs = activeSelection._objects;\r\n        for (i = 0; i < objs.length; i++) {\r\n          obj = objs[i];\r\n          removeFromArray(this._objects, obj);\r\n          this._objects.push(obj);\r\n        }\r\n      }\r\n      else {\r\n        removeFromArray(this._objects, object);\r\n        this._objects.push(object);\r\n      }\r\n      this.renderOnAddRemove && this.requestRenderAll();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Moves an object or a selection down in stack of drawn objects\r\n     * An optional parameter, intersecting allows to move the object in behind\r\n     * the first intersecting object. Where intersection is calculated with\r\n     * bounding box. If no intersection is found, there will not be change in the\r\n     * stack.\r\n     * @param {fabric.Object} object Object to send\r\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    sendBackwards: function (object, intersecting) {\r\n      if (!object) {\r\n        return this;\r\n      }\r\n      var activeSelection = this._activeObject,\r\n          i, obj, idx, newIdx, objs, objsMoved = 0;\r\n\r\n      if (object === activeSelection && object.type === 'activeSelection') {\r\n        objs = activeSelection._objects;\r\n        for (i = 0; i < objs.length; i++) {\r\n          obj = objs[i];\r\n          idx = this._objects.indexOf(obj);\r\n          if (idx > 0 + objsMoved) {\r\n            newIdx = idx - 1;\r\n            removeFromArray(this._objects, obj);\r\n            this._objects.splice(newIdx, 0, obj);\r\n          }\r\n          objsMoved++;\r\n        }\r\n      }\r\n      else {\r\n        idx = this._objects.indexOf(object);\r\n        if (idx !== 0) {\r\n          // if object is not on the bottom of stack\r\n          newIdx = this._findNewLowerIndex(object, idx, intersecting);\r\n          removeFromArray(this._objects, object);\r\n          this._objects.splice(newIdx, 0, object);\r\n        }\r\n      }\r\n      this.renderOnAddRemove && this.requestRenderAll();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _findNewLowerIndex: function(object, idx, intersecting) {\r\n      var newIdx, i;\r\n\r\n      if (intersecting) {\r\n        newIdx = idx;\r\n\r\n        // traverse down the stack looking for the nearest intersecting object\r\n        for (i = idx - 1; i >= 0; --i) {\r\n\r\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\r\n                               object.isContainedWithinObject(this._objects[i]) ||\r\n                               this._objects[i].isContainedWithinObject(object);\r\n\r\n          if (isIntersecting) {\r\n            newIdx = i;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        newIdx = idx - 1;\r\n      }\r\n\r\n      return newIdx;\r\n    },\r\n\r\n    /**\r\n     * Moves an object or a selection up in stack of drawn objects\r\n     * An optional parameter, intersecting allows to move the object in front\r\n     * of the first intersecting object. Where intersection is calculated with\r\n     * bounding box. If no intersection is found, there will not be change in the\r\n     * stack.\r\n     * @param {fabric.Object} object Object to send\r\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    bringForward: function (object, intersecting) {\r\n      if (!object) {\r\n        return this;\r\n      }\r\n      var activeSelection = this._activeObject,\r\n          i, obj, idx, newIdx, objs, objsMoved = 0;\r\n\r\n      if (object === activeSelection && object.type === 'activeSelection') {\r\n        objs = activeSelection._objects;\r\n        for (i = objs.length; i--;) {\r\n          obj = objs[i];\r\n          idx = this._objects.indexOf(obj);\r\n          if (idx < this._objects.length - 1 - objsMoved) {\r\n            newIdx = idx + 1;\r\n            removeFromArray(this._objects, obj);\r\n            this._objects.splice(newIdx, 0, obj);\r\n          }\r\n          objsMoved++;\r\n        }\r\n      }\r\n      else {\r\n        idx = this._objects.indexOf(object);\r\n        if (idx !== this._objects.length - 1) {\r\n          // if object is not on top of stack (last item in an array)\r\n          newIdx = this._findNewUpperIndex(object, idx, intersecting);\r\n          removeFromArray(this._objects, object);\r\n          this._objects.splice(newIdx, 0, object);\r\n        }\r\n      }\r\n      this.renderOnAddRemove && this.requestRenderAll();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _findNewUpperIndex: function(object, idx, intersecting) {\r\n      var newIdx, i, len;\r\n\r\n      if (intersecting) {\r\n        newIdx = idx;\r\n\r\n        // traverse up the stack looking for the nearest intersecting object\r\n        for (i = idx + 1, len = this._objects.length; i < len; ++i) {\r\n\r\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\r\n                               object.isContainedWithinObject(this._objects[i]) ||\r\n                               this._objects[i].isContainedWithinObject(object);\r\n\r\n          if (isIntersecting) {\r\n            newIdx = i;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        newIdx = idx + 1;\r\n      }\r\n\r\n      return newIdx;\r\n    },\r\n\r\n    /**\r\n     * Moves an object to specified level in stack of drawn objects\r\n     * @param {fabric.Object} object Object to send\r\n     * @param {Number} index Position to move to\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    moveTo: function (object, index) {\r\n      removeFromArray(this._objects, object);\r\n      this._objects.splice(index, 0, object);\r\n      return this.renderOnAddRemove && this.requestRenderAll();\r\n    },\r\n\r\n    /**\r\n     * Clears a canvas element and dispose objects\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    dispose: function () {\r\n      // cancel eventually ongoing renders\r\n      if (this.isRendering) {\r\n        fabric.util.cancelAnimFrame(this.isRendering);\r\n        this.isRendering = 0;\r\n      }\r\n      this.forEachObject(function(object) {\r\n        object.dispose && object.dispose();\r\n      });\r\n      this._objects = [];\r\n      if (this.backgroundImage && this.backgroundImage.dispose) {\r\n        this.backgroundImage.dispose();\r\n      }\r\n      this.backgroundImage = null;\r\n      if (this.overlayImage && this.overlayImage.dispose) {\r\n        this.overlayImage.dispose();\r\n      }\r\n      this.overlayImage = null;\r\n      this._iTextInstances = null;\r\n      this.contextContainer = null;\r\n      // restore canvas style\r\n      this.lowerCanvasEl.classList.remove('lower-canvas');\r\n      fabric.util.setStyle(this.lowerCanvasEl, this._originalCanvasStyle);\r\n      delete this._originalCanvasStyle;\r\n      // restore canvas size to original size in case retina scaling was applied\r\n      this.lowerCanvasEl.setAttribute('width', this.width);\r\n      this.lowerCanvasEl.setAttribute('height', this.height);\r\n      fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);\r\n      this.lowerCanvasEl = undefined;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns a string representation of an instance\r\n     * @return {String} string representation of an instance\r\n     */\r\n    toString: function () {\r\n      return '#<fabric.Canvas (' + this.complexity() + '): ' +\r\n               '{ objects: ' + this._objects.length + ' }>';\r\n    }\r\n  });\r\n\r\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\r\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\r\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\r\n\r\n  extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {\r\n\r\n    /**\r\n     * @static\r\n     * @type String\r\n     * @default\r\n     */\r\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\r\n\r\n    /**\r\n     * Provides a way to check support of some of the canvas methods\r\n     * (either those of HTMLCanvasElement itself, or rendering context)\r\n     *\r\n     * @param {String} methodName Method to check support for;\r\n     *                            Could be one of \"setLineDash\"\r\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\r\n     *                          `null` if canvas element or context can not be initialized\r\n     */\r\n    supports: function (methodName) {\r\n      var el = createCanvasElement();\r\n\r\n      if (!el || !el.getContext) {\r\n        return null;\r\n      }\r\n\r\n      var ctx = el.getContext('2d');\r\n      if (!ctx) {\r\n        return null;\r\n      }\r\n\r\n      switch (methodName) {\r\n\r\n        case 'setLineDash':\r\n          return typeof ctx.setLineDash !== 'undefined';\r\n\r\n        default:\r\n          return null;\r\n      }\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns Object representation of canvas\r\n   * this alias is provided because if you call JSON.stringify on an instance,\r\n   * the toJSON object will be invoked if it exists.\r\n   * Having a toJSON method means you can do JSON.stringify(myCanvas)\r\n   * @function\r\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n   * @return {Object} JSON compatible object\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\r\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\r\n   * @example <caption>JSON without additional properties</caption>\r\n   * var json = canvas.toJSON();\r\n   * @example <caption>JSON with additional properties included</caption>\r\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY']);\r\n   * @example <caption>JSON without default values</caption>\r\n   * canvas.includeDefaultValues = false;\r\n   * var json = canvas.toJSON();\r\n   */\r\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\r\n\r\n  if (fabric.isLikelyNode) {\r\n    fabric.StaticCanvas.prototype.createPNGStream = function() {\r\n      var impl = getNodeCanvas(this.lowerCanvasEl);\r\n      return impl && impl.createPNGStream();\r\n    };\r\n    fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {\r\n      var impl = getNodeCanvas(this.lowerCanvasEl);\r\n      return impl && impl.createJPEGStream(opts);\r\n    };\r\n  }\r\n})();\r\n\r\n\r\n/**\r\n * BaseBrush class\r\n * @class fabric.BaseBrush\r\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\r\n */\r\nfabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {\r\n\r\n  /**\r\n   * Color of a brush\r\n   * @type String\r\n   * @default\r\n   */\r\n  color: 'rgb(0, 0, 0)',\r\n\r\n  /**\r\n   * Width of a brush, has to be a Number, no string literals\r\n   * @type Number\r\n   * @default\r\n   */\r\n  width: 1,\r\n\r\n  /**\r\n   * Shadow object representing shadow of this shape.\r\n   * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\r\n   * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\r\n   * @type fabric.Shadow\r\n   * @default\r\n   */\r\n  shadow: null,\r\n\r\n  /**\r\n   * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\r\n   * @type String\r\n   * @default\r\n   */\r\n  strokeLineCap: 'round',\r\n\r\n  /**\r\n   * Corner style of a brush (one of \"bevel\", \"round\", \"miter\")\r\n   * @type String\r\n   * @default\r\n   */\r\n  strokeLineJoin: 'round',\r\n\r\n  /**\r\n   * Maximum miter length (used for strokeLineJoin = \"miter\") of a brush's\r\n   * @type Number\r\n   * @default\r\n   */\r\n  strokeMiterLimit:         10,\r\n\r\n  /**\r\n   * Stroke Dash Array.\r\n   * @type Array\r\n   * @default\r\n   */\r\n  strokeDashArray: null,\r\n\r\n  /**\r\n   * When `true`, the free drawing is limited to the whiteboard size. Default to false.\r\n   * @type Boolean\r\n   * @default false\r\n  */\r\n\r\n  limitedToCanvasSize: false,\r\n\r\n\r\n  /**\r\n   * Sets brush styles\r\n   * @private\r\n   * @param {CanvasRenderingContext2D} ctx\r\n   */\r\n  _setBrushStyles: function (ctx) {\r\n    ctx.strokeStyle = this.color;\r\n    ctx.lineWidth = this.width;\r\n    ctx.lineCap = this.strokeLineCap;\r\n    ctx.miterLimit = this.strokeMiterLimit;\r\n    ctx.lineJoin = this.strokeLineJoin;\r\n    ctx.setLineDash(this.strokeDashArray || []);\r\n  },\r\n\r\n  /**\r\n   * Sets the transformation on given context\r\n   * @param {RenderingContext2d} ctx context to render on\r\n   * @private\r\n   */\r\n  _saveAndTransform: function(ctx) {\r\n    var v = this.canvas.viewportTransform;\r\n    ctx.save();\r\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\r\n  },\r\n\r\n  /**\r\n   * Sets brush shadow styles\r\n   * @private\r\n   */\r\n  _setShadow: function() {\r\n    if (!this.shadow) {\r\n      return;\r\n    }\r\n\r\n    var canvas = this.canvas,\r\n        shadow = this.shadow,\r\n        ctx = canvas.contextTop,\r\n        zoom = canvas.getZoom();\r\n    if (canvas && canvas._isRetinaScaling()) {\r\n      zoom *= fabric.devicePixelRatio;\r\n    }\r\n\r\n    ctx.shadowColor = shadow.color;\r\n    ctx.shadowBlur = shadow.blur * zoom;\r\n    ctx.shadowOffsetX = shadow.offsetX * zoom;\r\n    ctx.shadowOffsetY = shadow.offsetY * zoom;\r\n  },\r\n\r\n  needsFullRender: function() {\r\n    var color = new fabric.Color(this.color);\r\n    return color.getAlpha() < 1 || !!this.shadow;\r\n  },\r\n\r\n  /**\r\n   * Removes brush shadow styles\r\n   * @private\r\n   */\r\n  _resetShadow: function() {\r\n    var ctx = this.canvas.contextTop;\r\n\r\n    ctx.shadowColor = '';\r\n    ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\r\n  },\r\n\r\n  /**\r\n   * Check is pointer is outside canvas boundaries\r\n   * @param {Object} pointer\r\n   * @private\r\n  */\r\n  _isOutSideCanvas: function(pointer) {\r\n    return pointer.x < 0 || pointer.x > this.canvas.getWidth() || pointer.y < 0 || pointer.y > this.canvas.getHeight();\r\n  }\r\n});\r\n\r\n\r\n(function() {\r\n  /**\r\n   * PencilBrush class\r\n   * @class fabric.PencilBrush\r\n   * @extends fabric.BaseBrush\r\n   */\r\n  fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\r\n\r\n    /**\r\n     * Discard points that are less than `decimate` pixel distant from each other\r\n     * @type Number\r\n     * @default 0.4\r\n     */\r\n    decimate: 0.4,\r\n\r\n    /**\r\n     * Draws a straight line between last recorded point to current pointer\r\n     * Used for `shift` functionality\r\n     *\r\n     * @type boolean\r\n     * @default false\r\n     */\r\n    drawStraightLine: false,\r\n\r\n    /**\r\n     * The event modifier key that makes the brush draw a straight line.\r\n     * If `null` or 'none' or any other string that is not a modifier key the feature is disabled.\r\n     * @type {'altKey' | 'shiftKey' | 'ctrlKey' | 'none' | undefined | null}\r\n     */\r\n    straightLineKey: 'shiftKey',\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {fabric.Canvas} canvas\r\n     * @return {fabric.PencilBrush} Instance of a pencil brush\r\n     */\r\n    initialize: function(canvas) {\r\n      this.canvas = canvas;\r\n      this._points = [];\r\n    },\r\n\r\n    needsFullRender: function () {\r\n      return this.callSuper('needsFullRender') || this._hasStraightLine;\r\n    },\r\n\r\n    /**\r\n     * Invoked inside on mouse down and mouse move\r\n     * @param {Object} pointer\r\n     */\r\n    _drawSegment: function (ctx, p1, p2) {\r\n      var midPoint = p1.midPointFrom(p2);\r\n      ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\r\n      return midPoint;\r\n    },\r\n\r\n    /**\r\n     * Invoked on mouse down\r\n     * @param {Object} pointer\r\n     */\r\n    onMouseDown: function(pointer, options) {\r\n      if (!this.canvas._isMainEvent(options.e)) {\r\n        return;\r\n      }\r\n      this.drawStraightLine = options.e[this.straightLineKey];\r\n      this._prepareForDrawing(pointer);\r\n      // capture coordinates immediately\r\n      // this allows to draw dots (when movement never occurs)\r\n      this._captureDrawingPath(pointer);\r\n      this._render();\r\n    },\r\n\r\n    /**\r\n     * Invoked on mouse move\r\n     * @param {Object} pointer\r\n     */\r\n    onMouseMove: function(pointer, options) {\r\n      if (!this.canvas._isMainEvent(options.e)) {\r\n        return;\r\n      }\r\n      this.drawStraightLine = options.e[this.straightLineKey];\r\n      if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\r\n        return;\r\n      }\r\n      if (this._captureDrawingPath(pointer) && this._points.length > 1) {\r\n        if (this.needsFullRender()) {\r\n          // redraw curve\r\n          // clear top canvas\r\n          this.canvas.clearContext(this.canvas.contextTop);\r\n          this._render();\r\n        }\r\n        else {\r\n          var points = this._points, length = points.length, ctx = this.canvas.contextTop;\r\n          // draw the curve update\r\n          this._saveAndTransform(ctx);\r\n          if (this.oldEnd) {\r\n            ctx.beginPath();\r\n            ctx.moveTo(this.oldEnd.x, this.oldEnd.y);\r\n          }\r\n          this.oldEnd = this._drawSegment(ctx, points[length - 2], points[length - 1], true);\r\n          ctx.stroke();\r\n          ctx.restore();\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Invoked on mouse up\r\n     */\r\n    onMouseUp: function(options) {\r\n      if (!this.canvas._isMainEvent(options.e)) {\r\n        return true;\r\n      }\r\n      this.drawStraightLine = false;\r\n      this.oldEnd = undefined;\r\n      this._finalizeAndAddPath();\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} pointer Actual mouse position related to the canvas.\r\n     */\r\n    _prepareForDrawing: function(pointer) {\r\n\r\n      var p = new fabric.Point(pointer.x, pointer.y);\r\n\r\n      this._reset();\r\n      this._addPoint(p);\r\n      this.canvas.contextTop.moveTo(p.x, p.y);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {fabric.Point} point Point to be added to points array\r\n     */\r\n    _addPoint: function(point) {\r\n      if (this._points.length > 1 && point.eq(this._points[this._points.length - 1])) {\r\n        return false;\r\n      }\r\n      if (this.drawStraightLine && this._points.length > 1) {\r\n        this._hasStraightLine = true;\r\n        this._points.pop();\r\n      }\r\n      this._points.push(point);\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * Clear points array and set contextTop canvas style.\r\n     * @private\r\n     */\r\n    _reset: function() {\r\n      this._points = [];\r\n      this._setBrushStyles(this.canvas.contextTop);\r\n      this._setShadow();\r\n      this._hasStraightLine = false;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} pointer Actual mouse position related to the canvas.\r\n     */\r\n    _captureDrawingPath: function(pointer) {\r\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y);\r\n      return this._addPoint(pointerPoint);\r\n    },\r\n\r\n    /**\r\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} [ctx]\r\n     */\r\n    _render: function(ctx) {\r\n      var i, len,\r\n          p1 = this._points[0],\r\n          p2 = this._points[1];\r\n      ctx = ctx || this.canvas.contextTop;\r\n      this._saveAndTransform(ctx);\r\n      ctx.beginPath();\r\n      //if we only have 2 points in the path and they are the same\r\n      //it means that the user only clicked the canvas without moving the mouse\r\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\r\n      //that's why we set them apart a bit\r\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\r\n        var width = this.width / 1000;\r\n        p1 = new fabric.Point(p1.x, p1.y);\r\n        p2 = new fabric.Point(p2.x, p2.y);\r\n        p1.x -= width;\r\n        p2.x += width;\r\n      }\r\n      ctx.moveTo(p1.x, p1.y);\r\n\r\n      for (i = 1, len = this._points.length; i < len; i++) {\r\n        // we pick the point between pi + 1 & pi + 2 as the\r\n        // end point and p1 as our control point.\r\n        this._drawSegment(ctx, p1, p2);\r\n        p1 = this._points[i];\r\n        p2 = this._points[i + 1];\r\n      }\r\n      // Draw last line as a straight line while\r\n      // we wait for the next point to be able to calculate\r\n      // the bezier control point\r\n      ctx.lineTo(p1.x, p1.y);\r\n      ctx.stroke();\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * Converts points to SVG path\r\n     * @param {Array} points Array of points\r\n     * @return {(string|number)[][]} SVG path commands\r\n     */\r\n    convertPointsToSVGPath: function (points) {\r\n      var correction = this.width / 1000;\r\n      return fabric.util.getSmoothPathFromPoints(points, correction);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {(string|number)[][]} pathData SVG path commands\r\n     * @returns {boolean}\r\n     */\r\n    _isEmptySVGPath: function (pathData) {\r\n      var pathString = fabric.util.joinPath(pathData);\r\n      return pathString === 'M 0 0 Q 0 0 0 0 L 0 0';\r\n    },\r\n\r\n    /**\r\n     * Creates fabric.Path object to add on canvas\r\n     * @param {(string|number)[][]} pathData Path data\r\n     * @return {fabric.Path} Path to add on canvas\r\n     */\r\n    createPath: function(pathData) {\r\n      var path = new fabric.Path(pathData, {\r\n        fill: null,\r\n        stroke: this.color,\r\n        strokeWidth: this.width,\r\n        strokeLineCap: this.strokeLineCap,\r\n        strokeMiterLimit: this.strokeMiterLimit,\r\n        strokeLineJoin: this.strokeLineJoin,\r\n        strokeDashArray: this.strokeDashArray,\r\n      });\r\n      if (this.shadow) {\r\n        this.shadow.affectStroke = true;\r\n        path.shadow = new fabric.Shadow(this.shadow);\r\n      }\r\n\r\n      return path;\r\n    },\r\n\r\n    /**\r\n     * Decimate points array with the decimate value\r\n     */\r\n    decimatePoints: function(points, distance) {\r\n      if (points.length <= 2) {\r\n        return points;\r\n      }\r\n      var zoom = this.canvas.getZoom(), adjustedDistance = Math.pow(distance / zoom, 2),\r\n          i, l = points.length - 1, lastPoint = points[0], newPoints = [lastPoint],\r\n          cDistance;\r\n      for (i = 1; i < l - 1; i++) {\r\n        cDistance = Math.pow(lastPoint.x - points[i].x, 2) + Math.pow(lastPoint.y - points[i].y, 2);\r\n        if (cDistance >= adjustedDistance) {\r\n          lastPoint = points[i];\r\n          newPoints.push(lastPoint);\r\n        }\r\n      }\r\n      /**\r\n       * Add the last point from the original line to the end of the array.\r\n       * This ensures decimate doesn't delete the last point on the line, and ensures the line is > 1 point.\r\n       */\r\n      newPoints.push(points[l]);\r\n      return newPoints;\r\n    },\r\n\r\n    /**\r\n     * On mouseup after drawing the path on contextTop canvas\r\n     * we use the points captured to create an new fabric path object\r\n     * and add it to the fabric canvas.\r\n     */\r\n    _finalizeAndAddPath: function() {\r\n      var ctx = this.canvas.contextTop;\r\n      ctx.closePath();\r\n      if (this.decimate) {\r\n        this._points = this.decimatePoints(this._points, this.decimate);\r\n      }\r\n      var pathData = this.convertPointsToSVGPath(this._points);\r\n      if (this._isEmptySVGPath(pathData)) {\r\n        // do not create 0 width/height paths, as they are\r\n        // rendered inconsistently across browsers\r\n        // Firefox 4, for example, renders a dot,\r\n        // whereas Chrome 10 renders nothing\r\n        this.canvas.requestRenderAll();\r\n        return;\r\n      }\r\n\r\n      var path = this.createPath(pathData);\r\n      this.canvas.clearContext(this.canvas.contextTop);\r\n      this.canvas.fire('before:path:created', { path: path });\r\n      this.canvas.add(path);\r\n      this.canvas.requestRenderAll();\r\n      path.setCoords();\r\n      this._resetShadow();\r\n\r\n\r\n      // fire event 'path' created\r\n      this.canvas.fire('path:created', { path: path });\r\n    }\r\n  });\r\n})();\r\n\r\n\r\n/**\r\n * CircleBrush class\r\n * @class fabric.CircleBrush\r\n */\r\nfabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {\r\n\r\n  /**\r\n   * Width of a brush\r\n   * @type Number\r\n   * @default\r\n   */\r\n  width: 10,\r\n\r\n  /**\r\n   * Constructor\r\n   * @param {fabric.Canvas} canvas\r\n   * @return {fabric.CircleBrush} Instance of a circle brush\r\n   */\r\n  initialize: function(canvas) {\r\n    this.canvas = canvas;\r\n    this.points = [];\r\n  },\r\n\r\n  /**\r\n   * Invoked inside on mouse down and mouse move\r\n   * @param {Object} pointer\r\n   */\r\n  drawDot: function(pointer) {\r\n    var point = this.addPoint(pointer),\r\n        ctx = this.canvas.contextTop;\r\n    this._saveAndTransform(ctx);\r\n    this.dot(ctx, point);\r\n    ctx.restore();\r\n  },\r\n\r\n  dot: function(ctx, point) {\r\n    ctx.fillStyle = point.fill;\r\n    ctx.beginPath();\r\n    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  },\r\n\r\n  /**\r\n   * Invoked on mouse down\r\n   */\r\n  onMouseDown: function(pointer) {\r\n    this.points.length = 0;\r\n    this.canvas.clearContext(this.canvas.contextTop);\r\n    this._setShadow();\r\n    this.drawDot(pointer);\r\n  },\r\n\r\n  /**\r\n   * Render the full state of the brush\r\n   * @private\r\n   */\r\n  _render: function() {\r\n    var ctx  = this.canvas.contextTop, i, len,\r\n        points = this.points;\r\n    this._saveAndTransform(ctx);\r\n    for (i = 0, len = points.length; i < len; i++) {\r\n      this.dot(ctx, points[i]);\r\n    }\r\n    ctx.restore();\r\n  },\r\n\r\n  /**\r\n   * Invoked on mouse move\r\n   * @param {Object} pointer\r\n   */\r\n  onMouseMove: function(pointer) {\r\n    if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\r\n      return;\r\n    }\r\n    if (this.needsFullRender()) {\r\n      this.canvas.clearContext(this.canvas.contextTop);\r\n      this.addPoint(pointer);\r\n      this._render();\r\n    }\r\n    else {\r\n      this.drawDot(pointer);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Invoked on mouse up\r\n   */\r\n  onMouseUp: function() {\r\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove, i, len;\r\n    this.canvas.renderOnAddRemove = false;\r\n\r\n    var circles = [];\r\n\r\n    for (i = 0, len = this.points.length; i < len; i++) {\r\n      var point = this.points[i],\r\n          circle = new fabric.Circle({\r\n            radius: point.radius,\r\n            left: point.x,\r\n            top: point.y,\r\n            originX: 'center',\r\n            originY: 'center',\r\n            fill: point.fill\r\n          });\r\n\r\n      this.shadow && (circle.shadow = new fabric.Shadow(this.shadow));\r\n\r\n      circles.push(circle);\r\n    }\r\n    var group = new fabric.Group(circles);\r\n    group.canvas = this.canvas;\r\n\r\n    this.canvas.fire('before:path:created', { path: group });\r\n    this.canvas.add(group);\r\n    this.canvas.fire('path:created', { path: group });\r\n\r\n    this.canvas.clearContext(this.canvas.contextTop);\r\n    this._resetShadow();\r\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\r\n    this.canvas.requestRenderAll();\r\n  },\r\n\r\n  /**\r\n   * @param {Object} pointer\r\n   * @return {fabric.Point} Just added pointer point\r\n   */\r\n  addPoint: function(pointer) {\r\n    var pointerPoint = new fabric.Point(pointer.x, pointer.y),\r\n\r\n        circleRadius = fabric.util.getRandomInt(\r\n          Math.max(0, this.width - 20), this.width + 20) / 2,\r\n\r\n        circleColor = new fabric.Color(this.color)\r\n          .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\r\n          .toRgba();\r\n\r\n    pointerPoint.radius = circleRadius;\r\n    pointerPoint.fill = circleColor;\r\n\r\n    this.points.push(pointerPoint);\r\n\r\n    return pointerPoint;\r\n  }\r\n});\r\n\r\n\r\n/**\r\n * SprayBrush class\r\n * @class fabric.SprayBrush\r\n */\r\nfabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {\r\n\r\n  /**\r\n   * Width of a spray\r\n   * @type Number\r\n   * @default\r\n   */\r\n  width:              10,\r\n\r\n  /**\r\n   * Density of a spray (number of dots per chunk)\r\n   * @type Number\r\n   * @default\r\n   */\r\n  density:            20,\r\n\r\n  /**\r\n   * Width of spray dots\r\n   * @type Number\r\n   * @default\r\n   */\r\n  dotWidth:           1,\r\n\r\n  /**\r\n   * Width variance of spray dots\r\n   * @type Number\r\n   * @default\r\n   */\r\n  dotWidthVariance:   1,\r\n\r\n  /**\r\n   * Whether opacity of a dot should be random\r\n   * @type Boolean\r\n   * @default\r\n   */\r\n  randomOpacity:        false,\r\n\r\n  /**\r\n   * Whether overlapping dots (rectangles) should be removed (for performance reasons)\r\n   * @type Boolean\r\n   * @default\r\n   */\r\n  optimizeOverlapping:  true,\r\n\r\n  /**\r\n   * Constructor\r\n   * @param {fabric.Canvas} canvas\r\n   * @return {fabric.SprayBrush} Instance of a spray brush\r\n   */\r\n  initialize: function(canvas) {\r\n    this.canvas = canvas;\r\n    this.sprayChunks = [];\r\n  },\r\n\r\n  /**\r\n   * Invoked on mouse down\r\n   * @param {Object} pointer\r\n   */\r\n  onMouseDown: function(pointer) {\r\n    this.sprayChunks.length = 0;\r\n    this.canvas.clearContext(this.canvas.contextTop);\r\n    this._setShadow();\r\n\r\n    this.addSprayChunk(pointer);\r\n    this.render(this.sprayChunkPoints);\r\n  },\r\n\r\n  /**\r\n   * Invoked on mouse move\r\n   * @param {Object} pointer\r\n   */\r\n  onMouseMove: function(pointer) {\r\n    if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\r\n      return;\r\n    }\r\n    this.addSprayChunk(pointer);\r\n    this.render(this.sprayChunkPoints);\r\n  },\r\n\r\n  /**\r\n   * Invoked on mouse up\r\n   */\r\n  onMouseUp: function() {\r\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\r\n    this.canvas.renderOnAddRemove = false;\r\n\r\n    var rects = [];\r\n\r\n    for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\r\n      var sprayChunk = this.sprayChunks[i];\r\n\r\n      for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\r\n\r\n        var rect = new fabric.Rect({\r\n          width: sprayChunk[j].width,\r\n          height: sprayChunk[j].width,\r\n          left: sprayChunk[j].x + 1,\r\n          top: sprayChunk[j].y + 1,\r\n          originX: 'center',\r\n          originY: 'center',\r\n          fill: this.color\r\n        });\r\n        rects.push(rect);\r\n      }\r\n    }\r\n\r\n    if (this.optimizeOverlapping) {\r\n      rects = this._getOptimizedRects(rects);\r\n    }\r\n\r\n    var group = new fabric.Group(rects);\r\n    this.shadow && group.set('shadow', new fabric.Shadow(this.shadow));\r\n    this.canvas.fire('before:path:created', { path: group });\r\n    this.canvas.add(group);\r\n    this.canvas.fire('path:created', { path: group });\r\n\r\n    this.canvas.clearContext(this.canvas.contextTop);\r\n    this._resetShadow();\r\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\r\n    this.canvas.requestRenderAll();\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {Array} rects\r\n   */\r\n  _getOptimizedRects: function(rects) {\r\n\r\n    // avoid creating duplicate rects at the same coordinates\r\n    var uniqueRects = { }, key, i, len;\r\n\r\n    for (i = 0, len = rects.length; i < len; i++) {\r\n      key = rects[i].left + '' + rects[i].top;\r\n      if (!uniqueRects[key]) {\r\n        uniqueRects[key] = rects[i];\r\n      }\r\n    }\r\n    var uniqueRectsArray = [];\r\n    for (key in uniqueRects) {\r\n      uniqueRectsArray.push(uniqueRects[key]);\r\n    }\r\n\r\n    return uniqueRectsArray;\r\n  },\r\n\r\n  /**\r\n   * Render new chunk of spray brush\r\n   */\r\n  render: function(sprayChunk) {\r\n    var ctx = this.canvas.contextTop, i, len;\r\n    ctx.fillStyle = this.color;\r\n\r\n    this._saveAndTransform(ctx);\r\n\r\n    for (i = 0, len = sprayChunk.length; i < len; i++) {\r\n      var point = sprayChunk[i];\r\n      if (typeof point.opacity !== 'undefined') {\r\n        ctx.globalAlpha = point.opacity;\r\n      }\r\n      ctx.fillRect(point.x, point.y, point.width, point.width);\r\n    }\r\n    ctx.restore();\r\n  },\r\n\r\n  /**\r\n   * Render all spray chunks\r\n   */\r\n  _render: function() {\r\n    var ctx = this.canvas.contextTop, i, ilen;\r\n    ctx.fillStyle = this.color;\r\n\r\n    this._saveAndTransform(ctx);\r\n\r\n    for (i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\r\n      this.render(this.sprayChunks[i]);\r\n    }\r\n    ctx.restore();\r\n  },\r\n\r\n  /**\r\n   * @param {Object} pointer\r\n   */\r\n  addSprayChunk: function(pointer) {\r\n    this.sprayChunkPoints = [];\r\n\r\n    var x, y, width, radius = this.width / 2, i;\r\n\r\n    for (i = 0; i < this.density; i++) {\r\n\r\n      x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\r\n      y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\r\n\r\n      if (this.dotWidthVariance) {\r\n        width = fabric.util.getRandomInt(\r\n          // bottom clamp width to 1\r\n          Math.max(1, this.dotWidth - this.dotWidthVariance),\r\n          this.dotWidth + this.dotWidthVariance);\r\n      }\r\n      else {\r\n        width = this.dotWidth;\r\n      }\r\n\r\n      var point = new fabric.Point(x, y);\r\n      point.width = width;\r\n\r\n      if (this.randomOpacity) {\r\n        point.opacity = fabric.util.getRandomInt(0, 100) / 100;\r\n      }\r\n\r\n      this.sprayChunkPoints.push(point);\r\n    }\r\n\r\n    this.sprayChunks.push(this.sprayChunkPoints);\r\n  }\r\n});\r\n\r\n\r\n/**\r\n * PatternBrush class\r\n * @class fabric.PatternBrush\r\n * @extends fabric.BaseBrush\r\n */\r\nfabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {\r\n\r\n  getPatternSrc: function() {\r\n\r\n    var dotWidth = 20,\r\n        dotDistance = 5,\r\n        patternCanvas = fabric.util.createCanvasElement(),\r\n        patternCtx = patternCanvas.getContext('2d');\r\n\r\n    patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\r\n\r\n    patternCtx.fillStyle = this.color;\r\n    patternCtx.beginPath();\r\n    patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);\r\n    patternCtx.closePath();\r\n    patternCtx.fill();\r\n\r\n    return patternCanvas;\r\n  },\r\n\r\n  getPatternSrcFunction: function() {\r\n    return String(this.getPatternSrc).replace('this.color', '\"' + this.color + '\"');\r\n  },\r\n\r\n  /**\r\n   * Creates \"pattern\" instance property\r\n   * @param {CanvasRenderingContext2D} ctx\r\n   */\r\n  getPattern: function(ctx) {\r\n    return ctx.createPattern(this.source || this.getPatternSrc(), 'repeat');\r\n  },\r\n\r\n  /**\r\n   * Sets brush styles\r\n   * @param {CanvasRenderingContext2D} ctx\r\n   */\r\n  _setBrushStyles: function(ctx) {\r\n    this.callSuper('_setBrushStyles', ctx);\r\n    ctx.strokeStyle = this.getPattern(ctx);\r\n  },\r\n\r\n  /**\r\n   * Creates path\r\n   */\r\n  createPath: function(pathData) {\r\n    var path = this.callSuper('createPath', pathData),\r\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\r\n\r\n    path.stroke = new fabric.Pattern({\r\n      source: this.source || this.getPatternSrcFunction(),\r\n      offsetX: -topLeft.x,\r\n      offsetY: -topLeft.y\r\n    });\r\n    return path;\r\n  }\r\n});\r\n\r\n\r\n(function() {\r\n\r\n  var getPointer = fabric.util.getPointer,\r\n      degreesToRadians = fabric.util.degreesToRadians,\r\n      isTouchEvent = fabric.util.isTouchEvent;\r\n\r\n  /**\r\n   * Canvas class\r\n   * @class fabric.Canvas\r\n   * @extends fabric.StaticCanvas\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\r\n   * @see {@link fabric.Canvas#initialize} for constructor definition\r\n   *\r\n   * @fires object:modified at the end of a transform or any change when statefull is true\r\n   * @fires object:rotating while an object is being rotated from the control\r\n   * @fires object:scaling while an object is being scaled by controls\r\n   * @fires object:moving while an object is being dragged\r\n   * @fires object:skewing while an object is being skewed from the controls\r\n   *\r\n   * @fires before:transform before a transform is is started\r\n   * @fires before:selection:cleared\r\n   * @fires selection:cleared\r\n   * @fires selection:updated\r\n   * @fires selection:created\r\n   *\r\n   * @fires path:created after a drawing operation ends and the path is added\r\n   * @fires mouse:down\r\n   * @fires mouse:move\r\n   * @fires mouse:up\r\n   * @fires mouse:down:before  on mouse down, before the inner fabric logic runs\r\n   * @fires mouse:move:before on mouse move, before the inner fabric logic runs\r\n   * @fires mouse:up:before on mouse up, before the inner fabric logic runs\r\n   * @fires mouse:over\r\n   * @fires mouse:out\r\n   * @fires mouse:dblclick whenever a native dbl click event fires on the canvas.\r\n   *\r\n   * @fires dragover\r\n   * @fires dragenter\r\n   * @fires dragleave\r\n   * @fires drop:before before drop event. same native event. This is added to handle edge cases\r\n   * @fires drop\r\n   * @fires after:render at the end of the render process, receives the context in the callback\r\n   * @fires before:render at start the render process, receives the context in the callback\r\n   *\r\n   */\r\n  fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\r\n     * @param {Object} [options] Options object\r\n     * @return {Object} thisArg\r\n     */\r\n    initialize: function(el, options) {\r\n      options || (options = { });\r\n      this.renderAndResetBound = this.renderAndReset.bind(this);\r\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\r\n      this._initStatic(el, options);\r\n      this._initInteractive();\r\n      this._createCacheCanvas();\r\n    },\r\n\r\n    /**\r\n     * When true, objects can be transformed by one side (unproportionally)\r\n     * when dragged on the corners that normally would not do that.\r\n     * @type Boolean\r\n     * @default\r\n     * @since fabric 4.0 // changed name and default value\r\n     */\r\n    uniformScaling:      true,\r\n\r\n    /**\r\n     * Indicates which key switches uniform scaling.\r\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\r\n     * If `null` or 'none' or any other string that is not a modifier key\r\n     * feature is disabled.\r\n     * totally wrong named. this sounds like `uniform scaling`\r\n     * if Canvas.uniformScaling is true, pressing this will set it to false\r\n     * and viceversa.\r\n     * @since 1.6.2\r\n     * @type String\r\n     * @default\r\n     */\r\n    uniScaleKey:           'shiftKey',\r\n\r\n    /**\r\n     * When true, objects use center point as the origin of scale transformation.\r\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\r\n     * @since 1.3.4\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    centeredScaling:        false,\r\n\r\n    /**\r\n     * When true, objects use center point as the origin of rotate transformation.\r\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\r\n     * @since 1.3.4\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    centeredRotation:       false,\r\n\r\n    /**\r\n     * Indicates which key enable centered Transform\r\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\r\n     * If `null` or 'none' or any other string that is not a modifier key\r\n     * feature is disabled feature disabled.\r\n     * @since 1.6.2\r\n     * @type String\r\n     * @default\r\n     */\r\n    centeredKey:           'altKey',\r\n\r\n    /**\r\n     * Indicates which key enable alternate action on corner\r\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\r\n     * If `null` or 'none' or any other string that is not a modifier key\r\n     * feature is disabled feature disabled.\r\n     * @since 1.6.2\r\n     * @type String\r\n     * @default\r\n     */\r\n    altActionKey:           'shiftKey',\r\n\r\n    /**\r\n     * Indicates that canvas is interactive. This property should not be changed.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    interactive:            true,\r\n\r\n    /**\r\n     * Indicates whether group selection should be enabled\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    selection:              true,\r\n\r\n    /**\r\n     * Indicates which key or keys enable multiple click selection\r\n     * Pass value as a string or array of strings\r\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\r\n     * If `null` or empty or containing any other string that is not a modifier key\r\n     * feature is disabled.\r\n     * @since 1.6.2\r\n     * @type String|Array\r\n     * @default\r\n     */\r\n    selectionKey:           'shiftKey',\r\n\r\n    /**\r\n     * Indicates which key enable alternative selection\r\n     * in case of target overlapping with active object\r\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\r\n     * For a series of reason that come from the general expectations on how\r\n     * things should work, this feature works only for preserveObjectStacking true.\r\n     * If `null` or 'none' or any other string that is not a modifier key\r\n     * feature is disabled.\r\n     * @since 1.6.5\r\n     * @type null|String\r\n     * @default\r\n     */\r\n    altSelectionKey:           null,\r\n\r\n    /**\r\n     * Color of selection\r\n     * @type String\r\n     * @default\r\n     */\r\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\r\n\r\n    /**\r\n     * Default dash array pattern\r\n     * If not empty the selection border is dashed\r\n     * @type Array\r\n     */\r\n    selectionDashArray:     [],\r\n\r\n    /**\r\n     * Color of the border of selection (usually slightly darker than color of selection itself)\r\n     * @type String\r\n     * @default\r\n     */\r\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\r\n\r\n    /**\r\n     * Width of a line used in object/group selection\r\n     * @type Number\r\n     * @default\r\n     */\r\n    selectionLineWidth:     1,\r\n\r\n    /**\r\n     * Select only shapes that are fully contained in the dragged selection rectangle.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    selectionFullyContained: false,\r\n\r\n    /**\r\n     * Default cursor value used when hovering over an object on canvas\r\n     * @type String\r\n     * @default\r\n     */\r\n    hoverCursor:            'move',\r\n\r\n    /**\r\n     * Default cursor value used when moving an object on canvas\r\n     * @type String\r\n     * @default\r\n     */\r\n    moveCursor:             'move',\r\n\r\n    /**\r\n     * Default cursor value used for the entire canvas\r\n     * @type String\r\n     * @default\r\n     */\r\n    defaultCursor:          'default',\r\n\r\n    /**\r\n     * Cursor value used during free drawing\r\n     * @type String\r\n     * @default\r\n     */\r\n    freeDrawingCursor:      'crosshair',\r\n\r\n    /**\r\n     * Cursor value used for disabled elements ( corners with disabled action )\r\n     * @type String\r\n     * @since 2.0.0\r\n     * @default\r\n     */\r\n    notAllowedCursor:         'not-allowed',\r\n\r\n    /**\r\n     * Default element class that's given to wrapper (div) element of canvas\r\n     * @type String\r\n     * @default\r\n     */\r\n    containerClass:         'canvas-container',\r\n\r\n    /**\r\n     * When true, object detection happens on per-pixel basis rather than on per-bounding-box\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    perPixelTargetFind:     false,\r\n\r\n    /**\r\n     * Number of pixels around target pixel to tolerate (consider active) during object detection\r\n     * @type Number\r\n     * @default\r\n     */\r\n    targetFindTolerance:    0,\r\n\r\n    /**\r\n     * When true, target detection is skipped. Target detection will return always undefined.\r\n     * click selection won't work anymore, events will fire with no targets.\r\n     * if something is selected before setting it to true, it will be deselected at the first click.\r\n     * area selection will still work. check the `selection` property too.\r\n     * if you deactivate both, you should look into staticCanvas.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    skipTargetFind:         false,\r\n\r\n    /**\r\n     * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\r\n     * After mousedown, mousemove creates a shape,\r\n     * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\r\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    isDrawingMode:          false,\r\n\r\n    /**\r\n     * Indicates whether objects should remain in current stack position when selected.\r\n     * When false objects are brought to top and rendered as part of the selection group\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    preserveObjectStacking: false,\r\n\r\n    /**\r\n     * Indicates the angle that an object will lock to while rotating.\r\n     * @type Number\r\n     * @since 1.6.7\r\n     * @default\r\n     */\r\n    snapAngle: 0,\r\n\r\n    /**\r\n     * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\r\n     * When `null`, the snapThreshold will default to the snapAngle.\r\n     * @type null|Number\r\n     * @since 1.6.7\r\n     * @default\r\n     */\r\n    snapThreshold: null,\r\n\r\n    /**\r\n     * Indicates if the right click on canvas can output the context menu or not\r\n     * @type Boolean\r\n     * @since 1.6.5\r\n     * @default\r\n     */\r\n    stopContextMenu: false,\r\n\r\n    /**\r\n     * Indicates if the canvas can fire right click events\r\n     * @type Boolean\r\n     * @since 1.6.5\r\n     * @default\r\n     */\r\n    fireRightClick: false,\r\n\r\n    /**\r\n     * Indicates if the canvas can fire middle click events\r\n     * @type Boolean\r\n     * @since 1.7.8\r\n     * @default\r\n     */\r\n    fireMiddleClick: false,\r\n\r\n    /**\r\n     * Keep track of the subTargets for Mouse Events\r\n     * @type fabric.Object[]\r\n     */\r\n    targets: [],\r\n\r\n    /**\r\n     * When the option is enabled, PointerEvent is used instead of MouseEvent.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    enablePointerEvents: false,\r\n\r\n    /**\r\n     * Keep track of the hovered target\r\n     * @type fabric.Object\r\n     * @private\r\n     */\r\n    _hoveredTarget: null,\r\n\r\n    /**\r\n     * hold the list of nested targets hovered\r\n     * @type fabric.Object[]\r\n     * @private\r\n     */\r\n    _hoveredTargets: [],\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _initInteractive: function() {\r\n      this._currentTransform = null;\r\n      this._groupSelector = null;\r\n      this._initWrapperElement();\r\n      this._createUpperCanvas();\r\n      this._initEventListeners();\r\n\r\n      this._initRetinaScaling();\r\n\r\n      this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\r\n\r\n      this.calcOffset();\r\n    },\r\n\r\n    /**\r\n     * Divides objects in two groups, one to render immediately\r\n     * and one to render as activeGroup.\r\n     * @return {Array} objects to render immediately and pushes the other in the activeGroup.\r\n     */\r\n    _chooseObjectsToRender: function() {\r\n      var activeObjects = this.getActiveObjects(),\r\n          object, objsToRender, activeGroupObjects;\r\n\r\n      if (activeObjects.length > 0 && !this.preserveObjectStacking) {\r\n        objsToRender = [];\r\n        activeGroupObjects = [];\r\n        for (var i = 0, length = this._objects.length; i < length; i++) {\r\n          object = this._objects[i];\r\n          if (activeObjects.indexOf(object) === -1 ) {\r\n            objsToRender.push(object);\r\n          }\r\n          else {\r\n            activeGroupObjects.push(object);\r\n          }\r\n        }\r\n        if (activeObjects.length > 1) {\r\n          this._activeObject._objects = activeGroupObjects;\r\n        }\r\n        objsToRender.push.apply(objsToRender, activeGroupObjects);\r\n      }\r\n      else {\r\n        objsToRender = this._objects;\r\n      }\r\n      return objsToRender;\r\n    },\r\n\r\n    /**\r\n     * Renders both the top canvas and the secondary container canvas.\r\n     * @return {fabric.Canvas} instance\r\n     * @chainable\r\n     */\r\n    renderAll: function () {\r\n      if (this.contextTopDirty && !this._groupSelector && !this.isDrawingMode) {\r\n        this.clearContext(this.contextTop);\r\n        this.contextTopDirty = false;\r\n      }\r\n      if (this.hasLostContext) {\r\n        this.renderTopLayer(this.contextTop);\r\n        this.hasLostContext = false;\r\n      }\r\n      var canvasToDrawOn = this.contextContainer;\r\n      this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\r\n      return this;\r\n    },\r\n\r\n    renderTopLayer: function(ctx) {\r\n      ctx.save();\r\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\r\n        this.freeDrawingBrush && this.freeDrawingBrush._render();\r\n        this.contextTopDirty = true;\r\n      }\r\n      // we render the top context - last object\r\n      if (this.selection && this._groupSelector) {\r\n        this._drawSelection(ctx);\r\n        this.contextTopDirty = true;\r\n      }\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * Method to render only the top canvas.\r\n     * Also used to render the group selection box.\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    renderTop: function () {\r\n      var ctx = this.contextTop;\r\n      this.clearContext(ctx);\r\n      this.renderTopLayer(ctx);\r\n      this.fire('after:render');\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _normalizePointer: function (object, pointer) {\r\n      var m = object.calcTransformMatrix(),\r\n          invertedM = fabric.util.invertTransform(m),\r\n          vptPointer = this.restorePointerVpt(pointer);\r\n      return fabric.util.transformPoint(vptPointer, invertedM);\r\n    },\r\n\r\n    /**\r\n     * Returns true if object is transparent at a certain location\r\n     * @param {fabric.Object} target Object to check\r\n     * @param {Number} x Left coordinate\r\n     * @param {Number} y Top coordinate\r\n     * @return {Boolean}\r\n     */\r\n    isTargetTransparent: function (target, x, y) {\r\n      // in case the target is the activeObject, we cannot execute this optimization\r\n      // because we need to draw controls too.\r\n      if (target.shouldCache() && target._cacheCanvas && target !== this._activeObject) {\r\n        var normalizedPointer = this._normalizePointer(target, {x: x, y: y}),\r\n            targetRelativeX = Math.max(target.cacheTranslationX + (normalizedPointer.x * target.zoomX), 0),\r\n            targetRelativeY = Math.max(target.cacheTranslationY + (normalizedPointer.y * target.zoomY), 0);\r\n\r\n        var isTransparent = fabric.util.isTransparent(\r\n          target._cacheContext, Math.round(targetRelativeX), Math.round(targetRelativeY), this.targetFindTolerance);\r\n\r\n        return isTransparent;\r\n      }\r\n\r\n      var ctx = this.contextCache,\r\n          originalColor = target.selectionBackgroundColor, v = this.viewportTransform;\r\n\r\n      target.selectionBackgroundColor = '';\r\n\r\n      this.clearContext(ctx);\r\n\r\n      ctx.save();\r\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\r\n      target.render(ctx);\r\n      ctx.restore();\r\n\r\n      target.selectionBackgroundColor = originalColor;\r\n\r\n      var isTransparent = fabric.util.isTransparent(\r\n        ctx, x, y, this.targetFindTolerance);\r\n\r\n      return isTransparent;\r\n    },\r\n\r\n    /**\r\n     * takes an event and determines if selection key has been pressed\r\n     * @private\r\n     * @param {Event} e Event object\r\n     */\r\n    _isSelectionKeyPressed: function(e) {\r\n      var selectionKeyPressed = false;\r\n\r\n      if (Array.isArray(this.selectionKey)) {\r\n        selectionKeyPressed = !!this.selectionKey.find(function(key) { return e[key] === true; });\r\n      }\r\n      else {\r\n        selectionKeyPressed = e[this.selectionKey];\r\n      }\r\n\r\n      return selectionKeyPressed;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object\r\n     * @param {fabric.Object} target\r\n     */\r\n    _shouldClearSelection: function (e, target) {\r\n      var activeObjects = this.getActiveObjects(),\r\n          activeObject = this._activeObject;\r\n\r\n      return (\r\n        !target\r\n        ||\r\n        (target &&\r\n          activeObject &&\r\n          activeObjects.length > 1 &&\r\n          activeObjects.indexOf(target) === -1 &&\r\n          activeObject !== target &&\r\n          !this._isSelectionKeyPressed(e))\r\n        ||\r\n        (target && !target.evented)\r\n        ||\r\n        (target &&\r\n          !target.selectable &&\r\n          activeObject &&\r\n          activeObject !== target)\r\n      );\r\n    },\r\n\r\n    /**\r\n     * centeredScaling from object can't override centeredScaling from canvas.\r\n     * this should be fixed, since object setting should take precedence over canvas.\r\n     * also this should be something that will be migrated in the control properties.\r\n     * as ability to define the origin of the transformation that the control provide.\r\n     * @private\r\n     * @param {fabric.Object} target\r\n     * @param {String} action\r\n     * @param {Boolean} altKey\r\n     */\r\n    _shouldCenterTransform: function (target, action, altKey) {\r\n      if (!target) {\r\n        return;\r\n      }\r\n\r\n      var centerTransform;\r\n\r\n      if (action === 'scale' || action === 'scaleX' || action === 'scaleY' || action === 'resizing') {\r\n        centerTransform = this.centeredScaling || target.centeredScaling;\r\n      }\r\n      else if (action === 'rotate') {\r\n        centerTransform = this.centeredRotation || target.centeredRotation;\r\n      }\r\n\r\n      return centerTransform ? !altKey : altKey;\r\n    },\r\n\r\n    /**\r\n     * should disappear before release 4.0\r\n     * @private\r\n     */\r\n    _getOriginFromCorner: function(target, corner) {\r\n      var origin = {\r\n        x: target.originX,\r\n        y: target.originY\r\n      };\r\n\r\n      if (corner === 'ml' || corner === 'tl' || corner === 'bl') {\r\n        origin.x = 'right';\r\n      }\r\n      else if (corner === 'mr' || corner === 'tr' || corner === 'br') {\r\n        origin.x = 'left';\r\n      }\r\n\r\n      if (corner === 'tl' || corner === 'mt' || corner === 'tr') {\r\n        origin.y = 'bottom';\r\n      }\r\n      else if (corner === 'bl' || corner === 'mb' || corner === 'br') {\r\n        origin.y = 'top';\r\n      }\r\n      return origin;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Boolean} alreadySelected true if target is already selected\r\n     * @param {String} corner a string representing the corner ml, mr, tl ...\r\n     * @param {Event} e Event object\r\n     * @param {fabric.Object} [target] inserted back to help overriding. Unused\r\n     */\r\n    _getActionFromCorner: function(alreadySelected, corner, e, target) {\r\n      if (!corner || !alreadySelected) {\r\n        return 'drag';\r\n      }\r\n      var control = target.controls[corner];\r\n      return control.getActionName(e, control, target);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object\r\n     * @param {fabric.Object} target\r\n     */\r\n    _setupCurrentTransform: function (e, target, alreadySelected) {\r\n      if (!target) {\r\n        return;\r\n      }\r\n\r\n      var pointer = this.getPointer(e), corner = target.__corner,\r\n          control = target.controls[corner],\r\n          actionHandler = (alreadySelected && corner) ?\r\n            control.getActionHandler(e, target, control) : fabric.controlsUtils.dragHandler,\r\n          action = this._getActionFromCorner(alreadySelected, corner, e, target),\r\n          origin = this._getOriginFromCorner(target, corner),\r\n          altKey = e[this.centeredKey],\r\n          transform = {\r\n            target: target,\r\n            action: action,\r\n            actionHandler: actionHandler,\r\n            corner: corner,\r\n            scaleX: target.scaleX,\r\n            scaleY: target.scaleY,\r\n            skewX: target.skewX,\r\n            skewY: target.skewY,\r\n            // used by transation\r\n            offsetX: pointer.x - target.left,\r\n            offsetY: pointer.y - target.top,\r\n            originX: origin.x,\r\n            originY: origin.y,\r\n            ex: pointer.x,\r\n            ey: pointer.y,\r\n            lastX: pointer.x,\r\n            lastY: pointer.y,\r\n            // unsure they are useful anymore.\r\n            // left: target.left,\r\n            // top: target.top,\r\n            theta: degreesToRadians(target.angle),\r\n            // end of unsure\r\n            width: target.width * target.scaleX,\r\n            shiftKey: e.shiftKey,\r\n            altKey: altKey,\r\n            original: fabric.util.saveObjectTransform(target),\r\n          };\r\n\r\n      if (this._shouldCenterTransform(target, action, altKey)) {\r\n        transform.originX = 'center';\r\n        transform.originY = 'center';\r\n      }\r\n      transform.original.originX = origin.x;\r\n      transform.original.originY = origin.y;\r\n      this._currentTransform = transform;\r\n      this._beforeTransform(e);\r\n    },\r\n\r\n    /**\r\n     * Set the cursor type of the canvas element\r\n     * @param {String} value Cursor type of the canvas element.\r\n     * @see http://www.w3.org/TR/css3-ui/#cursor\r\n     */\r\n    setCursor: function (value) {\r\n      this.upperCanvasEl.style.cursor = value;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx to draw the selection on\r\n     */\r\n    _drawSelection: function (ctx) {\r\n      var selector = this._groupSelector,\r\n          viewportStart = new fabric.Point(selector.ex, selector.ey),\r\n          start = fabric.util.transformPoint(viewportStart, this.viewportTransform),\r\n          viewportExtent = new fabric.Point(selector.ex + selector.left, selector.ey + selector.top),\r\n          extent = fabric.util.transformPoint(viewportExtent, this.viewportTransform),\r\n          minX = Math.min(start.x, extent.x),\r\n          minY = Math.min(start.y, extent.y),\r\n          maxX = Math.max(start.x, extent.x),\r\n          maxY = Math.max(start.y, extent.y),\r\n          strokeOffset = this.selectionLineWidth / 2;\r\n\r\n      if (this.selectionColor) {\r\n        ctx.fillStyle = this.selectionColor;\r\n        ctx.fillRect(minX, minY, maxX - minX, maxY - minY);\r\n      }\r\n\r\n      if (!this.selectionLineWidth || !this.selectionBorderColor) {\r\n        return;\r\n      }\r\n      ctx.lineWidth = this.selectionLineWidth;\r\n      ctx.strokeStyle = this.selectionBorderColor;\r\n\r\n      minX += strokeOffset;\r\n      minY += strokeOffset;\r\n      maxX -= strokeOffset;\r\n      maxY -= strokeOffset;\r\n      // selection border\r\n      fabric.Object.prototype._setLineDash.call(this, ctx, this.selectionDashArray);\r\n      ctx.strokeRect(minX, minY, maxX - minX, maxY - minY);\r\n    },\r\n\r\n    /**\r\n     * Method that determines what object we are clicking on\r\n     * the skipGroup parameter is for internal use, is needed for shift+click action\r\n     * 11/09/2018 TODO: would be cool if findTarget could discern between being a full target\r\n     * or the outside part of the corner.\r\n     * @param {Event} e mouse event\r\n     * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\r\n     * @return {fabric.Object} the target found\r\n     */\r\n    findTarget: function (e, skipGroup) {\r\n      if (this.skipTargetFind) {\r\n        return;\r\n      }\r\n\r\n      var ignoreZoom = true,\r\n          pointer = this.getPointer(e, ignoreZoom),\r\n          activeObject = this._activeObject,\r\n          aObjects = this.getActiveObjects(),\r\n          activeTarget, activeTargetSubs,\r\n          isTouch = isTouchEvent(e),\r\n          shouldLookForActive = (aObjects.length > 1 && !skipGroup) || aObjects.length === 1;\r\n\r\n      // first check current group (if one exists)\r\n      // active group does not check sub targets like normal groups.\r\n      // if active group just exits.\r\n      this.targets = [];\r\n\r\n      // if we hit the corner of an activeObject, let's return that.\r\n      if (shouldLookForActive && activeObject._findTargetCorner(pointer, isTouch)) {\r\n        return activeObject;\r\n      }\r\n      if (aObjects.length > 1 && !skipGroup && activeObject === this._searchPossibleTargets([activeObject], pointer)) {\r\n        return activeObject;\r\n      }\r\n      if (aObjects.length === 1 &&\r\n        activeObject === this._searchPossibleTargets([activeObject], pointer)) {\r\n        if (!this.preserveObjectStacking) {\r\n          return activeObject;\r\n        }\r\n        else {\r\n          activeTarget = activeObject;\r\n          activeTargetSubs = this.targets;\r\n          this.targets = [];\r\n        }\r\n      }\r\n      var target = this._searchPossibleTargets(this._objects, pointer);\r\n      if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {\r\n        target = activeTarget;\r\n        this.targets = activeTargetSubs;\r\n      }\r\n      return target;\r\n    },\r\n\r\n    /**\r\n     * Checks point is inside the object.\r\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\r\n     * @param {fabric.Object} obj Object to test against\r\n     * @param {Object} [globalPointer] x,y object of point coordinates relative to canvas used to search per pixel target.\r\n     * @return {Boolean} true if point is contained within an area of given object\r\n     * @private\r\n     */\r\n    _checkTarget: function(pointer, obj, globalPointer) {\r\n      if (obj &&\r\n          obj.visible &&\r\n          obj.evented &&\r\n          // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\r\n          // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\r\n          obj.containsPoint(pointer)\r\n      ) {\r\n        if ((this.perPixelTargetFind || obj.perPixelTargetFind) && !obj.isEditing) {\r\n          var isTransparent = this.isTargetTransparent(obj, globalPointer.x, globalPointer.y);\r\n          if (!isTransparent) {\r\n            return true;\r\n          }\r\n        }\r\n        else {\r\n          return true;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Function used to search inside objects an object that contains pointer in bounding box or that contains pointerOnCanvas when painted\r\n     * @param {Array} [objects] objects array to look into\r\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\r\n     * @return {fabric.Object} object that contains pointer\r\n     * @private\r\n     */\r\n    _searchPossibleTargets: function(objects, pointer) {\r\n      // Cache all targets where their bounding box contains point.\r\n      var target, i = objects.length, subTarget;\r\n      // Do not check for currently grouped objects, since we check the parent group itself.\r\n      // until we call this function specifically to search inside the activeGroup\r\n      while (i--) {\r\n        var objToCheck = objects[i];\r\n        var pointerToUse = objToCheck.group ?\r\n          this._normalizePointer(objToCheck.group, pointer) : pointer;\r\n        if (this._checkTarget(pointerToUse, objToCheck, pointer)) {\r\n          target = objects[i];\r\n          if (target.subTargetCheck && target instanceof fabric.Group) {\r\n            subTarget = this._searchPossibleTargets(target._objects, pointer);\r\n            subTarget && this.targets.push(subTarget);\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      return target;\r\n    },\r\n\r\n    /**\r\n     * Returns pointer coordinates without the effect of the viewport\r\n     * @param {Object} pointer with \"x\" and \"y\" number values\r\n     * @return {Object} object with \"x\" and \"y\" number values\r\n     */\r\n    restorePointerVpt: function(pointer) {\r\n      return fabric.util.transformPoint(\r\n        pointer,\r\n        fabric.util.invertTransform(this.viewportTransform)\r\n      );\r\n    },\r\n\r\n    /**\r\n     * Returns pointer coordinates relative to canvas.\r\n     * Can return coordinates with or without viewportTransform.\r\n     * ignoreZoom false gives back coordinates that represent\r\n     * the point clicked on canvas element.\r\n     * ignoreZoom true gives back coordinates after being processed\r\n     * by the viewportTransform ( sort of coordinates of what is displayed\r\n     * on the canvas where you are clicking.\r\n     * ignoreZoom true = HTMLElement coordinates relative to top,left\r\n     * ignoreZoom false, default = fabric space coordinates, the same used for shape position\r\n     * To interact with your shapes top and left you want to use ignoreZoom true\r\n     * most of the time, while ignoreZoom false will give you coordinates\r\n     * compatible with the object.oCoords system.\r\n     * of the time.\r\n     * @param {Event} e\r\n     * @param {Boolean} ignoreZoom\r\n     * @return {Object} object with \"x\" and \"y\" number values\r\n     */\r\n    getPointer: function (e, ignoreZoom) {\r\n      // return cached values if we are in the event processing chain\r\n      if (this._absolutePointer && !ignoreZoom) {\r\n        return this._absolutePointer;\r\n      }\r\n      if (this._pointer && ignoreZoom) {\r\n        return this._pointer;\r\n      }\r\n\r\n      var pointer = getPointer(e),\r\n          upperCanvasEl = this.upperCanvasEl,\r\n          bounds = upperCanvasEl.getBoundingClientRect(),\r\n          boundsWidth = bounds.width || 0,\r\n          boundsHeight = bounds.height || 0,\r\n          cssScale;\r\n\r\n      if (!boundsWidth || !boundsHeight ) {\r\n        if ('top' in bounds && 'bottom' in bounds) {\r\n          boundsHeight = Math.abs( bounds.top - bounds.bottom );\r\n        }\r\n        if ('right' in bounds && 'left' in bounds) {\r\n          boundsWidth = Math.abs( bounds.right - bounds.left );\r\n        }\r\n      }\r\n\r\n      this.calcOffset();\r\n      pointer.x = pointer.x - this._offset.left;\r\n      pointer.y = pointer.y - this._offset.top;\r\n      if (!ignoreZoom) {\r\n        pointer = this.restorePointerVpt(pointer);\r\n      }\r\n\r\n      var retinaScaling = this.getRetinaScaling();\r\n      if (retinaScaling !== 1) {\r\n        pointer.x /= retinaScaling;\r\n        pointer.y /= retinaScaling;\r\n      }\r\n\r\n      if (boundsWidth === 0 || boundsHeight === 0) {\r\n        // If bounds are not available (i.e. not visible), do not apply scale.\r\n        cssScale = { width: 1, height: 1 };\r\n      }\r\n      else {\r\n        cssScale = {\r\n          width: upperCanvasEl.width / boundsWidth,\r\n          height: upperCanvasEl.height / boundsHeight\r\n        };\r\n      }\r\n\r\n      return {\r\n        x: pointer.x * cssScale.width,\r\n        y: pointer.y * cssScale.height\r\n      };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\r\n     */\r\n    _createUpperCanvas: function () {\r\n      var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/, ''),\r\n          lowerCanvasEl = this.lowerCanvasEl, upperCanvasEl = this.upperCanvasEl;\r\n\r\n      // there is no need to create a new upperCanvas element if we have already one.\r\n      if (upperCanvasEl) {\r\n        upperCanvasEl.className = '';\r\n      }\r\n      else {\r\n        upperCanvasEl = this._createCanvasElement();\r\n        this.upperCanvasEl = upperCanvasEl;\r\n      }\r\n      fabric.util.addClass(upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);\r\n\r\n      this.wrapperEl.appendChild(upperCanvasEl);\r\n\r\n      this._copyCanvasStyle(lowerCanvasEl, upperCanvasEl);\r\n      this._applyCanvasStyle(upperCanvasEl);\r\n      this.contextTop = upperCanvasEl.getContext('2d');\r\n    },\r\n\r\n    /**\r\n     * Returns context of top canvas where interactions are drawn\r\n     * @returns {CanvasRenderingContext2D}\r\n     */\r\n    getTopContext: function () {\r\n      return this.contextTop;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _createCacheCanvas: function () {\r\n      this.cacheCanvasEl = this._createCanvasElement();\r\n      this.cacheCanvasEl.setAttribute('width', this.width);\r\n      this.cacheCanvasEl.setAttribute('height', this.height);\r\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _initWrapperElement: function () {\r\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\r\n        'class': this.containerClass\r\n      });\r\n      fabric.util.setStyle(this.wrapperEl, {\r\n        width: this.width + 'px',\r\n        height: this.height + 'px',\r\n        position: 'relative'\r\n      });\r\n      fabric.util.makeElementUnselectable(this.wrapperEl);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {HTMLElement} element canvas element to apply styles on\r\n     */\r\n    _applyCanvasStyle: function (element) {\r\n      var width = this.width || element.width,\r\n          height = this.height || element.height;\r\n\r\n      fabric.util.setStyle(element, {\r\n        position: 'absolute',\r\n        width: width + 'px',\r\n        height: height + 'px',\r\n        left: 0,\r\n        top: 0,\r\n        'touch-action': this.allowTouchScrolling ? 'manipulation' : 'none',\r\n        '-ms-touch-action': this.allowTouchScrolling ? 'manipulation' : 'none'\r\n      });\r\n      element.width = width;\r\n      element.height = height;\r\n      fabric.util.makeElementUnselectable(element);\r\n    },\r\n\r\n    /**\r\n     * Copy the entire inline style from one element (fromEl) to another (toEl)\r\n     * @private\r\n     * @param {Element} fromEl Element style is copied from\r\n     * @param {Element} toEl Element copied style is applied to\r\n     */\r\n    _copyCanvasStyle: function (fromEl, toEl) {\r\n      toEl.style.cssText = fromEl.style.cssText;\r\n    },\r\n\r\n    /**\r\n     * Returns context of canvas where object selection is drawn\r\n     * @return {CanvasRenderingContext2D}\r\n     */\r\n    getSelectionContext: function() {\r\n      return this.contextTop;\r\n    },\r\n\r\n    /**\r\n     * Returns &lt;canvas> element on which object selection is drawn\r\n     * @return {HTMLCanvasElement}\r\n     */\r\n    getSelectionElement: function () {\r\n      return this.upperCanvasEl;\r\n    },\r\n\r\n    /**\r\n     * Returns currently active object\r\n     * @return {fabric.Object} active object\r\n     */\r\n    getActiveObject: function () {\r\n      return this._activeObject;\r\n    },\r\n\r\n    /**\r\n     * Returns an array with the current selected objects\r\n     * @return {fabric.Object} active object\r\n     */\r\n    getActiveObjects: function () {\r\n      var active = this._activeObject;\r\n      if (active) {\r\n        if (active.type === 'activeSelection' && active._objects) {\r\n          return active._objects.slice(0);\r\n        }\r\n        else {\r\n          return [active];\r\n        }\r\n      }\r\n      return [];\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {fabric.Object} obj Object that was removed\r\n     */\r\n    _onObjectRemoved: function(obj) {\r\n      // removing active object should fire \"selection:cleared\" events\r\n      if (obj === this._activeObject) {\r\n        this.fire('before:selection:cleared', { target: obj });\r\n        this._discardActiveObject();\r\n        this.fire('selection:cleared', { target: obj });\r\n        obj.fire('deselected');\r\n      }\r\n      if (obj === this._hoveredTarget){\r\n        this._hoveredTarget = null;\r\n        this._hoveredTargets = [];\r\n      }\r\n      this.callSuper('_onObjectRemoved', obj);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * Compares the old activeObject with the current one and fires correct events\r\n     * @param {fabric.Object} obj old activeObject\r\n     */\r\n    _fireSelectionEvents: function(oldObjects, e) {\r\n      var somethingChanged = false, objects = this.getActiveObjects(),\r\n          added = [], removed = [];\r\n      oldObjects.forEach(function(oldObject) {\r\n        if (objects.indexOf(oldObject) === -1) {\r\n          somethingChanged = true;\r\n          oldObject.fire('deselected', {\r\n            e: e,\r\n            target: oldObject\r\n          });\r\n          removed.push(oldObject);\r\n        }\r\n      });\r\n      objects.forEach(function(object) {\r\n        if (oldObjects.indexOf(object) === -1) {\r\n          somethingChanged = true;\r\n          object.fire('selected', {\r\n            e: e,\r\n            target: object\r\n          });\r\n          added.push(object);\r\n        }\r\n      });\r\n      if (oldObjects.length > 0 && objects.length > 0) {\r\n        somethingChanged && this.fire('selection:updated', {\r\n          e: e,\r\n          selected: added,\r\n          deselected: removed,\r\n        });\r\n      }\r\n      else if (objects.length > 0) {\r\n        this.fire('selection:created', {\r\n          e: e,\r\n          selected: added,\r\n        });\r\n      }\r\n      else if (oldObjects.length > 0) {\r\n        this.fire('selection:cleared', {\r\n          e: e,\r\n          deselected: removed,\r\n        });\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Sets given object as the only active object on canvas\r\n     * @param {fabric.Object} object Object to set as an active one\r\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    setActiveObject: function (object, e) {\r\n      var currentActives = this.getActiveObjects();\r\n      this._setActiveObject(object, e);\r\n      this._fireSelectionEvents(currentActives, e);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * This is a private method for now.\r\n     * This is supposed to be equivalent to setActiveObject but without firing\r\n     * any event. There is commitment to have this stay this way.\r\n     * This is the functional part of setActiveObject.\r\n     * @private\r\n     * @param {Object} object to set as active\r\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\r\n     * @return {Boolean} true if the selection happened\r\n     */\r\n    _setActiveObject: function(object, e) {\r\n      if (this._activeObject === object) {\r\n        return false;\r\n      }\r\n      if (!this._discardActiveObject(e, object)) {\r\n        return false;\r\n      }\r\n      if (object.onSelect({ e: e })) {\r\n        return false;\r\n      }\r\n      this._activeObject = object;\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * This is a private method for now.\r\n     * This is supposed to be equivalent to discardActiveObject but without firing\r\n     * any events. There is commitment to have this stay this way.\r\n     * This is the functional part of discardActiveObject.\r\n     * @param {Event} [e] Event (passed along when firing \"object:deselected\")\r\n     * @param {Object} object to set as active\r\n     * @return {Boolean} true if the selection happened\r\n     * @private\r\n     */\r\n    _discardActiveObject: function(e, object) {\r\n      var obj = this._activeObject;\r\n      if (obj) {\r\n        // onDeselect return TRUE to cancel selection;\r\n        if (obj.onDeselect({ e: e, object: object })) {\r\n          return false;\r\n        }\r\n        this._activeObject = null;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * Discards currently active object and fire events. If the function is called by fabric\r\n     * as a consequence of a mouse event, the event is passed as a parameter and\r\n     * sent to the fire function for the custom events. When used as a method the\r\n     * e param does not have any application.\r\n     * @param {event} e\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    discardActiveObject: function (e) {\r\n      var currentActives = this.getActiveObjects(), activeObject = this.getActiveObject();\r\n      if (currentActives.length) {\r\n        this.fire('before:selection:cleared', { target: activeObject, e: e });\r\n      }\r\n      this._discardActiveObject(e);\r\n      this._fireSelectionEvents(currentActives, e);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Clears a canvas element and removes all event listeners\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    dispose: function () {\r\n      var wrapper = this.wrapperEl;\r\n      this.removeListeners();\r\n      wrapper.removeChild(this.upperCanvasEl);\r\n      wrapper.removeChild(this.lowerCanvasEl);\r\n      this.contextCache = null;\r\n      this.contextTop = null;\r\n      ['upperCanvasEl', 'cacheCanvasEl'].forEach((function(element) {\r\n        fabric.util.cleanUpJsdomNode(this[element]);\r\n        this[element] = undefined;\r\n      }).bind(this));\r\n      if (wrapper.parentNode) {\r\n        wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\r\n      }\r\n      delete this.wrapperEl;\r\n      fabric.StaticCanvas.prototype.dispose.call(this);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Clears all contexts (background, main, top) of an instance\r\n     * @return {fabric.Canvas} thisArg\r\n     * @chainable\r\n     */\r\n    clear: function () {\r\n      // this.discardActiveGroup();\r\n      this.discardActiveObject();\r\n      this.clearContext(this.contextTop);\r\n      return this.callSuper('clear');\r\n    },\r\n\r\n    /**\r\n     * Draws objects' controls (borders/controls)\r\n     * @param {CanvasRenderingContext2D} ctx Context to render controls on\r\n     */\r\n    drawControls: function(ctx) {\r\n      var activeObject = this._activeObject;\r\n\r\n      if (activeObject) {\r\n        activeObject._renderControls(ctx);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _toObject: function(instance, methodName, propertiesToInclude) {\r\n      //If the object is part of the current selection group, it should\r\n      //be transformed appropriately\r\n      //i.e. it should be serialised as it would appear if the selection group\r\n      //were to be destroyed.\r\n      var originalProperties = this._realizeGroupTransformOnObject(instance),\r\n          object = this.callSuper('_toObject', instance, methodName, propertiesToInclude);\r\n      //Undo the damage we did by changing all of its properties\r\n      this._unwindGroupTransformOnObject(instance, originalProperties);\r\n      return object;\r\n    },\r\n\r\n    /**\r\n     * Realises an object's group transformation on it\r\n     * @private\r\n     * @param {fabric.Object} [instance] the object to transform (gets mutated)\r\n     * @returns the original values of instance which were changed\r\n     */\r\n    _realizeGroupTransformOnObject: function(instance) {\r\n      if (instance.group && instance.group.type === 'activeSelection' && this._activeObject === instance.group) {\r\n        var layoutProps = ['angle', 'flipX', 'flipY', 'left', 'scaleX', 'scaleY', 'skewX', 'skewY', 'top'];\r\n        //Copy all the positionally relevant properties across now\r\n        var originalValues = {};\r\n        layoutProps.forEach(function(prop) {\r\n          originalValues[prop] = instance[prop];\r\n        });\r\n        fabric.util.addTransformToObject(instance, this._activeObject.calcOwnMatrix());\r\n        return originalValues;\r\n      }\r\n      else {\r\n        return null;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Restores the changed properties of instance\r\n     * @private\r\n     * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\r\n     * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\r\n     */\r\n    _unwindGroupTransformOnObject: function(instance, originalValues) {\r\n      if (originalValues) {\r\n        instance.set(originalValues);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setSVGObject: function(markup, instance, reviver) {\r\n      //If the object is in a selection group, simulate what would happen to that\r\n      //object when the group is deselected\r\n      var originalProperties = this._realizeGroupTransformOnObject(instance);\r\n      this.callSuper('_setSVGObject', markup, instance, reviver);\r\n      this._unwindGroupTransformOnObject(instance, originalProperties);\r\n    },\r\n\r\n    setViewportTransform: function (vpt) {\r\n      if (this.renderOnAddRemove && this._activeObject && this._activeObject.isEditing) {\r\n        this._activeObject.clearContextTop();\r\n      }\r\n      fabric.StaticCanvas.prototype.setViewportTransform.call(this, vpt);\r\n    }\r\n  });\r\n\r\n  // copying static properties manually to work around Opera's bug,\r\n  // where \"prototype\" property is enumerable and overrides existing prototype\r\n  for (var prop in fabric.StaticCanvas) {\r\n    if (prop !== 'prototype') {\r\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\r\n    }\r\n  }\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  var addListener = fabric.util.addListener,\r\n      removeListener = fabric.util.removeListener,\r\n      RIGHT_CLICK = 3, MIDDLE_CLICK = 2, LEFT_CLICK = 1,\r\n      addEventOptions = { passive: false };\r\n\r\n  function checkClick(e, value) {\r\n    return e.button && (e.button === value - 1);\r\n  }\r\n\r\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\r\n\r\n    /**\r\n     * Contains the id of the touch event that owns the fabric transform\r\n     * @type Number\r\n     * @private\r\n     */\r\n    mainTouchId: null,\r\n\r\n    /**\r\n     * Adds mouse listeners to canvas\r\n     * @private\r\n     */\r\n    _initEventListeners: function () {\r\n      // in case we initialized the class twice. This should not happen normally\r\n      // but in some kind of applications where the canvas element may be changed\r\n      // this is a workaround to having double listeners.\r\n      this.removeListeners();\r\n      this._bindEvents();\r\n      this.addOrRemove(addListener, 'add');\r\n    },\r\n\r\n    /**\r\n     * return an event prefix pointer or mouse.\r\n     * @private\r\n     */\r\n    _getEventPrefix: function () {\r\n      return this.enablePointerEvents ? 'pointer' : 'mouse';\r\n    },\r\n\r\n    addOrRemove: function(functor, eventjsFunctor) {\r\n      var canvasElement = this.upperCanvasEl,\r\n          eventTypePrefix = this._getEventPrefix();\r\n      functor(fabric.window, 'resize', this._onResize);\r\n      functor(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\r\n      functor(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\r\n      functor(canvasElement, eventTypePrefix + 'out', this._onMouseOut);\r\n      functor(canvasElement, eventTypePrefix + 'enter', this._onMouseEnter);\r\n      functor(canvasElement, 'wheel', this._onMouseWheel);\r\n      functor(canvasElement, 'contextmenu', this._onContextMenu);\r\n      functor(canvasElement, 'dblclick', this._onDoubleClick);\r\n      functor(canvasElement, 'dragover', this._onDragOver);\r\n      functor(canvasElement, 'dragenter', this._onDragEnter);\r\n      functor(canvasElement, 'dragleave', this._onDragLeave);\r\n      functor(canvasElement, 'drop', this._onDrop);\r\n      if (!this.enablePointerEvents) {\r\n        functor(canvasElement, 'touchstart', this._onTouchStart, addEventOptions);\r\n      }\r\n      if (typeof eventjs !== 'undefined' && eventjsFunctor in eventjs) {\r\n        eventjs[eventjsFunctor](canvasElement, 'gesture', this._onGesture);\r\n        eventjs[eventjsFunctor](canvasElement, 'drag', this._onDrag);\r\n        eventjs[eventjsFunctor](canvasElement, 'orientation', this._onOrientationChange);\r\n        eventjs[eventjsFunctor](canvasElement, 'shake', this._onShake);\r\n        eventjs[eventjsFunctor](canvasElement, 'longpress', this._onLongPress);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Removes all event listeners\r\n     */\r\n    removeListeners: function() {\r\n      this.addOrRemove(removeListener, 'remove');\r\n      // if you dispose on a mouseDown, before mouse up, you need to clean document to...\r\n      var eventTypePrefix = this._getEventPrefix();\r\n      removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\r\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\r\n      removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\r\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _bindEvents: function() {\r\n      if (this.eventsBound) {\r\n        // for any reason we pass here twice we do not want to bind events twice.\r\n        return;\r\n      }\r\n      this._onMouseDown = this._onMouseDown.bind(this);\r\n      this._onTouchStart = this._onTouchStart.bind(this);\r\n      this._onMouseMove = this._onMouseMove.bind(this);\r\n      this._onMouseUp = this._onMouseUp.bind(this);\r\n      this._onTouchEnd = this._onTouchEnd.bind(this);\r\n      this._onResize = this._onResize.bind(this);\r\n      this._onGesture = this._onGesture.bind(this);\r\n      this._onDrag = this._onDrag.bind(this);\r\n      this._onShake = this._onShake.bind(this);\r\n      this._onLongPress = this._onLongPress.bind(this);\r\n      this._onOrientationChange = this._onOrientationChange.bind(this);\r\n      this._onMouseWheel = this._onMouseWheel.bind(this);\r\n      this._onMouseOut = this._onMouseOut.bind(this);\r\n      this._onMouseEnter = this._onMouseEnter.bind(this);\r\n      this._onContextMenu = this._onContextMenu.bind(this);\r\n      this._onDoubleClick = this._onDoubleClick.bind(this);\r\n      this._onDragOver = this._onDragOver.bind(this);\r\n      this._onDragEnter = this._simpleEventHandler.bind(this, 'dragenter');\r\n      this._onDragLeave = this._simpleEventHandler.bind(this, 'dragleave');\r\n      this._onDrop = this._onDrop.bind(this);\r\n      this.eventsBound = true;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} [e] Event object fired on Event.js gesture\r\n     * @param {Event} [self] Inner Event object\r\n     */\r\n    _onGesture: function(e, self) {\r\n      this.__onTransformGesture && this.__onTransformGesture(e, self);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} [e] Event object fired on Event.js drag\r\n     * @param {Event} [self] Inner Event object\r\n     */\r\n    _onDrag: function(e, self) {\r\n      this.__onDrag && this.__onDrag(e, self);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} [e] Event object fired on wheel event\r\n     */\r\n    _onMouseWheel: function(e) {\r\n      this.__onMouseWheel(e);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousedown\r\n     */\r\n    _onMouseOut: function(e) {\r\n      var target = this._hoveredTarget;\r\n      this.fire('mouse:out', { target: target, e: e });\r\n      this._hoveredTarget = null;\r\n      target && target.fire('mouseout', { e: e });\r\n\r\n      var _this = this;\r\n      this._hoveredTargets.forEach(function(_target){\r\n        _this.fire('mouse:out', { target: target, e: e });\r\n        _target && target.fire('mouseout', { e: e });\r\n      });\r\n      this._hoveredTargets = [];\r\n\r\n      if (this._iTextInstances) {\r\n        this._iTextInstances.forEach(function(obj) {\r\n          if (obj.isEditing) {\r\n            obj.hiddenTextarea.focus();\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mouseenter\r\n     */\r\n    _onMouseEnter: function(e) {\r\n      // This find target and consequent 'mouse:over' is used to\r\n      // clear old instances on hovered target.\r\n      // calling findTarget has the side effect of killing target.__corner.\r\n      // as a short term fix we are not firing this if we are currently transforming.\r\n      // as a long term fix we need to separate the action of finding a target with the\r\n      // side effects we added to it.\r\n      if (!this._currentTransform && !this.findTarget(e)) {\r\n        this.fire('mouse:over', { target: null, e: e });\r\n        this._hoveredTarget = null;\r\n        this._hoveredTargets = [];\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} [e] Event object fired on Event.js orientation change\r\n     * @param {Event} [self] Inner Event object\r\n     */\r\n    _onOrientationChange: function(e, self) {\r\n      this.__onOrientationChange && this.__onOrientationChange(e, self);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} [e] Event object fired on Event.js shake\r\n     * @param {Event} [self] Inner Event object\r\n     */\r\n    _onShake: function(e, self) {\r\n      this.__onShake && this.__onShake(e, self);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} [e] Event object fired on Event.js shake\r\n     * @param {Event} [self] Inner Event object\r\n     */\r\n    _onLongPress: function(e, self) {\r\n      this.__onLongPress && this.__onLongPress(e, self);\r\n    },\r\n\r\n    /**\r\n     * prevent default to allow drop event to be fired\r\n     * @private\r\n     * @param {Event} [e] Event object fired on Event.js shake\r\n     */\r\n    _onDragOver: function(e) {\r\n      e.preventDefault();\r\n      var target = this._simpleEventHandler('dragover', e);\r\n      this._fireEnterLeaveEvents(target, e);\r\n    },\r\n\r\n    /**\r\n     * `drop:before` is a an event that allow you to schedule logic\r\n     * before the `drop` event. Prefer `drop` event always, but if you need\r\n     * to run some drop-disabling logic on an event, since there is no way\r\n     * to handle event handlers ordering, use `drop:before`\r\n     * @param {Event} e\r\n     */\r\n    _onDrop: function (e) {\r\n      this._simpleEventHandler('drop:before', e);\r\n      return this._simpleEventHandler('drop', e);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousedown\r\n     */\r\n    _onContextMenu: function (e) {\r\n      if (this.stopContextMenu) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousedown\r\n     */\r\n    _onDoubleClick: function (e) {\r\n      this._cacheTransformEventData(e);\r\n      this._handleEvent(e, 'dblclick');\r\n      this._resetTransformEventData(e);\r\n    },\r\n\r\n    /**\r\n     * Return a the id of an event.\r\n     * returns either the pointerId or the identifier or 0 for the mouse event\r\n     * @private\r\n     * @param {Event} evt Event object\r\n     */\r\n    getPointerId: function(evt) {\r\n      var changedTouches = evt.changedTouches;\r\n\r\n      if (changedTouches) {\r\n        return changedTouches[0] && changedTouches[0].identifier;\r\n      }\r\n\r\n      if (this.enablePointerEvents) {\r\n        return evt.pointerId;\r\n      }\r\n\r\n      return -1;\r\n    },\r\n\r\n    /**\r\n     * Determines if an event has the id of the event that is considered main\r\n     * @private\r\n     * @param {evt} event Event object\r\n     */\r\n    _isMainEvent: function(evt) {\r\n      if (evt.isPrimary === true) {\r\n        return true;\r\n      }\r\n      if (evt.isPrimary === false) {\r\n        return false;\r\n      }\r\n      if (evt.type === 'touchend' && evt.touches.length === 0) {\r\n        return true;\r\n      }\r\n      if (evt.changedTouches) {\r\n        return evt.changedTouches[0].identifier === this.mainTouchId;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousedown\r\n     */\r\n    _onTouchStart: function(e) {\r\n      e.preventDefault();\r\n      if (this.mainTouchId === null) {\r\n        this.mainTouchId = this.getPointerId(e);\r\n      }\r\n      this.__onMouseDown(e);\r\n      this._resetTransformEventData();\r\n      var canvasElement = this.upperCanvasEl,\r\n          eventTypePrefix = this._getEventPrefix();\r\n      addListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\r\n      addListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\r\n      // Unbind mousedown to prevent double triggers from touch devices\r\n      removeListener(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousedown\r\n     */\r\n    _onMouseDown: function (e) {\r\n      this.__onMouseDown(e);\r\n      this._resetTransformEventData();\r\n      var canvasElement = this.upperCanvasEl,\r\n          eventTypePrefix = this._getEventPrefix();\r\n      removeListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\r\n      addListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\r\n      addListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousedown\r\n     */\r\n    _onTouchEnd: function(e) {\r\n      if (e.touches.length > 0) {\r\n        // if there are still touches stop here\r\n        return;\r\n      }\r\n      this.__onMouseUp(e);\r\n      this._resetTransformEventData();\r\n      this.mainTouchId = null;\r\n      var eventTypePrefix = this._getEventPrefix();\r\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\r\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\r\n      var _this = this;\r\n      if (this._willAddMouseDown) {\r\n        clearTimeout(this._willAddMouseDown);\r\n      }\r\n      this._willAddMouseDown = setTimeout(function() {\r\n        // Wait 400ms before rebinding mousedown to prevent double triggers\r\n        // from touch devices\r\n        addListener(_this.upperCanvasEl, eventTypePrefix + 'down', _this._onMouseDown);\r\n        _this._willAddMouseDown = 0;\r\n      }, 400);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mouseup\r\n     */\r\n    _onMouseUp: function (e) {\r\n      this.__onMouseUp(e);\r\n      this._resetTransformEventData();\r\n      var canvasElement = this.upperCanvasEl,\r\n          eventTypePrefix = this._getEventPrefix();\r\n      if (this._isMainEvent(e)) {\r\n        removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\r\n        removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\r\n        addListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousemove\r\n     */\r\n    _onMouseMove: function (e) {\r\n      !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\r\n      this.__onMouseMove(e);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _onResize: function () {\r\n      this.calcOffset();\r\n    },\r\n\r\n    /**\r\n     * Decides whether the canvas should be redrawn in mouseup and mousedown events.\r\n     * @private\r\n     * @param {Object} target\r\n     */\r\n    _shouldRender: function(target) {\r\n      var activeObject = this._activeObject;\r\n\r\n      if (\r\n        !!activeObject !== !!target ||\r\n        (activeObject && target && (activeObject !== target))\r\n      ) {\r\n        // this covers: switch of target, from target to no target, selection of target\r\n        // multiSelection with key and mouse\r\n        return true;\r\n      }\r\n      else if (activeObject && activeObject.isEditing) {\r\n        // if we mouse up/down over a editing textbox a cursor change,\r\n        // there is no need to re render\r\n        return false;\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Method that defines the actions when mouse is released on canvas.\r\n     * The method resets the currentTransform parameters, store the image corner\r\n     * position in the image object and render the canvas on top.\r\n     * @private\r\n     * @param {Event} e Event object fired on mouseup\r\n     */\r\n    __onMouseUp: function (e) {\r\n      var target, transform = this._currentTransform,\r\n          groupSelector = this._groupSelector, shouldRender = false,\r\n          isClick = (!groupSelector || (groupSelector.left === 0 && groupSelector.top === 0));\r\n      this._cacheTransformEventData(e);\r\n      target = this._target;\r\n      this._handleEvent(e, 'up:before');\r\n      // if right/middle click just fire events and return\r\n      // target undefined will make the _handleEvent search the target\r\n      if (checkClick(e, RIGHT_CLICK)) {\r\n        if (this.fireRightClick) {\r\n          this._handleEvent(e, 'up', RIGHT_CLICK, isClick);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (checkClick(e, MIDDLE_CLICK)) {\r\n        if (this.fireMiddleClick) {\r\n          this._handleEvent(e, 'up', MIDDLE_CLICK, isClick);\r\n        }\r\n        this._resetTransformEventData();\r\n        return;\r\n      }\r\n\r\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\r\n        this._onMouseUpInDrawingMode(e);\r\n        return;\r\n      }\r\n\r\n      if (!this._isMainEvent(e)) {\r\n        return;\r\n      }\r\n      if (transform) {\r\n        this._finalizeCurrentTransform(e);\r\n        shouldRender = transform.actionPerformed;\r\n      }\r\n      if (!isClick) {\r\n        var targetWasActive = target === this._activeObject;\r\n        this._maybeGroupObjects(e);\r\n        if (!shouldRender) {\r\n          shouldRender = (\r\n            this._shouldRender(target) ||\r\n            (!targetWasActive && target === this._activeObject)\r\n          );\r\n        }\r\n      }\r\n      var corner, pointer;\r\n      if (target) {\r\n        corner = target._findTargetCorner(\r\n          this.getPointer(e, true),\r\n          fabric.util.isTouchEvent(e)\r\n        );\r\n        if (target.selectable && target !== this._activeObject && target.activeOn === 'up') {\r\n          this.setActiveObject(target, e);\r\n          shouldRender = true;\r\n        }\r\n        else {\r\n          var control = target.controls[corner],\r\n              mouseUpHandler = control && control.getMouseUpHandler(e, target, control);\r\n          if (mouseUpHandler) {\r\n            pointer = this.getPointer(e);\r\n            mouseUpHandler(e, transform, pointer.x, pointer.y);\r\n          }\r\n        }\r\n        target.isMoving = false;\r\n      }\r\n      // if we are ending up a transform on a different control or a new object\r\n      // fire the original mouse up from the corner that started the transform\r\n      if (transform && (transform.target !== target || transform.corner !== corner)) {\r\n        var originalControl = transform.target && transform.target.controls[transform.corner],\r\n            originalMouseUpHandler = originalControl && originalControl.getMouseUpHandler(e, target, control);\r\n        pointer = pointer || this.getPointer(e);\r\n        originalMouseUpHandler && originalMouseUpHandler(e, transform, pointer.x, pointer.y);\r\n      }\r\n      this._setCursorFromEvent(e, target);\r\n      this._handleEvent(e, 'up', LEFT_CLICK, isClick);\r\n      this._groupSelector = null;\r\n      this._currentTransform = null;\r\n      // reset the target information about which corner is selected\r\n      target && (target.__corner = 0);\r\n      if (shouldRender) {\r\n        this.requestRenderAll();\r\n      }\r\n      else if (!isClick) {\r\n        this.renderTop();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * Handle event firing for target and subtargets\r\n     * @param {Event} e event from mouse\r\n     * @param {String} eventType event to fire (up, down or move)\r\n     * @return {Fabric.Object} target return the the target found, for internal reasons.\r\n     */\r\n    _simpleEventHandler: function(eventType, e) {\r\n      var target = this.findTarget(e),\r\n          targets = this.targets,\r\n          options = {\r\n            e: e,\r\n            target: target,\r\n            subTargets: targets,\r\n          };\r\n      this.fire(eventType, options);\r\n      target && target.fire(eventType, options);\r\n      if (!targets) {\r\n        return target;\r\n      }\r\n      for (var i = 0; i < targets.length; i++) {\r\n        targets[i].fire(eventType, options);\r\n      }\r\n      return target;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * Handle event firing for target and subtargets\r\n     * @param {Event} e event from mouse\r\n     * @param {String} eventType event to fire (up, down or move)\r\n     * @param {fabric.Object} targetObj receiving event\r\n     * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\r\n     * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\r\n     */\r\n    _handleEvent: function(e, eventType, button, isClick) {\r\n      var target = this._target,\r\n          targets = this.targets || [],\r\n          options = {\r\n            e: e,\r\n            target: target,\r\n            subTargets: targets,\r\n            button: button || LEFT_CLICK,\r\n            isClick: isClick || false,\r\n            pointer: this._pointer,\r\n            absolutePointer: this._absolutePointer,\r\n            transform: this._currentTransform\r\n          };\r\n      if (eventType === 'up') {\r\n        options.currentTarget = this.findTarget(e);\r\n        options.currentSubTargets = this.targets;\r\n      }\r\n      this.fire('mouse:' + eventType, options);\r\n      target && target.fire('mouse' + eventType, options);\r\n      for (var i = 0; i < targets.length; i++) {\r\n        targets[i].fire('mouse' + eventType, options);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\r\n     */\r\n    _finalizeCurrentTransform: function(e) {\r\n\r\n      var transform = this._currentTransform,\r\n          target = transform.target,\r\n          options = {\r\n            e: e,\r\n            target: target,\r\n            transform: transform,\r\n            action: transform.action,\r\n          };\r\n\r\n      if (target._scaling) {\r\n        target._scaling = false;\r\n      }\r\n\r\n      target.setCoords();\r\n\r\n      if (transform.actionPerformed || (this.stateful && target.hasStateChanged())) {\r\n        this._fire('modified', options);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousedown\r\n     */\r\n    _onMouseDownInDrawingMode: function(e) {\r\n      this._isCurrentlyDrawing = true;\r\n      if (this.getActiveObject()) {\r\n        this.discardActiveObject(e).requestRenderAll();\r\n      }\r\n      var pointer = this.getPointer(e);\r\n      this.freeDrawingBrush.onMouseDown(pointer, { e: e, pointer: pointer });\r\n      this._handleEvent(e, 'down');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mousemove\r\n     */\r\n    _onMouseMoveInDrawingMode: function(e) {\r\n      if (this._isCurrentlyDrawing) {\r\n        var pointer = this.getPointer(e);\r\n        this.freeDrawingBrush.onMouseMove(pointer, { e: e, pointer: pointer });\r\n      }\r\n      this.setCursor(this.freeDrawingCursor);\r\n      this._handleEvent(e, 'move');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object fired on mouseup\r\n     */\r\n    _onMouseUpInDrawingMode: function(e) {\r\n      var pointer = this.getPointer(e);\r\n      this._isCurrentlyDrawing = this.freeDrawingBrush.onMouseUp({ e: e, pointer: pointer });\r\n      this._handleEvent(e, 'up');\r\n    },\r\n\r\n    /**\r\n     * Method that defines the actions when mouse is clicked on canvas.\r\n     * The method inits the currentTransform parameters and renders all the\r\n     * canvas so the current image can be placed on the top canvas and the rest\r\n     * in on the container one.\r\n     * @private\r\n     * @param {Event} e Event object fired on mousedown\r\n     */\r\n    __onMouseDown: function (e) {\r\n      this._cacheTransformEventData(e);\r\n      this._handleEvent(e, 'down:before');\r\n      var target = this._target;\r\n      // if right click just fire events\r\n      if (checkClick(e, RIGHT_CLICK)) {\r\n        if (this.fireRightClick) {\r\n          this._handleEvent(e, 'down', RIGHT_CLICK);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (checkClick(e, MIDDLE_CLICK)) {\r\n        if (this.fireMiddleClick) {\r\n          this._handleEvent(e, 'down', MIDDLE_CLICK);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (this.isDrawingMode) {\r\n        this._onMouseDownInDrawingMode(e);\r\n        return;\r\n      }\r\n\r\n      if (!this._isMainEvent(e)) {\r\n        return;\r\n      }\r\n\r\n      // ignore if some object is being transformed at this moment\r\n      if (this._currentTransform) {\r\n        return;\r\n      }\r\n\r\n      var pointer = this._pointer;\r\n      // save pointer for check in __onMouseUp event\r\n      this._previousPointer = pointer;\r\n      var shouldRender = this._shouldRender(target),\r\n          shouldGroup = this._shouldGroup(e, target);\r\n      if (this._shouldClearSelection(e, target)) {\r\n        this.discardActiveObject(e);\r\n      }\r\n      else if (shouldGroup) {\r\n        this._handleGrouping(e, target);\r\n        target = this._activeObject;\r\n      }\r\n\r\n      if (this.selection && (!target ||\r\n        (!target.selectable && !target.isEditing && target !== this._activeObject))) {\r\n        this._groupSelector = {\r\n          ex: this._absolutePointer.x,\r\n          ey: this._absolutePointer.y,\r\n          top: 0,\r\n          left: 0\r\n        };\r\n      }\r\n\r\n      if (target) {\r\n        var alreadySelected = target === this._activeObject;\r\n        if (target.selectable && target.activeOn === 'down') {\r\n          this.setActiveObject(target, e);\r\n        }\r\n        var corner = target._findTargetCorner(\r\n          this.getPointer(e, true),\r\n          fabric.util.isTouchEvent(e)\r\n        );\r\n        target.__corner = corner;\r\n        if (target === this._activeObject && (corner || !shouldGroup)) {\r\n          this._setupCurrentTransform(e, target, alreadySelected);\r\n          var control = target.controls[corner],\r\n              pointer = this.getPointer(e),\r\n              mouseDownHandler = control && control.getMouseDownHandler(e, target, control);\r\n          if (mouseDownHandler) {\r\n            mouseDownHandler(e, this._currentTransform, pointer.x, pointer.y);\r\n          }\r\n        }\r\n      }\r\n      this._handleEvent(e, 'down');\r\n      // we must renderAll so that we update the visuals\r\n      (shouldRender || shouldGroup) && this.requestRenderAll();\r\n    },\r\n\r\n    /**\r\n     * reset cache form common information needed during event processing\r\n     * @private\r\n     */\r\n    _resetTransformEventData: function() {\r\n      this._target = null;\r\n      this._pointer = null;\r\n      this._absolutePointer = null;\r\n    },\r\n\r\n    /**\r\n     * Cache common information needed during event processing\r\n     * @private\r\n     * @param {Event} e Event object fired on event\r\n     */\r\n    _cacheTransformEventData: function(e) {\r\n      // reset in order to avoid stale caching\r\n      this._resetTransformEventData();\r\n      this._pointer = this.getPointer(e, true);\r\n      this._absolutePointer = this.restorePointerVpt(this._pointer);\r\n      this._target = this._currentTransform ? this._currentTransform.target : this.findTarget(e) || null;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _beforeTransform: function(e) {\r\n      var t = this._currentTransform;\r\n      this.stateful && t.target.saveState();\r\n      this.fire('before:transform', {\r\n        e: e,\r\n        transform: t,\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Method that defines the actions when mouse is hovering the canvas.\r\n     * The currentTransform parameter will define whether the user is rotating/scaling/translating\r\n     * an image or neither of them (only hovering). A group selection is also possible and would cancel\r\n     * all any other type of action.\r\n     * In case of an image transformation only the top canvas will be rendered.\r\n     * @private\r\n     * @param {Event} e Event object fired on mousemove\r\n     */\r\n    __onMouseMove: function (e) {\r\n      this._handleEvent(e, 'move:before');\r\n      this._cacheTransformEventData(e);\r\n      var target, pointer;\r\n\r\n      if (this.isDrawingMode) {\r\n        this._onMouseMoveInDrawingMode(e);\r\n        return;\r\n      }\r\n\r\n      if (!this._isMainEvent(e)) {\r\n        return;\r\n      }\r\n\r\n      var groupSelector = this._groupSelector;\r\n\r\n      // We initially clicked in an empty area, so we draw a box for multiple selection\r\n      if (groupSelector) {\r\n        pointer = this._absolutePointer;\r\n\r\n        groupSelector.left = pointer.x - groupSelector.ex;\r\n        groupSelector.top = pointer.y - groupSelector.ey;\r\n\r\n        this.renderTop();\r\n      }\r\n      else if (!this._currentTransform) {\r\n        target = this.findTarget(e) || null;\r\n        this._setCursorFromEvent(e, target);\r\n        this._fireOverOutEvents(target, e);\r\n      }\r\n      else {\r\n        this._transformObject(e);\r\n      }\r\n      this._handleEvent(e, 'move');\r\n      this._resetTransformEventData();\r\n    },\r\n\r\n    /**\r\n     * Manage the mouseout, mouseover events for the fabric object on the canvas\r\n     * @param {Fabric.Object} target the target where the target from the mousemove event\r\n     * @param {Event} e Event object fired on mousemove\r\n     * @private\r\n     */\r\n    _fireOverOutEvents: function(target, e) {\r\n      var _hoveredTarget = this._hoveredTarget,\r\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\r\n          length = Math.max(_hoveredTargets.length, targets.length);\r\n\r\n      this.fireSyntheticInOutEvents(target, e, {\r\n        oldTarget: _hoveredTarget,\r\n        evtOut: 'mouseout',\r\n        canvasEvtOut: 'mouse:out',\r\n        evtIn: 'mouseover',\r\n        canvasEvtIn: 'mouse:over',\r\n      });\r\n      for (var i = 0; i < length; i++){\r\n        this.fireSyntheticInOutEvents(targets[i], e, {\r\n          oldTarget: _hoveredTargets[i],\r\n          evtOut: 'mouseout',\r\n          evtIn: 'mouseover',\r\n        });\r\n      }\r\n      this._hoveredTarget = target;\r\n      this._hoveredTargets = this.targets.concat();\r\n    },\r\n\r\n    /**\r\n     * Manage the dragEnter, dragLeave events for the fabric objects on the canvas\r\n     * @param {Fabric.Object} target the target where the target from the onDrag event\r\n     * @param {Event} e Event object fired on ondrag\r\n     * @private\r\n     */\r\n    _fireEnterLeaveEvents: function(target, e) {\r\n      var _draggedoverTarget = this._draggedoverTarget,\r\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\r\n          length = Math.max(_hoveredTargets.length, targets.length);\r\n\r\n      this.fireSyntheticInOutEvents(target, e, {\r\n        oldTarget: _draggedoverTarget,\r\n        evtOut: 'dragleave',\r\n        evtIn: 'dragenter',\r\n      });\r\n      for (var i = 0; i < length; i++) {\r\n        this.fireSyntheticInOutEvents(targets[i], e, {\r\n          oldTarget: _hoveredTargets[i],\r\n          evtOut: 'dragleave',\r\n          evtIn: 'dragenter',\r\n        });\r\n      }\r\n      this._draggedoverTarget = target;\r\n    },\r\n\r\n    /**\r\n     * Manage the synthetic in/out events for the fabric objects on the canvas\r\n     * @param {Fabric.Object} target the target where the target from the supported events\r\n     * @param {Event} e Event object fired\r\n     * @param {Object} config configuration for the function to work\r\n     * @param {String} config.targetName property on the canvas where the old target is stored\r\n     * @param {String} [config.canvasEvtOut] name of the event to fire at canvas level for out\r\n     * @param {String} config.evtOut name of the event to fire for out\r\n     * @param {String} [config.canvasEvtIn] name of the event to fire at canvas level for in\r\n     * @param {String} config.evtIn name of the event to fire for in\r\n     * @private\r\n     */\r\n    fireSyntheticInOutEvents: function(target, e, config) {\r\n      var inOpt, outOpt, oldTarget = config.oldTarget, outFires, inFires,\r\n          targetChanged = oldTarget !== target, canvasEvtIn = config.canvasEvtIn, canvasEvtOut = config.canvasEvtOut;\r\n      if (targetChanged) {\r\n        inOpt = { e: e, target: target, previousTarget: oldTarget };\r\n        outOpt = { e: e, target: oldTarget, nextTarget: target };\r\n      }\r\n      inFires = target && targetChanged;\r\n      outFires = oldTarget && targetChanged;\r\n      if (outFires) {\r\n        canvasEvtOut && this.fire(canvasEvtOut, outOpt);\r\n        oldTarget.fire(config.evtOut, outOpt);\r\n      }\r\n      if (inFires) {\r\n        canvasEvtIn && this.fire(canvasEvtIn, inOpt);\r\n        target.fire(config.evtIn, inOpt);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Method that defines actions when an Event Mouse Wheel\r\n     * @param {Event} e Event object fired on mouseup\r\n     */\r\n    __onMouseWheel: function(e) {\r\n      this._cacheTransformEventData(e);\r\n      this._handleEvent(e, 'wheel');\r\n      this._resetTransformEventData();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event fired on mousemove\r\n     */\r\n    _transformObject: function(e) {\r\n      var pointer = this.getPointer(e),\r\n          transform = this._currentTransform;\r\n\r\n      transform.reset = false;\r\n      transform.shiftKey = e.shiftKey;\r\n      transform.altKey = e[this.centeredKey];\r\n\r\n      this._performTransformAction(e, transform, pointer);\r\n      transform.actionPerformed && this.requestRenderAll();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _performTransformAction: function(e, transform, pointer) {\r\n      var x = pointer.x,\r\n          y = pointer.y,\r\n          action = transform.action,\r\n          actionPerformed = false,\r\n          actionHandler = transform.actionHandler;\r\n          // this object could be created from the function in the control handlers\r\n\r\n\r\n      if (actionHandler) {\r\n        actionPerformed = actionHandler(e, transform, x, y);\r\n      }\r\n      if (action === 'drag' && actionPerformed) {\r\n        transform.target.isMoving = true;\r\n        this.setCursor(transform.target.moveCursor || this.moveCursor);\r\n      }\r\n      transform.actionPerformed = transform.actionPerformed || actionPerformed;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _fire: fabric.controlsUtils.fireEvent,\r\n\r\n    /**\r\n     * Sets the cursor depending on where the canvas is being hovered.\r\n     * Note: very buggy in Opera\r\n     * @param {Event} e Event object\r\n     * @param {Object} target Object that the mouse is hovering, if so.\r\n     */\r\n    _setCursorFromEvent: function (e, target) {\r\n      if (!target) {\r\n        this.setCursor(this.defaultCursor);\r\n        return false;\r\n      }\r\n      var hoverCursor = target.hoverCursor || this.hoverCursor,\r\n          activeSelection = this._activeObject && this._activeObject.type === 'activeSelection' ?\r\n            this._activeObject : null,\r\n          // only show proper corner when group selection is not active\r\n          corner = (!activeSelection || !activeSelection.contains(target))\r\n          // here we call findTargetCorner always with undefined for the touch parameter.\r\n          // we assume that if you are using a cursor you do not need to interact with\r\n          // the bigger touch area.\r\n                    && target._findTargetCorner(this.getPointer(e, true));\r\n\r\n      if (!corner) {\r\n        if (target.subTargetCheck){\r\n          // hoverCursor should come from top-most subTarget,\r\n          // so we walk the array backwards\r\n          this.targets.concat().reverse().map(function(_target){\r\n            hoverCursor = _target.hoverCursor || hoverCursor;\r\n          });\r\n        }\r\n        this.setCursor(hoverCursor);\r\n      }\r\n      else {\r\n        this.setCursor(this.getCornerCursor(corner, target, e));\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    getCornerCursor: function(corner, target, e) {\r\n      var control = target.controls[corner];\r\n      return control.cursorStyleHandler(e, control, target);\r\n    }\r\n  });\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  var min = Math.min,\r\n      max = Math.max;\r\n\r\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object\r\n     * @param {fabric.Object} target\r\n     * @return {Boolean}\r\n     */\r\n    _shouldGroup: function(e, target) {\r\n      var activeObject = this._activeObject;\r\n      return activeObject && this._isSelectionKeyPressed(e) && target && target.selectable && this.selection &&\r\n            (activeObject !== target || activeObject.type === 'activeSelection') && !target.onSelect({ e: e });\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e Event object\r\n     * @param {fabric.Object} target\r\n     */\r\n    _handleGrouping: function (e, target) {\r\n      var activeObject = this._activeObject;\r\n      // avoid multi select when shift click on a corner\r\n      if (activeObject.__corner) {\r\n        return;\r\n      }\r\n      if (target === activeObject) {\r\n        // if it's a group, find target again, using activeGroup objects\r\n        target = this.findTarget(e, true);\r\n        // if even object is not found or we are on activeObjectCorner, bail out\r\n        if (!target || !target.selectable) {\r\n          return;\r\n        }\r\n      }\r\n      if (activeObject && activeObject.type === 'activeSelection') {\r\n        this._updateActiveSelection(target, e);\r\n      }\r\n      else {\r\n        this._createActiveSelection(target, e);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _updateActiveSelection: function(target, e) {\r\n      var activeSelection = this._activeObject,\r\n          currentActiveObjects = activeSelection._objects.slice(0);\r\n      if (activeSelection.contains(target)) {\r\n        activeSelection.removeWithUpdate(target);\r\n        this._hoveredTarget = target;\r\n        this._hoveredTargets = this.targets.concat();\r\n        if (activeSelection.size() === 1) {\r\n          // activate last remaining object\r\n          this._setActiveObject(activeSelection.item(0), e);\r\n        }\r\n      }\r\n      else {\r\n        activeSelection.addWithUpdate(target);\r\n        this._hoveredTarget = activeSelection;\r\n        this._hoveredTargets = this.targets.concat();\r\n      }\r\n      this._fireSelectionEvents(currentActiveObjects, e);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _createActiveSelection: function(target, e) {\r\n      var currentActives = this.getActiveObjects(), group = this._createGroup(target);\r\n      this._hoveredTarget = group;\r\n      // ISSUE 4115: should we consider subTargets here?\r\n      // this._hoveredTargets = [];\r\n      // this._hoveredTargets = this.targets.concat();\r\n      this._setActiveObject(group, e);\r\n      this._fireSelectionEvents(currentActives, e);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} target\r\n     */\r\n    _createGroup: function(target) {\r\n      var objects = this._objects,\r\n          isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target),\r\n          groupObjects = isActiveLower\r\n            ? [this._activeObject, target]\r\n            : [target, this._activeObject];\r\n      this._activeObject.isEditing && this._activeObject.exitEditing();\r\n      return new fabric.ActiveSelection(groupObjects, {\r\n        canvas: this\r\n      });\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Event} e mouse event\r\n     */\r\n    _groupSelectedObjects: function (e) {\r\n\r\n      var group = this._collectObjects(e),\r\n          aGroup;\r\n\r\n      // do not create group for 1 element only\r\n      if (group.length === 1) {\r\n        this.setActiveObject(group[0], e);\r\n      }\r\n      else if (group.length > 1) {\r\n        aGroup = new fabric.ActiveSelection(group.reverse(), {\r\n          canvas: this\r\n        });\r\n        this.setActiveObject(aGroup, e);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _collectObjects: function(e) {\r\n      var group = [],\r\n          currentObject,\r\n          x1 = this._groupSelector.ex,\r\n          y1 = this._groupSelector.ey,\r\n          x2 = x1 + this._groupSelector.left,\r\n          y2 = y1 + this._groupSelector.top,\r\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\r\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\r\n          allowIntersect = !this.selectionFullyContained,\r\n          isClick = x1 === x2 && y1 === y2;\r\n      // we iterate reverse order to collect top first in case of click.\r\n      for (var i = this._objects.length; i--; ) {\r\n        currentObject = this._objects[i];\r\n\r\n        if (!currentObject || !currentObject.selectable || !currentObject.visible) {\r\n          continue;\r\n        }\r\n\r\n        if ((allowIntersect && currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2, true)) ||\r\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2, true) ||\r\n            (allowIntersect && currentObject.containsPoint(selectionX1Y1, null, true)) ||\r\n            (allowIntersect && currentObject.containsPoint(selectionX2Y2, null, true))\r\n        ) {\r\n          group.push(currentObject);\r\n          // only add one object if it's a click\r\n          if (isClick) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (group.length > 1) {\r\n        group = group.filter(function(object) {\r\n          return !object.onSelect({ e: e });\r\n        });\r\n      }\r\n\r\n      return group;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _maybeGroupObjects: function(e) {\r\n      if (this.selection && this._groupSelector) {\r\n        this._groupSelectedObjects(e);\r\n      }\r\n      this.setCursor(this.defaultCursor);\r\n      // clear selection and current transformation\r\n      this._groupSelector = null;\r\n    }\r\n  });\r\n\r\n})();\r\n\r\n\r\n(function () {\r\n  fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\r\n\r\n    /**\r\n     * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\r\n     * @param {Object} [options] Options object\r\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\r\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\r\n     * @param {Number} [options.multiplier=1] Multiplier to scale by, to have consistent\r\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\r\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\r\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\r\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\r\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 2.0.0\r\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\r\n     * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\r\n     * @example <caption>Generate jpeg dataURL with lower quality</caption>\r\n     * var dataURL = canvas.toDataURL({\r\n     *   format: 'jpeg',\r\n     *   quality: 0.8\r\n     * });\r\n     * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\r\n     * var dataURL = canvas.toDataURL({\r\n     *   format: 'png',\r\n     *   left: 100,\r\n     *   top: 100,\r\n     *   width: 200,\r\n     *   height: 200\r\n     * });\r\n     * @example <caption>Generate double scaled png dataURL</caption>\r\n     * var dataURL = canvas.toDataURL({\r\n     *   format: 'png',\r\n     *   multiplier: 2\r\n     * });\r\n     */\r\n    toDataURL: function (options) {\r\n      options || (options = { });\r\n\r\n      var format = options.format || 'png',\r\n          quality = options.quality || 1,\r\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? this.getRetinaScaling() : 1),\r\n          canvasEl = this.toCanvasElement(multiplier, options);\r\n      return fabric.util.toDataURL(canvasEl, format, quality);\r\n    },\r\n\r\n    /**\r\n     * Create a new HTMLCanvas element painted with the current canvas content.\r\n     * No need to resize the actual one or repaint it.\r\n     * Will transfer object ownership to a new canvas, paint it, and set everything back.\r\n     * This is an intermediary step used to get to a dataUrl but also it is useful to\r\n     * create quick image copies of a canvas without passing for the dataUrl string\r\n     * @param {Number} [multiplier] a zoom factor.\r\n     * @param {Object} [cropping] Cropping informations\r\n     * @param {Number} [cropping.left] Cropping left offset.\r\n     * @param {Number} [cropping.top] Cropping top offset.\r\n     * @param {Number} [cropping.width] Cropping width.\r\n     * @param {Number} [cropping.height] Cropping height.\r\n     */\r\n    toCanvasElement: function(multiplier, cropping) {\r\n      multiplier = multiplier || 1;\r\n      cropping = cropping || { };\r\n      var scaledWidth = (cropping.width || this.width) * multiplier,\r\n          scaledHeight = (cropping.height || this.height) * multiplier,\r\n          zoom = this.getZoom(),\r\n          originalWidth = this.width,\r\n          originalHeight = this.height,\r\n          newZoom = zoom * multiplier,\r\n          vp = this.viewportTransform,\r\n          translateX = (vp[4] - (cropping.left || 0)) * multiplier,\r\n          translateY = (vp[5] - (cropping.top || 0)) * multiplier,\r\n          originalInteractive = this.interactive,\r\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\r\n          originalRetina = this.enableRetinaScaling,\r\n          canvasEl = fabric.util.createCanvasElement(),\r\n          originalContextTop = this.contextTop;\r\n      canvasEl.width = scaledWidth;\r\n      canvasEl.height = scaledHeight;\r\n      this.contextTop = null;\r\n      this.enableRetinaScaling = false;\r\n      this.interactive = false;\r\n      this.viewportTransform = newVp;\r\n      this.width = scaledWidth;\r\n      this.height = scaledHeight;\r\n      this.calcViewportBoundaries();\r\n      this.renderCanvas(canvasEl.getContext('2d'), this._objects);\r\n      this.viewportTransform = vp;\r\n      this.width = originalWidth;\r\n      this.height = originalHeight;\r\n      this.calcViewportBoundaries();\r\n      this.interactive = originalInteractive;\r\n      this.enableRetinaScaling = originalRetina;\r\n      this.contextTop = originalContextTop;\r\n      return canvasEl;\r\n    },\r\n  });\r\n\r\n})();\r\n\r\n\r\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\r\n  /**\r\n   * Populates canvas with data from the specified JSON.\r\n   * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\r\n   * @param {String|Object} json JSON string or object\r\n   * @param {Function} callback Callback, invoked when json is parsed\r\n   *                            and corresponding objects (e.g: {@link fabric.Image})\r\n   *                            are initialized\r\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\r\n   * @return {fabric.Canvas} instance\r\n   * @chainable\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\r\n   * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\r\n   * @example <caption>loadFromJSON</caption>\r\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\r\n   * @example <caption>loadFromJSON with reviver</caption>\r\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\r\n   *   // `o` = json object\r\n   *   // `object` = fabric.Object instance\r\n   *   // ... do some stuff ...\r\n   * });\r\n   */\r\n  loadFromJSON: function (json, callback, reviver) {\r\n    if (!json) {\r\n      return;\r\n    }\r\n\r\n    // serialize if it wasn't already\r\n    var serialized = (typeof json === 'string')\r\n      ? JSON.parse(json)\r\n      : fabric.util.object.clone(json);\r\n\r\n    var _this = this,\r\n        clipPath = serialized.clipPath,\r\n        renderOnAddRemove = this.renderOnAddRemove;\r\n\r\n    this.renderOnAddRemove = false;\r\n\r\n    delete serialized.clipPath;\r\n\r\n    this._enlivenObjects(serialized.objects, function (enlivenedObjects) {\r\n      _this.clear();\r\n      _this._setBgOverlay(serialized, function () {\r\n        if (clipPath) {\r\n          _this._enlivenObjects([clipPath], function (enlivenedCanvasClip) {\r\n            _this.clipPath = enlivenedCanvasClip[0];\r\n            _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\r\n          });\r\n        }\r\n        else {\r\n          _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\r\n        }\r\n      });\r\n    }, reviver);\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {Object} serialized Object with background and overlay information\r\n   * @param {Array} restored canvas objects\r\n   * @param {Function} cached renderOnAddRemove callback\r\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\r\n   */\r\n  __setupCanvas: function(serialized, enlivenedObjects, renderOnAddRemove, callback) {\r\n    var _this = this;\r\n    enlivenedObjects.forEach(function(obj, index) {\r\n      // we splice the array just in case some custom classes restored from JSON\r\n      // will add more object to canvas at canvas init.\r\n      _this.insertAt(obj, index);\r\n    });\r\n    this.renderOnAddRemove = renderOnAddRemove;\r\n    // remove parts i cannot set as options\r\n    delete serialized.objects;\r\n    delete serialized.backgroundImage;\r\n    delete serialized.overlayImage;\r\n    delete serialized.background;\r\n    delete serialized.overlay;\r\n    // this._initOptions does too many things to just\r\n    // call it. Normally loading an Object from JSON\r\n    // create the Object instance. Here the Canvas is\r\n    // already an instance and we are just loading things over it\r\n    this._setOptions(serialized);\r\n    this.renderAll();\r\n    callback && callback();\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {Object} serialized Object with background and overlay information\r\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\r\n   */\r\n  _setBgOverlay: function(serialized, callback) {\r\n    var loaded = {\r\n      backgroundColor: false,\r\n      overlayColor: false,\r\n      backgroundImage: false,\r\n      overlayImage: false\r\n    };\r\n\r\n    if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {\r\n      callback && callback();\r\n      return;\r\n    }\r\n\r\n    var cbIfLoaded = function () {\r\n      if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {\r\n        callback && callback();\r\n      }\r\n    };\r\n\r\n    this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);\r\n    this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);\r\n    this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);\r\n    this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\r\n   * @param {(Object|String)} value Value to set\r\n   * @param {Object} loaded Set loaded property to true if property is set\r\n   * @param {Object} callback Callback function to invoke after property is set\r\n   */\r\n  __setBgOverlay: function(property, value, loaded, callback) {\r\n    var _this = this;\r\n\r\n    if (!value) {\r\n      loaded[property] = true;\r\n      callback && callback();\r\n      return;\r\n    }\r\n\r\n    if (property === 'backgroundImage' || property === 'overlayImage') {\r\n      fabric.util.enlivenObjects([value], function(enlivedObject){\r\n        _this[property] = enlivedObject[0];\r\n        loaded[property] = true;\r\n        callback && callback();\r\n      });\r\n    }\r\n    else {\r\n      this['set' + fabric.util.string.capitalize(property, true)](value, function() {\r\n        loaded[property] = true;\r\n        callback && callback();\r\n      });\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {Array} objects\r\n   * @param {Function} callback\r\n   * @param {Function} [reviver]\r\n   */\r\n  _enlivenObjects: function (objects, callback, reviver) {\r\n    if (!objects || objects.length === 0) {\r\n      callback && callback([]);\r\n      return;\r\n    }\r\n\r\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\r\n      callback && callback(enlivenedObjects);\r\n    }, null, reviver);\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {String} format\r\n   * @param {Function} callback\r\n   */\r\n  _toDataURL: function (format, callback) {\r\n    this.clone(function (clone) {\r\n      callback(clone.toDataURL(format));\r\n    });\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {String} format\r\n   * @param {Number} multiplier\r\n   * @param {Function} callback\r\n   */\r\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\r\n    this.clone(function (clone) {\r\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Clones canvas instance\r\n   * @param {Object} [callback] Receives cloned instance as a first argument\r\n   * @param {Array} [properties] Array of properties to include in the cloned canvas and children\r\n   */\r\n  clone: function (callback, properties) {\r\n    var data = JSON.stringify(this.toJSON(properties));\r\n    this.cloneWithoutData(function(clone) {\r\n      clone.loadFromJSON(data, function() {\r\n        callback && callback(clone);\r\n      });\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Clones canvas instance without cloning existing data.\r\n   * This essentially copies canvas dimensions, clipping properties, etc.\r\n   * but leaves data empty (so that you can populate it with your own)\r\n   * @param {Object} [callback] Receives cloned instance as a first argument\r\n   */\r\n  cloneWithoutData: function(callback) {\r\n    var el = fabric.util.createCanvasElement();\r\n\r\n    el.width = this.width;\r\n    el.height = this.height;\r\n\r\n    var clone = new fabric.Canvas(el);\r\n    if (this.backgroundImage) {\r\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\r\n        clone.renderAll();\r\n        callback && callback(clone);\r\n      });\r\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\r\n      clone.backgroundImageStretch = this.backgroundImageStretch;\r\n    }\r\n    else {\r\n      callback && callback(clone);\r\n    }\r\n  }\r\n});\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      extend = fabric.util.object.extend,\r\n      clone = fabric.util.object.clone,\r\n      toFixed = fabric.util.toFixed,\r\n      capitalize = fabric.util.string.capitalize,\r\n      degreesToRadians = fabric.util.degreesToRadians,\r\n      objectCaching = !fabric.isLikelyNode,\r\n      ALIASING_LIMIT = 2;\r\n\r\n  if (fabric.Object) {\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Root object class from which all 2d shape classes inherit from\r\n   * @class fabric.Object\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\r\n   * @see {@link fabric.Object#initialize} for constructor definition\r\n   *\r\n   * @fires added\r\n   * @fires removed\r\n   *\r\n   * @fires selected\r\n   * @fires deselected\r\n   * @fires modified\r\n   * @fires modified\r\n   * @fires moved\r\n   * @fires scaled\r\n   * @fires rotated\r\n   * @fires skewed\r\n   *\r\n   * @fires rotating\r\n   * @fires scaling\r\n   * @fires moving\r\n   * @fires skewing\r\n   *\r\n   * @fires mousedown\r\n   * @fires mouseup\r\n   * @fires mouseover\r\n   * @fires mouseout\r\n   * @fires mousewheel\r\n   * @fires mousedblclick\r\n   *\r\n   * @fires dragover\r\n   * @fires dragenter\r\n   * @fires dragleave\r\n   * @fires drop\r\n   */\r\n  fabric.Object = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.Object.prototype */ {\r\n\r\n    /**\r\n     * Type of an object (rect, circle, path, etc.).\r\n     * Note that this property is meant to be read-only and not meant to be modified.\r\n     * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\r\n     * @type String\r\n     * @default\r\n     */\r\n    type:                     'object',\r\n\r\n    /**\r\n     * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\r\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\r\n     * @type String\r\n     * @default\r\n     */\r\n    originX:                  'left',\r\n\r\n    /**\r\n     * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\r\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\r\n     * @type String\r\n     * @default\r\n     */\r\n    originY:                  'top',\r\n\r\n    /**\r\n     * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\r\n     * @type Number\r\n     * @default\r\n     */\r\n    top:                      0,\r\n\r\n    /**\r\n     * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\r\n     * @type Number\r\n     * @default\r\n     */\r\n    left:                     0,\r\n\r\n    /**\r\n     * Object width\r\n     * @type Number\r\n     * @default\r\n     */\r\n    width:                    0,\r\n\r\n    /**\r\n     * Object height\r\n     * @type Number\r\n     * @default\r\n     */\r\n    height:                   0,\r\n\r\n    /**\r\n     * Object scale factor (horizontal)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    scaleX:                   1,\r\n\r\n    /**\r\n     * Object scale factor (vertical)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    scaleY:                   1,\r\n\r\n    /**\r\n     * When true, an object is rendered as flipped horizontally\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    flipX:                    false,\r\n\r\n    /**\r\n     * When true, an object is rendered as flipped vertically\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    flipY:                    false,\r\n\r\n    /**\r\n     * Opacity of an object\r\n     * @type Number\r\n     * @default\r\n     */\r\n    opacity:                  1,\r\n\r\n    /**\r\n     * Angle of rotation of an object (in degrees)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    angle:                    0,\r\n\r\n    /**\r\n     * Angle of skew on x axes of an object (in degrees)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    skewX:                    0,\r\n\r\n    /**\r\n     * Angle of skew on y axes of an object (in degrees)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    skewY:                    0,\r\n\r\n    /**\r\n     * Size of object's controlling corners (in pixels)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    cornerSize:               13,\r\n\r\n    /**\r\n     * Size of object's controlling corners when touch interaction is detected\r\n     * @type Number\r\n     * @default\r\n     */\r\n    touchCornerSize:               24,\r\n\r\n    /**\r\n     * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    transparentCorners:       true,\r\n\r\n    /**\r\n     * Default cursor value used when hovering over this object on canvas\r\n     * @type String\r\n     * @default\r\n     */\r\n    hoverCursor:              null,\r\n\r\n    /**\r\n     * Default cursor value used when moving this object on canvas\r\n     * @type String\r\n     * @default\r\n     */\r\n    moveCursor:               null,\r\n\r\n    /**\r\n     * Padding between object and its controlling borders (in pixels)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    padding:                  0,\r\n\r\n    /**\r\n     * Color of controlling borders of an object (when it's active)\r\n     * @type String\r\n     * @default\r\n     */\r\n    borderColor:              'rgb(178,204,255)',\r\n\r\n    /**\r\n     * Array specifying dash pattern of an object's borders (hasBorder must be true)\r\n     * @since 1.6.2\r\n     * @type Array\r\n     */\r\n    borderDashArray:          null,\r\n\r\n    /**\r\n     * Color of controlling corners of an object (when it's active)\r\n     * @type String\r\n     * @default\r\n     */\r\n    cornerColor:              'rgb(178,204,255)',\r\n\r\n    /**\r\n     * Color of controlling corners of an object (when it's active and transparentCorners false)\r\n     * @since 1.6.2\r\n     * @type String\r\n     * @default\r\n     */\r\n    cornerStrokeColor:        null,\r\n\r\n    /**\r\n     * Specify style of control, 'rect' or 'circle'\r\n     * @since 1.6.2\r\n     * @type String\r\n     */\r\n    cornerStyle:          'rect',\r\n\r\n    /**\r\n     * Array specifying dash pattern of an object's control (hasBorder must be true)\r\n     * @since 1.6.2\r\n     * @type Array\r\n     */\r\n    cornerDashArray:          null,\r\n\r\n    /**\r\n     * When true, this object will use center point as the origin of transformation\r\n     * when being scaled via the controls.\r\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\r\n     * @since 1.3.4\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    centeredScaling:          false,\r\n\r\n    /**\r\n     * When true, this object will use center point as the origin of transformation\r\n     * when being rotated via the controls.\r\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\r\n     * @since 1.3.4\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    centeredRotation:         true,\r\n\r\n    /**\r\n     * Color of object's fill\r\n     * takes css colors https://www.w3.org/TR/css-color-3/\r\n     * @type String\r\n     * @default\r\n     */\r\n    fill:                     'rgb(0,0,0)',\r\n\r\n    /**\r\n     * Fill rule used to fill an object\r\n     * accepted values are nonzero, evenodd\r\n     * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\r\n     * @type String\r\n     * @default\r\n     */\r\n    fillRule:                 'nonzero',\r\n\r\n    /**\r\n     * Composite rule used for canvas globalCompositeOperation\r\n     * @type String\r\n     * @default\r\n     */\r\n    globalCompositeOperation: 'source-over',\r\n\r\n    /**\r\n     * Background color of an object.\r\n     * takes css colors https://www.w3.org/TR/css-color-3/\r\n     * @type String\r\n     * @default\r\n     */\r\n    backgroundColor:          '',\r\n\r\n    /**\r\n     * Selection Background color of an object. colored layer behind the object when it is active.\r\n     * does not mix good with globalCompositeOperation methods.\r\n     * @type String\r\n     * @default\r\n     */\r\n    selectionBackgroundColor:          '',\r\n\r\n    /**\r\n     * When defined, an object is rendered via stroke and this property specifies its color\r\n     * takes css colors https://www.w3.org/TR/css-color-3/\r\n     * @type String\r\n     * @default\r\n     */\r\n    stroke:                   null,\r\n\r\n    /**\r\n     * Width of a stroke used to render this object\r\n     * @type Number\r\n     * @default\r\n     */\r\n    strokeWidth:              1,\r\n\r\n    /**\r\n     * Array specifying dash pattern of an object's stroke (stroke must be defined)\r\n     * @type Array\r\n     */\r\n    strokeDashArray:          null,\r\n\r\n    /**\r\n     * Line offset of an object's stroke\r\n     * @type Number\r\n     * @default\r\n     */\r\n    strokeDashOffset: 0,\r\n\r\n    /**\r\n     * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\r\n     * @type String\r\n     * @default\r\n     */\r\n    strokeLineCap:            'butt',\r\n\r\n    /**\r\n     * Corner style of an object's stroke (one of \"bevel\", \"round\", \"miter\")\r\n     * @type String\r\n     * @default\r\n     */\r\n    strokeLineJoin:           'miter',\r\n\r\n    /**\r\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\r\n     * @type Number\r\n     * @default\r\n     */\r\n    strokeMiterLimit:         4,\r\n\r\n    /**\r\n     * Shadow object representing shadow of this shape\r\n     * @type fabric.Shadow\r\n     * @default\r\n     */\r\n    shadow:                   null,\r\n\r\n    /**\r\n     * Opacity of object's controlling borders when object is active and moving\r\n     * @type Number\r\n     * @default\r\n     */\r\n    borderOpacityWhenMoving:  0.4,\r\n\r\n    /**\r\n     * Scale factor of object's controlling borders\r\n     * bigger number will make a thicker border\r\n     * border is 1, so this is basically a border thickness\r\n     * since there is no way to change the border itself.\r\n     * @type Number\r\n     * @default\r\n     */\r\n    borderScaleFactor:        1,\r\n\r\n    /**\r\n     * Minimum allowed scale value of an object\r\n     * @type Number\r\n     * @default\r\n     */\r\n    minScaleLimit:            0,\r\n\r\n    /**\r\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\r\n     * But events still fire on it.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    selectable:               true,\r\n\r\n    /**\r\n     * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    evented:                  true,\r\n\r\n    /**\r\n     * When set to `false`, an object is not rendered on canvas\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    visible:                  true,\r\n\r\n    /**\r\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    hasControls:              true,\r\n\r\n    /**\r\n     * When set to `false`, object's controlling borders are not rendered\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    hasBorders:               true,\r\n\r\n    /**\r\n     * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    perPixelTargetFind:       false,\r\n\r\n    /**\r\n     * When `false`, default object's values are not included in its serialization\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    includeDefaultValues:     true,\r\n\r\n    /**\r\n     * When `true`, object horizontal movement is locked\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    lockMovementX:            false,\r\n\r\n    /**\r\n     * When `true`, object vertical movement is locked\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    lockMovementY:            false,\r\n\r\n    /**\r\n     * When `true`, object rotation is locked\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    lockRotation:             false,\r\n\r\n    /**\r\n     * When `true`, object horizontal scaling is locked\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    lockScalingX:             false,\r\n\r\n    /**\r\n     * When `true`, object vertical scaling is locked\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    lockScalingY:             false,\r\n\r\n    /**\r\n     * When `true`, object horizontal skewing is locked\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    lockSkewingX:             false,\r\n\r\n    /**\r\n     * When `true`, object vertical skewing is locked\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    lockSkewingY:             false,\r\n\r\n    /**\r\n     * When `true`, object cannot be flipped by scaling into negative values\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    lockScalingFlip:          false,\r\n\r\n    /**\r\n     * When `true`, object is not exported in OBJECT/JSON\r\n     * @since 1.6.3\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    excludeFromExport:        false,\r\n\r\n    /**\r\n     * When `true`, object is cached on an additional canvas.\r\n     * When `false`, object is not cached unless necessary ( clipPath )\r\n     * default to true\r\n     * @since 1.7.0\r\n     * @type Boolean\r\n     * @default true\r\n     */\r\n    objectCaching:            objectCaching,\r\n\r\n    /**\r\n     * When `true`, object properties are checked for cache invalidation. In some particular\r\n     * situation you may want this to be disabled ( spray brush, very big, groups)\r\n     * or if your application does not allow you to modify properties for groups child you want\r\n     * to disable it for groups.\r\n     * default to false\r\n     * since 1.7.0\r\n     * @type Boolean\r\n     * @default false\r\n     */\r\n    statefullCache:            false,\r\n\r\n    /**\r\n     * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\r\n     * too much and will be redrawn with correct details at the end of scaling.\r\n     * this setting is performance and application dependant.\r\n     * default to true\r\n     * since 1.7.0\r\n     * @type Boolean\r\n     * @default true\r\n     */\r\n    noScaleCache:              true,\r\n\r\n    /**\r\n     * When `false`, the stoke width will scale with the object.\r\n     * When `true`, the stroke will always match the exact pixel size entered for stroke width.\r\n     * this Property does not work on Text classes or drawing call that uses strokeText,fillText methods\r\n     * default to false\r\n     * @since 2.6.0\r\n     * @type Boolean\r\n     * @default false\r\n     * @type Boolean\r\n     * @default false\r\n     */\r\n    strokeUniform:              false,\r\n\r\n    /**\r\n     * When set to `true`, object's cache will be rerendered next render call.\r\n     * since 1.7.0\r\n     * @type Boolean\r\n     * @default true\r\n     */\r\n    dirty:                true,\r\n\r\n    /**\r\n     * keeps the value of the last hovered corner during mouse move.\r\n     * 0 is no corner, or 'mt', 'ml', 'mtr' etc..\r\n     * It should be private, but there is no harm in using it as\r\n     * a read-only property.\r\n     * @type number|string|any\r\n     * @default 0\r\n     */\r\n    __corner: 0,\r\n\r\n    /**\r\n     * Determines if the fill or the stroke is drawn first (one of \"fill\" or \"stroke\")\r\n     * @type String\r\n     * @default\r\n     */\r\n    paintFirst:           'fill',\r\n\r\n    /**\r\n     * When 'down', object is set to active on mousedown/touchstart\r\n     * When 'up', object is set to active on mouseup/touchend\r\n     * Experimental. Let's see if this breaks anything before supporting officially\r\n     * @private\r\n     * since 4.4.0\r\n     * @type String\r\n     * @default 'down'\r\n     */\r\n    activeOn:           'down',\r\n\r\n    /**\r\n     * List of properties to consider when checking if state\r\n     * of an object is changed (fabric.Object#hasStateChanged)\r\n     * as well as for history (undo/redo) purposes\r\n     * @type Array\r\n     */\r\n    stateProperties: (\r\n      'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +\r\n      'stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit ' +\r\n      'angle opacity fill globalCompositeOperation shadow visible backgroundColor ' +\r\n      'skewX skewY fillRule paintFirst clipPath strokeUniform'\r\n    ).split(' '),\r\n\r\n    /**\r\n     * List of properties to consider when checking if cache needs refresh\r\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\r\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\r\n     * and refreshed at the next render\r\n     * @type Array\r\n     */\r\n    cacheProperties: (\r\n      'fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform' +\r\n      ' strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath'\r\n    ).split(' '),\r\n\r\n    /**\r\n     * List of properties to consider for animating colors.\r\n     * @type Array\r\n     */\r\n    colorProperties: (\r\n      'fill stroke backgroundColor'\r\n    ).split(' '),\r\n\r\n    /**\r\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\r\n     * the clipPath object gets used when the object has rendered, and the context is placed in the center\r\n     * of the object cacheCanvas.\r\n     * If you want 0,0 of a clipPath to align with an object center, use clipPath.originX/Y to 'center'\r\n     * @type fabric.Object\r\n     */\r\n    clipPath: undefined,\r\n\r\n    /**\r\n     * Meaningful ONLY when the object is used as clipPath.\r\n     * if true, the clipPath will make the object clip to the outside of the clipPath\r\n     * since 2.4.0\r\n     * @type boolean\r\n     * @default false\r\n     */\r\n    inverted: false,\r\n\r\n    /**\r\n     * Meaningful ONLY when the object is used as clipPath.\r\n     * if true, the clipPath will have its top and left relative to canvas, and will\r\n     * not be influenced by the object transform. This will make the clipPath relative\r\n     * to the canvas, but clipping just a particular object.\r\n     * WARNING this is beta, this feature may change or be renamed.\r\n     * since 2.4.0\r\n     * @type boolean\r\n     * @default false\r\n     */\r\n    absolutePositioned: false,\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} [options] Options object\r\n     */\r\n    initialize: function(options) {\r\n      if (options) {\r\n        this.setOptions(options);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Create a the canvas used to keep the cached copy of the object\r\n     * @private\r\n     */\r\n    _createCacheCanvas: function() {\r\n      this._cacheProperties = {};\r\n      this._cacheCanvas = fabric.util.createCanvasElement();\r\n      this._cacheContext = this._cacheCanvas.getContext('2d');\r\n      this._updateCacheCanvas();\r\n      // if canvas gets created, is empty, so dirty.\r\n      this.dirty = true;\r\n    },\r\n\r\n    /**\r\n     * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\r\n     * and each side do not cross fabric.cacheSideLimit\r\n     * those numbers are configurable so that you can get as much detail as you want\r\n     * making bargain with performances.\r\n     * @param {Object} dims\r\n     * @param {Object} dims.width width of canvas\r\n     * @param {Object} dims.height height of canvas\r\n     * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\r\n     * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\r\n     * @return {Object}.width width of canvas\r\n     * @return {Object}.height height of canvas\r\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\r\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\r\n     */\r\n    _limitCacheSize: function(dims) {\r\n      var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\r\n          width = dims.width, height = dims.height,\r\n          max = fabric.maxCacheSideLimit, min = fabric.minCacheSideLimit;\r\n      if (width <= max && height <= max && width * height <= perfLimitSizeTotal) {\r\n        if (width < min) {\r\n          dims.width = min;\r\n        }\r\n        if (height < min) {\r\n          dims.height = min;\r\n        }\r\n        return dims;\r\n      }\r\n      var ar = width / height, limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal),\r\n          capValue = fabric.util.capValue,\r\n          x = capValue(min, limitedDims.x, max),\r\n          y = capValue(min, limitedDims.y, max);\r\n      if (width > x) {\r\n        dims.zoomX /= width / x;\r\n        dims.width = x;\r\n        dims.capped = true;\r\n      }\r\n      if (height > y) {\r\n        dims.zoomY /= height / y;\r\n        dims.height = y;\r\n        dims.capped = true;\r\n      }\r\n      return dims;\r\n    },\r\n\r\n    /**\r\n     * Return the dimension and the zoom level needed to create a cache canvas\r\n     * big enough to host the object to be cached.\r\n     * @private\r\n     * @return {Object}.x width of object to be cached\r\n     * @return {Object}.y height of object to be cached\r\n     * @return {Object}.width width of canvas\r\n     * @return {Object}.height height of canvas\r\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\r\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\r\n     */\r\n    _getCacheCanvasDimensions: function() {\r\n      var objectScale = this.getTotalObjectScaling(),\r\n          // caculate dimensions without skewing\r\n          dim = this._getTransformedDimensions(0, 0),\r\n          neededX = dim.x * objectScale.scaleX / this.scaleX,\r\n          neededY = dim.y * objectScale.scaleY / this.scaleY;\r\n      return {\r\n        // for sure this ALIASING_LIMIT is slightly creating problem\r\n        // in situation in which the cache canvas gets an upper limit\r\n        // also objectScale contains already scaleX and scaleY\r\n        width: neededX + ALIASING_LIMIT,\r\n        height: neededY + ALIASING_LIMIT,\r\n        zoomX: objectScale.scaleX,\r\n        zoomY: objectScale.scaleY,\r\n        x: neededX,\r\n        y: neededY\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Update width and height of the canvas for cache\r\n     * returns true or false if canvas needed resize.\r\n     * @private\r\n     * @return {Boolean} true if the canvas has been resized\r\n     */\r\n    _updateCacheCanvas: function() {\r\n      var targetCanvas = this.canvas;\r\n      if (this.noScaleCache && targetCanvas && targetCanvas._currentTransform) {\r\n        var target = targetCanvas._currentTransform.target,\r\n            action = targetCanvas._currentTransform.action;\r\n        if (this === target && action.slice && action.slice(0, 5) === 'scale') {\r\n          return false;\r\n        }\r\n      }\r\n      var canvas = this._cacheCanvas,\r\n          dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\r\n          minCacheSize = fabric.minCacheSideLimit,\r\n          width = dims.width, height = dims.height, drawingWidth, drawingHeight,\r\n          zoomX = dims.zoomX, zoomY = dims.zoomY,\r\n          dimensionsChanged = width !== this.cacheWidth || height !== this.cacheHeight,\r\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\r\n          shouldRedraw = dimensionsChanged || zoomChanged,\r\n          additionalWidth = 0, additionalHeight = 0, shouldResizeCanvas = false;\r\n      if (dimensionsChanged) {\r\n        var canvasWidth = this._cacheCanvas.width,\r\n            canvasHeight = this._cacheCanvas.height,\r\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\r\n            sizeShrinking = (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\r\n              canvasWidth > minCacheSize && canvasHeight > minCacheSize;\r\n        shouldResizeCanvas = sizeGrowing || sizeShrinking;\r\n        if (sizeGrowing && !dims.capped && (width > minCacheSize || height > minCacheSize)) {\r\n          additionalWidth = width * 0.1;\r\n          additionalHeight = height * 0.1;\r\n        }\r\n      }\r\n      if (this instanceof fabric.Text && this.path) {\r\n        shouldRedraw = true;\r\n        shouldResizeCanvas = true;\r\n        additionalWidth += this.getHeightOfLine(0) * this.zoomX;\r\n        additionalHeight += this.getHeightOfLine(0) * this.zoomY;\r\n      }\r\n      if (shouldRedraw) {\r\n        if (shouldResizeCanvas) {\r\n          canvas.width = Math.ceil(width + additionalWidth);\r\n          canvas.height = Math.ceil(height + additionalHeight);\r\n        }\r\n        else {\r\n          this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\r\n          this._cacheContext.clearRect(0, 0, canvas.width, canvas.height);\r\n        }\r\n        drawingWidth = dims.x / 2;\r\n        drawingHeight = dims.y / 2;\r\n        this.cacheTranslationX = Math.round(canvas.width / 2 - drawingWidth) + drawingWidth;\r\n        this.cacheTranslationY = Math.round(canvas.height / 2 - drawingHeight) + drawingHeight;\r\n        this.cacheWidth = width;\r\n        this.cacheHeight = height;\r\n        this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY);\r\n        this._cacheContext.scale(zoomX, zoomY);\r\n        this.zoomX = zoomX;\r\n        this.zoomY = zoomY;\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Sets object's properties from options\r\n     * @param {Object} [options] Options object\r\n     */\r\n    setOptions: function(options) {\r\n      this._setOptions(options);\r\n      this._initGradient(options.fill, 'fill');\r\n      this._initGradient(options.stroke, 'stroke');\r\n      this._initPattern(options.fill, 'fill');\r\n      this._initPattern(options.stroke, 'stroke');\r\n    },\r\n\r\n    /**\r\n     * Transforms context when rendering an object\r\n     * @param {CanvasRenderingContext2D} ctx Context\r\n     */\r\n    transform: function(ctx) {\r\n      var needFullTransform = (this.group && !this.group._transformDone) ||\r\n         (this.group && this.canvas && ctx === this.canvas.contextTop);\r\n      var m = this.calcTransformMatrix(!needFullTransform);\r\n      ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\r\n    },\r\n\r\n    /**\r\n     * Returns an object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\r\n\r\n          object = {\r\n            type:                     this.type,\r\n            version:                  fabric.version,\r\n            originX:                  this.originX,\r\n            originY:                  this.originY,\r\n            left:                     toFixed(this.left, NUM_FRACTION_DIGITS),\r\n            top:                      toFixed(this.top, NUM_FRACTION_DIGITS),\r\n            width:                    toFixed(this.width, NUM_FRACTION_DIGITS),\r\n            height:                   toFixed(this.height, NUM_FRACTION_DIGITS),\r\n            fill:                     (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\r\n            stroke:                   (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,\r\n            strokeWidth:              toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\r\n            strokeDashArray:          this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray,\r\n            strokeLineCap:            this.strokeLineCap,\r\n            strokeDashOffset:         this.strokeDashOffset,\r\n            strokeLineJoin:           this.strokeLineJoin,\r\n            strokeUniform:            this.strokeUniform,\r\n            strokeMiterLimit:         toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),\r\n            scaleX:                   toFixed(this.scaleX, NUM_FRACTION_DIGITS),\r\n            scaleY:                   toFixed(this.scaleY, NUM_FRACTION_DIGITS),\r\n            angle:                    toFixed(this.angle, NUM_FRACTION_DIGITS),\r\n            flipX:                    this.flipX,\r\n            flipY:                    this.flipY,\r\n            opacity:                  toFixed(this.opacity, NUM_FRACTION_DIGITS),\r\n            shadow:                   (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,\r\n            visible:                  this.visible,\r\n            backgroundColor:          this.backgroundColor,\r\n            fillRule:                 this.fillRule,\r\n            paintFirst:               this.paintFirst,\r\n            globalCompositeOperation: this.globalCompositeOperation,\r\n            skewX:                    toFixed(this.skewX, NUM_FRACTION_DIGITS),\r\n            skewY:                    toFixed(this.skewY, NUM_FRACTION_DIGITS),\r\n          };\r\n\r\n      if (this.clipPath && !this.clipPath.excludeFromExport) {\r\n        object.clipPath = this.clipPath.toObject(propertiesToInclude);\r\n        object.clipPath.inverted = this.clipPath.inverted;\r\n        object.clipPath.absolutePositioned = this.clipPath.absolutePositioned;\r\n      }\r\n\r\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\r\n      if (!this.includeDefaultValues) {\r\n        object = this._removeDefaultValues(object);\r\n      }\r\n\r\n      return object;\r\n    },\r\n\r\n    /**\r\n     * Returns (dataless) object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toDatalessObject: function(propertiesToInclude) {\r\n      // will be overwritten by subclasses\r\n      return this.toObject(propertiesToInclude);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} object\r\n     */\r\n    _removeDefaultValues: function(object) {\r\n      var prototype = fabric.util.getKlass(object.type).prototype,\r\n          stateProperties = prototype.stateProperties;\r\n      stateProperties.forEach(function(prop) {\r\n        if (prop === 'left' || prop === 'top') {\r\n          return;\r\n        }\r\n        if (object[prop] === prototype[prop]) {\r\n          delete object[prop];\r\n        }\r\n        // basically a check for [] === []\r\n        if (Array.isArray(object[prop]) && Array.isArray(prototype[prop])\r\n          && object[prop].length === 0 && prototype[prop].length === 0) {\r\n          delete object[prop];\r\n        }\r\n      });\r\n\r\n      return object;\r\n    },\r\n\r\n    /**\r\n     * Returns a string representation of an instance\r\n     * @return {String}\r\n     */\r\n    toString: function() {\r\n      return '#<fabric.' + capitalize(this.type) + '>';\r\n    },\r\n\r\n    /**\r\n     * Return the object scale factor counting also the group scaling\r\n     * @return {Object} object with scaleX and scaleY properties\r\n     */\r\n    getObjectScaling: function() {\r\n      // if the object is a top level one, on the canvas, we go for simple aritmetic\r\n      // otherwise the complex method with angles will return approximations and decimals\r\n      // and will likely kill the cache when not needed\r\n      // https://github.com/fabricjs/fabric.js/issues/7157\r\n      if (!this.group) {\r\n        return {\r\n          scaleX: this.scaleX,\r\n          scaleY: this.scaleY,\r\n        };\r\n      }\r\n      // if we are inside a group total zoom calculation is complex, we defer to generic matrices\r\n      var options = fabric.util.qrDecompose(this.calcTransformMatrix());\r\n      return { scaleX: Math.abs(options.scaleX), scaleY: Math.abs(options.scaleY) };\r\n    },\r\n\r\n    /**\r\n     * Return the object scale factor counting also the group scaling, zoom and retina\r\n     * @return {Object} object with scaleX and scaleY properties\r\n     */\r\n    getTotalObjectScaling: function() {\r\n      var scale = this.getObjectScaling(), scaleX = scale.scaleX, scaleY = scale.scaleY;\r\n      if (this.canvas) {\r\n        var zoom = this.canvas.getZoom();\r\n        var retina = this.canvas.getRetinaScaling();\r\n        scaleX *= zoom * retina;\r\n        scaleY *= zoom * retina;\r\n      }\r\n      return { scaleX: scaleX, scaleY: scaleY };\r\n    },\r\n\r\n    /**\r\n     * Return the object opacity counting also the group property\r\n     * @return {Number}\r\n     */\r\n    getObjectOpacity: function() {\r\n      var opacity = this.opacity;\r\n      if (this.group) {\r\n        opacity *= this.group.getObjectOpacity();\r\n      }\r\n      return opacity;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} key\r\n     * @param {*} value\r\n     * @return {fabric.Object} thisArg\r\n     */\r\n    _set: function(key, value) {\r\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY'),\r\n          isChanged = this[key] !== value, groupNeedsUpdate = false;\r\n\r\n      if (shouldConstrainValue) {\r\n        value = this._constrainScale(value);\r\n      }\r\n      if (key === 'scaleX' && value < 0) {\r\n        this.flipX = !this.flipX;\r\n        value *= -1;\r\n      }\r\n      else if (key === 'scaleY' && value < 0) {\r\n        this.flipY = !this.flipY;\r\n        value *= -1;\r\n      }\r\n      else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {\r\n        value = new fabric.Shadow(value);\r\n      }\r\n      else if (key === 'dirty' && this.group) {\r\n        this.group.set('dirty', value);\r\n      }\r\n\r\n      this[key] = value;\r\n\r\n      if (isChanged) {\r\n        groupNeedsUpdate = this.group && this.group.isOnACache();\r\n        if (this.cacheProperties.indexOf(key) > -1) {\r\n          this.dirty = true;\r\n          groupNeedsUpdate && this.group.set('dirty', true);\r\n        }\r\n        else if (groupNeedsUpdate && this.stateProperties.indexOf(key) > -1) {\r\n          this.group.set('dirty', true);\r\n        }\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * This callback function is called by the parent group of an object every\r\n     * time a non-delegated property changes on the group. It is passed the key\r\n     * and value as parameters. Not adding in this function's signature to avoid\r\n     * Travis build error about unused variables.\r\n     */\r\n    setOnGroup: function() {\r\n      // implemented by sub-classes, as needed.\r\n    },\r\n\r\n    /**\r\n     * Retrieves viewportTransform from Object's canvas if possible\r\n     * @method getViewportTransform\r\n     * @memberOf fabric.Object.prototype\r\n     * @return {Array}\r\n     */\r\n    getViewportTransform: function() {\r\n      if (this.canvas && this.canvas.viewportTransform) {\r\n        return this.canvas.viewportTransform;\r\n      }\r\n      return fabric.iMatrix.concat();\r\n    },\r\n\r\n    /*\r\n     * @private\r\n     * return if the object would be visible in rendering\r\n     * @memberOf fabric.Object.prototype\r\n     * @return {Boolean}\r\n     */\r\n    isNotVisible: function() {\r\n      return this.opacity === 0 ||\r\n        (!this.width && !this.height && this.strokeWidth === 0) ||\r\n        !this.visible;\r\n    },\r\n\r\n    /**\r\n     * Renders an object on a specified context\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    render: function(ctx) {\r\n      // do not render if width/height are zeros or object is not visible\r\n      if (this.isNotVisible()) {\r\n        return;\r\n      }\r\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\r\n        return;\r\n      }\r\n      ctx.save();\r\n      this._setupCompositeOperation(ctx);\r\n      this.drawSelectionBackground(ctx);\r\n      this.transform(ctx);\r\n      this._setOpacity(ctx);\r\n      this._setShadow(ctx, this);\r\n      if (this.shouldCache()) {\r\n        this.renderCache();\r\n        this.drawCacheOnCanvas(ctx);\r\n      }\r\n      else {\r\n        this._removeCacheCanvas();\r\n        this.dirty = false;\r\n        this.drawObject(ctx);\r\n        if (this.objectCaching && this.statefullCache) {\r\n          this.saveState({ propertySet: 'cacheProperties' });\r\n        }\r\n      }\r\n      ctx.restore();\r\n    },\r\n\r\n    renderCache: function(options) {\r\n      options = options || {};\r\n      if (!this._cacheCanvas || !this._cacheContext) {\r\n        this._createCacheCanvas();\r\n      }\r\n      if (this.isCacheDirty()) {\r\n        this.statefullCache && this.saveState({ propertySet: 'cacheProperties' });\r\n        this.drawObject(this._cacheContext, options.forClipping);\r\n        this.dirty = false;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Remove cacheCanvas and its dimensions from the objects\r\n     */\r\n    _removeCacheCanvas: function() {\r\n      this._cacheCanvas = null;\r\n      this._cacheContext = null;\r\n      this.cacheWidth = 0;\r\n      this.cacheHeight = 0;\r\n    },\r\n\r\n    /**\r\n     * return true if the object will draw a stroke\r\n     * Does not consider text styles. This is just a shortcut used at rendering time\r\n     * We want it to be an approximation and be fast.\r\n     * wrote to avoid extra caching, it has to return true when stroke happens,\r\n     * can guess when it will not happen at 100% chance, does not matter if it misses\r\n     * some use case where the stroke is invisible.\r\n     * @since 3.0.0\r\n     * @returns Boolean\r\n     */\r\n    hasStroke: function() {\r\n      return this.stroke && this.stroke !== 'transparent' && this.strokeWidth !== 0;\r\n    },\r\n\r\n    /**\r\n     * return true if the object will draw a fill\r\n     * Does not consider text styles. This is just a shortcut used at rendering time\r\n     * We want it to be an approximation and be fast.\r\n     * wrote to avoid extra caching, it has to return true when fill happens,\r\n     * can guess when it will not happen at 100% chance, does not matter if it misses\r\n     * some use case where the fill is invisible.\r\n     * @since 3.0.0\r\n     * @returns Boolean\r\n     */\r\n    hasFill: function() {\r\n      return this.fill && this.fill !== 'transparent';\r\n    },\r\n\r\n    /**\r\n     * When set to `true`, force the object to have its own cache, even if it is inside a group\r\n     * it may be needed when your object behave in a particular way on the cache and always needs\r\n     * its own isolated canvas to render correctly.\r\n     * Created to be overridden\r\n     * since 1.7.12\r\n     * @returns Boolean\r\n     */\r\n    needsItsOwnCache: function() {\r\n      if (this.paintFirst === 'stroke' &&\r\n        this.hasFill() && this.hasStroke() && typeof this.shadow === 'object') {\r\n        return true;\r\n      }\r\n      if (this.clipPath) {\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Decide if the object should cache or not. Create its own cache level\r\n     * objectCaching is a global flag, wins over everything\r\n     * needsItsOwnCache should be used when the object drawing method requires\r\n     * a cache step. None of the fabric classes requires it.\r\n     * Generally you do not cache objects in groups because the group outside is cached.\r\n     * Read as: cache if is needed, or if the feature is enabled but we are not already caching.\r\n     * @return {Boolean}\r\n     */\r\n    shouldCache: function() {\r\n      this.ownCaching = this.needsItsOwnCache() || (\r\n        this.objectCaching &&\r\n        (!this.group || !this.group.isOnACache())\r\n      );\r\n      return this.ownCaching;\r\n    },\r\n\r\n    /**\r\n     * Check if this object or a child object will cast a shadow\r\n     * used by Group.shouldCache to know if child has a shadow recursively\r\n     * @return {Boolean}\r\n     */\r\n    willDrawShadow: function() {\r\n      return !!this.shadow && (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0);\r\n    },\r\n\r\n    /**\r\n     * Execute the drawing operation for an object clipPath\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {fabric.Object} clipPath\r\n     */\r\n    drawClipPathOnCache: function(ctx, clipPath) {\r\n      ctx.save();\r\n      // DEBUG: uncomment this line, comment the following\r\n      // ctx.globalAlpha = 0.4\r\n      if (clipPath.inverted) {\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n      }\r\n      else {\r\n        ctx.globalCompositeOperation = 'destination-in';\r\n      }\r\n      //ctx.scale(1 / 2, 1 / 2);\r\n      if (clipPath.absolutePositioned) {\r\n        var m = fabric.util.invertTransform(this.calcTransformMatrix());\r\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\r\n      }\r\n      clipPath.transform(ctx);\r\n      ctx.scale(1 / clipPath.zoomX, 1 / clipPath.zoomY);\r\n      ctx.drawImage(clipPath._cacheCanvas, -clipPath.cacheTranslationX, -clipPath.cacheTranslationY);\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * Execute the drawing operation for an object on a specified context\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    drawObject: function(ctx, forClipping) {\r\n      var originalFill = this.fill, originalStroke = this.stroke;\r\n      if (forClipping) {\r\n        this.fill = 'black';\r\n        this.stroke = '';\r\n        this._setClippingProperties(ctx);\r\n      }\r\n      else {\r\n        this._renderBackground(ctx);\r\n      }\r\n      this._render(ctx);\r\n      this._drawClipPath(ctx, this.clipPath);\r\n      this.fill = originalFill;\r\n      this.stroke = originalStroke;\r\n    },\r\n\r\n    /**\r\n     * Prepare clipPath state and cache and draw it on instance's cache\r\n     * @param {CanvasRenderingContext2D} ctx\r\n     * @param {fabric.Object} clipPath\r\n     */\r\n    _drawClipPath: function (ctx, clipPath) {\r\n      if (!clipPath) { return; }\r\n      // needed to setup a couple of variables\r\n      // path canvas gets overridden with this one.\r\n      // TODO find a better solution?\r\n      clipPath.canvas = this.canvas;\r\n      clipPath.shouldCache();\r\n      clipPath._transformDone = true;\r\n      clipPath.renderCache({ forClipping: true });\r\n      this.drawClipPathOnCache(ctx, clipPath);\r\n    },\r\n\r\n    /**\r\n     * Paint the cached copy of the object on the target context.\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    drawCacheOnCanvas: function(ctx) {\r\n      ctx.scale(1 / this.zoomX, 1 / this.zoomY);\r\n      ctx.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY);\r\n    },\r\n\r\n    /**\r\n     * Check if cache is dirty\r\n     * @param {Boolean} skipCanvas skip canvas checks because this object is painted\r\n     * on parent canvas.\r\n     */\r\n    isCacheDirty: function(skipCanvas) {\r\n      if (this.isNotVisible()) {\r\n        return false;\r\n      }\r\n      if (this._cacheCanvas && this._cacheContext && !skipCanvas && this._updateCacheCanvas()) {\r\n        // in this case the context is already cleared.\r\n        return true;\r\n      }\r\n      else {\r\n        if (this.dirty ||\r\n          (this.clipPath && this.clipPath.absolutePositioned) ||\r\n          (this.statefullCache && this.hasStateChanged('cacheProperties'))\r\n        ) {\r\n          if (this._cacheCanvas && this._cacheContext && !skipCanvas) {\r\n            var width = this.cacheWidth / this.zoomX;\r\n            var height = this.cacheHeight / this.zoomY;\r\n            this._cacheContext.clearRect(-width / 2, -height / 2, width, height);\r\n          }\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Draws a background for the object big as its untransformed dimensions\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderBackground: function(ctx) {\r\n      if (!this.backgroundColor) {\r\n        return;\r\n      }\r\n      var dim = this._getNonTransformedDimensions();\r\n      ctx.fillStyle = this.backgroundColor;\r\n\r\n      ctx.fillRect(\r\n        -dim.x / 2,\r\n        -dim.y / 2,\r\n        dim.x,\r\n        dim.y\r\n      );\r\n      // if there is background color no other shadows\r\n      // should be casted\r\n      this._removeShadow(ctx);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _setOpacity: function(ctx) {\r\n      if (this.group && !this.group._transformDone) {\r\n        ctx.globalAlpha = this.getObjectOpacity();\r\n      }\r\n      else {\r\n        ctx.globalAlpha *= this.opacity;\r\n      }\r\n    },\r\n\r\n    _setStrokeStyles: function(ctx, decl) {\r\n      var stroke = decl.stroke;\r\n      if (stroke) {\r\n        ctx.lineWidth = decl.strokeWidth;\r\n        ctx.lineCap = decl.strokeLineCap;\r\n        ctx.lineDashOffset = decl.strokeDashOffset;\r\n        ctx.lineJoin = decl.strokeLineJoin;\r\n        ctx.miterLimit = decl.strokeMiterLimit;\r\n        if (stroke.toLive) {\r\n          if (stroke.gradientUnits === 'percentage' || stroke.gradientTransform || stroke.patternTransform) {\r\n            // need to transform gradient in a pattern.\r\n            // this is a slow process. If you are hitting this codepath, and the object\r\n            // is not using caching, you should consider switching it on.\r\n            // we need a canvas as big as the current object caching canvas.\r\n            this._applyPatternForTransformedGradient(ctx, stroke);\r\n          }\r\n          else {\r\n            // is a simple gradient or pattern\r\n            ctx.strokeStyle = stroke.toLive(ctx, this);\r\n            this._applyPatternGradientTransform(ctx, stroke);\r\n          }\r\n        }\r\n        else {\r\n          // is a color\r\n          ctx.strokeStyle = decl.stroke;\r\n        }\r\n      }\r\n    },\r\n\r\n    _setFillStyles: function(ctx, decl) {\r\n      var fill = decl.fill;\r\n      if (fill) {\r\n        if (fill.toLive) {\r\n          ctx.fillStyle = fill.toLive(ctx, this);\r\n          this._applyPatternGradientTransform(ctx, decl.fill);\r\n        }\r\n        else {\r\n          ctx.fillStyle = fill;\r\n        }\r\n      }\r\n    },\r\n\r\n    _setClippingProperties: function(ctx) {\r\n      ctx.globalAlpha = 1;\r\n      ctx.strokeStyle = 'transparent';\r\n      ctx.fillStyle = '#000000';\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * Sets line dash\r\n     * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\r\n     * @param {Array} dashArray array representing dashes\r\n     */\r\n    _setLineDash: function(ctx, dashArray) {\r\n      if (!dashArray || dashArray.length === 0) {\r\n        return;\r\n      }\r\n      // Spec requires the concatenation of two copies the dash list when the number of elements is odd\r\n      if (1 & dashArray.length) {\r\n        dashArray.push.apply(dashArray, dashArray);\r\n      }\r\n      ctx.setLineDash(dashArray);\r\n    },\r\n\r\n    /**\r\n     * Renders controls and borders for the object\r\n     * the context here is not transformed\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {Object} [styleOverride] properties to override the object style\r\n     */\r\n    _renderControls: function(ctx, styleOverride) {\r\n      var vpt = this.getViewportTransform(),\r\n          matrix = this.calcTransformMatrix(),\r\n          options, drawBorders, drawControls;\r\n      styleOverride = styleOverride || { };\r\n      drawBorders = typeof styleOverride.hasBorders !== 'undefined' ? styleOverride.hasBorders : this.hasBorders;\r\n      drawControls = typeof styleOverride.hasControls !== 'undefined' ? styleOverride.hasControls : this.hasControls;\r\n      matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\r\n      options = fabric.util.qrDecompose(matrix);\r\n      ctx.save();\r\n      ctx.translate(options.translateX, options.translateY);\r\n      ctx.lineWidth = 1 * this.borderScaleFactor;\r\n      if (!this.group) {\r\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\r\n      }\r\n      if (this.flipX) {\r\n        options.angle -= 180;\r\n      }\r\n      ctx.rotate(degreesToRadians(this.group ? options.angle : this.angle));\r\n      if (styleOverride.forActiveSelection || this.group) {\r\n        drawBorders && this.drawBordersInGroup(ctx, options, styleOverride);\r\n      }\r\n      else {\r\n        drawBorders && this.drawBorders(ctx, styleOverride);\r\n      }\r\n      drawControls && this.drawControls(ctx, styleOverride);\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _setShadow: function(ctx) {\r\n      if (!this.shadow) {\r\n        return;\r\n      }\r\n\r\n      var shadow = this.shadow, canvas = this.canvas, scaling,\r\n          multX = (canvas && canvas.viewportTransform[0]) || 1,\r\n          multY = (canvas && canvas.viewportTransform[3]) || 1;\r\n      if (shadow.nonScaling) {\r\n        scaling = { scaleX: 1, scaleY: 1 };\r\n      }\r\n      else {\r\n        scaling = this.getObjectScaling();\r\n      }\r\n      if (canvas && canvas._isRetinaScaling()) {\r\n        multX *= fabric.devicePixelRatio;\r\n        multY *= fabric.devicePixelRatio;\r\n      }\r\n      ctx.shadowColor = shadow.color;\r\n      ctx.shadowBlur = shadow.blur * fabric.browserShadowBlurConstant *\r\n        (multX + multY) * (scaling.scaleX + scaling.scaleY) / 4;\r\n      ctx.shadowOffsetX = shadow.offsetX * multX * scaling.scaleX;\r\n      ctx.shadowOffsetY = shadow.offsetY * multY * scaling.scaleY;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _removeShadow: function(ctx) {\r\n      if (!this.shadow) {\r\n        return;\r\n      }\r\n\r\n      ctx.shadowColor = '';\r\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {Object} filler fabric.Pattern or fabric.Gradient\r\n     * @return {Object} offset.offsetX offset for text rendering\r\n     * @return {Object} offset.offsetY offset for text rendering\r\n     */\r\n    _applyPatternGradientTransform: function(ctx, filler) {\r\n      if (!filler || !filler.toLive) {\r\n        return { offsetX: 0, offsetY: 0 };\r\n      }\r\n      var t = filler.gradientTransform || filler.patternTransform;\r\n      var offsetX = -this.width / 2 + filler.offsetX || 0,\r\n          offsetY = -this.height / 2 + filler.offsetY || 0;\r\n\r\n      if (filler.gradientUnits === 'percentage') {\r\n        ctx.transform(this.width, 0, 0, this.height, offsetX, offsetY);\r\n      }\r\n      else {\r\n        ctx.transform(1, 0, 0, 1, offsetX, offsetY);\r\n      }\r\n      if (t) {\r\n        ctx.transform(t[0], t[1], t[2], t[3], t[4], t[5]);\r\n      }\r\n      return { offsetX: offsetX, offsetY: offsetY };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderPaintInOrder: function(ctx) {\r\n      if (this.paintFirst === 'stroke') {\r\n        this._renderStroke(ctx);\r\n        this._renderFill(ctx);\r\n      }\r\n      else {\r\n        this._renderFill(ctx);\r\n        this._renderStroke(ctx);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * function that actually render something on the context.\r\n     * empty here to allow Obects to work on tests to benchmark fabric functionalites\r\n     * not related to rendering\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(/* ctx */) {\r\n\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderFill: function(ctx) {\r\n      if (!this.fill) {\r\n        return;\r\n      }\r\n\r\n      ctx.save();\r\n      this._setFillStyles(ctx, this);\r\n      if (this.fillRule === 'evenodd') {\r\n        ctx.fill('evenodd');\r\n      }\r\n      else {\r\n        ctx.fill();\r\n      }\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderStroke: function(ctx) {\r\n      if (!this.stroke || this.strokeWidth === 0) {\r\n        return;\r\n      }\r\n\r\n      if (this.shadow && !this.shadow.affectStroke) {\r\n        this._removeShadow(ctx);\r\n      }\r\n\r\n      ctx.save();\r\n      if (this.strokeUniform && this.group) {\r\n        var scaling = this.getObjectScaling();\r\n        ctx.scale(1 / scaling.scaleX, 1 / scaling.scaleY);\r\n      }\r\n      else if (this.strokeUniform) {\r\n        ctx.scale(1 / this.scaleX, 1 / this.scaleY);\r\n      }\r\n      this._setLineDash(ctx, this.strokeDashArray);\r\n      this._setStrokeStyles(ctx, this);\r\n      ctx.stroke();\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * This function try to patch the missing gradientTransform on canvas gradients.\r\n     * transforming a context to transform the gradient, is going to transform the stroke too.\r\n     * we want to transform the gradient but not the stroke operation, so we create\r\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\r\n     * this method has drwabacks: is slow, is in low resolution, needs a patch for when the size\r\n     * is limited.\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {fabric.Gradient} filler a fabric gradient instance\r\n     */\r\n    _applyPatternForTransformedGradient: function(ctx, filler) {\r\n      var dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\r\n          pCanvas = fabric.util.createCanvasElement(), pCtx, retinaScaling = this.canvas.getRetinaScaling(),\r\n          width = dims.x / this.scaleX / retinaScaling, height = dims.y / this.scaleY / retinaScaling;\r\n      pCanvas.width = width;\r\n      pCanvas.height = height;\r\n      pCtx = pCanvas.getContext('2d');\r\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\r\n      pCtx.lineTo(0, height); pCtx.closePath();\r\n      pCtx.translate(width / 2, height / 2);\r\n      pCtx.scale(\r\n        dims.zoomX / this.scaleX / retinaScaling,\r\n        dims.zoomY / this.scaleY / retinaScaling\r\n      );\r\n      this._applyPatternGradientTransform(pCtx, filler);\r\n      pCtx.fillStyle = filler.toLive(ctx);\r\n      pCtx.fill();\r\n      ctx.translate(-this.width / 2 - this.strokeWidth / 2, -this.height / 2 - this.strokeWidth / 2);\r\n      ctx.scale(\r\n        retinaScaling * this.scaleX / dims.zoomX,\r\n        retinaScaling * this.scaleY / dims.zoomY\r\n      );\r\n      ctx.strokeStyle = pCtx.createPattern(pCanvas, 'no-repeat');\r\n    },\r\n\r\n    /**\r\n     * This function is an helper for svg import. it returns the center of the object in the svg\r\n     * untransformed coordinates\r\n     * @private\r\n     * @return {Object} center point from element coordinates\r\n     */\r\n    _findCenterFromElement: function() {\r\n      return { x: this.left + this.width / 2, y: this.top + this.height / 2 };\r\n    },\r\n\r\n    /**\r\n     * This function is an helper for svg import. it decompose the transformMatrix\r\n     * and assign properties to object.\r\n     * untransformed coordinates\r\n     * @private\r\n     * @chainable\r\n     */\r\n    _assignTransformMatrixProps: function() {\r\n      if (this.transformMatrix) {\r\n        var options = fabric.util.qrDecompose(this.transformMatrix);\r\n        this.flipX = false;\r\n        this.flipY = false;\r\n        this.set('scaleX', options.scaleX);\r\n        this.set('scaleY', options.scaleY);\r\n        this.angle = options.angle;\r\n        this.skewX = options.skewX;\r\n        this.skewY = 0;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * This function is an helper for svg import. it removes the transform matrix\r\n     * and set to object properties that fabricjs can handle\r\n     * @private\r\n     * @param {Object} preserveAspectRatioOptions\r\n     * @return {thisArg}\r\n     */\r\n    _removeTransformMatrix: function(preserveAspectRatioOptions) {\r\n      var center = this._findCenterFromElement();\r\n      if (this.transformMatrix) {\r\n        this._assignTransformMatrixProps();\r\n        center = fabric.util.transformPoint(center, this.transformMatrix);\r\n      }\r\n      this.transformMatrix = null;\r\n      if (preserveAspectRatioOptions) {\r\n        this.scaleX *= preserveAspectRatioOptions.scaleX;\r\n        this.scaleY *= preserveAspectRatioOptions.scaleY;\r\n        this.cropX = preserveAspectRatioOptions.cropX;\r\n        this.cropY = preserveAspectRatioOptions.cropY;\r\n        center.x += preserveAspectRatioOptions.offsetLeft;\r\n        center.y += preserveAspectRatioOptions.offsetTop;\r\n        this.width = preserveAspectRatioOptions.width;\r\n        this.height = preserveAspectRatioOptions.height;\r\n      }\r\n      this.setPositionByOrigin(center, 'center', 'center');\r\n    },\r\n\r\n    /**\r\n     * Clones an instance, using a callback method will work for every object.\r\n     * @param {Function} callback Callback is invoked with a clone as a first argument\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     */\r\n    clone: function(callback, propertiesToInclude) {\r\n      var objectForm = this.toObject(propertiesToInclude);\r\n      if (this.constructor.fromObject) {\r\n        this.constructor.fromObject(objectForm, callback);\r\n      }\r\n      else {\r\n        fabric.Object._fromObject('Object', objectForm, callback);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Creates an instance of fabric.Image out of an object\r\n     * makes use of toCanvasElement.\r\n     * Once this method was based on toDataUrl and loadImage, so it also had a quality\r\n     * and format option. toCanvasElement is faster and produce no loss of quality.\r\n     * If you need to get a real Jpeg or Png from an object, using toDataURL is the right way to do it.\r\n     * toCanvasElement and then toBlob from the obtained canvas is also a good option.\r\n     * This method is sync now, but still support the callback because we did not want to break.\r\n     * When fabricJS 5.0 will be planned, this will probably be changed to not have a callback.\r\n     * @param {Function} callback callback, invoked with an instance as a first argument\r\n     * @param {Object} [options] for clone as image, passed to toDataURL\r\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\r\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\r\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\r\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\r\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\r\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\r\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\r\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\r\n     * @return {fabric.Object} thisArg\r\n     */\r\n    cloneAsImage: function(callback, options) {\r\n      var canvasEl = this.toCanvasElement(options);\r\n      if (callback) {\r\n        callback(new fabric.Image(canvasEl));\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Converts an object into a HTMLCanvas element\r\n     * @param {Object} options Options object\r\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\r\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\r\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\r\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\r\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\r\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\r\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\r\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\r\n     * @return {HTMLCanvasElement} Returns DOM element <canvas> with the fabric.Object\r\n     */\r\n    toCanvasElement: function(options) {\r\n      options || (options = { });\r\n\r\n      var utils = fabric.util, origParams = utils.saveObjectTransform(this),\r\n          originalGroup = this.group,\r\n          originalShadow = this.shadow, abs = Math.abs,\r\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? fabric.devicePixelRatio : 1);\r\n      delete this.group;\r\n      if (options.withoutTransform) {\r\n        utils.resetObjectTransform(this);\r\n      }\r\n      if (options.withoutShadow) {\r\n        this.shadow = null;\r\n      }\r\n\r\n      var el = fabric.util.createCanvasElement(),\r\n          // skip canvas zoom and calculate with setCoords now.\r\n          boundingRect = this.getBoundingRect(true, true),\r\n          shadow = this.shadow, scaling,\r\n          shadowOffset = { x: 0, y: 0 }, shadowBlur,\r\n          width, height;\r\n\r\n      if (shadow) {\r\n        shadowBlur = shadow.blur;\r\n        if (shadow.nonScaling) {\r\n          scaling = { scaleX: 1, scaleY: 1 };\r\n        }\r\n        else {\r\n          scaling = this.getObjectScaling();\r\n        }\r\n        // consider non scaling shadow.\r\n        shadowOffset.x = 2 * Math.round(abs(shadow.offsetX) + shadowBlur) * (abs(scaling.scaleX));\r\n        shadowOffset.y = 2 * Math.round(abs(shadow.offsetY) + shadowBlur) * (abs(scaling.scaleY));\r\n      }\r\n      width = boundingRect.width + shadowOffset.x;\r\n      height = boundingRect.height + shadowOffset.y;\r\n      // if the current width/height is not an integer\r\n      // we need to make it so.\r\n      el.width = Math.ceil(width);\r\n      el.height = Math.ceil(height);\r\n      var canvas = new fabric.StaticCanvas(el, {\r\n        enableRetinaScaling: false,\r\n        renderOnAddRemove: false,\r\n        skipOffscreen: false,\r\n      });\r\n      if (options.format === 'jpeg') {\r\n        canvas.backgroundColor = '#fff';\r\n      }\r\n      this.setPositionByOrigin(new fabric.Point(canvas.width / 2, canvas.height / 2), 'center', 'center');\r\n\r\n      var originalCanvas = this.canvas;\r\n      canvas.add(this);\r\n      var canvasEl = canvas.toCanvasElement(multiplier || 1, options);\r\n      this.shadow = originalShadow;\r\n      this.set('canvas', originalCanvas);\r\n      if (originalGroup) {\r\n        this.group = originalGroup;\r\n      }\r\n      this.set(origParams).setCoords();\r\n      // canvas.dispose will call image.dispose that will nullify the elements\r\n      // since this canvas is a simple element for the process, we remove references\r\n      // to objects in this way in order to avoid object trashing.\r\n      canvas._objects = [];\r\n      canvas.dispose();\r\n      canvas = null;\r\n\r\n      return canvasEl;\r\n    },\r\n\r\n    /**\r\n     * Converts an object into a data-url-like string\r\n     * @param {Object} options Options object\r\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\r\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\r\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\r\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\r\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\r\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\r\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\r\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\r\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\r\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\r\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\r\n     */\r\n    toDataURL: function(options) {\r\n      options || (options = { });\r\n      return fabric.util.toDataURL(this.toCanvasElement(options), options.format || 'png', options.quality || 1);\r\n    },\r\n\r\n    /**\r\n     * Returns true if specified type is identical to the type of an instance\r\n     * @param {String} type Type to check against\r\n     * @return {Boolean}\r\n     */\r\n    isType: function(type) {\r\n      return arguments.length > 1 ? Array.from(arguments).includes(this.type) : this.type === type;\r\n    },\r\n\r\n    /**\r\n     * Returns complexity of an instance\r\n     * @return {Number} complexity of this instance (is 1 unless subclassed)\r\n     */\r\n    complexity: function() {\r\n      return 1;\r\n    },\r\n\r\n    /**\r\n     * Returns a JSON representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} JSON\r\n     */\r\n    toJSON: function(propertiesToInclude) {\r\n      // delegate, not alias\r\n      return this.toObject(propertiesToInclude);\r\n    },\r\n\r\n    /**\r\n     * Sets \"angle\" of an instance with centered rotation\r\n     * @param {Number} angle Angle value (in degrees)\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    rotate: function(angle) {\r\n      var shouldCenterOrigin = (this.originX !== 'center' || this.originY !== 'center') && this.centeredRotation;\r\n\r\n      if (shouldCenterOrigin) {\r\n        this._setOriginToCenter();\r\n      }\r\n\r\n      this.set('angle', angle);\r\n\r\n      if (shouldCenterOrigin) {\r\n        this._resetOrigin();\r\n      }\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Centers object horizontally on canvas to which it was added last.\r\n     * You might need to call `setCoords` on an object after centering, to update controls area.\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    centerH: function () {\r\n      this.canvas && this.canvas.centerObjectH(this);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Centers object horizontally on current viewport of canvas to which it was added last.\r\n     * You might need to call `setCoords` on an object after centering, to update controls area.\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    viewportCenterH: function () {\r\n      this.canvas && this.canvas.viewportCenterObjectH(this);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Centers object vertically on canvas to which it was added last.\r\n     * You might need to call `setCoords` on an object after centering, to update controls area.\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    centerV: function () {\r\n      this.canvas && this.canvas.centerObjectV(this);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Centers object vertically on current viewport of canvas to which it was added last.\r\n     * You might need to call `setCoords` on an object after centering, to update controls area.\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    viewportCenterV: function () {\r\n      this.canvas && this.canvas.viewportCenterObjectV(this);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Centers object vertically and horizontally on canvas to which is was added last\r\n     * You might need to call `setCoords` on an object after centering, to update controls area.\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    center: function () {\r\n      this.canvas && this.canvas.centerObject(this);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Centers object on current viewport of canvas to which it was added last.\r\n     * You might need to call `setCoords` on an object after centering, to update controls area.\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    viewportCenter: function () {\r\n      this.canvas && this.canvas.viewportCenterObject(this);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns coordinates of a pointer relative to an object\r\n     * @param {Event} e Event to operate upon\r\n     * @param {Object} [pointer] Pointer to operate upon (instead of event)\r\n     * @return {Object} Coordinates of a pointer (x, y)\r\n     */\r\n    getLocalPointer: function(e, pointer) {\r\n      pointer = pointer || this.canvas.getPointer(e);\r\n      var pClicked = new fabric.Point(pointer.x, pointer.y),\r\n          objectLeftTop = this._getLeftTopCoords();\r\n      if (this.angle) {\r\n        pClicked = fabric.util.rotatePoint(\r\n          pClicked, objectLeftTop, degreesToRadians(-this.angle));\r\n      }\r\n      return {\r\n        x: pClicked.x - objectLeftTop.x,\r\n        y: pClicked.y - objectLeftTop.y\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Sets canvas globalCompositeOperation for specific object\r\n     * custom composition operation for the particular object can be specified using globalCompositeOperation property\r\n     * @param {CanvasRenderingContext2D} ctx Rendering canvas context\r\n     */\r\n    _setupCompositeOperation: function (ctx) {\r\n      if (this.globalCompositeOperation) {\r\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * cancel instance's running animations\r\n     * override if necessary to dispose artifacts such as `clipPath`\r\n     */\r\n    dispose: function () {\r\n      if (fabric.runningAnimations) {\r\n        fabric.runningAnimations.cancelByTarget(this);\r\n      }\r\n    }\r\n  });\r\n\r\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Object);\r\n\r\n  extend(fabric.Object.prototype, fabric.Observable);\r\n\r\n  /**\r\n   * Defines the number of fraction digits to use when serializing object values.\r\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\r\n   * @static\r\n   * @memberOf fabric.Object\r\n   * @constant\r\n   * @type Number\r\n   */\r\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\r\n\r\n  /**\r\n   * Defines which properties should be enlivened from the object passed to {@link fabric.Object._fromObject}\r\n   * @static\r\n   * @memberOf fabric.Object\r\n   * @constant\r\n   * @type string[]\r\n   */\r\n  fabric.Object.ENLIVEN_PROPS = ['clipPath'];\r\n\r\n  fabric.Object._fromObject = function(className, object, callback, extraParam) {\r\n    var klass = fabric[className];\r\n    object = clone(object, true);\r\n    fabric.util.enlivenPatterns([object.fill, object.stroke], function(patterns) {\r\n      if (typeof patterns[0] !== 'undefined') {\r\n        object.fill = patterns[0];\r\n      }\r\n      if (typeof patterns[1] !== 'undefined') {\r\n        object.stroke = patterns[1];\r\n      }\r\n      fabric.util.enlivenObjectEnlivables(object, object, function () {\r\n        var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\r\n        callback && callback(instance);\r\n      });\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Unique id used internally when creating SVG elements\r\n   * @static\r\n   * @memberOf fabric.Object\r\n   * @type Number\r\n   */\r\n  fabric.Object.__uid = 0;\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function() {\r\n\r\n  var degreesToRadians = fabric.util.degreesToRadians,\r\n      originXOffset = {\r\n        left: -0.5,\r\n        center: 0,\r\n        right: 0.5\r\n      },\r\n      originYOffset = {\r\n        top: -0.5,\r\n        center: 0,\r\n        bottom: 0.5\r\n      };\r\n\r\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\r\n\r\n    /**\r\n     * Translates the coordinates from a set of origin to another (based on the object's dimensions)\r\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\r\n     * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\r\n     * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\r\n     * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\r\n     * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\r\n     * @return {fabric.Point}\r\n     */\r\n    translateToGivenOrigin: function(point, fromOriginX, fromOriginY, toOriginX, toOriginY) {\r\n      var x = point.x,\r\n          y = point.y,\r\n          offsetX, offsetY, dim;\r\n\r\n      if (typeof fromOriginX === 'string') {\r\n        fromOriginX = originXOffset[fromOriginX];\r\n      }\r\n      else {\r\n        fromOriginX -= 0.5;\r\n      }\r\n\r\n      if (typeof toOriginX === 'string') {\r\n        toOriginX = originXOffset[toOriginX];\r\n      }\r\n      else {\r\n        toOriginX -= 0.5;\r\n      }\r\n\r\n      offsetX = toOriginX - fromOriginX;\r\n\r\n      if (typeof fromOriginY === 'string') {\r\n        fromOriginY = originYOffset[fromOriginY];\r\n      }\r\n      else {\r\n        fromOriginY -= 0.5;\r\n      }\r\n\r\n      if (typeof toOriginY === 'string') {\r\n        toOriginY = originYOffset[toOriginY];\r\n      }\r\n      else {\r\n        toOriginY -= 0.5;\r\n      }\r\n\r\n      offsetY = toOriginY - fromOriginY;\r\n\r\n      if (offsetX || offsetY) {\r\n        dim = this._getTransformedDimensions();\r\n        x = point.x + offsetX * dim.x;\r\n        y = point.y + offsetY * dim.y;\r\n      }\r\n\r\n      return new fabric.Point(x, y);\r\n    },\r\n\r\n    /**\r\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\r\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\r\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\r\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\r\n     * @return {fabric.Point}\r\n     */\r\n    translateToCenterPoint: function(point, originX, originY) {\r\n      var p = this.translateToGivenOrigin(point, originX, originY, 'center', 'center');\r\n      if (this.angle) {\r\n        return fabric.util.rotatePoint(p, point, degreesToRadians(this.angle));\r\n      }\r\n      return p;\r\n    },\r\n\r\n    /**\r\n     * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\r\n     * @param {fabric.Point} center The point which corresponds to center of the object\r\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\r\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\r\n     * @return {fabric.Point}\r\n     */\r\n    translateToOriginPoint: function(center, originX, originY) {\r\n      var p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\r\n      if (this.angle) {\r\n        return fabric.util.rotatePoint(p, center, degreesToRadians(this.angle));\r\n      }\r\n      return p;\r\n    },\r\n\r\n    /**\r\n     * Returns the real center coordinates of the object\r\n     * @return {fabric.Point}\r\n     */\r\n    getCenterPoint: function() {\r\n      var leftTop = new fabric.Point(this.left, this.top);\r\n      return this.translateToCenterPoint(leftTop, this.originX, this.originY);\r\n    },\r\n\r\n    /**\r\n     * Returns the coordinates of the object based on center coordinates\r\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\r\n     * @return {fabric.Point}\r\n     */\r\n    // getOriginPoint: function(center) {\r\n    //   return this.translateToOriginPoint(center, this.originX, this.originY);\r\n    // },\r\n\r\n    /**\r\n     * Returns the coordinates of the object as if it has a different origin\r\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\r\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\r\n     * @return {fabric.Point}\r\n     */\r\n    getPointByOrigin: function(originX, originY) {\r\n      var center = this.getCenterPoint();\r\n      return this.translateToOriginPoint(center, originX, originY);\r\n    },\r\n\r\n    /**\r\n     * Returns the point in local coordinates\r\n     * @param {fabric.Point} point The point relative to the global coordinate system\r\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\r\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\r\n     * @return {fabric.Point}\r\n     */\r\n    toLocalPoint: function(point, originX, originY) {\r\n      var center = this.getCenterPoint(),\r\n          p, p2;\r\n\r\n      if (typeof originX !== 'undefined' && typeof originY !== 'undefined' ) {\r\n        p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\r\n      }\r\n      else {\r\n        p = new fabric.Point(this.left, this.top);\r\n      }\r\n\r\n      p2 = new fabric.Point(point.x, point.y);\r\n      if (this.angle) {\r\n        p2 = fabric.util.rotatePoint(p2, center, -degreesToRadians(this.angle));\r\n      }\r\n      return p2.subtractEquals(p);\r\n    },\r\n\r\n    /**\r\n     * Returns the point in global coordinates\r\n     * @param {fabric.Point} The point relative to the local coordinate system\r\n     * @return {fabric.Point}\r\n     */\r\n    // toGlobalPoint: function(point) {\r\n    //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\r\n    // },\r\n\r\n    /**\r\n     * Sets the position of the object taking into consideration the object's origin\r\n     * @param {fabric.Point} pos The new position of the object\r\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\r\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\r\n     * @return {void}\r\n     */\r\n    setPositionByOrigin: function(pos, originX, originY) {\r\n      var center = this.translateToCenterPoint(pos, originX, originY),\r\n          position = this.translateToOriginPoint(center, this.originX, this.originY);\r\n      this.set('left', position.x);\r\n      this.set('top', position.y);\r\n    },\r\n\r\n    /**\r\n     * @param {String} to One of 'left', 'center', 'right'\r\n     */\r\n    adjustPosition: function(to) {\r\n      var angle = degreesToRadians(this.angle),\r\n          hypotFull = this.getScaledWidth(),\r\n          xFull = fabric.util.cos(angle) * hypotFull,\r\n          yFull = fabric.util.sin(angle) * hypotFull,\r\n          offsetFrom, offsetTo;\r\n\r\n      //TODO: this function does not consider mixed situation like top, center.\r\n      if (typeof this.originX === 'string') {\r\n        offsetFrom = originXOffset[this.originX];\r\n      }\r\n      else {\r\n        offsetFrom = this.originX - 0.5;\r\n      }\r\n      if (typeof to === 'string') {\r\n        offsetTo = originXOffset[to];\r\n      }\r\n      else {\r\n        offsetTo = to - 0.5;\r\n      }\r\n      this.left += xFull * (offsetTo - offsetFrom);\r\n      this.top += yFull * (offsetTo - offsetFrom);\r\n      this.setCoords();\r\n      this.originX = to;\r\n    },\r\n\r\n    /**\r\n     * Sets the origin/position of the object to it's center point\r\n     * @private\r\n     * @return {void}\r\n     */\r\n    _setOriginToCenter: function() {\r\n      this._originalOriginX = this.originX;\r\n      this._originalOriginY = this.originY;\r\n\r\n      var center = this.getCenterPoint();\r\n\r\n      this.originX = 'center';\r\n      this.originY = 'center';\r\n\r\n      this.left = center.x;\r\n      this.top = center.y;\r\n    },\r\n\r\n    /**\r\n     * Resets the origin/position of the object to it's original origin\r\n     * @private\r\n     * @return {void}\r\n     */\r\n    _resetOrigin: function() {\r\n      var originPoint = this.translateToOriginPoint(\r\n        this.getCenterPoint(),\r\n        this._originalOriginX,\r\n        this._originalOriginY);\r\n\r\n      this.originX = this._originalOriginX;\r\n      this.originY = this._originalOriginY;\r\n\r\n      this.left = originPoint.x;\r\n      this.top = originPoint.y;\r\n\r\n      this._originalOriginX = null;\r\n      this._originalOriginY = null;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _getLeftTopCoords: function() {\r\n      return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');\r\n    },\r\n  });\r\n\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  function arrayFromCoords(coords) {\r\n    return [\r\n      new fabric.Point(coords.tl.x, coords.tl.y),\r\n      new fabric.Point(coords.tr.x, coords.tr.y),\r\n      new fabric.Point(coords.br.x, coords.br.y),\r\n      new fabric.Point(coords.bl.x, coords.bl.y)\r\n    ];\r\n  }\r\n\r\n  var util = fabric.util,\r\n      degreesToRadians = util.degreesToRadians,\r\n      multiplyMatrices = util.multiplyTransformMatrices,\r\n      transformPoint = util.transformPoint;\r\n\r\n  util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\r\n\r\n    /**\r\n     * Describe object's corner position in canvas element coordinates.\r\n     * properties are depending on control keys and padding the main controls.\r\n     * each property is an object with x, y and corner.\r\n     * The `corner` property contains in a similar manner the 4 points of the\r\n     * interactive area of the corner.\r\n     * The coordinates depends from the controls positionHandler and are used\r\n     * to draw and locate controls\r\n     * @memberOf fabric.Object.prototype\r\n     */\r\n    oCoords: null,\r\n\r\n    /**\r\n     * Describe object's corner position in canvas object absolute coordinates\r\n     * properties are tl,tr,bl,br and describe the four main corner.\r\n     * each property is an object with x, y, instance of Fabric.Point.\r\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\r\n     * skewX, skewY, angle, strokeWidth, top, left.\r\n     * Those coordinates are useful to understand where an object is. They get updated\r\n     * with oCoords but they do not need to be updated when zoom or panning change.\r\n     * The coordinates get updated with @method setCoords.\r\n     * You can calculate them without updating with @method calcACoords();\r\n     * @memberOf fabric.Object.prototype\r\n     */\r\n    aCoords: null,\r\n\r\n    /**\r\n     * Describe object's corner position in canvas element coordinates.\r\n     * includes padding. Used of object detection.\r\n     * set and refreshed with setCoords.\r\n     * @memberOf fabric.Object.prototype\r\n     */\r\n    lineCoords: null,\r\n\r\n    /**\r\n     * storage for object transform matrix\r\n     */\r\n    ownMatrixCache: null,\r\n\r\n    /**\r\n     * storage for object full transform matrix\r\n     */\r\n    matrixCache: null,\r\n\r\n    /**\r\n     * custom controls interface\r\n     * controls are added by default_controls.js\r\n     */\r\n    controls: { },\r\n\r\n    /**\r\n     * return correct set of coordinates for intersection\r\n     * this will return either aCoords or lineCoords.\r\n     * @param {Boolean} absolute will return aCoords if true or lineCoords\r\n     * @return {Object} {tl, tr, br, bl} points\r\n     */\r\n    _getCoords: function(absolute, calculate) {\r\n      if (calculate) {\r\n        return (absolute ? this.calcACoords() : this.calcLineCoords());\r\n      }\r\n      if (!this.aCoords || !this.lineCoords) {\r\n        this.setCoords(true);\r\n      }\r\n      return (absolute ? this.aCoords : this.lineCoords);\r\n    },\r\n\r\n    /**\r\n     * return correct set of coordinates for intersection\r\n     * this will return either aCoords or lineCoords.\r\n     * The coords are returned in an array.\r\n     * @return {Array} [tl, tr, br, bl] of points\r\n     */\r\n    getCoords: function(absolute, calculate) {\r\n      return arrayFromCoords(this._getCoords(absolute, calculate));\r\n    },\r\n\r\n    /**\r\n     * Checks if object intersects with an area formed by 2 points\r\n     * @param {Object} pointTL top-left point of area\r\n     * @param {Object} pointBR bottom-right point of area\r\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\r\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\r\n     * @return {Boolean} true if object intersects with an area formed by 2 points\r\n     */\r\n    intersectsWithRect: function(pointTL, pointBR, absolute, calculate) {\r\n      var coords = this.getCoords(absolute, calculate),\r\n          intersection = fabric.Intersection.intersectPolygonRectangle(\r\n            coords,\r\n            pointTL,\r\n            pointBR\r\n          );\r\n      return intersection.status === 'Intersection';\r\n    },\r\n\r\n    /**\r\n     * Checks if object intersects with another object\r\n     * @param {Object} other Object to test\r\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\r\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\r\n     * @return {Boolean} true if object intersects with another object\r\n     */\r\n    intersectsWithObject: function(other, absolute, calculate) {\r\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\r\n        this.getCoords(absolute, calculate),\r\n        other.getCoords(absolute, calculate)\r\n      );\r\n\r\n      return intersection.status === 'Intersection'\r\n        || other.isContainedWithinObject(this, absolute, calculate)\r\n        || this.isContainedWithinObject(other, absolute, calculate);\r\n    },\r\n\r\n    /**\r\n     * Checks if object is fully contained within area of another object\r\n     * @param {Object} other Object to test\r\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\r\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\r\n     * @return {Boolean} true if object is fully contained within area of another object\r\n     */\r\n    isContainedWithinObject: function(other, absolute, calculate) {\r\n      var points = this.getCoords(absolute, calculate),\r\n          otherCoords = absolute ? other.aCoords : other.lineCoords,\r\n          i = 0, lines = other._getImageLines(otherCoords);\r\n      for (; i < 4; i++) {\r\n        if (!other.containsPoint(points[i], lines)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * Checks if object is fully contained within area formed by 2 points\r\n     * @param {Object} pointTL top-left point of area\r\n     * @param {Object} pointBR bottom-right point of area\r\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\r\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\r\n     * @return {Boolean} true if object is fully contained within area formed by 2 points\r\n     */\r\n    isContainedWithinRect: function(pointTL, pointBR, absolute, calculate) {\r\n      var boundingRect = this.getBoundingRect(absolute, calculate);\r\n\r\n      return (\r\n        boundingRect.left >= pointTL.x &&\r\n        boundingRect.left + boundingRect.width <= pointBR.x &&\r\n        boundingRect.top >= pointTL.y &&\r\n        boundingRect.top + boundingRect.height <= pointBR.y\r\n      );\r\n    },\r\n\r\n    /**\r\n     * Checks if point is inside the object\r\n     * @param {fabric.Point} point Point to check against\r\n     * @param {Object} [lines] object returned from @method _getImageLines\r\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\r\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\r\n     * @return {Boolean} true if point is inside the object\r\n     */\r\n    containsPoint: function(point, lines, absolute, calculate) {\r\n      var coords = this._getCoords(absolute, calculate),\r\n          lines = lines || this._getImageLines(coords),\r\n          xPoints = this._findCrossPoints(point, lines);\r\n      // if xPoints is odd then point is inside the object\r\n      return (xPoints !== 0 && xPoints % 2 === 1);\r\n    },\r\n\r\n    /**\r\n     * Checks if object is contained within the canvas with current viewportTransform\r\n     * the check is done stopping at first point that appears on screen\r\n     * @param {Boolean} [calculate] use coordinates of current position instead of .aCoords\r\n     * @return {Boolean} true if object is fully or partially contained within canvas\r\n     */\r\n    isOnScreen: function(calculate) {\r\n      if (!this.canvas) {\r\n        return false;\r\n      }\r\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\r\n      var points = this.getCoords(true, calculate);\r\n      // if some point is on screen, the object is on screen.\r\n      if (points.some(function(point) {\r\n        return point.x <= pointBR.x && point.x >= pointTL.x &&\r\n        point.y <= pointBR.y && point.y >= pointTL.y;\r\n      })) {\r\n        return true;\r\n      }\r\n      // no points on screen, check intersection with absolute coordinates\r\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\r\n        return true;\r\n      }\r\n      return this._containsCenterOfCanvas(pointTL, pointBR, calculate);\r\n    },\r\n\r\n    /**\r\n     * Checks if the object contains the midpoint between canvas extremities\r\n     * Does not make sense outside the context of isOnScreen and isPartiallyOnScreen\r\n     * @private\r\n     * @param {Fabric.Point} pointTL Top Left point\r\n     * @param {Fabric.Point} pointBR Top Right point\r\n     * @param {Boolean} calculate use coordinates of current position instead of .oCoords\r\n     * @return {Boolean} true if the object contains the point\r\n     */\r\n    _containsCenterOfCanvas: function(pointTL, pointBR, calculate) {\r\n      // worst case scenario the object is so big that contains the screen\r\n      var centerPoint = { x: (pointTL.x + pointBR.x) / 2, y: (pointTL.y + pointBR.y) / 2 };\r\n      if (this.containsPoint(centerPoint, null, true, calculate)) {\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Checks if object is partially contained within the canvas with current viewportTransform\r\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\r\n     * @return {Boolean} true if object is partially contained within canvas\r\n     */\r\n    isPartiallyOnScreen: function(calculate) {\r\n      if (!this.canvas) {\r\n        return false;\r\n      }\r\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\r\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\r\n        return true;\r\n      }\r\n      var allPointsAreOutside = this.getCoords(true, calculate).every(function(point) {\r\n        return (point.x >= pointBR.x || point.x <= pointTL.x) &&\r\n        (point.y >= pointBR.y || point.y <= pointTL.y);\r\n      });\r\n      return allPointsAreOutside && this._containsCenterOfCanvas(pointTL, pointBR, calculate);\r\n    },\r\n\r\n    /**\r\n     * Method that returns an object with the object edges in it, given the coordinates of the corners\r\n     * @private\r\n     * @param {Object} oCoords Coordinates of the object corners\r\n     */\r\n    _getImageLines: function(oCoords) {\r\n\r\n      var lines = {\r\n        topline: {\r\n          o: oCoords.tl,\r\n          d: oCoords.tr\r\n        },\r\n        rightline: {\r\n          o: oCoords.tr,\r\n          d: oCoords.br\r\n        },\r\n        bottomline: {\r\n          o: oCoords.br,\r\n          d: oCoords.bl\r\n        },\r\n        leftline: {\r\n          o: oCoords.bl,\r\n          d: oCoords.tl\r\n        }\r\n      };\r\n\r\n      // // debugging\r\n      // if (this.canvas.contextTop) {\r\n      //   this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\r\n      //   this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\r\n      //\r\n      //   this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\r\n      //   this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\r\n      //\r\n      //   this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\r\n      //   this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\r\n      //\r\n      //   this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\r\n      //   this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\r\n      // }\r\n\r\n      return lines;\r\n    },\r\n\r\n    /**\r\n     * Helper method to determine how many cross points are between the 4 object edges\r\n     * and the horizontal line determined by a point on canvas\r\n     * @private\r\n     * @param {fabric.Point} point Point to check\r\n     * @param {Object} lines Coordinates of the object being evaluated\r\n     */\r\n    // remove yi, not used but left code here just in case.\r\n    _findCrossPoints: function(point, lines) {\r\n      var b1, b2, a1, a2, xi, // yi,\r\n          xcount = 0,\r\n          iLine;\r\n\r\n      for (var lineKey in lines) {\r\n        iLine = lines[lineKey];\r\n        // optimisation 1: line below point. no cross\r\n        if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {\r\n          continue;\r\n        }\r\n        // optimisation 2: line above point. no cross\r\n        if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {\r\n          continue;\r\n        }\r\n        // optimisation 3: vertical line case\r\n        if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {\r\n          xi = iLine.o.x;\r\n          // yi = point.y;\r\n        }\r\n        // calculate the intersection point\r\n        else {\r\n          b1 = 0;\r\n          b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\r\n          a1 = point.y - b1 * point.x;\r\n          a2 = iLine.o.y - b2 * iLine.o.x;\r\n\r\n          xi = -(a1 - a2) / (b1 - b2);\r\n          // yi = a1 + b1 * xi;\r\n        }\r\n        // dont count xi < point.x cases\r\n        if (xi >= point.x) {\r\n          xcount += 1;\r\n        }\r\n        // optimisation 4: specific for square images\r\n        if (xcount === 2) {\r\n          break;\r\n        }\r\n      }\r\n      return xcount;\r\n    },\r\n\r\n    /**\r\n     * Returns coordinates of object's bounding rectangle (left, top, width, height)\r\n     * the box is intended as aligned to axis of canvas.\r\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\r\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords / .aCoords\r\n     * @return {Object} Object with left, top, width, height properties\r\n     */\r\n    getBoundingRect: function(absolute, calculate) {\r\n      var coords = this.getCoords(absolute, calculate);\r\n      return util.makeBoundingBoxFromPoints(coords);\r\n    },\r\n\r\n    /**\r\n     * Returns width of an object's bounding box counting transformations\r\n     * before 2.0 it was named getWidth();\r\n     * @return {Number} width value\r\n     */\r\n    getScaledWidth: function() {\r\n      return this._getTransformedDimensions().x;\r\n    },\r\n\r\n    /**\r\n     * Returns height of an object bounding box counting transformations\r\n     * before 2.0 it was named getHeight();\r\n     * @return {Number} height value\r\n     */\r\n    getScaledHeight: function() {\r\n      return this._getTransformedDimensions().y;\r\n    },\r\n\r\n    /**\r\n     * Makes sure the scale is valid and modifies it if necessary\r\n     * @private\r\n     * @param {Number} value\r\n     * @return {Number}\r\n     */\r\n    _constrainScale: function(value) {\r\n      if (Math.abs(value) < this.minScaleLimit) {\r\n        if (value < 0) {\r\n          return -this.minScaleLimit;\r\n        }\r\n        else {\r\n          return this.minScaleLimit;\r\n        }\r\n      }\r\n      else if (value === 0) {\r\n        return 0.0001;\r\n      }\r\n      return value;\r\n    },\r\n\r\n    /**\r\n     * Scales an object (equally by x and y)\r\n     * @param {Number} value Scale factor\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    scale: function(value) {\r\n      this._set('scaleX', value);\r\n      this._set('scaleY', value);\r\n      return this.setCoords();\r\n    },\r\n\r\n    /**\r\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\r\n     * @param {Number} value New width value\r\n     * @param {Boolean} absolute ignore viewport\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    scaleToWidth: function(value, absolute) {\r\n      // adjust to bounding rect factor so that rotated shapes would fit as well\r\n      var boundingRectFactor = this.getBoundingRect(absolute).width / this.getScaledWidth();\r\n      return this.scale(value / this.width / boundingRectFactor);\r\n    },\r\n\r\n    /**\r\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\r\n     * @param {Number} value New height value\r\n     * @param {Boolean} absolute ignore viewport\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    scaleToHeight: function(value, absolute) {\r\n      // adjust to bounding rect factor so that rotated shapes would fit as well\r\n      var boundingRectFactor = this.getBoundingRect(absolute).height / this.getScaledHeight();\r\n      return this.scale(value / this.height / boundingRectFactor);\r\n    },\r\n\r\n    calcLineCoords: function() {\r\n      var vpt = this.getViewportTransform(),\r\n          padding = this.padding, angle = degreesToRadians(this.angle),\r\n          cos = util.cos(angle), sin = util.sin(angle),\r\n          cosP = cos * padding, sinP = sin * padding, cosPSinP = cosP + sinP,\r\n          cosPMinusSinP = cosP - sinP, aCoords = this.calcACoords();\r\n\r\n      var lineCoords = {\r\n        tl: transformPoint(aCoords.tl, vpt),\r\n        tr: transformPoint(aCoords.tr, vpt),\r\n        bl: transformPoint(aCoords.bl, vpt),\r\n        br: transformPoint(aCoords.br, vpt),\r\n      };\r\n\r\n      if (padding) {\r\n        lineCoords.tl.x -= cosPMinusSinP;\r\n        lineCoords.tl.y -= cosPSinP;\r\n        lineCoords.tr.x += cosPSinP;\r\n        lineCoords.tr.y -= cosPMinusSinP;\r\n        lineCoords.bl.x -= cosPSinP;\r\n        lineCoords.bl.y += cosPMinusSinP;\r\n        lineCoords.br.x += cosPMinusSinP;\r\n        lineCoords.br.y += cosPSinP;\r\n      }\r\n\r\n      return lineCoords;\r\n    },\r\n\r\n    calcOCoords: function() {\r\n      var rotateMatrix = this._calcRotateMatrix(),\r\n          translateMatrix = this._calcTranslateMatrix(),\r\n          vpt = this.getViewportTransform(),\r\n          startMatrix = multiplyMatrices(vpt, translateMatrix),\r\n          finalMatrix = multiplyMatrices(startMatrix, rotateMatrix),\r\n          finalMatrix = multiplyMatrices(finalMatrix, [1 / vpt[0], 0, 0, 1 / vpt[3], 0, 0]),\r\n          dim = this._calculateCurrentDimensions(),\r\n          coords = {};\r\n      this.forEachControl(function(control, key, fabricObject) {\r\n        coords[key] = control.positionHandler(dim, finalMatrix, fabricObject);\r\n      });\r\n\r\n      // debug code\r\n      // var canvas = this.canvas;\r\n      // setTimeout(function() {\r\n      //   canvas.contextTop.clearRect(0, 0, 700, 700);\r\n      //   canvas.contextTop.fillStyle = 'green';\r\n      //   Object.keys(coords).forEach(function(key) {\r\n      //     var control = coords[key];\r\n      //     canvas.contextTop.fillRect(control.x, control.y, 3, 3);\r\n      //   });\r\n      // }, 50);\r\n      return coords;\r\n    },\r\n\r\n    calcACoords: function() {\r\n      var rotateMatrix = this._calcRotateMatrix(),\r\n          translateMatrix = this._calcTranslateMatrix(),\r\n          finalMatrix = multiplyMatrices(translateMatrix, rotateMatrix),\r\n          dim = this._getTransformedDimensions(),\r\n          w = dim.x / 2, h = dim.y / 2;\r\n      return {\r\n        // corners\r\n        tl: transformPoint({ x: -w, y: -h }, finalMatrix),\r\n        tr: transformPoint({ x: w, y: -h }, finalMatrix),\r\n        bl: transformPoint({ x: -w, y: h }, finalMatrix),\r\n        br: transformPoint({ x: w, y: h }, finalMatrix)\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Sets corner and controls position coordinates based on current angle, width and height, left and top.\r\n     * oCoords are used to find the corners\r\n     * aCoords are used to quickly find an object on the canvas\r\n     * lineCoords are used to quickly find object during pointer events.\r\n     * See {@link https://github.com/fabricjs/fabric.js/wiki/When-to-call-setCoords} and {@link http://fabricjs.com/fabric-gotchas}\r\n     *\r\n     * @param {Boolean} [skipCorners] skip calculation of oCoords.\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    setCoords: function(skipCorners) {\r\n      this.aCoords = this.calcACoords();\r\n      // in case we are in a group, for how the inner group target check works,\r\n      // lineCoords are exactly aCoords. Since the vpt gets absorbed by the normalized pointer.\r\n      this.lineCoords = this.group ? this.aCoords : this.calcLineCoords();\r\n      if (skipCorners) {\r\n        return this;\r\n      }\r\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\r\n      this.oCoords = this.calcOCoords();\r\n      this._setCornerCoords && this._setCornerCoords();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * calculate rotation matrix of an object\r\n     * @return {Array} rotation matrix for the object\r\n     */\r\n    _calcRotateMatrix: function() {\r\n      return util.calcRotateMatrix(this);\r\n    },\r\n\r\n    /**\r\n     * calculate the translation matrix for an object transform\r\n     * @return {Array} rotation matrix for the object\r\n     */\r\n    _calcTranslateMatrix: function() {\r\n      var center = this.getCenterPoint();\r\n      return [1, 0, 0, 1, center.x, center.y];\r\n    },\r\n\r\n    transformMatrixKey: function(skipGroup) {\r\n      var sep = '_', prefix = '';\r\n      if (!skipGroup && this.group) {\r\n        prefix = this.group.transformMatrixKey(skipGroup) + sep;\r\n      };\r\n      return prefix + this.top + sep + this.left + sep + this.scaleX + sep + this.scaleY +\r\n        sep + this.skewX + sep + this.skewY + sep + this.angle + sep + this.originX + sep + this.originY +\r\n        sep + this.width + sep + this.height + sep + this.strokeWidth + this.flipX + this.flipY;\r\n    },\r\n\r\n    /**\r\n     * calculate transform matrix that represents the current transformations from the\r\n     * object's properties.\r\n     * @param {Boolean} [skipGroup] return transform matrix for object not counting parent transformations\r\n     * There are some situation in which this is useful to avoid the fake rotation.\r\n     * @return {Array} transform matrix for the object\r\n     */\r\n    calcTransformMatrix: function(skipGroup) {\r\n      var matrix = this.calcOwnMatrix();\r\n      if (skipGroup || !this.group) {\r\n        return matrix;\r\n      }\r\n      var key = this.transformMatrixKey(skipGroup), cache = this.matrixCache || (this.matrixCache = {});\r\n      if (cache.key === key) {\r\n        return cache.value;\r\n      }\r\n      if (this.group) {\r\n        matrix = multiplyMatrices(this.group.calcTransformMatrix(false), matrix);\r\n      }\r\n      cache.key = key;\r\n      cache.value = matrix;\r\n      return matrix;\r\n    },\r\n\r\n    /**\r\n     * calculate transform matrix that represents the current transformations from the\r\n     * object's properties, this matrix does not include the group transformation\r\n     * @return {Array} transform matrix for the object\r\n     */\r\n    calcOwnMatrix: function() {\r\n      var key = this.transformMatrixKey(true), cache = this.ownMatrixCache || (this.ownMatrixCache = {});\r\n      if (cache.key === key) {\r\n        return cache.value;\r\n      }\r\n      var tMatrix = this._calcTranslateMatrix(),\r\n          options = {\r\n            angle: this.angle,\r\n            translateX: tMatrix[4],\r\n            translateY: tMatrix[5],\r\n            scaleX: this.scaleX,\r\n            scaleY: this.scaleY,\r\n            skewX: this.skewX,\r\n            skewY: this.skewY,\r\n            flipX: this.flipX,\r\n            flipY: this.flipY,\r\n          };\r\n      cache.key = key;\r\n      cache.value = util.composeMatrix(options);\r\n      return cache.value;\r\n    },\r\n\r\n    /*\r\n     * Calculate object dimensions from its properties\r\n     * @private\r\n     * @return {Object} .x width dimension\r\n     * @return {Object} .y height dimension\r\n     */\r\n    _getNonTransformedDimensions: function() {\r\n      var strokeWidth = this.strokeWidth,\r\n          w = this.width + strokeWidth,\r\n          h = this.height + strokeWidth;\r\n      return { x: w, y: h };\r\n    },\r\n\r\n    /*\r\n     * Calculate object bounding box dimensions from its properties scale, skew.\r\n     * @param {Number} skewX, a value to override current skewX\r\n     * @param {Number} skewY, a value to override current skewY\r\n     * @private\r\n     * @return {Object} .x width dimension\r\n     * @return {Object} .y height dimension\r\n     */\r\n    _getTransformedDimensions: function(skewX, skewY) {\r\n      if (typeof skewX === 'undefined') {\r\n        skewX = this.skewX;\r\n      }\r\n      if (typeof skewY === 'undefined') {\r\n        skewY = this.skewY;\r\n      }\r\n      var dimensions, dimX, dimY,\r\n          noSkew = skewX === 0 && skewY === 0;\r\n\r\n      if (this.strokeUniform) {\r\n        dimX = this.width;\r\n        dimY = this.height;\r\n      }\r\n      else {\r\n        dimensions = this._getNonTransformedDimensions();\r\n        dimX = dimensions.x;\r\n        dimY = dimensions.y;\r\n      }\r\n      if (noSkew) {\r\n        return this._finalizeDimensions(dimX * this.scaleX, dimY * this.scaleY);\r\n      }\r\n      var bbox = util.sizeAfterTransform(dimX, dimY, {\r\n        scaleX: this.scaleX,\r\n        scaleY: this.scaleY,\r\n        skewX: skewX,\r\n        skewY: skewY,\r\n      });\r\n      return this._finalizeDimensions(bbox.x, bbox.y);\r\n    },\r\n\r\n    /*\r\n     * Calculate object bounding box dimensions from its properties scale, skew.\r\n     * @param Number width width of the bbox\r\n     * @param Number height height of the bbox\r\n     * @private\r\n     * @return {Object} .x finalized width dimension\r\n     * @return {Object} .y finalized height dimension\r\n     */\r\n    _finalizeDimensions: function(width, height) {\r\n      return this.strokeUniform ?\r\n        { x: width + this.strokeWidth, y: height + this.strokeWidth }\r\n        :\r\n        { x: width, y: height };\r\n    },\r\n\r\n    /*\r\n     * Calculate object dimensions for controls box, including padding and canvas zoom.\r\n     * and active selection\r\n     * private\r\n     */\r\n    _calculateCurrentDimensions: function()  {\r\n      var vpt = this.getViewportTransform(),\r\n          dim = this._getTransformedDimensions(),\r\n          p = transformPoint(dim, vpt, true);\r\n      return p.scalarAdd(2 * this.padding);\r\n    },\r\n  });\r\n})();\r\n\r\n\r\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\r\n\r\n  /**\r\n   * Moves an object to the bottom of the stack of drawn objects\r\n   * @return {fabric.Object} thisArg\r\n   * @chainable\r\n   */\r\n  sendToBack: function() {\r\n    if (this.group) {\r\n      fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\r\n    }\r\n    else if (this.canvas) {\r\n      this.canvas.sendToBack(this);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Moves an object to the top of the stack of drawn objects\r\n   * @return {fabric.Object} thisArg\r\n   * @chainable\r\n   */\r\n  bringToFront: function() {\r\n    if (this.group) {\r\n      fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\r\n    }\r\n    else if (this.canvas) {\r\n      this.canvas.bringToFront(this);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Moves an object down in stack of drawn objects\r\n   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\r\n   * @return {fabric.Object} thisArg\r\n   * @chainable\r\n   */\r\n  sendBackwards: function(intersecting) {\r\n    if (this.group) {\r\n      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);\r\n    }\r\n    else if (this.canvas) {\r\n      this.canvas.sendBackwards(this, intersecting);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Moves an object up in stack of drawn objects\r\n   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\r\n   * @return {fabric.Object} thisArg\r\n   * @chainable\r\n   */\r\n  bringForward: function(intersecting) {\r\n    if (this.group) {\r\n      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);\r\n    }\r\n    else if (this.canvas) {\r\n      this.canvas.bringForward(this, intersecting);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Moves an object to specified level in stack of drawn objects\r\n   * @param {Number} index New position of object\r\n   * @return {fabric.Object} thisArg\r\n   * @chainable\r\n   */\r\n  moveTo: function(index) {\r\n    if (this.group && this.group.type !== 'activeSelection') {\r\n      fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\r\n    }\r\n    else if (this.canvas) {\r\n      this.canvas.moveTo(this, index);\r\n    }\r\n    return this;\r\n  }\r\n});\r\n\r\n\r\n/* _TO_SVG_START_ */\r\n(function() {\r\n  function getSvgColorString(prop, value) {\r\n    if (!value) {\r\n      return prop + ': none; ';\r\n    }\r\n    else if (value.toLive) {\r\n      return prop + ': url(#SVGID_' + value.id + '); ';\r\n    }\r\n    else {\r\n      var color = new fabric.Color(value),\r\n          str = prop + ': ' + color.toRgb() + '; ',\r\n          opacity = color.getAlpha();\r\n      if (opacity !== 1) {\r\n        //change the color in rgb + opacity\r\n        str += prop + '-opacity: ' + opacity.toString() + '; ';\r\n      }\r\n      return str;\r\n    }\r\n  }\r\n\r\n  var toFixed = fabric.util.toFixed;\r\n\r\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\r\n    /**\r\n     * Returns styles-string for svg-export\r\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\r\n     * @return {String}\r\n     */\r\n    getSvgStyles: function(skipShadow) {\r\n\r\n      var fillRule = this.fillRule ? this.fillRule : 'nonzero',\r\n          strokeWidth = this.strokeWidth ? this.strokeWidth : '0',\r\n          strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : 'none',\r\n          strokeDashOffset = this.strokeDashOffset ? this.strokeDashOffset : '0',\r\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt',\r\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter',\r\n          strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4',\r\n          opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1',\r\n          visibility = this.visible ? '' : ' visibility: hidden;',\r\n          filter = skipShadow ? '' : this.getSvgFilter(),\r\n          fill = getSvgColorString('fill', this.fill),\r\n          stroke = getSvgColorString('stroke', this.stroke);\r\n\r\n      return [\r\n        stroke,\r\n        'stroke-width: ', strokeWidth, '; ',\r\n        'stroke-dasharray: ', strokeDashArray, '; ',\r\n        'stroke-linecap: ', strokeLineCap, '; ',\r\n        'stroke-dashoffset: ', strokeDashOffset, '; ',\r\n        'stroke-linejoin: ', strokeLineJoin, '; ',\r\n        'stroke-miterlimit: ', strokeMiterLimit, '; ',\r\n        fill,\r\n        'fill-rule: ', fillRule, '; ',\r\n        'opacity: ', opacity, ';',\r\n        filter,\r\n        visibility\r\n      ].join('');\r\n    },\r\n\r\n    /**\r\n     * Returns styles-string for svg-export\r\n     * @param {Object} style the object from which to retrieve style properties\r\n     * @param {Boolean} useWhiteSpace a boolean to include an additional attribute in the style.\r\n     * @return {String}\r\n     */\r\n    getSvgSpanStyles: function(style, useWhiteSpace) {\r\n      var term = '; ';\r\n      var fontFamily = style.fontFamily ?\r\n        'font-family: ' + (((style.fontFamily.indexOf('\\'') === -1 && style.fontFamily.indexOf('\"') === -1) ?\r\n          '\\'' + style.fontFamily  + '\\'' : style.fontFamily)) + term : '';\r\n      var strokeWidth = style.strokeWidth ? 'stroke-width: ' + style.strokeWidth + term : '',\r\n          fontFamily = fontFamily,\r\n          fontSize = style.fontSize ? 'font-size: ' + style.fontSize + 'px' + term : '',\r\n          fontStyle = style.fontStyle ? 'font-style: ' + style.fontStyle + term : '',\r\n          fontWeight = style.fontWeight ? 'font-weight: ' + style.fontWeight + term : '',\r\n          fill = style.fill ? getSvgColorString('fill', style.fill) : '',\r\n          stroke = style.stroke ? getSvgColorString('stroke', style.stroke) : '',\r\n          textDecoration = this.getSvgTextDecoration(style),\r\n          deltaY = style.deltaY ? 'baseline-shift: ' + (-style.deltaY) + '; ' : '';\r\n      if (textDecoration) {\r\n        textDecoration = 'text-decoration: ' + textDecoration + term;\r\n      }\r\n\r\n      return [\r\n        stroke,\r\n        strokeWidth,\r\n        fontFamily,\r\n        fontSize,\r\n        fontStyle,\r\n        fontWeight,\r\n        textDecoration,\r\n        fill,\r\n        deltaY,\r\n        useWhiteSpace ? 'white-space: pre; ' : ''\r\n      ].join('');\r\n    },\r\n\r\n    /**\r\n     * Returns text-decoration property for svg-export\r\n     * @param {Object} style the object from which to retrieve style properties\r\n     * @return {String}\r\n     */\r\n    getSvgTextDecoration: function(style) {\r\n      return ['overline', 'underline', 'line-through'].filter(function(decoration) {\r\n        return style[decoration.replace('-', '')];\r\n      }).join(' ');\r\n    },\r\n\r\n    /**\r\n     * Returns filter for svg shadow\r\n     * @return {String}\r\n     */\r\n    getSvgFilter: function() {\r\n      return this.shadow ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';\r\n    },\r\n\r\n    /**\r\n     * Returns id attribute for svg output\r\n     * @return {String}\r\n     */\r\n    getSvgCommons: function() {\r\n      return [\r\n        this.id ? 'id=\"' + this.id + '\" ' : '',\r\n        this.clipPath ? 'clip-path=\"url(#' + this.clipPath.clipPathId + ')\" ' : '',\r\n      ].join('');\r\n    },\r\n\r\n    /**\r\n     * Returns transform-string for svg-export\r\n     * @param {Boolean} use the full transform or the single object one.\r\n     * @return {String}\r\n     */\r\n    getSvgTransform: function(full, additionalTransform) {\r\n      var transform = full ? this.calcTransformMatrix() : this.calcOwnMatrix(),\r\n          svgTransform = 'transform=\"' + fabric.util.matrixToSVG(transform);\r\n      return svgTransform +\r\n        (additionalTransform || '') + '\" ';\r\n    },\r\n\r\n    _setSVGBg: function(textBgRects) {\r\n      if (this.backgroundColor) {\r\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\r\n        textBgRects.push(\r\n          '\\t\\t<rect ',\r\n          this._getFillAttributes(this.backgroundColor),\r\n          ' x=\"',\r\n          toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\r\n          '\" y=\"',\r\n          toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\r\n          '\" width=\"',\r\n          toFixed(this.width, NUM_FRACTION_DIGITS),\r\n          '\" height=\"',\r\n          toFixed(this.height, NUM_FRACTION_DIGITS),\r\n          '\"></rect>\\n');\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @param {Function} [reviver] Method for further parsing of svg representation.\r\n     * @return {String} svg representation of an instance\r\n     */\r\n    toSVG: function(reviver) {\r\n      return this._createBaseSVGMarkup(this._toSVG(reviver), { reviver: reviver });\r\n    },\r\n\r\n    /**\r\n     * Returns svg clipPath representation of an instance\r\n     * @param {Function} [reviver] Method for further parsing of svg representation.\r\n     * @return {String} svg representation of an instance\r\n     */\r\n    toClipPathSVG: function(reviver) {\r\n      return '\\t' + this._createBaseClipPathSVGMarkup(this._toSVG(reviver), { reviver: reviver });\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _createBaseClipPathSVGMarkup: function(objectMarkup, options) {\r\n      options = options || {};\r\n      var reviver = options.reviver,\r\n          additionalTransform = options.additionalTransform || '',\r\n          commonPieces = [\r\n            this.getSvgTransform(true, additionalTransform),\r\n            this.getSvgCommons(),\r\n          ].join(''),\r\n          // insert commons in the markup, style and svgCommons\r\n          index = objectMarkup.indexOf('COMMON_PARTS');\r\n      objectMarkup[index] = commonPieces;\r\n      return reviver ? reviver(objectMarkup.join('')) : objectMarkup.join('');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _createBaseSVGMarkup: function(objectMarkup, options) {\r\n      options = options || {};\r\n      var noStyle = options.noStyle,\r\n          reviver = options.reviver,\r\n          styleInfo = noStyle ? '' : 'style=\"' + this.getSvgStyles() + '\" ',\r\n          shadowInfo = options.withShadow ? 'style=\"' + this.getSvgFilter() + '\" ' : '',\r\n          clipPath = this.clipPath,\r\n          vectorEffect = this.strokeUniform ? 'vector-effect=\"non-scaling-stroke\" ' : '',\r\n          absoluteClipPath = clipPath && clipPath.absolutePositioned,\r\n          stroke = this.stroke, fill = this.fill, shadow = this.shadow,\r\n          commonPieces, markup = [], clipPathMarkup,\r\n          // insert commons in the markup, style and svgCommons\r\n          index = objectMarkup.indexOf('COMMON_PARTS'),\r\n          additionalTransform = options.additionalTransform;\r\n      if (clipPath) {\r\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\r\n        clipPathMarkup = '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\r\n          clipPath.toClipPathSVG(reviver) +\r\n          '</clipPath>\\n';\r\n      }\r\n      if (absoluteClipPath) {\r\n        markup.push(\r\n          '<g ', shadowInfo, this.getSvgCommons(), ' >\\n'\r\n        );\r\n      }\r\n      markup.push(\r\n        '<g ',\r\n        this.getSvgTransform(false),\r\n        !absoluteClipPath ? shadowInfo + this.getSvgCommons() : '',\r\n        ' >\\n'\r\n      );\r\n      commonPieces = [\r\n        styleInfo,\r\n        vectorEffect,\r\n        noStyle ? '' : this.addPaintOrder(), ' ',\r\n        additionalTransform ? 'transform=\"' + additionalTransform + '\" ' : '',\r\n      ].join('');\r\n      objectMarkup[index] = commonPieces;\r\n      if (fill && fill.toLive) {\r\n        markup.push(fill.toSVG(this));\r\n      }\r\n      if (stroke && stroke.toLive) {\r\n        markup.push(stroke.toSVG(this));\r\n      }\r\n      if (shadow) {\r\n        markup.push(shadow.toSVG(this));\r\n      }\r\n      if (clipPath) {\r\n        markup.push(clipPathMarkup);\r\n      }\r\n      markup.push(objectMarkup.join(''));\r\n      markup.push('</g>\\n');\r\n      absoluteClipPath && markup.push('</g>\\n');\r\n      return reviver ? reviver(markup.join('')) : markup.join('');\r\n    },\r\n\r\n    addPaintOrder: function() {\r\n      return this.paintFirst !== 'fill' ? ' paint-order=\"' + this.paintFirst + '\" ' : '';\r\n    }\r\n  });\r\n})();\r\n/* _TO_SVG_END_ */\r\n\r\n\r\n(function() {\r\n\r\n  var extend = fabric.util.object.extend,\r\n      originalSet = 'stateProperties';\r\n\r\n  /*\r\n    Depends on `stateProperties`\r\n  */\r\n  function saveProps(origin, destination, props) {\r\n    var tmpObj = { }, deep = true;\r\n    props.forEach(function(prop) {\r\n      tmpObj[prop] = origin[prop];\r\n    });\r\n\r\n    extend(origin[destination], tmpObj, deep);\r\n  }\r\n\r\n  function _isEqual(origValue, currentValue, firstPass) {\r\n    if (origValue === currentValue) {\r\n      // if the objects are identical, return\r\n      return true;\r\n    }\r\n    else if (Array.isArray(origValue)) {\r\n      if (!Array.isArray(currentValue) || origValue.length !== currentValue.length) {\r\n        return false;\r\n      }\r\n      for (var i = 0, len = origValue.length; i < len; i++) {\r\n        if (!_isEqual(origValue[i], currentValue[i])) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n    else if (origValue && typeof origValue === 'object') {\r\n      var keys = Object.keys(origValue), key;\r\n      if (!currentValue ||\r\n          typeof currentValue !== 'object' ||\r\n          (!firstPass && keys.length !== Object.keys(currentValue).length)\r\n      ) {\r\n        return false;\r\n      }\r\n      for (var i = 0, len = keys.length; i < len; i++) {\r\n        key = keys[i];\r\n        // since clipPath is in the statefull cache list and the clipPath objects\r\n        // would be iterated as an object, this would lead to possible infinite recursion\r\n        // we do not want to compare those.\r\n        if (key === 'canvas' || key === 'group') {\r\n          continue;\r\n        }\r\n        if (!_isEqual(origValue[key], currentValue[key])) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n  }\r\n\r\n\r\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\r\n\r\n    /**\r\n     * Returns true if object state (one of its state properties) was changed\r\n     * @param {String} [propertySet] optional name for the set of property we want to save\r\n     * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\r\n     */\r\n    hasStateChanged: function(propertySet) {\r\n      propertySet = propertySet || originalSet;\r\n      var dashedPropertySet = '_' + propertySet;\r\n      if (Object.keys(this[dashedPropertySet]).length < this[propertySet].length) {\r\n        return true;\r\n      }\r\n      return !_isEqual(this[dashedPropertySet], this, true);\r\n    },\r\n\r\n    /**\r\n     * Saves state of an object\r\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\r\n     * @return {fabric.Object} thisArg\r\n     */\r\n    saveState: function(options) {\r\n      var propertySet = options && options.propertySet || originalSet,\r\n          destination = '_' + propertySet;\r\n      if (!this[destination]) {\r\n        return this.setupState(options);\r\n      }\r\n      saveProps(this, destination, this[propertySet]);\r\n      if (options && options.stateProperties) {\r\n        saveProps(this, destination, options.stateProperties);\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Setups state of an object\r\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\r\n     * @return {fabric.Object} thisArg\r\n     */\r\n    setupState: function(options) {\r\n      options = options || { };\r\n      var propertySet = options.propertySet || originalSet;\r\n      options.propertySet = propertySet;\r\n      this['_' + propertySet] = { };\r\n      this.saveState(options);\r\n      return this;\r\n    }\r\n  });\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  var degreesToRadians = fabric.util.degreesToRadians;\r\n\r\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\r\n    /**\r\n     * Determines which corner has been clicked\r\n     * @private\r\n     * @param {Object} pointer The pointer indicating the mouse position\r\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\r\n     */\r\n    _findTargetCorner: function(pointer, forTouch) {\r\n      // objects in group, anykind, are not self modificable,\r\n      // must not return an hovered corner.\r\n      if (!this.hasControls || this.group || (!this.canvas || this.canvas._activeObject !== this)) {\r\n        return false;\r\n      }\r\n\r\n      var ex = pointer.x,\r\n          ey = pointer.y,\r\n          xPoints,\r\n          lines, keys = Object.keys(this.oCoords),\r\n          j = keys.length - 1, i;\r\n      this.__corner = 0;\r\n\r\n      // cycle in reverse order so we pick first the one on top\r\n      for (; j >= 0; j--) {\r\n        i = keys[j];\r\n        if (!this.isControlVisible(i)) {\r\n          continue;\r\n        }\r\n\r\n        lines = this._getImageLines(forTouch ? this.oCoords[i].touchCorner : this.oCoords[i].corner);\r\n        // // debugging\r\n        //\r\n        // this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\r\n        // this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\r\n        //\r\n        // this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\r\n        // this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\r\n        //\r\n        // this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\r\n        // this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\r\n        //\r\n        // this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\r\n        // this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\r\n\r\n        xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\r\n        if (xPoints !== 0 && xPoints % 2 === 1) {\r\n          this.__corner = i;\r\n          return i;\r\n        }\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Calls a function for each control. The function gets called,\r\n     * with the control, the object that is calling the iterator and the control's key\r\n     * @param {Function} fn function to iterate over the controls over\r\n     */\r\n    forEachControl: function(fn) {\r\n      for (var i in this.controls) {\r\n        fn(this.controls[i], i, this);\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Sets the coordinates of the draggable boxes in the corners of\r\n     * the image used to scale/rotate it.\r\n     * note: if we would switch to ROUND corner area, all of this would disappear.\r\n     * everything would resolve to a single point and a pythagorean theorem for the distance\r\n     * @private\r\n     */\r\n    _setCornerCoords: function() {\r\n      var coords = this.oCoords;\r\n\r\n      for (var control in coords) {\r\n        var controlObject = this.controls[control];\r\n        coords[control].corner = controlObject.calcCornerCoords(\r\n          this.angle, this.cornerSize, coords[control].x, coords[control].y, false);\r\n        coords[control].touchCorner = controlObject.calcCornerCoords(\r\n          this.angle, this.touchCornerSize, coords[control].x, coords[control].y, true);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Draws a colored layer behind the object, inside its selection borders.\r\n     * Requires public options: padding, selectionBackgroundColor\r\n     * this function is called when the context is transformed\r\n     * has checks to be skipped when the object is on a staticCanvas\r\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    drawSelectionBackground: function(ctx) {\r\n      if (!this.selectionBackgroundColor ||\r\n        (this.canvas && !this.canvas.interactive) ||\r\n        (this.canvas && this.canvas._activeObject !== this)\r\n      ) {\r\n        return this;\r\n      }\r\n      ctx.save();\r\n      var center = this.getCenterPoint(), wh = this._calculateCurrentDimensions(),\r\n          vpt = this.canvas.viewportTransform;\r\n      ctx.translate(center.x, center.y);\r\n      ctx.scale(1 / vpt[0], 1 / vpt[3]);\r\n      ctx.rotate(degreesToRadians(this.angle));\r\n      ctx.fillStyle = this.selectionBackgroundColor;\r\n      ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\r\n      ctx.restore();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Draws borders of an object's bounding box.\r\n     * Requires public properties: width, height\r\n     * Requires public options: padding, borderColor\r\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\r\n     * @param {Object} styleOverride object to override the object style\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    drawBorders: function(ctx, styleOverride) {\r\n      styleOverride = styleOverride || {};\r\n      var wh = this._calculateCurrentDimensions(),\r\n          strokeWidth = this.borderScaleFactor,\r\n          width = wh.x + strokeWidth,\r\n          height = wh.y + strokeWidth,\r\n          hasControls = typeof styleOverride.hasControls !== 'undefined' ?\r\n            styleOverride.hasControls : this.hasControls,\r\n          shouldStroke = false;\r\n\r\n      ctx.save();\r\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\r\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray);\r\n\r\n      ctx.strokeRect(\r\n        -width / 2,\r\n        -height / 2,\r\n        width,\r\n        height\r\n      );\r\n\r\n      if (hasControls) {\r\n        ctx.beginPath();\r\n        this.forEachControl(function(control, key, fabricObject) {\r\n          // in this moment, the ctx is centered on the object.\r\n          // width and height of the above function are the size of the bbox.\r\n          if (control.withConnection && control.getVisibility(fabricObject, key)) {\r\n            // reset movement for each control\r\n            shouldStroke = true;\r\n            ctx.moveTo(control.x * width, control.y * height);\r\n            ctx.lineTo(\r\n              control.x * width + control.offsetX,\r\n              control.y * height + control.offsetY\r\n            );\r\n          }\r\n        });\r\n        if (shouldStroke) {\r\n          ctx.stroke();\r\n        }\r\n      }\r\n      ctx.restore();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Draws borders of an object's bounding box when it is inside a group.\r\n     * Requires public properties: width, height\r\n     * Requires public options: padding, borderColor\r\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\r\n     * @param {object} options object representing current object parameters\r\n     * @param {Object} styleOverride object to override the object style\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    drawBordersInGroup: function(ctx, options, styleOverride) {\r\n      styleOverride = styleOverride || {};\r\n      var bbox = fabric.util.sizeAfterTransform(this.width, this.height, options),\r\n          strokeWidth = this.strokeWidth,\r\n          strokeUniform = this.strokeUniform,\r\n          borderScaleFactor = this.borderScaleFactor,\r\n          width =\r\n            bbox.x + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleX) + borderScaleFactor,\r\n          height =\r\n            bbox.y + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleY) + borderScaleFactor;\r\n      ctx.save();\r\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray);\r\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\r\n      ctx.strokeRect(\r\n        -width / 2,\r\n        -height / 2,\r\n        width,\r\n        height\r\n      );\r\n\r\n      ctx.restore();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Draws corners of an object's bounding box.\r\n     * Requires public properties: width, height\r\n     * Requires public options: cornerSize, padding\r\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\r\n     * @param {Object} styleOverride object to override the object style\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    drawControls: function(ctx, styleOverride) {\r\n      styleOverride = styleOverride || {};\r\n      ctx.save();\r\n      var retinaScaling = this.canvas.getRetinaScaling(), matrix, p;\r\n      ctx.setTransform(retinaScaling, 0, 0, retinaScaling, 0, 0);\r\n      ctx.strokeStyle = ctx.fillStyle = styleOverride.cornerColor || this.cornerColor;\r\n      if (!this.transparentCorners) {\r\n        ctx.strokeStyle = styleOverride.cornerStrokeColor || this.cornerStrokeColor;\r\n      }\r\n      this._setLineDash(ctx, styleOverride.cornerDashArray || this.cornerDashArray);\r\n      this.setCoords();\r\n      if (this.group) {\r\n        // fabricJS does not really support drawing controls inside groups,\r\n        // this piece of code here helps having at least the control in places.\r\n        // If an application needs to show some objects as selected because of some UI state\r\n        // can still call Object._renderControls() on any object they desire, independently of groups.\r\n        // using no padding, circular controls and hiding the rotating cursor is higly suggested,\r\n        matrix = this.group.calcTransformMatrix();\r\n      }\r\n      this.forEachControl(function(control, key, fabricObject) {\r\n        p = fabricObject.oCoords[key];\r\n        if (control.getVisibility(fabricObject, key)) {\r\n          if (matrix) {\r\n            p = fabric.util.transformPoint(p, matrix);\r\n          }\r\n          control.render(ctx, p.x, p.y, styleOverride, fabricObject);\r\n        }\r\n      });\r\n      ctx.restore();\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns true if the specified control is visible, false otherwise.\r\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\r\n     * @returns {Boolean} true if the specified control is visible, false otherwise\r\n     */\r\n    isControlVisible: function(controlKey) {\r\n      return this.controls[controlKey] && this.controls[controlKey].getVisibility(this, controlKey);\r\n    },\r\n\r\n    /**\r\n     * Sets the visibility of the specified control.\r\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\r\n     * @param {Boolean} visible true to set the specified control visible, false otherwise\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    setControlVisible: function(controlKey, visible) {\r\n      if (!this._controlsVisibility) {\r\n        this._controlsVisibility = {};\r\n      }\r\n      this._controlsVisibility[controlKey] = visible;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Sets the visibility state of object controls.\r\n     * @param {Object} [options] Options object\r\n     * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\r\n     * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\r\n     * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\r\n     * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\r\n     * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\r\n     * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\r\n     * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\r\n     * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\r\n     * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    setControlsVisibility: function(options) {\r\n      options || (options = { });\r\n\r\n      for (var p in options) {\r\n        this.setControlVisible(p, options[p]);\r\n      }\r\n      return this;\r\n    },\r\n\r\n\r\n    /**\r\n     * This callback function is called every time _discardActiveObject or _setActiveObject\r\n     * try to to deselect this object. If the function returns true, the process is cancelled\r\n     * @param {Object} [options] options sent from the upper functions\r\n     * @param {Event} [options.e] event if the process is generated by an event\r\n     */\r\n    onDeselect: function() {\r\n      // implemented by sub-classes, as needed.\r\n    },\r\n\r\n\r\n    /**\r\n     * This callback function is called every time _discardActiveObject or _setActiveObject\r\n     * try to to select this object. If the function returns true, the process is cancelled\r\n     * @param {Object} [options] options sent from the upper functions\r\n     * @param {Event} [options.e] event if the process is generated by an event\r\n     */\r\n    onSelect: function() {\r\n      // implemented by sub-classes, as needed.\r\n    }\r\n  });\r\n})();\r\n\r\n\r\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\r\n\r\n  /**\r\n   * Animation duration (in ms) for fx* methods\r\n   * @type Number\r\n   * @default\r\n   */\r\n  FX_DURATION: 500,\r\n\r\n  /**\r\n   * Centers object horizontally with animation.\r\n   * @param {fabric.Object} object Object to center\r\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\r\n   * @param {Function} [callbacks.onComplete] Invoked on completion\r\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\r\n   * @return {fabric.AnimationContext} context\r\n   */\r\n  fxCenterObjectH: function (object, callbacks) {\r\n    callbacks = callbacks || { };\r\n\r\n    var empty = function() { },\r\n        onComplete = callbacks.onComplete || empty,\r\n        onChange = callbacks.onChange || empty,\r\n        _this = this;\r\n\r\n    return fabric.util.animate({\r\n      target: this,\r\n      startValue: object.left,\r\n      endValue: this.getCenterPoint().x,\r\n      duration: this.FX_DURATION,\r\n      onChange: function(value) {\r\n        object.set('left', value);\r\n        _this.requestRenderAll();\r\n        onChange();\r\n      },\r\n      onComplete: function() {\r\n        object.setCoords();\r\n        onComplete();\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Centers object vertically with animation.\r\n   * @param {fabric.Object} object Object to center\r\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\r\n   * @param {Function} [callbacks.onComplete] Invoked on completion\r\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\r\n   * @return {fabric.AnimationContext} context\r\n   */\r\n  fxCenterObjectV: function (object, callbacks) {\r\n    callbacks = callbacks || { };\r\n\r\n    var empty = function() { },\r\n        onComplete = callbacks.onComplete || empty,\r\n        onChange = callbacks.onChange || empty,\r\n        _this = this;\r\n\r\n    return fabric.util.animate({\r\n      target: this,\r\n      startValue: object.top,\r\n      endValue: this.getCenterPoint().y,\r\n      duration: this.FX_DURATION,\r\n      onChange: function(value) {\r\n        object.set('top', value);\r\n        _this.requestRenderAll();\r\n        onChange();\r\n      },\r\n      onComplete: function() {\r\n        object.setCoords();\r\n        onComplete();\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Same as `fabric.Canvas#remove` but animated\r\n   * @param {fabric.Object} object Object to remove\r\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\r\n   * @param {Function} [callbacks.onComplete] Invoked on completion\r\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\r\n   * @return {fabric.AnimationContext} context\r\n   */\r\n  fxRemove: function (object, callbacks) {\r\n    callbacks = callbacks || { };\r\n\r\n    var empty = function() { },\r\n        onComplete = callbacks.onComplete || empty,\r\n        onChange = callbacks.onChange || empty,\r\n        _this = this;\r\n\r\n    return fabric.util.animate({\r\n      target: this,\r\n      startValue: object.opacity,\r\n      endValue: 0,\r\n      duration: this.FX_DURATION,\r\n      onChange: function(value) {\r\n        object.set('opacity', value);\r\n        _this.requestRenderAll();\r\n        onChange();\r\n      },\r\n      onComplete: function () {\r\n        _this.remove(object);\r\n        onComplete();\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\r\n  /**\r\n   * Animates object's properties\r\n   * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\r\n   * @param {Number|Object} value Value to animate property to (if string was given first) or options object\r\n   * @return {fabric.Object} thisArg\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\r\n   * @return {fabric.AnimationContext | fabric.AnimationContext[]} animation context (or an array if passed multiple properties)\r\n   *\r\n   * As object  multiple properties\r\n   *\r\n   * object.animate({ left: ..., top: ... });\r\n   * object.animate({ left: ..., top: ... }, { duration: ... });\r\n   *\r\n   * As string  one property\r\n   *\r\n   * object.animate('left', ...);\r\n   * object.animate('left', { duration: ... });\r\n   *\r\n   */\r\n  animate: function () {\r\n    if (arguments[0] && typeof arguments[0] === 'object') {\r\n      var propsToAnimate = [], prop, skipCallbacks, out = [];\r\n      for (prop in arguments[0]) {\r\n        propsToAnimate.push(prop);\r\n      }\r\n      for (var i = 0, len = propsToAnimate.length; i < len; i++) {\r\n        prop = propsToAnimate[i];\r\n        skipCallbacks = i !== len - 1;\r\n        out.push(this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks));\r\n      }\r\n      return out;\r\n    }\r\n    else {\r\n      return this._animate.apply(this, arguments);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {String} property Property to animate\r\n   * @param {String} to Value to animate to\r\n   * @param {Object} [options] Options object\r\n   * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\r\n   */\r\n  _animate: function(property, to, options, skipCallbacks) {\r\n    var _this = this, propPair;\r\n\r\n    to = to.toString();\r\n\r\n    if (!options) {\r\n      options = { };\r\n    }\r\n    else {\r\n      options = fabric.util.object.clone(options);\r\n    }\r\n\r\n    if (~property.indexOf('.')) {\r\n      propPair = property.split('.');\r\n    }\r\n\r\n    var propIsColor =\r\n      _this.colorProperties.indexOf(property) > -1 ||\r\n      (propPair && _this.colorProperties.indexOf(propPair[1]) > -1);\r\n\r\n    var currentValue = propPair\r\n      ? this.get(propPair[0])[propPair[1]]\r\n      : this.get(property);\r\n\r\n    if (!('from' in options)) {\r\n      options.from = currentValue;\r\n    }\r\n\r\n    if (!propIsColor) {\r\n      if (~to.indexOf('=')) {\r\n        to = currentValue + parseFloat(to.replace('=', ''));\r\n      }\r\n      else {\r\n        to = parseFloat(to);\r\n      }\r\n    }\r\n\r\n    var _options = {\r\n      target: this,\r\n      startValue: options.from,\r\n      endValue: to,\r\n      byValue: options.by,\r\n      easing: options.easing,\r\n      duration: options.duration,\r\n      abort: options.abort && function(value, valueProgress, timeProgress) {\r\n        return options.abort.call(_this, value, valueProgress, timeProgress);\r\n      },\r\n      onChange: function (value, valueProgress, timeProgress) {\r\n        if (propPair) {\r\n          _this[propPair[0]][propPair[1]] = value;\r\n        }\r\n        else {\r\n          _this.set(property, value);\r\n        }\r\n        if (skipCallbacks) {\r\n          return;\r\n        }\r\n        options.onChange && options.onChange(value, valueProgress, timeProgress);\r\n      },\r\n      onComplete: function (value, valueProgress, timeProgress) {\r\n        if (skipCallbacks) {\r\n          return;\r\n        }\r\n\r\n        _this.setCoords();\r\n        options.onComplete && options.onComplete(value, valueProgress, timeProgress);\r\n      }\r\n    };\r\n\r\n    if (propIsColor) {\r\n      return fabric.util.animateColor(_options.startValue, _options.endValue, _options.duration, _options);\r\n    }\r\n    else {\r\n      return fabric.util.animate(_options);\r\n    }\r\n  }\r\n});\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      extend = fabric.util.object.extend,\r\n      clone = fabric.util.object.clone,\r\n      coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 };\r\n\r\n  if (fabric.Line) {\r\n    fabric.warn('fabric.Line is already defined');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Line class\r\n   * @class fabric.Line\r\n   * @extends fabric.Object\r\n   * @see {@link fabric.Line#initialize} for constructor definition\r\n   */\r\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'line',\r\n\r\n    /**\r\n     * x value or first line edge\r\n     * @type Number\r\n     * @default\r\n     */\r\n    x1: 0,\r\n\r\n    /**\r\n     * y value or first line edge\r\n     * @type Number\r\n     * @default\r\n     */\r\n    y1: 0,\r\n\r\n    /**\r\n     * x value or second line edge\r\n     * @type Number\r\n     * @default\r\n     */\r\n    x2: 0,\r\n\r\n    /**\r\n     * y value or second line edge\r\n     * @type Number\r\n     * @default\r\n     */\r\n    y2: 0,\r\n\r\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('x1', 'x2', 'y1', 'y2'),\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Array} [points] Array of points\r\n     * @param {Object} [options] Options object\r\n     * @return {fabric.Line} thisArg\r\n     */\r\n    initialize: function(points, options) {\r\n      if (!points) {\r\n        points = [0, 0, 0, 0];\r\n      }\r\n\r\n      this.callSuper('initialize', options);\r\n\r\n      this.set('x1', points[0]);\r\n      this.set('y1', points[1]);\r\n      this.set('x2', points[2]);\r\n      this.set('y2', points[3]);\r\n\r\n      this._setWidthHeight(options);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} [options] Options\r\n     */\r\n    _setWidthHeight: function(options) {\r\n      options || (options = { });\r\n\r\n      this.width = Math.abs(this.x2 - this.x1);\r\n      this.height = Math.abs(this.y2 - this.y1);\r\n\r\n      this.left = 'left' in options\r\n        ? options.left\r\n        : this._getLeftToOriginX();\r\n\r\n      this.top = 'top' in options\r\n        ? options.top\r\n        : this._getTopToOriginY();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} key\r\n     * @param {*} value\r\n     */\r\n    _set: function(key, value) {\r\n      this.callSuper('_set', key, value);\r\n      if (typeof coordProps[key] !== 'undefined') {\r\n        this._setWidthHeight();\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\r\n     */\r\n    _getLeftToOriginX: makeEdgeToOriginGetter(\r\n      { // property names\r\n        origin: 'originX',\r\n        axis1: 'x1',\r\n        axis2: 'x2',\r\n        dimension: 'width'\r\n      },\r\n      { // possible values of origin\r\n        nearest: 'left',\r\n        center: 'center',\r\n        farthest: 'right'\r\n      }\r\n    ),\r\n\r\n    /**\r\n     * @private\r\n     * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\r\n     */\r\n    _getTopToOriginY: makeEdgeToOriginGetter(\r\n      { // property names\r\n        origin: 'originY',\r\n        axis1: 'y1',\r\n        axis2: 'y2',\r\n        dimension: 'height'\r\n      },\r\n      { // possible values of origin\r\n        nearest: 'top',\r\n        center: 'center',\r\n        farthest: 'bottom'\r\n      }\r\n    ),\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      ctx.beginPath();\r\n\r\n\r\n      var p = this.calcLinePoints();\r\n      ctx.moveTo(p.x1, p.y1);\r\n      ctx.lineTo(p.x2, p.y2);\r\n\r\n      ctx.lineWidth = this.strokeWidth;\r\n\r\n      // TODO: test this\r\n      // make sure setting \"fill\" changes color of a line\r\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\r\n      var origStrokeStyle = ctx.strokeStyle;\r\n      ctx.strokeStyle = this.stroke || ctx.fillStyle;\r\n      this.stroke && this._renderStroke(ctx);\r\n      ctx.strokeStyle = origStrokeStyle;\r\n    },\r\n\r\n    /**\r\n     * This function is an helper for svg import. it returns the center of the object in the svg\r\n     * untransformed coordinates\r\n     * @private\r\n     * @return {Object} center point from element coordinates\r\n     */\r\n    _findCenterFromElement: function() {\r\n      return {\r\n        x: (this.x1 + this.x2) / 2,\r\n        y: (this.y1 + this.y2) / 2,\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @method toObject\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      return extend(this.callSuper('toObject', propertiesToInclude), this.calcLinePoints());\r\n    },\r\n\r\n    /*\r\n     * Calculate object dimensions from its properties\r\n     * @private\r\n     */\r\n    _getNonTransformedDimensions: function() {\r\n      var dim = this.callSuper('_getNonTransformedDimensions');\r\n      if (this.strokeLineCap === 'butt') {\r\n        if (this.width === 0) {\r\n          dim.y -= this.strokeWidth;\r\n        }\r\n        if (this.height === 0) {\r\n          dim.x -= this.strokeWidth;\r\n        }\r\n      }\r\n      return dim;\r\n    },\r\n\r\n    /**\r\n     * Recalculates line points given width and height\r\n     * @private\r\n     */\r\n    calcLinePoints: function() {\r\n      var xMult = this.x1 <= this.x2 ? -1 : 1,\r\n          yMult = this.y1 <= this.y2 ? -1 : 1,\r\n          x1 = (xMult * this.width * 0.5),\r\n          y1 = (yMult * this.height * 0.5),\r\n          x2 = (xMult * this.width * -0.5),\r\n          y2 = (yMult * this.height * -0.5);\r\n\r\n      return {\r\n        x1: x1,\r\n        x2: x2,\r\n        y1: y1,\r\n        y2: y2\r\n      };\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @return {Array} an array of strings with the specific svg representation\r\n     * of the instance\r\n     */\r\n    _toSVG: function() {\r\n      var p = this.calcLinePoints();\r\n      return [\r\n        '<line ', 'COMMON_PARTS',\r\n        'x1=\"', p.x1,\r\n        '\" y1=\"', p.y1,\r\n        '\" x2=\"', p.x2,\r\n        '\" y2=\"', p.y2,\r\n        '\" />\\n'\r\n      ];\r\n    },\r\n    /* _TO_SVG_END_ */\r\n  });\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\r\n   * @static\r\n   * @memberOf fabric.Line\r\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\r\n   */\r\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));\r\n\r\n  /**\r\n   * Returns fabric.Line instance from an SVG element\r\n   * @static\r\n   * @memberOf fabric.Line\r\n   * @param {SVGElement} element Element to parse\r\n   * @param {Object} [options] Options object\r\n   * @param {Function} [callback] callback function invoked after parsing\r\n   */\r\n  fabric.Line.fromElement = function(element, callback, options) {\r\n    options = options || { };\r\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES),\r\n        points = [\r\n          parsedAttributes.x1 || 0,\r\n          parsedAttributes.y1 || 0,\r\n          parsedAttributes.x2 || 0,\r\n          parsedAttributes.y2 || 0\r\n        ];\r\n    callback(new fabric.Line(points, extend(parsedAttributes, options)));\r\n  };\r\n  /* _FROM_SVG_END_ */\r\n\r\n  /**\r\n   * Returns fabric.Line instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Line\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] invoked with new instance as first argument\r\n   */\r\n  fabric.Line.fromObject = function(object, callback) {\r\n    function _callback(instance) {\r\n      delete instance.points;\r\n      callback && callback(instance);\r\n    };\r\n    var options = clone(object, true);\r\n    options.points = [object.x1, object.y1, object.x2, object.y2];\r\n    fabric.Object._fromObject('Line', options, _callback, 'points');\r\n  };\r\n\r\n  /**\r\n   * Produces a function that calculates distance from canvas edge to Line origin.\r\n   */\r\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\r\n    var origin = propertyNames.origin,\r\n        axis1 = propertyNames.axis1,\r\n        axis2 = propertyNames.axis2,\r\n        dimension = propertyNames.dimension,\r\n        nearest = originValues.nearest,\r\n        center = originValues.center,\r\n        farthest = originValues.farthest;\r\n\r\n    return function() {\r\n      switch (this.get(origin)) {\r\n        case nearest:\r\n          return Math.min(this.get(axis1), this.get(axis2));\r\n        case center:\r\n          return Math.min(this.get(axis1), this.get(axis2)) + (0.5 * this.get(dimension));\r\n        case farthest:\r\n          return Math.max(this.get(axis1), this.get(axis2));\r\n      }\r\n    };\r\n\r\n  }\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      degreesToRadians = fabric.util.degreesToRadians;\r\n\r\n  if (fabric.Circle) {\r\n    fabric.warn('fabric.Circle is already defined.');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Circle class\r\n   * @class fabric.Circle\r\n   * @extends fabric.Object\r\n   * @see {@link fabric.Circle#initialize} for constructor definition\r\n   */\r\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'circle',\r\n\r\n    /**\r\n     * Radius of this circle\r\n     * @type Number\r\n     * @default\r\n     */\r\n    radius: 0,\r\n\r\n    /**\r\n     * degrees of start of the circle.\r\n     * probably will change to degrees in next major version\r\n     * @type Number 0 - 359\r\n     * @default 0\r\n     */\r\n    startAngle: 0,\r\n\r\n    /**\r\n     * End angle of the circle\r\n     * probably will change to degrees in next major version\r\n     * @type Number 1 - 360\r\n     * @default 360\r\n     */\r\n    endAngle: 360,\r\n\r\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('radius', 'startAngle', 'endAngle'),\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} key\r\n     * @param {*} value\r\n     * @return {fabric.Circle} thisArg\r\n     */\r\n    _set: function(key, value) {\r\n      this.callSuper('_set', key, value);\r\n\r\n      if (key === 'radius') {\r\n        this.setRadius(value);\r\n      }\r\n\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      return this.callSuper('toObject', ['radius', 'startAngle', 'endAngle'].concat(propertiesToInclude));\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @return {Array} an array of strings with the specific svg representation\r\n     * of the instance\r\n     */\r\n    _toSVG: function() {\r\n      var svgString, x = 0, y = 0,\r\n          angle = (this.endAngle - this.startAngle) % 360;\r\n\r\n      if (angle === 0) {\r\n        svgString = [\r\n          '<circle ', 'COMMON_PARTS',\r\n          'cx=\"' + x + '\" cy=\"' + y + '\" ',\r\n          'r=\"', this.radius,\r\n          '\" />\\n'\r\n        ];\r\n      }\r\n      else {\r\n        var start = degreesToRadians(this.startAngle),\r\n            end = degreesToRadians(this.endAngle),\r\n            radius = this.radius,\r\n            startX = fabric.util.cos(start) * radius,\r\n            startY = fabric.util.sin(start) * radius,\r\n            endX = fabric.util.cos(end) * radius,\r\n            endY = fabric.util.sin(end) * radius,\r\n            largeFlag = angle > 180 ? '1' : '0';\r\n        svgString = [\r\n          '<path d=\"M ' + startX + ' ' + startY,\r\n          ' A ' + radius + ' ' + radius,\r\n          ' 0 ', +largeFlag + ' 1', ' ' + endX + ' ' + endY,\r\n          '\" ', 'COMMON_PARTS', ' />\\n'\r\n        ];\r\n      }\r\n      return svgString;\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      ctx.beginPath();\r\n      ctx.arc(\r\n        0,\r\n        0,\r\n        this.radius,\r\n        degreesToRadians(this.startAngle),\r\n        degreesToRadians(this.endAngle),\r\n        false\r\n      );\r\n      this._renderPaintInOrder(ctx);\r\n    },\r\n\r\n    /**\r\n     * Returns horizontal radius of an object (according to how an object is scaled)\r\n     * @return {Number}\r\n     */\r\n    getRadiusX: function() {\r\n      return this.get('radius') * this.get('scaleX');\r\n    },\r\n\r\n    /**\r\n     * Returns vertical radius of an object (according to how an object is scaled)\r\n     * @return {Number}\r\n     */\r\n    getRadiusY: function() {\r\n      return this.get('radius') * this.get('scaleY');\r\n    },\r\n\r\n    /**\r\n     * Sets radius of an object (and updates width accordingly)\r\n     * @return {fabric.Circle} thisArg\r\n     */\r\n    setRadius: function(value) {\r\n      this.radius = value;\r\n      return this.set('width', value * 2).set('height', value * 2);\r\n    },\r\n  });\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\r\n   * @static\r\n   * @memberOf fabric.Circle\r\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\r\n   */\r\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));\r\n\r\n  /**\r\n   * Returns {@link fabric.Circle} instance from an SVG element\r\n   * @static\r\n   * @memberOf fabric.Circle\r\n   * @param {SVGElement} element Element to parse\r\n   * @param {Function} [callback] Options callback invoked after parsing is finished\r\n   * @param {Object} [options] Options object\r\n   * @throws {Error} If value of `r` attribute is missing or invalid\r\n   */\r\n  fabric.Circle.fromElement = function(element, callback) {\r\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\r\n\r\n    if (!isValidRadius(parsedAttributes)) {\r\n      throw new Error('value of `r` attribute is required and can not be negative');\r\n    }\r\n\r\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.radius;\r\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.radius;\r\n    callback(new fabric.Circle(parsedAttributes));\r\n  };\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  function isValidRadius(attributes) {\r\n    return (('radius' in attributes) && (attributes.radius >= 0));\r\n  }\r\n  /* _FROM_SVG_END_ */\r\n\r\n  /**\r\n   * Returns {@link fabric.Circle} instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Circle\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] invoked with new instance as first argument\r\n   * @return {void}\r\n   */\r\n  fabric.Circle.fromObject = function(object, callback) {\r\n    fabric.Object._fromObject('Circle', object, callback);\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { });\r\n\r\n  if (fabric.Triangle) {\r\n    fabric.warn('fabric.Triangle is already defined');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Triangle class\r\n   * @class fabric.Triangle\r\n   * @extends fabric.Object\r\n   * @return {fabric.Triangle} thisArg\r\n   * @see {@link fabric.Triangle#initialize} for constructor definition\r\n   */\r\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'triangle',\r\n\r\n    /**\r\n     * Width is set to 100 to compensate the old initialize code that was setting it to 100\r\n     * @type Number\r\n     * @default\r\n     */\r\n    width: 100,\r\n\r\n    /**\r\n     * Height is set to 100 to compensate the old initialize code that was setting it to 100\r\n     * @type Number\r\n     * @default\r\n     */\r\n    height: 100,\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      var widthBy2 = this.width / 2,\r\n          heightBy2 = this.height / 2;\r\n\r\n      ctx.beginPath();\r\n      ctx.moveTo(-widthBy2, heightBy2);\r\n      ctx.lineTo(0, -heightBy2);\r\n      ctx.lineTo(widthBy2, heightBy2);\r\n      ctx.closePath();\r\n\r\n      this._renderPaintInOrder(ctx);\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @return {Array} an array of strings with the specific svg representation\r\n     * of the instance\r\n     */\r\n    _toSVG: function() {\r\n      var widthBy2 = this.width / 2,\r\n          heightBy2 = this.height / 2,\r\n          points = [\r\n            -widthBy2 + ' ' + heightBy2,\r\n            '0 ' + -heightBy2,\r\n            widthBy2 + ' ' + heightBy2\r\n          ].join(',');\r\n      return [\r\n        '<polygon ', 'COMMON_PARTS',\r\n        'points=\"', points,\r\n        '\" />'\r\n      ];\r\n    },\r\n    /* _TO_SVG_END_ */\r\n  });\r\n\r\n  /**\r\n   * Returns {@link fabric.Triangle} instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Triangle\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] invoked with new instance as first argument\r\n   */\r\n  fabric.Triangle.fromObject = function(object, callback) {\r\n    return fabric.Object._fromObject('Triangle', object, callback);\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      piBy2   = Math.PI * 2;\r\n\r\n  if (fabric.Ellipse) {\r\n    fabric.warn('fabric.Ellipse is already defined.');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Ellipse class\r\n   * @class fabric.Ellipse\r\n   * @extends fabric.Object\r\n   * @return {fabric.Ellipse} thisArg\r\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\r\n   */\r\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'ellipse',\r\n\r\n    /**\r\n     * Horizontal radius\r\n     * @type Number\r\n     * @default\r\n     */\r\n    rx:   0,\r\n\r\n    /**\r\n     * Vertical radius\r\n     * @type Number\r\n     * @default\r\n     */\r\n    ry:   0,\r\n\r\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} [options] Options object\r\n     * @return {fabric.Ellipse} thisArg\r\n     */\r\n    initialize: function(options) {\r\n      this.callSuper('initialize', options);\r\n      this.set('rx', options && options.rx || 0);\r\n      this.set('ry', options && options.ry || 0);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} key\r\n     * @param {*} value\r\n     * @return {fabric.Ellipse} thisArg\r\n     */\r\n    _set: function(key, value) {\r\n      this.callSuper('_set', key, value);\r\n      switch (key) {\r\n\r\n        case 'rx':\r\n          this.rx = value;\r\n          this.set('width', value * 2);\r\n          break;\r\n\r\n        case 'ry':\r\n          this.ry = value;\r\n          this.set('height', value * 2);\r\n          break;\r\n\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns horizontal radius of an object (according to how an object is scaled)\r\n     * @return {Number}\r\n     */\r\n    getRx: function() {\r\n      return this.get('rx') * this.get('scaleX');\r\n    },\r\n\r\n    /**\r\n     * Returns Vertical radius of an object (according to how an object is scaled)\r\n     * @return {Number}\r\n     */\r\n    getRy: function() {\r\n      return this.get('ry') * this.get('scaleY');\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @return {Array} an array of strings with the specific svg representation\r\n     * of the instance\r\n     */\r\n    _toSVG: function() {\r\n      return [\r\n        '<ellipse ', 'COMMON_PARTS',\r\n        'cx=\"0\" cy=\"0\" ',\r\n        'rx=\"', this.rx,\r\n        '\" ry=\"', this.ry,\r\n        '\" />\\n'\r\n      ];\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      ctx.beginPath();\r\n      ctx.save();\r\n      ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\r\n      ctx.arc(\r\n        0,\r\n        0,\r\n        this.rx,\r\n        0,\r\n        piBy2,\r\n        false);\r\n      ctx.restore();\r\n      this._renderPaintInOrder(ctx);\r\n    },\r\n  });\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\r\n   * @static\r\n   * @memberOf fabric.Ellipse\r\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\r\n   */\r\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));\r\n\r\n  /**\r\n   * Returns {@link fabric.Ellipse} instance from an SVG element\r\n   * @static\r\n   * @memberOf fabric.Ellipse\r\n   * @param {SVGElement} element Element to parse\r\n   * @param {Function} [callback] Options callback invoked after parsing is finished\r\n   * @return {fabric.Ellipse}\r\n   */\r\n  fabric.Ellipse.fromElement = function(element, callback) {\r\n\r\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\r\n\r\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.rx;\r\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.ry;\r\n    callback(new fabric.Ellipse(parsedAttributes));\r\n  };\r\n  /* _FROM_SVG_END_ */\r\n\r\n  /**\r\n   * Returns {@link fabric.Ellipse} instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Ellipse\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] invoked with new instance as first argument\r\n   * @return {void}\r\n   */\r\n  fabric.Ellipse.fromObject = function(object, callback) {\r\n    fabric.Object._fromObject('Ellipse', object, callback);\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      extend = fabric.util.object.extend;\r\n\r\n  if (fabric.Rect) {\r\n    fabric.warn('fabric.Rect is already defined');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Rectangle class\r\n   * @class fabric.Rect\r\n   * @extends fabric.Object\r\n   * @return {fabric.Rect} thisArg\r\n   * @see {@link fabric.Rect#initialize} for constructor definition\r\n   */\r\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {\r\n\r\n    /**\r\n     * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\r\n     * as well as for history (undo/redo) purposes\r\n     * @type Array\r\n     */\r\n    stateProperties: fabric.Object.prototype.stateProperties.concat('rx', 'ry'),\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'rect',\r\n\r\n    /**\r\n     * Horizontal border radius\r\n     * @type Number\r\n     * @default\r\n     */\r\n    rx:   0,\r\n\r\n    /**\r\n     * Vertical border radius\r\n     * @type Number\r\n     * @default\r\n     */\r\n    ry:   0,\r\n\r\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} [options] Options object\r\n     * @return {Object} thisArg\r\n     */\r\n    initialize: function(options) {\r\n      this.callSuper('initialize', options);\r\n      this._initRxRy();\r\n    },\r\n\r\n    /**\r\n     * Initializes rx/ry attributes\r\n     * @private\r\n     */\r\n    _initRxRy: function() {\r\n      if (this.rx && !this.ry) {\r\n        this.ry = this.rx;\r\n      }\r\n      else if (this.ry && !this.rx) {\r\n        this.rx = this.ry;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(ctx) {\r\n\r\n      // 1x1 case (used in spray brush) optimization was removed because\r\n      // with caching and higher zoom level this makes more damage than help\r\n\r\n      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\r\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\r\n          w = this.width,\r\n          h = this.height,\r\n          x = -this.width / 2,\r\n          y = -this.height / 2,\r\n          isRounded = rx !== 0 || ry !== 0,\r\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\r\n          k = 1 - 0.5522847498;\r\n      ctx.beginPath();\r\n\r\n      ctx.moveTo(x + rx, y);\r\n\r\n      ctx.lineTo(x + w - rx, y);\r\n      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);\r\n\r\n      ctx.lineTo(x + w, y + h - ry);\r\n      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);\r\n\r\n      ctx.lineTo(x + rx, y + h);\r\n      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);\r\n\r\n      ctx.lineTo(x, y + ry);\r\n      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\r\n\r\n      ctx.closePath();\r\n\r\n      this._renderPaintInOrder(ctx);\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @return {Array} an array of strings with the specific svg representation\r\n     * of the instance\r\n     */\r\n    _toSVG: function() {\r\n      var x = -this.width / 2, y = -this.height / 2;\r\n      return [\r\n        '<rect ', 'COMMON_PARTS',\r\n        'x=\"', x, '\" y=\"', y,\r\n        '\" rx=\"', this.rx, '\" ry=\"', this.ry,\r\n        '\" width=\"', this.width, '\" height=\"', this.height,\r\n        '\" />\\n'\r\n      ];\r\n    },\r\n    /* _TO_SVG_END_ */\r\n  });\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\r\n   * @static\r\n   * @memberOf fabric.Rect\r\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\r\n   */\r\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));\r\n\r\n  /**\r\n   * Returns {@link fabric.Rect} instance from an SVG element\r\n   * @static\r\n   * @memberOf fabric.Rect\r\n   * @param {SVGElement} element Element to parse\r\n   * @param {Function} callback callback function invoked after parsing\r\n   * @param {Object} [options] Options object\r\n   */\r\n  fabric.Rect.fromElement = function(element, callback, options) {\r\n    if (!element) {\r\n      return callback(null);\r\n    }\r\n    options = options || { };\r\n\r\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\r\n    parsedAttributes.left = parsedAttributes.left || 0;\r\n    parsedAttributes.top  = parsedAttributes.top  || 0;\r\n    parsedAttributes.height  = parsedAttributes.height || 0;\r\n    parsedAttributes.width  = parsedAttributes.width || 0;\r\n    var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\r\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\r\n    callback(rect);\r\n  };\r\n  /* _FROM_SVG_END_ */\r\n\r\n  /**\r\n   * Returns {@link fabric.Rect} instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Rect\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\r\n   */\r\n  fabric.Rect.fromObject = function(object, callback) {\r\n    return fabric.Object._fromObject('Rect', object, callback);\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      extend = fabric.util.object.extend,\r\n      min = fabric.util.array.min,\r\n      max = fabric.util.array.max,\r\n      toFixed = fabric.util.toFixed,\r\n      projectStrokeOnPoints = fabric.util.projectStrokeOnPoints;\r\n\r\n  if (fabric.Polyline) {\r\n    fabric.warn('fabric.Polyline is already defined');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Polyline class\r\n   * @class fabric.Polyline\r\n   * @extends fabric.Object\r\n   * @see {@link fabric.Polyline#initialize} for constructor definition\r\n   */\r\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'polyline',\r\n\r\n    /**\r\n     * Points array\r\n     * @type Array\r\n     * @default\r\n     */\r\n    points: null,\r\n\r\n    /**\r\n     * WARNING: Feature in progress\r\n     * Calculate the exact bounding box taking in account strokeWidth on acute angles\r\n     * this will be turned to true by default on fabric 6.0\r\n     * maybe will be left in as an optimization since calculations may be slow\r\n     * @deprecated\r\n     * @type Boolean\r\n     * @default false\r\n     */\r\n    exactBoundingBox: false,\r\n\r\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('points'),\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Array} points Array of points (where each point is an object with x and y)\r\n     * @param {Object} [options] Options object\r\n     * @return {fabric.Polyline} thisArg\r\n     * @example\r\n     * var poly = new fabric.Polyline([\r\n     *     { x: 10, y: 10 },\r\n     *     { x: 50, y: 30 },\r\n     *     { x: 40, y: 70 },\r\n     *     { x: 60, y: 50 },\r\n     *     { x: 100, y: 150 },\r\n     *     { x: 40, y: 100 }\r\n     *   ], {\r\n     *   stroke: 'red',\r\n     *   left: 100,\r\n     *   top: 100\r\n     * });\r\n     */\r\n    initialize: function(points, options) {\r\n      options = options || {};\r\n      this.points = points || [];\r\n      this.callSuper('initialize', options);\r\n      this._setPositionDimensions(options);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _projectStrokeOnPoints: function () {\r\n      return projectStrokeOnPoints(this.points, this, true);\r\n    },\r\n\r\n    _setPositionDimensions: function(options) {\r\n      var calcDim = this._calcDimensions(options), correctLeftTop,\r\n          correctSize = this.exactBoundingBox ? this.strokeWidth : 0;\r\n      this.width = calcDim.width - correctSize;\r\n      this.height = calcDim.height - correctSize;\r\n      if (!options.fromSVG) {\r\n        correctLeftTop = this.translateToGivenOrigin(\r\n          {\r\n            // this looks bad, but is one way to keep it optional for now.\r\n            x: calcDim.left - this.strokeWidth / 2 + correctSize / 2,\r\n            y: calcDim.top - this.strokeWidth / 2 + correctSize / 2\r\n          },\r\n          'left',\r\n          'top',\r\n          this.originX,\r\n          this.originY\r\n        );\r\n      }\r\n      if (typeof options.left === 'undefined') {\r\n        this.left = options.fromSVG ? calcDim.left : correctLeftTop.x;\r\n      }\r\n      if (typeof options.top === 'undefined') {\r\n        this.top = options.fromSVG ? calcDim.top : correctLeftTop.y;\r\n      }\r\n      this.pathOffset = {\r\n        x: calcDim.left + this.width / 2 + correctSize / 2,\r\n        y: calcDim.top + this.height / 2 + correctSize / 2\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Calculate the polygon min and max point from points array,\r\n     * returning an object with left, top, width, height to measure the\r\n     * polygon size\r\n     * @return {Object} object.left X coordinate of the polygon leftmost point\r\n     * @return {Object} object.top Y coordinate of the polygon topmost point\r\n     * @return {Object} object.width distance between X coordinates of the polygon leftmost and rightmost point\r\n     * @return {Object} object.height distance between Y coordinates of the polygon topmost and bottommost point\r\n     * @private\r\n     */\r\n    _calcDimensions: function() {\r\n\r\n      var points = this.exactBoundingBox ? this._projectStrokeOnPoints() : this.points,\r\n          minX = min(points, 'x') || 0,\r\n          minY = min(points, 'y') || 0,\r\n          maxX = max(points, 'x') || 0,\r\n          maxY = max(points, 'y') || 0,\r\n          width = (maxX - minX),\r\n          height = (maxY - minY);\r\n\r\n      return {\r\n        left: minX,\r\n        top: minY,\r\n        width: width,\r\n        height: height,\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      return extend(this.callSuper('toObject', propertiesToInclude), {\r\n        points: this.points.concat()\r\n      });\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @return {Array} an array of strings with the specific svg representation\r\n     * of the instance\r\n     */\r\n    _toSVG: function() {\r\n      var points = [], diffX = this.pathOffset.x, diffY = this.pathOffset.y,\r\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\r\n\r\n      for (var i = 0, len = this.points.length; i < len; i++) {\r\n        points.push(\r\n          toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS), ',',\r\n          toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS), ' '\r\n        );\r\n      }\r\n      return [\r\n        '<' + this.type + ' ', 'COMMON_PARTS',\r\n        'points=\"', points.join(''),\r\n        '\" />\\n'\r\n      ];\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    commonRender: function(ctx) {\r\n      var point, len = this.points.length,\r\n          x = this.pathOffset.x,\r\n          y = this.pathOffset.y;\r\n\r\n      if (!len || isNaN(this.points[len - 1].y)) {\r\n        // do not draw if no points or odd points\r\n        // NaN comes from parseFloat of a empty string in parser\r\n        return false;\r\n      }\r\n      ctx.beginPath();\r\n      ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\r\n      for (var i = 0; i < len; i++) {\r\n        point = this.points[i];\r\n        ctx.lineTo(point.x - x, point.y - y);\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      if (!this.commonRender(ctx)) {\r\n        return;\r\n      }\r\n      this._renderPaintInOrder(ctx);\r\n    },\r\n\r\n    /**\r\n     * Returns complexity of an instance\r\n     * @return {Number} complexity of this instance\r\n     */\r\n    complexity: function() {\r\n      return this.get('points').length;\r\n    }\r\n  });\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\r\n   * @static\r\n   * @memberOf fabric.Polyline\r\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\r\n   */\r\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\r\n\r\n  /**\r\n   * Returns fabric.Polyline instance from an SVG element\r\n   * @static\r\n   * @memberOf fabric.Polyline\r\n   * @param {SVGElement} element Element to parser\r\n   * @param {Function} callback callback function invoked after parsing\r\n   * @param {Object} [options] Options object\r\n   */\r\n  fabric.Polyline.fromElementGenerator = function(_class) {\r\n    return function(element, callback, options) {\r\n      if (!element) {\r\n        return callback(null);\r\n      }\r\n      options || (options = { });\r\n\r\n      var points = fabric.parsePointsAttribute(element.getAttribute('points')),\r\n          parsedAttributes = fabric.parseAttributes(element, fabric[_class].ATTRIBUTE_NAMES);\r\n      parsedAttributes.fromSVG = true;\r\n      callback(new fabric[_class](points, extend(parsedAttributes, options)));\r\n    };\r\n  };\r\n\r\n  fabric.Polyline.fromElement = fabric.Polyline.fromElementGenerator('Polyline');\r\n\r\n  /* _FROM_SVG_END_ */\r\n\r\n  /**\r\n   * Returns fabric.Polyline instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Polyline\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\r\n   */\r\n  fabric.Polyline.fromObject = function(object, callback) {\r\n    return fabric.Object._fromObject('Polyline', object, callback, 'points');\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = {}),\r\n      projectStrokeOnPoints = fabric.util.projectStrokeOnPoints;\r\n\r\n  if (fabric.Polygon) {\r\n    fabric.warn('fabric.Polygon is already defined');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Polygon class\r\n   * @class fabric.Polygon\r\n   * @extends fabric.Polyline\r\n   * @see {@link fabric.Polygon#initialize} for constructor definition\r\n   */\r\n  fabric.Polygon = fabric.util.createClass(fabric.Polyline, /** @lends fabric.Polygon.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'polygon',\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _projectStrokeOnPoints: function () {\r\n      return projectStrokeOnPoints(this.points, this);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      if (!this.commonRender(ctx)) {\r\n        return;\r\n      }\r\n      ctx.closePath();\r\n      this._renderPaintInOrder(ctx);\r\n    },\r\n\r\n  });\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\r\n   * @static\r\n   * @memberOf fabric.Polygon\r\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\r\n   */\r\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\r\n\r\n  /**\r\n   * Returns {@link fabric.Polygon} instance from an SVG element\r\n   * @static\r\n   * @memberOf fabric.Polygon\r\n   * @param {SVGElement} element Element to parse\r\n   * @param {Function} callback callback function invoked after parsing\r\n   * @param {Object} [options] Options object\r\n   */\r\n  fabric.Polygon.fromElement = fabric.Polyline.fromElementGenerator('Polygon');\r\n  /* _FROM_SVG_END_ */\r\n\r\n  /**\r\n   * Returns fabric.Polygon instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Polygon\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\r\n   * @return {void}\r\n   */\r\n  fabric.Polygon.fromObject = function(object, callback) {\r\n    fabric.Object._fromObject('Polygon', object, callback, 'points');\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      min = fabric.util.array.min,\r\n      max = fabric.util.array.max,\r\n      extend = fabric.util.object.extend,\r\n      clone = fabric.util.object.clone,\r\n      toFixed = fabric.util.toFixed;\r\n\r\n  if (fabric.Path) {\r\n    fabric.warn('fabric.Path is already defined');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Path class\r\n   * @class fabric.Path\r\n   * @extends fabric.Object\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\r\n   * @see {@link fabric.Path#initialize} for constructor definition\r\n   */\r\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'path',\r\n\r\n    /**\r\n     * Array of path points\r\n     * @type Array\r\n     * @default\r\n     */\r\n    path: null,\r\n\r\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('path', 'fillRule'),\r\n\r\n    stateProperties: fabric.Object.prototype.stateProperties.concat('path'),\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\r\n     * @param {Object} [options] Options object\r\n     * @return {fabric.Path} thisArg\r\n     */\r\n    initialize: function (path, options) {\r\n      options = clone(options || {});\r\n      delete options.path;\r\n      this.callSuper('initialize', options);\r\n      this._setPath(path || [], options);\r\n    },\r\n\r\n    /**\r\n    * @private\r\n    * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\r\n    * @param {Object} [options] Options object\r\n    */\r\n    _setPath: function (path, options) {\r\n      this.path = fabric.util.makePathSimpler(\r\n        Array.isArray(path) ? path : fabric.util.parsePath(path)\r\n      );\r\n\r\n      fabric.Polyline.prototype._setPositionDimensions.call(this, options || {});\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx context to render path on\r\n     */\r\n    _renderPathCommands: function(ctx) {\r\n      var current, // current instruction\r\n          subpathStartX = 0,\r\n          subpathStartY = 0,\r\n          x = 0, // current x\r\n          y = 0, // current y\r\n          controlX = 0, // current control point x\r\n          controlY = 0, // current control point y\r\n          l = -this.pathOffset.x,\r\n          t = -this.pathOffset.y;\r\n\r\n      ctx.beginPath();\r\n\r\n      for (var i = 0, len = this.path.length; i < len; ++i) {\r\n\r\n        current = this.path[i];\r\n\r\n        switch (current[0]) { // first letter\r\n\r\n          case 'L': // lineto, absolute\r\n            x = current[1];\r\n            y = current[2];\r\n            ctx.lineTo(x + l, y + t);\r\n            break;\r\n\r\n          case 'M': // moveTo, absolute\r\n            x = current[1];\r\n            y = current[2];\r\n            subpathStartX = x;\r\n            subpathStartY = y;\r\n            ctx.moveTo(x + l, y + t);\r\n            break;\r\n\r\n          case 'C': // bezierCurveTo, absolute\r\n            x = current[5];\r\n            y = current[6];\r\n            controlX = current[3];\r\n            controlY = current[4];\r\n            ctx.bezierCurveTo(\r\n              current[1] + l,\r\n              current[2] + t,\r\n              controlX + l,\r\n              controlY + t,\r\n              x + l,\r\n              y + t\r\n            );\r\n            break;\r\n\r\n          case 'Q': // quadraticCurveTo, absolute\r\n            ctx.quadraticCurveTo(\r\n              current[1] + l,\r\n              current[2] + t,\r\n              current[3] + l,\r\n              current[4] + t\r\n            );\r\n            x = current[3];\r\n            y = current[4];\r\n            controlX = current[1];\r\n            controlY = current[2];\r\n            break;\r\n\r\n          case 'z':\r\n          case 'Z':\r\n            x = subpathStartX;\r\n            y = subpathStartY;\r\n            ctx.closePath();\r\n            break;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx context to render path on\r\n     */\r\n    _render: function(ctx) {\r\n      this._renderPathCommands(ctx);\r\n      this._renderPaintInOrder(ctx);\r\n    },\r\n\r\n    /**\r\n     * Returns string representation of an instance\r\n     * @return {String} string representation of an instance\r\n     */\r\n    toString: function() {\r\n      return '#<fabric.Path (' + this.complexity() +\r\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      return extend(this.callSuper('toObject', propertiesToInclude), {\r\n        path: this.path.map(function(item) { return item.slice(); }),\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Returns dataless object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toDatalessObject: function(propertiesToInclude) {\r\n      var o = this.toObject(['sourcePath'].concat(propertiesToInclude));\r\n      if (o.sourcePath) {\r\n        delete o.path;\r\n      }\r\n      return o;\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @return {Array} an array of strings with the specific svg representation\r\n     * of the instance\r\n     */\r\n    _toSVG: function() {\r\n      var path = fabric.util.joinPath(this.path);\r\n      return [\r\n        '<path ', 'COMMON_PARTS',\r\n        'd=\"', path,\r\n        '\" stroke-linecap=\"round\" ',\r\n        '/>\\n'\r\n      ];\r\n    },\r\n\r\n    _getOffsetTransform: function() {\r\n      var digits = fabric.Object.NUM_FRACTION_DIGITS;\r\n      return ' translate(' + toFixed(-this.pathOffset.x, digits) + ', ' +\r\n          toFixed(-this.pathOffset.y, digits) + ')';\r\n    },\r\n\r\n    /**\r\n     * Returns svg clipPath representation of an instance\r\n     * @param {Function} [reviver] Method for further parsing of svg representation.\r\n     * @return {String} svg representation of an instance\r\n     */\r\n    toClipPathSVG: function(reviver) {\r\n      var additionalTransform = this._getOffsetTransform();\r\n      return '\\t' + this._createBaseClipPathSVGMarkup(\r\n        this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform }\r\n      );\r\n    },\r\n\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @param {Function} [reviver] Method for further parsing of svg representation.\r\n     * @return {String} svg representation of an instance\r\n     */\r\n    toSVG: function(reviver) {\r\n      var additionalTransform = this._getOffsetTransform();\r\n      return this._createBaseSVGMarkup(this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform  });\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n    /**\r\n     * Returns number representation of an instance complexity\r\n     * @return {Number} complexity of this instance\r\n     */\r\n    complexity: function() {\r\n      return this.path.length;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _calcDimensions: function() {\r\n\r\n      var aX = [],\r\n          aY = [],\r\n          current, // current instruction\r\n          subpathStartX = 0,\r\n          subpathStartY = 0,\r\n          x = 0, // current x\r\n          y = 0, // current y\r\n          bounds;\r\n\r\n      for (var i = 0, len = this.path.length; i < len; ++i) {\r\n\r\n        current = this.path[i];\r\n\r\n        switch (current[0]) { // first letter\r\n\r\n          case 'L': // lineto, absolute\r\n            x = current[1];\r\n            y = current[2];\r\n            bounds = [];\r\n            break;\r\n\r\n          case 'M': // moveTo, absolute\r\n            x = current[1];\r\n            y = current[2];\r\n            subpathStartX = x;\r\n            subpathStartY = y;\r\n            bounds = [];\r\n            break;\r\n\r\n          case 'C': // bezierCurveTo, absolute\r\n            bounds = fabric.util.getBoundsOfCurve(x, y,\r\n              current[1],\r\n              current[2],\r\n              current[3],\r\n              current[4],\r\n              current[5],\r\n              current[6]\r\n            );\r\n            x = current[5];\r\n            y = current[6];\r\n            break;\r\n\r\n          case 'Q': // quadraticCurveTo, absolute\r\n            bounds = fabric.util.getBoundsOfCurve(x, y,\r\n              current[1],\r\n              current[2],\r\n              current[1],\r\n              current[2],\r\n              current[3],\r\n              current[4]\r\n            );\r\n            x = current[3];\r\n            y = current[4];\r\n            break;\r\n\r\n          case 'z':\r\n          case 'Z':\r\n            x = subpathStartX;\r\n            y = subpathStartY;\r\n            break;\r\n        }\r\n        bounds.forEach(function (point) {\r\n          aX.push(point.x);\r\n          aY.push(point.y);\r\n        });\r\n        aX.push(x);\r\n        aY.push(y);\r\n      }\r\n\r\n      var minX = min(aX) || 0,\r\n          minY = min(aY) || 0,\r\n          maxX = max(aX) || 0,\r\n          maxY = max(aY) || 0,\r\n          deltaX = maxX - minX,\r\n          deltaY = maxY - minY;\r\n\r\n      return {\r\n        left: minX,\r\n        top: minY,\r\n        width: deltaX,\r\n        height: deltaY\r\n      };\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Creates an instance of fabric.Path from an object\r\n   * @static\r\n   * @memberOf fabric.Path\r\n   * @param {Object} object\r\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\r\n   */\r\n  fabric.Path.fromObject = function(object, callback) {\r\n    if (typeof object.sourcePath === 'string') {\r\n      var pathUrl = object.sourcePath;\r\n      fabric.loadSVGFromURL(pathUrl, function (elements) {\r\n        var path = elements[0];\r\n        path.setOptions(object);\r\n        callback && callback(path);\r\n      });\r\n    }\r\n    else {\r\n      fabric.Object._fromObject('Path', object, callback, 'path');\r\n    }\r\n  };\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\r\n   * @static\r\n   * @memberOf fabric.Path\r\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\r\n   */\r\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);\r\n\r\n  /**\r\n   * Creates an instance of fabric.Path from an SVG <path> element\r\n   * @static\r\n   * @memberOf fabric.Path\r\n   * @param {SVGElement} element to parse\r\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\r\n   * @param {Object} [options] Options object\r\n   * @param {Function} [callback] Options callback invoked after parsing is finished\r\n   */\r\n  fabric.Path.fromElement = function(element, callback, options) {\r\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\r\n    parsedAttributes.fromSVG = true;\r\n    callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));\r\n  };\r\n  /* _FROM_SVG_END_ */\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      min = fabric.util.array.min,\r\n      max = fabric.util.array.max;\r\n\r\n  if (fabric.Group) {\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Group class\r\n   * @class fabric.Group\r\n   * @extends fabric.Object\r\n   * @mixes fabric.Collection\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\r\n   * @see {@link fabric.Group#initialize} for constructor definition\r\n   */\r\n  fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'group',\r\n\r\n    /**\r\n     * Width of stroke\r\n     * @type Number\r\n     * @default\r\n     */\r\n    strokeWidth: 0,\r\n\r\n    /**\r\n     * Indicates if click, mouseover, mouseout events & hoverCursor should also check for subtargets\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    subTargetCheck: false,\r\n\r\n    /**\r\n     * Groups are container, do not render anything on theyr own, ence no cache properties\r\n     * @type Array\r\n     * @default\r\n     */\r\n    cacheProperties: [],\r\n\r\n    /**\r\n     * setOnGroup is a method used for TextBox that is no more used since 2.0.0 The behavior is still\r\n     * available setting this boolean to true.\r\n     * @type Boolean\r\n     * @since 2.0.0\r\n     * @default\r\n     */\r\n    useSetOnGroup: false,\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} objects Group objects\r\n     * @param {Object} [options] Options object\r\n     * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\r\n     * @return {Object} thisArg\r\n     */\r\n    initialize: function(objects, options, isAlreadyGrouped) {\r\n      options = options || {};\r\n      this._objects = [];\r\n      // if objects enclosed in a group have been grouped already,\r\n      // we cannot change properties of objects.\r\n      // Thus we need to set options to group without objects,\r\n      isAlreadyGrouped && this.callSuper('initialize', options);\r\n      this._objects = objects || [];\r\n      for (var i = this._objects.length; i--; ) {\r\n        this._objects[i].group = this;\r\n      }\r\n\r\n      if (!isAlreadyGrouped) {\r\n        var center = options && options.centerPoint;\r\n        // we want to set origins before calculating the bounding box.\r\n        // so that the topleft can be set with that in mind.\r\n        // if specific top and left are passed, are overwritten later\r\n        // with the callSuper('initialize', options)\r\n        if (options.originX !== undefined) {\r\n          this.originX = options.originX;\r\n        }\r\n        if (options.originY !== undefined) {\r\n          this.originY = options.originY;\r\n        }\r\n        // if coming from svg i do not want to calc bounds.\r\n        // i assume width and height are passed along options\r\n        center || this._calcBounds();\r\n        this._updateObjectsCoords(center);\r\n        delete options.centerPoint;\r\n        this.callSuper('initialize', options);\r\n      }\r\n      else {\r\n        this._updateObjectsACoords();\r\n      }\r\n\r\n      this.setCoords();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _updateObjectsACoords: function() {\r\n      var skipControls = true;\r\n      for (var i = this._objects.length; i--; ){\r\n        this._objects[i].setCoords(skipControls);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\r\n     */\r\n    _updateObjectsCoords: function(center) {\r\n      var center = center || this.getCenterPoint();\r\n      for (var i = this._objects.length; i--; ){\r\n        this._updateObjectCoords(this._objects[i], center);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} object\r\n     * @param {fabric.Point} center, current center of group.\r\n     */\r\n    _updateObjectCoords: function(object, center) {\r\n      var objectLeft = object.left,\r\n          objectTop = object.top,\r\n          skipControls = true;\r\n\r\n      object.set({\r\n        left: objectLeft - center.x,\r\n        top: objectTop - center.y\r\n      });\r\n      object.group = this;\r\n      object.setCoords(skipControls);\r\n    },\r\n\r\n    /**\r\n     * Returns string represenation of a group\r\n     * @return {String}\r\n     */\r\n    toString: function() {\r\n      return '#<fabric.Group: (' + this.complexity() + ')>';\r\n    },\r\n\r\n    /**\r\n     * Adds an object to a group; Then recalculates group's dimension, position.\r\n     * @param {Object} object\r\n     * @return {fabric.Group} thisArg\r\n     * @chainable\r\n     */\r\n    addWithUpdate: function(object) {\r\n      var nested = !!this.group;\r\n      this._restoreObjectsState();\r\n      fabric.util.resetObjectTransform(this);\r\n      if (object) {\r\n        if (nested) {\r\n          // if this group is inside another group, we need to pre transform the object\r\n          fabric.util.removeTransformFromObject(object, this.group.calcTransformMatrix());\r\n        }\r\n        this._objects.push(object);\r\n        object.group = this;\r\n        object._set('canvas', this.canvas);\r\n      }\r\n      this._calcBounds();\r\n      this._updateObjectsCoords();\r\n      this.dirty = true;\r\n      if (nested) {\r\n        this.group.addWithUpdate();\r\n      }\r\n      else {\r\n        this.setCoords();\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Removes an object from a group; Then recalculates group's dimension, position.\r\n     * @param {Object} object\r\n     * @return {fabric.Group} thisArg\r\n     * @chainable\r\n     */\r\n    removeWithUpdate: function(object) {\r\n      this._restoreObjectsState();\r\n      fabric.util.resetObjectTransform(this);\r\n\r\n      this.remove(object);\r\n      this._calcBounds();\r\n      this._updateObjectsCoords();\r\n      this.setCoords();\r\n      this.dirty = true;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _onObjectAdded: function(object) {\r\n      this.dirty = true;\r\n      object.group = this;\r\n      object._set('canvas', this.canvas);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _onObjectRemoved: function(object) {\r\n      this.dirty = true;\r\n      delete object.group;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _set: function(key, value) {\r\n      var i = this._objects.length;\r\n      if (this.useSetOnGroup) {\r\n        while (i--) {\r\n          this._objects[i].setOnGroup(key, value);\r\n        }\r\n      }\r\n      if (key === 'canvas') {\r\n        while (i--) {\r\n          this._objects[i]._set(key, value);\r\n        }\r\n      }\r\n      fabric.Object.prototype._set.call(this, key, value);\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      var _includeDefaultValues = this.includeDefaultValues;\r\n      var objsToObject = this._objects\r\n        .filter(function (obj) {\r\n          return !obj.excludeFromExport;\r\n        })\r\n        .map(function (obj) {\r\n          var originalDefaults = obj.includeDefaultValues;\r\n          obj.includeDefaultValues = _includeDefaultValues;\r\n          var _obj = obj.toObject(propertiesToInclude);\r\n          obj.includeDefaultValues = originalDefaults;\r\n          return _obj;\r\n        });\r\n      var obj = fabric.Object.prototype.toObject.call(this, propertiesToInclude);\r\n      obj.objects = objsToObject;\r\n      return obj;\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance, in dataless mode.\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toDatalessObject: function(propertiesToInclude) {\r\n      var objsToObject, sourcePath = this.sourcePath;\r\n      if (sourcePath) {\r\n        objsToObject = sourcePath;\r\n      }\r\n      else {\r\n        var _includeDefaultValues = this.includeDefaultValues;\r\n        objsToObject = this._objects.map(function(obj) {\r\n          var originalDefaults = obj.includeDefaultValues;\r\n          obj.includeDefaultValues = _includeDefaultValues;\r\n          var _obj = obj.toDatalessObject(propertiesToInclude);\r\n          obj.includeDefaultValues = originalDefaults;\r\n          return _obj;\r\n        });\r\n      }\r\n      var obj = fabric.Object.prototype.toDatalessObject.call(this, propertiesToInclude);\r\n      obj.objects = objsToObject;\r\n      return obj;\r\n    },\r\n\r\n    /**\r\n     * Renders instance on a given context\r\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\r\n     */\r\n    render: function(ctx) {\r\n      this._transformDone = true;\r\n      this.callSuper('render', ctx);\r\n      this._transformDone = false;\r\n    },\r\n\r\n    /**\r\n     * Decide if the object should cache or not. Create its own cache level\r\n     * needsItsOwnCache should be used when the object drawing method requires\r\n     * a cache step. None of the fabric classes requires it.\r\n     * Generally you do not cache objects in groups because the group is already cached.\r\n     * @return {Boolean}\r\n     */\r\n    shouldCache: function() {\r\n      var ownCache = fabric.Object.prototype.shouldCache.call(this);\r\n      if (ownCache) {\r\n        for (var i = 0, len = this._objects.length; i < len; i++) {\r\n          if (this._objects[i].willDrawShadow()) {\r\n            this.ownCaching = false;\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n      return ownCache;\r\n    },\r\n\r\n    /**\r\n     * Check if this object or a child object will cast a shadow\r\n     * @return {Boolean}\r\n     */\r\n    willDrawShadow: function() {\r\n      if (fabric.Object.prototype.willDrawShadow.call(this)) {\r\n        return true;\r\n      }\r\n      for (var i = 0, len = this._objects.length; i < len; i++) {\r\n        if (this._objects[i].willDrawShadow()) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Check if this group or its parent group are caching, recursively up\r\n     * @return {Boolean}\r\n     */\r\n    isOnACache: function() {\r\n      return this.ownCaching || (this.group && this.group.isOnACache());\r\n    },\r\n\r\n    /**\r\n     * Execute the drawing operation for an object on a specified context\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    drawObject: function(ctx) {\r\n      for (var i = 0, len = this._objects.length; i < len; i++) {\r\n        this._objects[i].render(ctx);\r\n      }\r\n      this._drawClipPath(ctx, this.clipPath);\r\n    },\r\n\r\n    /**\r\n     * Check if cache is dirty\r\n     */\r\n    isCacheDirty: function(skipCanvas) {\r\n      if (this.callSuper('isCacheDirty', skipCanvas)) {\r\n        return true;\r\n      }\r\n      if (!this.statefullCache) {\r\n        return false;\r\n      }\r\n      for (var i = 0, len = this._objects.length; i < len; i++) {\r\n        if (this._objects[i].isCacheDirty(true)) {\r\n          if (this._cacheCanvas) {\r\n            // if this group has not a cache canvas there is nothing to clean\r\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\r\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\r\n          }\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Restores original state of each of group objects (original state is that which was before group was created).\r\n     * if the nested boolean is true, the original state will be restored just for the\r\n     * first group and not for all the group chain\r\n     * @private\r\n     * @param {Boolean} nested tell the function to restore object state up to the parent group and not more\r\n     * @return {fabric.Group} thisArg\r\n     * @chainable\r\n     */\r\n    _restoreObjectsState: function() {\r\n      var groupMatrix = this.calcOwnMatrix();\r\n      this._objects.forEach(function(object) {\r\n        // instead of using _this = this;\r\n        fabric.util.addTransformToObject(object, groupMatrix);\r\n        delete object.group;\r\n        object.setCoords();\r\n      });\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Destroys a group (restoring state of its objects)\r\n     * @return {fabric.Group} thisArg\r\n     * @chainable\r\n     */\r\n    destroy: function() {\r\n      // when group is destroyed objects needs to get a repaint to be eventually\r\n      // displayed on canvas.\r\n      this._objects.forEach(function(object) {\r\n        object.set('dirty', true);\r\n      });\r\n      return this._restoreObjectsState();\r\n    },\r\n\r\n    dispose: function () {\r\n      this.callSuper('dispose');\r\n      this.forEachObject(function (object) {\r\n        object.dispose && object.dispose();\r\n      });\r\n      this._objects = [];\r\n    },\r\n\r\n    /**\r\n     * make a group an active selection, remove the group from canvas\r\n     * the group has to be on canvas for this to work.\r\n     * @return {fabric.ActiveSelection} thisArg\r\n     * @chainable\r\n     */\r\n    toActiveSelection: function() {\r\n      if (!this.canvas) {\r\n        return;\r\n      }\r\n      var objects = this._objects, canvas = this.canvas;\r\n      this._objects = [];\r\n      var options = this.toObject();\r\n      delete options.objects;\r\n      var activeSelection = new fabric.ActiveSelection([]);\r\n      activeSelection.set(options);\r\n      activeSelection.type = 'activeSelection';\r\n      canvas.remove(this);\r\n      objects.forEach(function(object) {\r\n        object.group = activeSelection;\r\n        object.dirty = true;\r\n        canvas.add(object);\r\n      });\r\n      activeSelection.canvas = canvas;\r\n      activeSelection._objects = objects;\r\n      canvas._activeObject = activeSelection;\r\n      activeSelection.setCoords();\r\n      return activeSelection;\r\n    },\r\n\r\n    /**\r\n     * Destroys a group (restoring state of its objects)\r\n     * @return {fabric.Group} thisArg\r\n     * @chainable\r\n     */\r\n    ungroupOnCanvas: function() {\r\n      return this._restoreObjectsState();\r\n    },\r\n\r\n    /**\r\n     * Sets coordinates of all objects inside group\r\n     * @return {fabric.Group} thisArg\r\n     * @chainable\r\n     */\r\n    setObjectsCoords: function() {\r\n      var skipControls = true;\r\n      this.forEachObject(function(object) {\r\n        object.setCoords(skipControls);\r\n      });\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _calcBounds: function(onlyWidthHeight) {\r\n      var aX = [],\r\n          aY = [],\r\n          o, prop, coords,\r\n          props = ['tr', 'br', 'bl', 'tl'],\r\n          i = 0, iLen = this._objects.length,\r\n          j, jLen = props.length;\r\n\r\n      for ( ; i < iLen; ++i) {\r\n        o = this._objects[i];\r\n        coords = o.calcACoords();\r\n        for (j = 0; j < jLen; j++) {\r\n          prop = props[j];\r\n          aX.push(coords[prop].x);\r\n          aY.push(coords[prop].y);\r\n        }\r\n        o.aCoords = coords;\r\n      }\r\n\r\n      this._getBounds(aX, aY, onlyWidthHeight);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _getBounds: function(aX, aY, onlyWidthHeight) {\r\n      var minXY = new fabric.Point(min(aX), min(aY)),\r\n          maxXY = new fabric.Point(max(aX), max(aY)),\r\n          top = minXY.y || 0, left = minXY.x || 0,\r\n          width = (maxXY.x - minXY.x) || 0,\r\n          height = (maxXY.y - minXY.y) || 0;\r\n      this.width = width;\r\n      this.height = height;\r\n      if (!onlyWidthHeight) {\r\n        // the bounding box always finds the topleft most corner.\r\n        // whatever is the group origin, we set up here the left/top position.\r\n        this.setPositionByOrigin({ x: left, y: top }, 'left', 'top');\r\n      }\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @param {Function} [reviver] Method for further parsing of svg representation.\r\n     * @return {String} svg representation of an instance\r\n     */\r\n    _toSVG: function(reviver) {\r\n      var svgString = ['<g ', 'COMMON_PARTS', ' >\\n'];\r\n\r\n      for (var i = 0, len = this._objects.length; i < len; i++) {\r\n        svgString.push('\\t\\t', this._objects[i].toSVG(reviver));\r\n      }\r\n      svgString.push('</g>\\n');\r\n      return svgString;\r\n    },\r\n\r\n    /**\r\n     * Returns styles-string for svg-export, specific version for group\r\n     * @return {String}\r\n     */\r\n    getSvgStyles: function() {\r\n      var opacity = typeof this.opacity !== 'undefined' && this.opacity !== 1 ?\r\n            'opacity: ' + this.opacity + ';' : '',\r\n          visibility = this.visible ? '' : ' visibility: hidden;';\r\n      return [\r\n        opacity,\r\n        this.getSvgFilter(),\r\n        visibility\r\n      ].join('');\r\n    },\r\n\r\n    /**\r\n     * Returns svg clipPath representation of an instance\r\n     * @param {Function} [reviver] Method for further parsing of svg representation.\r\n     * @return {String} svg representation of an instance\r\n     */\r\n    toClipPathSVG: function(reviver) {\r\n      var svgString = [];\r\n\r\n      for (var i = 0, len = this._objects.length; i < len; i++) {\r\n        svgString.push('\\t', this._objects[i].toClipPathSVG(reviver));\r\n      }\r\n\r\n      return this._createBaseClipPathSVGMarkup(svgString, { reviver: reviver });\r\n    },\r\n    /* _TO_SVG_END_ */\r\n  });\r\n\r\n  /**\r\n   * Returns {@link fabric.Group} instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Group\r\n   * @param {Object} object Object to create a group from\r\n   * @param {Function} [callback] Callback to invoke when an group instance is created\r\n   */\r\n  fabric.Group.fromObject = function(object, callback) {\r\n    var objects = object.objects,\r\n        options = fabric.util.object.clone(object, true);\r\n    delete options.objects;\r\n    if (typeof objects === 'string') {\r\n      // it has to be an url or something went wrong.\r\n      fabric.loadSVGFromURL(objects, function (elements) {\r\n        var group = fabric.util.groupSVGElements(elements, object, objects);\r\n        group.set(options);\r\n        callback && callback(group);\r\n      });\r\n      return;\r\n    }\r\n    fabric.util.enlivenObjects(objects, function (enlivenedObjects) {\r\n      var options = fabric.util.object.clone(object, true);\r\n      delete options.objects;\r\n      fabric.util.enlivenObjectEnlivables(object, options, function () {\r\n        callback && callback(new fabric.Group(enlivenedObjects, options, true));\r\n      });\r\n    });\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { });\r\n\r\n  if (fabric.ActiveSelection) {\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Group class\r\n   * @class fabric.ActiveSelection\r\n   * @extends fabric.Group\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\r\n   * @see {@link fabric.ActiveSelection#initialize} for constructor definition\r\n   */\r\n  fabric.ActiveSelection = fabric.util.createClass(fabric.Group, /** @lends fabric.ActiveSelection.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'activeSelection',\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} objects ActiveSelection objects\r\n     * @param {Object} [options] Options object\r\n     * @return {Object} thisArg\r\n     */\r\n    initialize: function(objects, options) {\r\n      options = options || {};\r\n      this._objects = objects || [];\r\n      for (var i = this._objects.length; i--; ) {\r\n        this._objects[i].group = this;\r\n      }\r\n\r\n      if (options.originX) {\r\n        this.originX = options.originX;\r\n      }\r\n      if (options.originY) {\r\n        this.originY = options.originY;\r\n      }\r\n      this._calcBounds();\r\n      this._updateObjectsCoords();\r\n      fabric.Object.prototype.initialize.call(this, options);\r\n      this.setCoords();\r\n    },\r\n\r\n    /**\r\n     * Change te activeSelection to a normal group,\r\n     * High level function that automatically adds it to canvas as\r\n     * active object. no events fired.\r\n     * @since 2.0.0\r\n     * @return {fabric.Group}\r\n     */\r\n    toGroup: function() {\r\n      var objects = this._objects.concat();\r\n      this._objects = [];\r\n      var options = fabric.Object.prototype.toObject.call(this);\r\n      var newGroup = new fabric.Group([]);\r\n      delete options.type;\r\n      newGroup.set(options);\r\n      objects.forEach(function(object) {\r\n        object.canvas.remove(object);\r\n        object.group = newGroup;\r\n      });\r\n      newGroup._objects = objects;\r\n      if (!this.canvas) {\r\n        return newGroup;\r\n      }\r\n      var canvas = this.canvas;\r\n      canvas.add(newGroup);\r\n      canvas._activeObject = newGroup;\r\n      newGroup.setCoords();\r\n      return newGroup;\r\n    },\r\n\r\n    /**\r\n     * If returns true, deselection is cancelled.\r\n     * @since 2.0.0\r\n     * @return {Boolean} [cancel]\r\n     */\r\n    onDeselect: function() {\r\n      this.destroy();\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Returns string representation of a group\r\n     * @return {String}\r\n     */\r\n    toString: function() {\r\n      return '#<fabric.ActiveSelection: (' + this.complexity() + ')>';\r\n    },\r\n\r\n    /**\r\n     * Decide if the object should cache or not. Create its own cache level\r\n     * objectCaching is a global flag, wins over everything\r\n     * needsItsOwnCache should be used when the object drawing method requires\r\n     * a cache step. None of the fabric classes requires it.\r\n     * Generally you do not cache objects in groups because the group outside is cached.\r\n     * @return {Boolean}\r\n     */\r\n    shouldCache: function() {\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Check if this group or its parent group are caching, recursively up\r\n     * @return {Boolean}\r\n     */\r\n    isOnACache: function() {\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Renders controls and borders for the object\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {Object} [styleOverride] properties to override the object style\r\n     * @param {Object} [childrenOverride] properties to override the children overrides\r\n     */\r\n    _renderControls: function(ctx, styleOverride, childrenOverride) {\r\n      ctx.save();\r\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\r\n      this.callSuper('_renderControls', ctx, styleOverride);\r\n      childrenOverride = childrenOverride || { };\r\n      if (typeof childrenOverride.hasControls === 'undefined') {\r\n        childrenOverride.hasControls = false;\r\n      }\r\n      childrenOverride.forActiveSelection = true;\r\n      for (var i = 0, len = this._objects.length; i < len; i++) {\r\n        this._objects[i]._renderControls(ctx, childrenOverride);\r\n      }\r\n      ctx.restore();\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns {@link fabric.ActiveSelection} instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.ActiveSelection\r\n   * @param {Object} object Object to create a group from\r\n   * @param {Function} [callback] Callback to invoke when an ActiveSelection instance is created\r\n   */\r\n  fabric.ActiveSelection.fromObject = function(object, callback) {\r\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\r\n      delete object.objects;\r\n      callback && callback(new fabric.ActiveSelection(enlivenedObjects, object, true));\r\n    });\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var extend = fabric.util.object.extend;\r\n\r\n  if (!global.fabric) {\r\n    global.fabric = { };\r\n  }\r\n\r\n  if (global.fabric.Image) {\r\n    fabric.warn('fabric.Image is already defined.');\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Image class\r\n   * @class fabric.Image\r\n   * @extends fabric.Object\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\r\n   * @see {@link fabric.Image#initialize} for constructor definition\r\n   */\r\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'image',\r\n\r\n    /**\r\n     * Width of a stroke.\r\n     * For image quality a stroke multiple of 2 gives better results.\r\n     * @type Number\r\n     * @default\r\n     */\r\n    strokeWidth: 0,\r\n\r\n    /**\r\n     * When calling {@link fabric.Image.getSrc}, return value from element src with `element.getAttribute('src')`.\r\n     * This allows for relative urls as image src.\r\n     * @since 2.7.0\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    srcFromAttribute: false,\r\n\r\n    /**\r\n     * private\r\n     * contains last value of scaleX to detect\r\n     * if the Image got resized after the last Render\r\n     * @type Number\r\n     */\r\n    _lastScaleX: 1,\r\n\r\n    /**\r\n     * private\r\n     * contains last value of scaleY to detect\r\n     * if the Image got resized after the last Render\r\n     * @type Number\r\n     */\r\n    _lastScaleY: 1,\r\n\r\n    /**\r\n     * private\r\n     * contains last value of scaling applied by the apply filter chain\r\n     * @type Number\r\n     */\r\n    _filterScalingX: 1,\r\n\r\n    /**\r\n     * private\r\n     * contains last value of scaling applied by the apply filter chain\r\n     * @type Number\r\n     */\r\n    _filterScalingY: 1,\r\n\r\n    /**\r\n     * minimum scale factor under which any resizeFilter is triggered to resize the image\r\n     * 0 will disable the automatic resize. 1 will trigger automatically always.\r\n     * number bigger than 1 are not implemented yet.\r\n     * @type Number\r\n     */\r\n    minimumScaleTrigger: 0.5,\r\n\r\n    /**\r\n     * List of properties to consider when checking if\r\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\r\n     * as well as for history (undo/redo) purposes\r\n     * @type Array\r\n     */\r\n    stateProperties: fabric.Object.prototype.stateProperties.concat('cropX', 'cropY'),\r\n\r\n    /**\r\n     * List of properties to consider when checking if cache needs refresh\r\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\r\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\r\n     * and refreshed at the next render\r\n     * @type Array\r\n     */\r\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('cropX', 'cropY'),\r\n\r\n    /**\r\n     * key used to retrieve the texture representing this image\r\n     * @since 2.0.0\r\n     * @type String\r\n     * @default\r\n     */\r\n    cacheKey: '',\r\n\r\n    /**\r\n     * Image crop in pixels from original image size.\r\n     * @since 2.0.0\r\n     * @type Number\r\n     * @default\r\n     */\r\n    cropX: 0,\r\n\r\n    /**\r\n     * Image crop in pixels from original image size.\r\n     * @since 2.0.0\r\n     * @type Number\r\n     * @default\r\n     */\r\n    cropY: 0,\r\n\r\n    /**\r\n     * Indicates whether this canvas will use image smoothing when painting this image.\r\n     * Also influence if the cacheCanvas for this image uses imageSmoothing\r\n     * @since 4.0.0-beta.11\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    imageSmoothing: true,\r\n\r\n    /**\r\n     * Constructor\r\n     * Image can be initialized with any canvas drawable or a string.\r\n     * The string should be a url and will be loaded as an image.\r\n     * Canvas and Image element work out of the box, while videos require extra code to work.\r\n     * Please check video element events for seeking.\r\n     * @param {HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | String} element Image element\r\n     * @param {Object} [options] Options object\r\n     * @param {function} [callback] callback function to call after eventual filters applied.\r\n     * @return {fabric.Image} thisArg\r\n     */\r\n    initialize: function(element, options) {\r\n      options || (options = { });\r\n      this.filters = [];\r\n      this.cacheKey = 'texture' + fabric.Object.__uid++;\r\n      this.callSuper('initialize', options);\r\n      this._initElement(element, options);\r\n    },\r\n\r\n    /**\r\n     * Returns image element which this instance if based on\r\n     * @return {HTMLImageElement} Image element\r\n     */\r\n    getElement: function() {\r\n      return this._element || {};\r\n    },\r\n\r\n    /**\r\n     * Sets image element for this instance to a specified one.\r\n     * If filters defined they are applied to new image.\r\n     * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\r\n     * @param {HTMLImageElement} element\r\n     * @param {Object} [options] Options object\r\n     * @return {fabric.Image} thisArg\r\n     * @chainable\r\n     */\r\n    setElement: function(element, options) {\r\n      this.removeTexture(this.cacheKey);\r\n      this.removeTexture(this.cacheKey + '_filtered');\r\n      this._element = element;\r\n      this._originalElement = element;\r\n      this._initConfig(options);\r\n      if (this.filters.length !== 0) {\r\n        this.applyFilters();\r\n      }\r\n      // resizeFilters work on the already filtered copy.\r\n      // we need to apply resizeFilters AFTER normal filters.\r\n      // applyResizeFilters is run more often than normal filters\r\n      // and is triggered by user interactions rather than dev code\r\n      if (this.resizeFilter) {\r\n        this.applyResizeFilters();\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Delete a single texture if in webgl mode\r\n     */\r\n    removeTexture: function(key) {\r\n      var backend = fabric.filterBackend;\r\n      if (backend && backend.evictCachesForKey) {\r\n        backend.evictCachesForKey(key);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Delete textures, reference to elements and eventually JSDOM cleanup\r\n     */\r\n    dispose: function () {\r\n      this.callSuper('dispose');\r\n      this.removeTexture(this.cacheKey);\r\n      this.removeTexture(this.cacheKey + '_filtered');\r\n      this._cacheContext = undefined;\r\n      ['_originalElement', '_element', '_filteredEl', '_cacheCanvas'].forEach((function(element) {\r\n        fabric.util.cleanUpJsdomNode(this[element]);\r\n        this[element] = undefined;\r\n      }).bind(this));\r\n    },\r\n\r\n    /**\r\n     * Get the crossOrigin value (of the corresponding image element)\r\n     */\r\n    getCrossOrigin: function() {\r\n      return this._originalElement && (this._originalElement.crossOrigin || null);\r\n    },\r\n\r\n    /**\r\n     * Returns original size of an image\r\n     * @return {Object} Object with \"width\" and \"height\" properties\r\n     */\r\n    getOriginalSize: function() {\r\n      var element = this.getElement();\r\n      return {\r\n        width: element.naturalWidth || element.width,\r\n        height: element.naturalHeight || element.height\r\n      };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _stroke: function(ctx) {\r\n      if (!this.stroke || this.strokeWidth === 0) {\r\n        return;\r\n      }\r\n      var w = this.width / 2, h = this.height / 2;\r\n      ctx.beginPath();\r\n      ctx.moveTo(-w, -h);\r\n      ctx.lineTo(w, -h);\r\n      ctx.lineTo(w, h);\r\n      ctx.lineTo(-w, h);\r\n      ctx.lineTo(-w, -h);\r\n      ctx.closePath();\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      var filters = [];\r\n\r\n      this.filters.forEach(function(filterObj) {\r\n        if (filterObj) {\r\n          filters.push(filterObj.toObject());\r\n        }\r\n      });\r\n      var object = extend(\r\n        this.callSuper(\r\n          'toObject',\r\n          ['cropX', 'cropY'].concat(propertiesToInclude)\r\n        ), {\r\n          src: this.getSrc(),\r\n          crossOrigin: this.getCrossOrigin(),\r\n          filters: filters,\r\n        });\r\n      if (this.resizeFilter) {\r\n        object.resizeFilter = this.resizeFilter.toObject();\r\n      }\r\n      return object;\r\n    },\r\n\r\n    /**\r\n     * Returns true if an image has crop applied, inspecting values of cropX,cropY,width,height.\r\n     * @return {Boolean}\r\n     */\r\n    hasCrop: function() {\r\n      return this.cropX || this.cropY || this.width < this._element.width || this.height < this._element.height;\r\n    },\r\n\r\n    /* _TO_SVG_START_ */\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @return {Array} an array of strings with the specific svg representation\r\n     * of the instance\r\n     */\r\n    _toSVG: function() {\r\n      var svgString = [], imageMarkup = [], strokeSvg, element = this._element,\r\n          x = -this.width / 2, y = -this.height / 2, clipPath = '', imageRendering = '';\r\n      if (!element) {\r\n        return [];\r\n      }\r\n      if (this.hasCrop()) {\r\n        var clipPathId = fabric.Object.__uid++;\r\n        svgString.push(\r\n          '<clipPath id=\"imageCrop_' + clipPathId + '\">\\n',\r\n          '\\t<rect x=\"' + x + '\" y=\"' + y + '\" width=\"' + this.width + '\" height=\"' + this.height + '\" />\\n',\r\n          '</clipPath>\\n'\r\n        );\r\n        clipPath = ' clip-path=\"url(#imageCrop_' + clipPathId + ')\" ';\r\n      }\r\n      if (!this.imageSmoothing) {\r\n        imageRendering = '\" image-rendering=\"optimizeSpeed';\r\n      }\r\n      imageMarkup.push('\\t<image ', 'COMMON_PARTS', 'xlink:href=\"', this.getSvgSrc(true),\r\n        '\" x=\"', x - this.cropX, '\" y=\"', y - this.cropY,\r\n        // we're essentially moving origin of transformation from top/left corner to the center of the shape\r\n        // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\r\n        // so that object's center aligns with container's left/top\r\n        '\" width=\"', element.width || element.naturalWidth,\r\n        '\" height=\"', element.height || element.height,\r\n        imageRendering,\r\n        '\"', clipPath,\r\n        '></image>\\n');\r\n\r\n      if (this.stroke || this.strokeDashArray) {\r\n        var origFill = this.fill;\r\n        this.fill = null;\r\n        strokeSvg = [\r\n          '\\t<rect ',\r\n          'x=\"', x, '\" y=\"', y,\r\n          '\" width=\"', this.width, '\" height=\"', this.height,\r\n          '\" style=\"', this.getSvgStyles(),\r\n          '\"/>\\n'\r\n        ];\r\n        this.fill = origFill;\r\n      }\r\n      if (this.paintFirst !== 'fill') {\r\n        svgString = svgString.concat(strokeSvg, imageMarkup);\r\n      }\r\n      else {\r\n        svgString = svgString.concat(imageMarkup, strokeSvg);\r\n      }\r\n      return svgString;\r\n    },\r\n    /* _TO_SVG_END_ */\r\n\r\n    /**\r\n     * Returns source of an image\r\n     * @param {Boolean} filtered indicates if the src is needed for svg\r\n     * @return {String} Source of an image\r\n     */\r\n    getSrc: function(filtered) {\r\n      var element = filtered ? this._element : this._originalElement;\r\n      if (element) {\r\n        if (element.toDataURL) {\r\n          return element.toDataURL();\r\n        }\r\n\r\n        if (this.srcFromAttribute) {\r\n          return element.getAttribute('src');\r\n        }\r\n        else {\r\n          return element.src;\r\n        }\r\n      }\r\n      else {\r\n        return this.src || '';\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Sets source of an image\r\n     * @param {String} src Source string (URL)\r\n     * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\r\n     * @param {Object} [options] Options object\r\n     * @param {String} [options.crossOrigin] crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\r\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\r\n     * @return {fabric.Image} thisArg\r\n     * @chainable\r\n     */\r\n    setSrc: function(src, callback, options) {\r\n      fabric.util.loadImage(src, function(img, isError) {\r\n        this.setElement(img, options);\r\n        this._setWidthHeight();\r\n        callback && callback(this, isError);\r\n      }, this, options && options.crossOrigin);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns string representation of an instance\r\n     * @return {String} String representation of an instance\r\n     */\r\n    toString: function() {\r\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\r\n    },\r\n\r\n    applyResizeFilters: function() {\r\n      var filter = this.resizeFilter,\r\n          minimumScale = this.minimumScaleTrigger,\r\n          objectScale = this.getTotalObjectScaling(),\r\n          scaleX = objectScale.scaleX,\r\n          scaleY = objectScale.scaleY,\r\n          elementToFilter = this._filteredEl || this._originalElement;\r\n      if (this.group) {\r\n        this.set('dirty', true);\r\n      }\r\n      if (!filter || (scaleX > minimumScale && scaleY > minimumScale)) {\r\n        this._element = elementToFilter;\r\n        this._filterScalingX = 1;\r\n        this._filterScalingY = 1;\r\n        this._lastScaleX = scaleX;\r\n        this._lastScaleY = scaleY;\r\n        return;\r\n      }\r\n      if (!fabric.filterBackend) {\r\n        fabric.filterBackend = fabric.initFilterBackend();\r\n      }\r\n      var canvasEl = fabric.util.createCanvasElement(),\r\n          cacheKey = this._filteredEl ? (this.cacheKey + '_filtered') : this.cacheKey,\r\n          sourceWidth = elementToFilter.width, sourceHeight = elementToFilter.height;\r\n      canvasEl.width = sourceWidth;\r\n      canvasEl.height = sourceHeight;\r\n      this._element = canvasEl;\r\n      this._lastScaleX = filter.scaleX = scaleX;\r\n      this._lastScaleY = filter.scaleY = scaleY;\r\n      fabric.filterBackend.applyFilters(\r\n        [filter], elementToFilter, sourceWidth, sourceHeight, this._element, cacheKey);\r\n      this._filterScalingX = canvasEl.width / this._originalElement.width;\r\n      this._filterScalingY = canvasEl.height / this._originalElement.height;\r\n    },\r\n\r\n    /**\r\n     * Applies filters assigned to this image (from \"filters\" array) or from filter param\r\n     * @method applyFilters\r\n     * @param {Array} filters to be applied\r\n     * @param {Boolean} forResizing specify if the filter operation is a resize operation\r\n     * @return {thisArg} return the fabric.Image object\r\n     * @chainable\r\n     */\r\n    applyFilters: function(filters) {\r\n\r\n      filters = filters || this.filters || [];\r\n      filters = filters.filter(function(filter) { return filter && !filter.isNeutralState(); });\r\n      this.set('dirty', true);\r\n\r\n      // needs to clear out or WEBGL will not resize correctly\r\n      this.removeTexture(this.cacheKey + '_filtered');\r\n\r\n      if (filters.length === 0) {\r\n        this._element = this._originalElement;\r\n        this._filteredEl = null;\r\n        this._filterScalingX = 1;\r\n        this._filterScalingY = 1;\r\n        return this;\r\n      }\r\n\r\n      var imgElement = this._originalElement,\r\n          sourceWidth = imgElement.naturalWidth || imgElement.width,\r\n          sourceHeight = imgElement.naturalHeight || imgElement.height;\r\n\r\n      if (this._element === this._originalElement) {\r\n        // if the element is the same we need to create a new element\r\n        var canvasEl = fabric.util.createCanvasElement();\r\n        canvasEl.width = sourceWidth;\r\n        canvasEl.height = sourceHeight;\r\n        this._element = canvasEl;\r\n        this._filteredEl = canvasEl;\r\n      }\r\n      else {\r\n        // clear the existing element to get new filter data\r\n        // also dereference the eventual resized _element\r\n        this._element = this._filteredEl;\r\n        this._filteredEl.getContext('2d').clearRect(0, 0, sourceWidth, sourceHeight);\r\n        // we also need to resize again at next renderAll, so remove saved _lastScaleX/Y\r\n        this._lastScaleX = 1;\r\n        this._lastScaleY = 1;\r\n      }\r\n      if (!fabric.filterBackend) {\r\n        fabric.filterBackend = fabric.initFilterBackend();\r\n      }\r\n      fabric.filterBackend.applyFilters(\r\n        filters, this._originalElement, sourceWidth, sourceHeight, this._element, this.cacheKey);\r\n      if (this._originalElement.width !== this._element.width ||\r\n        this._originalElement.height !== this._element.height) {\r\n        this._filterScalingX = this._element.width / this._originalElement.width;\r\n        this._filterScalingY = this._element.height / this._originalElement.height;\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\r\n      if (this.isMoving !== true && this.resizeFilter && this._needsResize()) {\r\n        this.applyResizeFilters();\r\n      }\r\n      this._stroke(ctx);\r\n      this._renderPaintInOrder(ctx);\r\n    },\r\n\r\n    /**\r\n     * Paint the cached copy of the object on the target context.\r\n     * it will set the imageSmoothing for the draw operation\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    drawCacheOnCanvas: function(ctx) {\r\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\r\n      fabric.Object.prototype.drawCacheOnCanvas.call(this, ctx);\r\n    },\r\n\r\n    /**\r\n     * Decide if the object should cache or not. Create its own cache level\r\n     * needsItsOwnCache should be used when the object drawing method requires\r\n     * a cache step. None of the fabric classes requires it.\r\n     * Generally you do not cache objects in groups because the group outside is cached.\r\n     * This is the special image version where we would like to avoid caching where possible.\r\n     * Essentially images do not benefit from caching. They may require caching, and in that\r\n     * case we do it. Also caching an image usually ends in a loss of details.\r\n     * A full performance audit should be done.\r\n     * @return {Boolean}\r\n     */\r\n    shouldCache: function() {\r\n      return this.needsItsOwnCache();\r\n    },\r\n\r\n    _renderFill: function(ctx) {\r\n      var elementToDraw = this._element;\r\n      if (!elementToDraw) {\r\n        return;\r\n      }\r\n      var scaleX = this._filterScalingX, scaleY = this._filterScalingY,\r\n          w = this.width, h = this.height, min = Math.min, max = Math.max,\r\n          // crop values cannot be lesser than 0.\r\n          cropX = max(this.cropX, 0), cropY = max(this.cropY, 0),\r\n          elWidth = elementToDraw.naturalWidth || elementToDraw.width,\r\n          elHeight = elementToDraw.naturalHeight || elementToDraw.height,\r\n          sX = cropX * scaleX,\r\n          sY = cropY * scaleY,\r\n          // the width height cannot exceed element width/height, starting from the crop offset.\r\n          sW = min(w * scaleX, elWidth - sX),\r\n          sH = min(h * scaleY, elHeight - sY),\r\n          x = -w / 2, y = -h / 2,\r\n          maxDestW = min(w, elWidth / scaleX - cropX),\r\n          maxDestH = min(h, elHeight / scaleY - cropY);\r\n\r\n      elementToDraw && ctx.drawImage(elementToDraw, sX, sY, sW, sH, x, y, maxDestW, maxDestH);\r\n    },\r\n\r\n    /**\r\n     * needed to check if image needs resize\r\n     * @private\r\n     */\r\n    _needsResize: function() {\r\n      var scale = this.getTotalObjectScaling();\r\n      return (scale.scaleX !== this._lastScaleX || scale.scaleY !== this._lastScaleY);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _resetWidthHeight: function() {\r\n      this.set(this.getOriginalSize());\r\n    },\r\n\r\n    /**\r\n     * The Image class's initialization method. This method is automatically\r\n     * called by the constructor.\r\n     * @private\r\n     * @param {HTMLImageElement|String} element The element representing the image\r\n     * @param {Object} [options] Options object\r\n     */\r\n    _initElement: function(element, options) {\r\n      this.setElement(fabric.util.getById(element), options);\r\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} [options] Options object\r\n     */\r\n    _initConfig: function(options) {\r\n      options || (options = { });\r\n      this.setOptions(options);\r\n      this._setWidthHeight(options);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Array} filters to be initialized\r\n     * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\r\n     */\r\n    _initFilters: function(filters, callback) {\r\n      if (filters && filters.length) {\r\n        fabric.util.enlivenObjects(filters, function(enlivenedObjects) {\r\n          callback && callback(enlivenedObjects);\r\n        }, 'fabric.Image.filters');\r\n      }\r\n      else {\r\n        callback && callback();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * Set the width and the height of the image object, using the element or the\r\n     * options.\r\n     * @param {Object} [options] Object with width/height properties\r\n     */\r\n    _setWidthHeight: function(options) {\r\n      options || (options = { });\r\n      var el = this.getElement();\r\n      this.width = options.width || el.naturalWidth || el.width || 0;\r\n      this.height = options.height || el.naturalHeight || el.height || 0;\r\n    },\r\n\r\n    /**\r\n     * Calculate offset for center and scale factor for the image in order to respect\r\n     * the preserveAspectRatio attribute\r\n     * @private\r\n     * @return {Object}\r\n     */\r\n    parsePreserveAspectRatioAttribute: function() {\r\n      var pAR = fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio || ''),\r\n          rWidth = this._element.width, rHeight = this._element.height,\r\n          scaleX = 1, scaleY = 1, offsetLeft = 0, offsetTop = 0, cropX = 0, cropY = 0,\r\n          offset, pWidth = this.width, pHeight = this.height, parsedAttributes = { width: pWidth, height: pHeight };\r\n      if (pAR && (pAR.alignX !== 'none' || pAR.alignY !== 'none')) {\r\n        if (pAR.meetOrSlice === 'meet') {\r\n          scaleX = scaleY = fabric.util.findScaleToFit(this._element, parsedAttributes);\r\n          offset = (pWidth - rWidth * scaleX) / 2;\r\n          if (pAR.alignX === 'Min') {\r\n            offsetLeft = -offset;\r\n          }\r\n          if (pAR.alignX === 'Max') {\r\n            offsetLeft = offset;\r\n          }\r\n          offset = (pHeight - rHeight * scaleY) / 2;\r\n          if (pAR.alignY === 'Min') {\r\n            offsetTop = -offset;\r\n          }\r\n          if (pAR.alignY === 'Max') {\r\n            offsetTop = offset;\r\n          }\r\n        }\r\n        if (pAR.meetOrSlice === 'slice') {\r\n          scaleX = scaleY = fabric.util.findScaleToCover(this._element, parsedAttributes);\r\n          offset = rWidth - pWidth / scaleX;\r\n          if (pAR.alignX === 'Mid') {\r\n            cropX = offset / 2;\r\n          }\r\n          if (pAR.alignX === 'Max') {\r\n            cropX = offset;\r\n          }\r\n          offset = rHeight - pHeight / scaleY;\r\n          if (pAR.alignY === 'Mid') {\r\n            cropY = offset / 2;\r\n          }\r\n          if (pAR.alignY === 'Max') {\r\n            cropY = offset;\r\n          }\r\n          rWidth = pWidth / scaleX;\r\n          rHeight = pHeight / scaleY;\r\n        }\r\n      }\r\n      else {\r\n        scaleX = pWidth / rWidth;\r\n        scaleY = pHeight / rHeight;\r\n      }\r\n      return {\r\n        width: rWidth,\r\n        height: rHeight,\r\n        scaleX: scaleX,\r\n        scaleY: scaleY,\r\n        offsetLeft: offsetLeft,\r\n        offsetTop: offsetTop,\r\n        cropX: cropX,\r\n        cropY: cropY\r\n      };\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Default CSS class name for canvas\r\n   * @static\r\n   * @type String\r\n   * @default\r\n   */\r\n  fabric.Image.CSS_CANVAS = 'canvas-img';\r\n\r\n  /**\r\n   * Alias for getSrc\r\n   * @static\r\n   */\r\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\r\n\r\n  /**\r\n   * Creates an instance of fabric.Image from its object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} callback Callback to invoke when an image instance is created\r\n   */\r\n  fabric.Image.fromObject = function(_object, callback) {\r\n    var object = fabric.util.object.clone(_object);\r\n    fabric.util.loadImage(object.src, function(img, isError) {\r\n      if (isError) {\r\n        callback && callback(null, true);\r\n        return;\r\n      }\r\n      fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {\r\n        object.filters = filters || [];\r\n        fabric.Image.prototype._initFilters.call(object, [object.resizeFilter], function(resizeFilters) {\r\n          object.resizeFilter = resizeFilters[0];\r\n          fabric.util.enlivenObjectEnlivables(object, object, function () {\r\n            var image = new fabric.Image(img, object);\r\n            callback(image, false);\r\n          });\r\n        });\r\n      });\r\n    }, null, object.crossOrigin);\r\n  };\r\n\r\n  /**\r\n   * Creates an instance of fabric.Image from an URL string\r\n   * @static\r\n   * @param {String} url URL to create an image from\r\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument). Second argument is a boolean indicating if an error occurred or not.\r\n   * @param {Object} [imgOptions] Options object\r\n   */\r\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\r\n    fabric.util.loadImage(url, function(img, isError) {\r\n      callback && callback(new fabric.Image(img, imgOptions), isError);\r\n    }, null, imgOptions && imgOptions.crossOrigin);\r\n  };\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\r\n   * @static\r\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\r\n   */\r\n  fabric.Image.ATTRIBUTE_NAMES =\r\n    fabric.SHARED_ATTRIBUTES.concat(\r\n      'x y width height preserveAspectRatio xlink:href crossOrigin image-rendering'.split(' ')\r\n    );\r\n\r\n  /**\r\n   * Returns {@link fabric.Image} instance from an SVG element\r\n   * @static\r\n   * @param {SVGElement} element Element to parse\r\n   * @param {Object} [options] Options object\r\n   * @param {Function} callback Callback to execute when fabric.Image object is created\r\n   * @return {fabric.Image} Instance of fabric.Image\r\n   */\r\n  fabric.Image.fromElement = function(element, callback, options) {\r\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES);\r\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,\r\n      extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\r\n  };\r\n  /* _FROM_SVG_END_ */\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\r\n\r\n  /**\r\n   * @private\r\n   * @return {Number} angle value\r\n   */\r\n  _getAngleValueForStraighten: function() {\r\n    var angle = this.angle % 360;\r\n    if (angle > 0) {\r\n      return Math.round((angle - 1) / 90) * 90;\r\n    }\r\n    return Math.round(angle / 90) * 90;\r\n  },\r\n\r\n  /**\r\n   * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\r\n   * @return {fabric.Object} thisArg\r\n   * @chainable\r\n   */\r\n  straighten: function() {\r\n    return this.rotate(this._getAngleValueForStraighten());\r\n  },\r\n\r\n  /**\r\n   * Same as {@link fabric.Object.prototype.straighten} but with animation\r\n   * @param {Object} callbacks Object with callback functions\r\n   * @param {Function} [callbacks.onComplete] Invoked on completion\r\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\r\n   * @return {fabric.Object} thisArg\r\n   */\r\n  fxStraighten: function(callbacks) {\r\n    callbacks = callbacks || { };\r\n\r\n    var empty = function() { },\r\n        onComplete = callbacks.onComplete || empty,\r\n        onChange = callbacks.onChange || empty,\r\n        _this = this;\r\n\r\n    return fabric.util.animate({\r\n      target: this,\r\n      startValue: this.get('angle'),\r\n      endValue: this._getAngleValueForStraighten(),\r\n      duration: this.FX_DURATION,\r\n      onChange: function(value) {\r\n        _this.rotate(value);\r\n        onChange();\r\n      },\r\n      onComplete: function() {\r\n        _this.setCoords();\r\n        onComplete();\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\r\n\r\n  /**\r\n   * Straightens object, then rerenders canvas\r\n   * @param {fabric.Object} object Object to straighten\r\n   * @return {fabric.Canvas} thisArg\r\n   * @chainable\r\n   */\r\n  straightenObject: function (object) {\r\n    object.straighten();\r\n    this.requestRenderAll();\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\r\n   * @param {fabric.Object} object Object to straighten\r\n   * @return {fabric.Canvas} thisArg\r\n   */\r\n  fxStraightenObject: function (object) {\r\n    return object.fxStraighten({\r\n      onChange: this.requestRenderAllBound\r\n    });\r\n  }\r\n});\r\n\r\n\r\n(function() {\r\n\r\n  'use strict';\r\n\r\n  /**\r\n   * Tests if webgl supports certain precision\r\n   * @param {WebGL} Canvas WebGL context to test on\r\n   * @param {String} Precision to test can be any of following: 'lowp', 'mediump', 'highp'\r\n   * @returns {Boolean} Whether the user's browser WebGL supports given precision.\r\n   */\r\n  function testPrecision(gl, precision){\r\n    var fragmentSource = 'precision ' + precision + ' float;\\nvoid main(){}';\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    gl.shaderSource(fragmentShader, fragmentSource);\r\n    gl.compileShader(fragmentShader);\r\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Indicate whether this filtering backend is supported by the user's browser.\r\n   * @param {Number} tileSize check if the tileSize is supported\r\n   * @returns {Boolean} Whether the user's browser supports WebGL.\r\n   */\r\n  fabric.isWebglSupported = function(tileSize) {\r\n    if (fabric.isLikelyNode) {\r\n      return false;\r\n    }\r\n    tileSize = tileSize || fabric.WebglFilterBackend.prototype.tileSize;\r\n    var canvas = document.createElement('canvas');\r\n    var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\r\n    var isSupported = false;\r\n    // eslint-disable-next-line\r\n    if (gl) {\r\n      fabric.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\r\n      isSupported = fabric.maxTextureSize >= tileSize;\r\n      var precisions = ['highp', 'mediump', 'lowp'];\r\n      for (var i = 0; i < 3; i++){\r\n        if (testPrecision(gl, precisions[i])){\r\n          fabric.webGlPrecision = precisions[i];\r\n          break;\r\n        };\r\n      }\r\n    }\r\n    this.isSupported = isSupported;\r\n    return isSupported;\r\n  };\r\n\r\n  fabric.WebglFilterBackend = WebglFilterBackend;\r\n\r\n  /**\r\n   * WebGL filter backend.\r\n   */\r\n  function WebglFilterBackend(options) {\r\n    if (options && options.tileSize) {\r\n      this.tileSize = options.tileSize;\r\n    }\r\n    this.setupGLContext(this.tileSize, this.tileSize);\r\n    this.captureGPUInfo();\r\n  };\r\n\r\n  WebglFilterBackend.prototype = /** @lends fabric.WebglFilterBackend.prototype */ {\r\n\r\n    tileSize: 2048,\r\n\r\n    /**\r\n     * Experimental. This object is a sort of repository of help layers used to avoid\r\n     * of recreating them during frequent filtering. If you are previewing a filter with\r\n     * a slider you probably do not want to create help layers every filter step.\r\n     * in this object there will be appended some canvases, created once, resized sometimes\r\n     * cleared never. Clearing is left to the developer.\r\n     **/\r\n    resources: {\r\n\r\n    },\r\n\r\n    /**\r\n     * Setup a WebGL context suitable for filtering, and bind any needed event handlers.\r\n     */\r\n    setupGLContext: function(width, height) {\r\n      this.dispose();\r\n      this.createWebGLCanvas(width, height);\r\n      // eslint-disable-next-line\r\n      this.aPosition = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]);\r\n      this.chooseFastestCopyGLTo2DMethod(width, height);\r\n    },\r\n\r\n    /**\r\n     * Pick a method to copy data from GL context to 2d canvas.  In some browsers using\r\n     * putImageData is faster than drawImage for that specific operation.\r\n     */\r\n    chooseFastestCopyGLTo2DMethod: function(width, height) {\r\n      var canMeasurePerf = typeof window.performance !== 'undefined', canUseImageData;\r\n      try {\r\n        new ImageData(1, 1);\r\n        canUseImageData = true;\r\n      }\r\n      catch (e) {\r\n        canUseImageData = false;\r\n      }\r\n      // eslint-disable-next-line no-undef\r\n      var canUseArrayBuffer = typeof ArrayBuffer !== 'undefined';\r\n      // eslint-disable-next-line no-undef\r\n      var canUseUint8Clamped = typeof Uint8ClampedArray !== 'undefined';\r\n\r\n      if (!(canMeasurePerf && canUseImageData && canUseArrayBuffer && canUseUint8Clamped)) {\r\n        return;\r\n      }\r\n\r\n      var targetCanvas = fabric.util.createCanvasElement();\r\n      // eslint-disable-next-line no-undef\r\n      var imageBuffer = new ArrayBuffer(width * height * 4);\r\n      if (fabric.forceGLPutImageData) {\r\n        this.imageBuffer = imageBuffer;\r\n        this.copyGLTo2D = copyGLTo2DPutImageData;\r\n        return;\r\n      }\r\n      var testContext = {\r\n        imageBuffer: imageBuffer,\r\n        destinationWidth: width,\r\n        destinationHeight: height,\r\n        targetCanvas: targetCanvas\r\n      };\r\n      var startTime, drawImageTime, putImageDataTime;\r\n      targetCanvas.width = width;\r\n      targetCanvas.height = height;\r\n\r\n      startTime = window.performance.now();\r\n      copyGLTo2DDrawImage.call(testContext, this.gl, testContext);\r\n      drawImageTime = window.performance.now() - startTime;\r\n\r\n      startTime = window.performance.now();\r\n      copyGLTo2DPutImageData.call(testContext, this.gl, testContext);\r\n      putImageDataTime = window.performance.now() - startTime;\r\n\r\n      if (drawImageTime > putImageDataTime) {\r\n        this.imageBuffer = imageBuffer;\r\n        this.copyGLTo2D = copyGLTo2DPutImageData;\r\n      }\r\n      else {\r\n        this.copyGLTo2D = copyGLTo2DDrawImage;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Create a canvas element and associated WebGL context and attaches them as\r\n     * class properties to the GLFilterBackend class.\r\n     */\r\n    createWebGLCanvas: function(width, height) {\r\n      var canvas = fabric.util.createCanvasElement();\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      var glOptions = {\r\n            alpha: true,\r\n            premultipliedAlpha: false,\r\n            depth: false,\r\n            stencil: false,\r\n            antialias: false\r\n          },\r\n          gl = canvas.getContext('webgl', glOptions);\r\n      if (!gl) {\r\n        gl = canvas.getContext('experimental-webgl', glOptions);\r\n      }\r\n      if (!gl) {\r\n        return;\r\n      }\r\n      gl.clearColor(0, 0, 0, 0);\r\n      // this canvas can fire webglcontextlost and webglcontextrestored\r\n      this.canvas = canvas;\r\n      this.gl = gl;\r\n    },\r\n\r\n    /**\r\n     * Attempts to apply the requested filters to the source provided, drawing the filtered output\r\n     * to the provided target canvas.\r\n     *\r\n     * @param {Array} filters The filters to apply.\r\n     * @param {HTMLImageElement|HTMLCanvasElement} source The source to be filtered.\r\n     * @param {Number} width The width of the source input.\r\n     * @param {Number} height The height of the source input.\r\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\r\n     * @param {String|undefined} cacheKey A key used to cache resources related to the source. If\r\n     * omitted, caching will be skipped.\r\n     */\r\n    applyFilters: function(filters, source, width, height, targetCanvas, cacheKey) {\r\n      var gl = this.gl;\r\n      var cachedTexture;\r\n      if (cacheKey) {\r\n        cachedTexture = this.getCachedTexture(cacheKey, source);\r\n      }\r\n      var pipelineState = {\r\n        originalWidth: source.width || source.originalWidth,\r\n        originalHeight: source.height || source.originalHeight,\r\n        sourceWidth: width,\r\n        sourceHeight: height,\r\n        destinationWidth: width,\r\n        destinationHeight: height,\r\n        context: gl,\r\n        sourceTexture: this.createTexture(gl, width, height, !cachedTexture && source),\r\n        targetTexture: this.createTexture(gl, width, height),\r\n        originalTexture: cachedTexture ||\r\n          this.createTexture(gl, width, height, !cachedTexture && source),\r\n        passes: filters.length,\r\n        webgl: true,\r\n        aPosition: this.aPosition,\r\n        programCache: this.programCache,\r\n        pass: 0,\r\n        filterBackend: this,\r\n        targetCanvas: targetCanvas\r\n      };\r\n      var tempFbo = gl.createFramebuffer();\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, tempFbo);\r\n      filters.forEach(function(filter) { filter && filter.applyTo(pipelineState); });\r\n      resizeCanvasIfNeeded(pipelineState);\r\n      this.copyGLTo2D(gl, pipelineState);\r\n      gl.bindTexture(gl.TEXTURE_2D, null);\r\n      gl.deleteTexture(pipelineState.sourceTexture);\r\n      gl.deleteTexture(pipelineState.targetTexture);\r\n      gl.deleteFramebuffer(tempFbo);\r\n      targetCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\r\n      return pipelineState;\r\n    },\r\n\r\n    /**\r\n     * Detach event listeners, remove references, and clean up caches.\r\n     */\r\n    dispose: function() {\r\n      if (this.canvas) {\r\n        this.canvas = null;\r\n        this.gl = null;\r\n      }\r\n      this.clearWebGLCaches();\r\n    },\r\n\r\n    /**\r\n     * Wipe out WebGL-related caches.\r\n     */\r\n    clearWebGLCaches: function() {\r\n      this.programCache = {};\r\n      this.textureCache = {};\r\n    },\r\n\r\n    /**\r\n     * Create a WebGL texture object.\r\n     *\r\n     * Accepts specific dimensions to initialize the texture to or a source image.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL context to use for creating the texture.\r\n     * @param {Number} width The width to initialize the texture at.\r\n     * @param {Number} height The height to initialize the texture.\r\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source for the texture data.\r\n     * @returns {WebGLTexture}\r\n     */\r\n    createTexture: function(gl, width, height, textureImageSource) {\r\n      var texture = gl.createTexture();\r\n      gl.bindTexture(gl.TEXTURE_2D, texture);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n      if (textureImageSource) {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureImageSource);\r\n      }\r\n      else {\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n      }\r\n      return texture;\r\n    },\r\n\r\n    /**\r\n     * Can be optionally used to get a texture from the cache array\r\n     *\r\n     * If an existing texture is not found, a new texture is created and cached.\r\n     *\r\n     * @param {String} uniqueId A cache key to use to find an existing texture.\r\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source to use to create the\r\n     * texture cache entry if one does not already exist.\r\n     */\r\n    getCachedTexture: function(uniqueId, textureImageSource) {\r\n      if (this.textureCache[uniqueId]) {\r\n        return this.textureCache[uniqueId];\r\n      }\r\n      else {\r\n        var texture = this.createTexture(\r\n          this.gl, textureImageSource.width, textureImageSource.height, textureImageSource);\r\n        this.textureCache[uniqueId] = texture;\r\n        return texture;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Clear out cached resources related to a source image that has been\r\n     * filtered previously.\r\n     *\r\n     * @param {String} cacheKey The cache key provided when the source image was filtered.\r\n     */\r\n    evictCachesForKey: function(cacheKey) {\r\n      if (this.textureCache[cacheKey]) {\r\n        this.gl.deleteTexture(this.textureCache[cacheKey]);\r\n        delete this.textureCache[cacheKey];\r\n      }\r\n    },\r\n\r\n    copyGLTo2D: copyGLTo2DDrawImage,\r\n\r\n    /**\r\n     * Attempt to extract GPU information strings from a WebGL context.\r\n     *\r\n     * Useful information when debugging or blacklisting specific GPUs.\r\n     *\r\n     * @returns {Object} A GPU info object with renderer and vendor strings.\r\n     */\r\n    captureGPUInfo: function() {\r\n      if (this.gpuInfo) {\r\n        return this.gpuInfo;\r\n      }\r\n      var gl = this.gl, gpuInfo = { renderer: '', vendor: '' };\r\n      if (!gl) {\r\n        return gpuInfo;\r\n      }\r\n      var ext = gl.getExtension('WEBGL_debug_renderer_info');\r\n      if (ext) {\r\n        var renderer = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);\r\n        var vendor = gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);\r\n        if (renderer) {\r\n          gpuInfo.renderer = renderer.toLowerCase();\r\n        }\r\n        if (vendor) {\r\n          gpuInfo.vendor = vendor.toLowerCase();\r\n        }\r\n      }\r\n      this.gpuInfo = gpuInfo;\r\n      return gpuInfo;\r\n    },\r\n  };\r\n})();\r\n\r\nfunction resizeCanvasIfNeeded(pipelineState) {\r\n  var targetCanvas = pipelineState.targetCanvas,\r\n      width = targetCanvas.width, height = targetCanvas.height,\r\n      dWidth = pipelineState.destinationWidth,\r\n      dHeight = pipelineState.destinationHeight;\r\n\r\n  if (width !== dWidth || height !== dHeight) {\r\n    targetCanvas.width = dWidth;\r\n    targetCanvas.height = dHeight;\r\n  }\r\n}\r\n\r\n/**\r\n * Copy an input WebGL canvas on to an output 2D canvas.\r\n *\r\n * The WebGL canvas is assumed to be upside down, with the top-left pixel of the\r\n * desired output image appearing in the bottom-left corner of the WebGL canvas.\r\n *\r\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\r\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\r\n * @param {Object} pipelineState The 2D target canvas to copy on to.\r\n */\r\nfunction copyGLTo2DDrawImage(gl, pipelineState) {\r\n  var glCanvas = gl.canvas, targetCanvas = pipelineState.targetCanvas,\r\n      ctx = targetCanvas.getContext('2d');\r\n  ctx.translate(0, targetCanvas.height); // move it down again\r\n  ctx.scale(1, -1); // vertical flip\r\n  // where is my image on the big glcanvas?\r\n  var sourceY = glCanvas.height - targetCanvas.height;\r\n  ctx.drawImage(glCanvas, 0, sourceY, targetCanvas.width, targetCanvas.height, 0, 0,\r\n    targetCanvas.width, targetCanvas.height);\r\n}\r\n\r\n/**\r\n * Copy an input WebGL canvas on to an output 2D canvas using 2d canvas' putImageData\r\n * API. Measurably faster than using ctx.drawImage in Firefox (version 54 on OSX Sierra).\r\n *\r\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\r\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\r\n * @param {Object} pipelineState The 2D target canvas to copy on to.\r\n */\r\nfunction copyGLTo2DPutImageData(gl, pipelineState) {\r\n  var targetCanvas = pipelineState.targetCanvas, ctx = targetCanvas.getContext('2d'),\r\n      dWidth = pipelineState.destinationWidth,\r\n      dHeight = pipelineState.destinationHeight,\r\n      numBytes = dWidth * dHeight * 4;\r\n\r\n  // eslint-disable-next-line no-undef\r\n  var u8 = new Uint8Array(this.imageBuffer, 0, numBytes);\r\n  // eslint-disable-next-line no-undef\r\n  var u8Clamped = new Uint8ClampedArray(this.imageBuffer, 0, numBytes);\r\n\r\n  gl.readPixels(0, 0, dWidth, dHeight, gl.RGBA, gl.UNSIGNED_BYTE, u8);\r\n  var imgData = new ImageData(u8Clamped, dWidth, dHeight);\r\n  ctx.putImageData(imgData, 0, 0);\r\n}\r\n\r\n\r\n(function() {\r\n\r\n  'use strict';\r\n\r\n  var noop = function() {};\r\n\r\n  fabric.Canvas2dFilterBackend = Canvas2dFilterBackend;\r\n\r\n  /**\r\n   * Canvas 2D filter backend.\r\n   */\r\n  function Canvas2dFilterBackend() {};\r\n\r\n  Canvas2dFilterBackend.prototype = /** @lends fabric.Canvas2dFilterBackend.prototype */ {\r\n    evictCachesForKey: noop,\r\n    dispose: noop,\r\n    clearWebGLCaches: noop,\r\n\r\n    /**\r\n     * Experimental. This object is a sort of repository of help layers used to avoid\r\n     * of recreating them during frequent filtering. If you are previewing a filter with\r\n     * a slider you probably do not want to create help layers every filter step.\r\n     * in this object there will be appended some canvases, created once, resized sometimes\r\n     * cleared never. Clearing is left to the developer.\r\n     **/\r\n    resources: {\r\n\r\n    },\r\n\r\n    /**\r\n     * Apply a set of filters against a source image and draw the filtered output\r\n     * to the provided destination canvas.\r\n     *\r\n     * @param {EnhancedFilter} filters The filter to apply.\r\n     * @param {HTMLImageElement|HTMLCanvasElement} sourceElement The source to be filtered.\r\n     * @param {Number} sourceWidth The width of the source input.\r\n     * @param {Number} sourceHeight The height of the source input.\r\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\r\n     */\r\n    applyFilters: function(filters, sourceElement, sourceWidth, sourceHeight, targetCanvas) {\r\n      var ctx = targetCanvas.getContext('2d');\r\n      ctx.drawImage(sourceElement, 0, 0, sourceWidth, sourceHeight);\r\n      var imageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\r\n      var originalImageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\r\n      var pipelineState = {\r\n        sourceWidth: sourceWidth,\r\n        sourceHeight: sourceHeight,\r\n        imageData: imageData,\r\n        originalEl: sourceElement,\r\n        originalImageData: originalImageData,\r\n        canvasEl: targetCanvas,\r\n        ctx: ctx,\r\n        filterBackend: this,\r\n      };\r\n      filters.forEach(function(filter) { filter.applyTo(pipelineState); });\r\n      if (pipelineState.imageData.width !== sourceWidth || pipelineState.imageData.height !== sourceHeight) {\r\n        targetCanvas.width = pipelineState.imageData.width;\r\n        targetCanvas.height = pipelineState.imageData.height;\r\n      }\r\n      ctx.putImageData(pipelineState.imageData, 0, 0);\r\n      return pipelineState;\r\n    },\r\n\r\n  };\r\n})();\r\n\r\n\r\n/**\r\n * @namespace fabric.Image.filters\r\n * @memberOf fabric.Image\r\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\r\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n */\r\nfabric.Image = fabric.Image || { };\r\nfabric.Image.filters = fabric.Image.filters || { };\r\n\r\n/**\r\n * Root filter class from which all filter classes inherit from\r\n * @class fabric.Image.filters.BaseFilter\r\n * @memberOf fabric.Image.filters\r\n */\r\nfabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {\r\n\r\n  /**\r\n   * Filter type\r\n   * @param {String} type\r\n   * @default\r\n   */\r\n  type: 'BaseFilter',\r\n\r\n  /**\r\n   * Array of attributes to send with buffers. do not modify\r\n   * @private\r\n   */\r\n\r\n  vertexSource: 'attribute vec2 aPosition;\\n' +\r\n    'varying vec2 vTexCoord;\\n' +\r\n    'void main() {\\n' +\r\n      'vTexCoord = aPosition;\\n' +\r\n      'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\r\n    '}',\r\n\r\n  fragmentSource: 'precision highp float;\\n' +\r\n    'varying vec2 vTexCoord;\\n' +\r\n    'uniform sampler2D uTexture;\\n' +\r\n    'void main() {\\n' +\r\n      'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\r\n    '}',\r\n\r\n  /**\r\n   * Constructor\r\n   * @param {Object} [options] Options object\r\n   */\r\n  initialize: function(options) {\r\n    if (options) {\r\n      this.setOptions(options);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Sets filter's properties from options\r\n   * @param {Object} [options] Options object\r\n   */\r\n  setOptions: function(options) {\r\n    for (var prop in options) {\r\n      this[prop] = options[prop];\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Compile this filter's shader program.\r\n   *\r\n   * @param {WebGLRenderingContext} gl The GL canvas context to use for shader compilation.\r\n   * @param {String} fragmentSource fragmentShader source for compilation\r\n   * @param {String} vertexSource vertexShader source for compilation\r\n   */\r\n  createProgram: function(gl, fragmentSource, vertexSource) {\r\n    fragmentSource = fragmentSource || this.fragmentSource;\r\n    vertexSource = vertexSource || this.vertexSource;\r\n    if (fabric.webGlPrecision !== 'highp'){\r\n      fragmentSource = fragmentSource.replace(\r\n        /precision highp float/g,\r\n        'precision ' + fabric.webGlPrecision + ' float'\r\n      );\r\n    }\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n    gl.shaderSource(vertexShader, vertexSource);\r\n    gl.compileShader(vertexShader);\r\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\r\n      throw new Error(\r\n        // eslint-disable-next-line prefer-template\r\n        'Vertex shader compile error for ' + this.type + ': ' +\r\n        gl.getShaderInfoLog(vertexShader)\r\n      );\r\n    }\r\n\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    gl.shaderSource(fragmentShader, fragmentSource);\r\n    gl.compileShader(fragmentShader);\r\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\r\n      throw new Error(\r\n        // eslint-disable-next-line prefer-template\r\n        'Fragment shader compile error for ' + this.type + ': ' +\r\n        gl.getShaderInfoLog(fragmentShader)\r\n      );\r\n    }\r\n\r\n    var program = gl.createProgram();\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n      throw new Error(\r\n        // eslint-disable-next-line prefer-template\r\n        'Shader link error for \"${this.type}\" ' +\r\n        gl.getProgramInfoLog(program)\r\n      );\r\n    }\r\n\r\n    var attributeLocations = this.getAttributeLocations(gl, program);\r\n    var uniformLocations = this.getUniformLocations(gl, program) || { };\r\n    uniformLocations.uStepW = gl.getUniformLocation(program, 'uStepW');\r\n    uniformLocations.uStepH = gl.getUniformLocation(program, 'uStepH');\r\n    return {\r\n      program: program,\r\n      attributeLocations: attributeLocations,\r\n      uniformLocations: uniformLocations\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Return a map of attribute names to WebGLAttributeLocation objects.\r\n   *\r\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\r\n   * @param {WebGLShaderProgram} program The shader program from which to take attribute locations.\r\n   * @returns {Object} A map of attribute names to attribute locations.\r\n   */\r\n  getAttributeLocations: function(gl, program) {\r\n    return {\r\n      aPosition: gl.getAttribLocation(program, 'aPosition'),\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Return a map of uniform names to WebGLUniformLocation objects.\r\n   *\r\n   * Intended to be overridden by subclasses.\r\n   *\r\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\r\n   * @param {WebGLShaderProgram} program The shader program from which to take uniform locations.\r\n   * @returns {Object} A map of uniform names to uniform locations.\r\n   */\r\n  getUniformLocations: function (/* gl, program */) {\r\n    // in case i do not need any special uniform i need to return an empty object\r\n    return { };\r\n  },\r\n\r\n  /**\r\n   * Send attribute data from this filter to its shader program on the GPU.\r\n   *\r\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\r\n   * @param {Object} attributeLocations A map of shader attribute names to their locations.\r\n   */\r\n  sendAttributeData: function(gl, attributeLocations, aPositionData) {\r\n    var attributeLocation = attributeLocations.aPosition;\r\n    var buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n    gl.enableVertexAttribArray(attributeLocation);\r\n    gl.vertexAttribPointer(attributeLocation, 2, gl.FLOAT, false, 0, 0);\r\n    gl.bufferData(gl.ARRAY_BUFFER, aPositionData, gl.STATIC_DRAW);\r\n  },\r\n\r\n  _setupFrameBuffer: function(options) {\r\n    var gl = options.context, width, height;\r\n    if (options.passes > 1) {\r\n      width = options.destinationWidth;\r\n      height = options.destinationHeight;\r\n      if (options.sourceWidth !== width || options.sourceHeight !== height) {\r\n        gl.deleteTexture(options.targetTexture);\r\n        options.targetTexture = options.filterBackend.createTexture(gl, width, height);\r\n      }\r\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D,\r\n        options.targetTexture, 0);\r\n    }\r\n    else {\r\n      // draw last filter on canvas and not to framebuffer.\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n      gl.finish();\r\n    }\r\n  },\r\n\r\n  _swapTextures: function(options) {\r\n    options.passes--;\r\n    options.pass++;\r\n    var temp = options.targetTexture;\r\n    options.targetTexture = options.sourceTexture;\r\n    options.sourceTexture = temp;\r\n  },\r\n\r\n  /**\r\n   * Generic isNeutral implementation for one parameter based filters.\r\n   * Used only in image applyFilters to discard filters that will not have an effect\r\n   * on the image\r\n   * Other filters may need their own version ( ColorMatrix, HueRotation, gamma, ComposedFilter )\r\n   * @param {Object} options\r\n   **/\r\n  isNeutralState: function(/* options */) {\r\n    var main = this.mainParameter,\r\n        _class = fabric.Image.filters[this.type].prototype;\r\n    if (main) {\r\n      if (Array.isArray(_class[main])) {\r\n        for (var i = _class[main].length; i--;) {\r\n          if (this[main][i] !== _class[main][i]) {\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      }\r\n      else {\r\n        return _class[main] === this[main];\r\n      }\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Apply this filter to the input image data provided.\r\n   *\r\n   * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\r\n   *\r\n   * @param {Object} options\r\n   * @param {Number} options.passes The number of filters remaining to be executed\r\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\r\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\r\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\r\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n   */\r\n  applyTo: function(options) {\r\n    if (options.webgl) {\r\n      this._setupFrameBuffer(options);\r\n      this.applyToWebGL(options);\r\n      this._swapTextures(options);\r\n    }\r\n    else {\r\n      this.applyTo2d(options);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Retrieves the cached shader.\r\n   * @param {Object} options\r\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n   */\r\n  retrieveShader: function(options) {\r\n    if (!options.programCache.hasOwnProperty(this.type)) {\r\n      options.programCache[this.type] = this.createProgram(options.context);\r\n    }\r\n    return options.programCache[this.type];\r\n  },\r\n\r\n  /**\r\n   * Apply this filter using webgl.\r\n   *\r\n   * @param {Object} options\r\n   * @param {Number} options.passes The number of filters remaining to be executed\r\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\r\n   * @param {WebGLTexture} options.originalTexture The texture of the original input image.\r\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\r\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\r\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n   */\r\n  applyToWebGL: function(options) {\r\n    var gl = options.context;\r\n    var shader = this.retrieveShader(options);\r\n    if (options.pass === 0 && options.originalTexture) {\r\n      gl.bindTexture(gl.TEXTURE_2D, options.originalTexture);\r\n    }\r\n    else {\r\n      gl.bindTexture(gl.TEXTURE_2D, options.sourceTexture);\r\n    }\r\n    gl.useProgram(shader.program);\r\n    this.sendAttributeData(gl, shader.attributeLocations, options.aPosition);\r\n\r\n    gl.uniform1f(shader.uniformLocations.uStepW, 1 / options.sourceWidth);\r\n    gl.uniform1f(shader.uniformLocations.uStepH, 1 / options.sourceHeight);\r\n\r\n    this.sendUniformData(gl, shader.uniformLocations);\r\n    gl.viewport(0, 0, options.destinationWidth, options.destinationHeight);\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n  },\r\n\r\n  bindAdditionalTexture: function(gl, texture, textureUnit) {\r\n    gl.activeTexture(textureUnit);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    // reset active texture to 0 as usual\r\n    gl.activeTexture(gl.TEXTURE0);\r\n  },\r\n\r\n  unbindAdditionalTexture: function(gl, textureUnit) {\r\n    gl.activeTexture(textureUnit);\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n    gl.activeTexture(gl.TEXTURE0);\r\n  },\r\n\r\n  getMainParameter: function() {\r\n    return this[this.mainParameter];\r\n  },\r\n\r\n  setMainParameter: function(value) {\r\n    this[this.mainParameter] = value;\r\n  },\r\n\r\n  /**\r\n   * Send uniform data from this filter to its shader program on the GPU.\r\n   *\r\n   * Intended to be overridden by subclasses.\r\n   *\r\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\r\n   * @param {Object} uniformLocations A map of shader uniform names to their locations.\r\n   */\r\n  sendUniformData: function(/* gl, uniformLocations */) {\r\n    // Intentionally left blank.  Override me in subclasses.\r\n  },\r\n\r\n  /**\r\n   * If needed by a 2d filter, this functions can create an helper canvas to be used\r\n   * remember that options.targetCanvas is available for use till end of chain.\r\n   */\r\n  createHelpLayer: function(options) {\r\n    if (!options.helpLayer) {\r\n      var helpLayer = document.createElement('canvas');\r\n      helpLayer.width = options.sourceWidth;\r\n      helpLayer.height = options.sourceHeight;\r\n      options.helpLayer = helpLayer;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Returns object representation of an instance\r\n   * @return {Object} Object representation of an instance\r\n   */\r\n  toObject: function() {\r\n    var object = { type: this.type }, mainP = this.mainParameter;\r\n    if (mainP) {\r\n      object[mainP] = this[mainP];\r\n    }\r\n    return object;\r\n  },\r\n\r\n  /**\r\n   * Returns a JSON representation of an instance\r\n   * @return {Object} JSON\r\n   */\r\n  toJSON: function() {\r\n    // delegate, not alias\r\n    return this.toObject();\r\n  }\r\n});\r\n\r\nfabric.Image.filters.BaseFilter.fromObject = function(object, callback) {\r\n  var filter = new fabric.Image.filters[object.type](object);\r\n  callback && callback(filter);\r\n  return filter;\r\n};\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Color Matrix filter class\r\n   * @class fabric.Image.filters.ColorMatrix\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\r\n   * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\r\n   * @example <caption>Kodachrome filter</caption>\r\n   * var filter = new fabric.Image.filters.ColorMatrix({\r\n   *  matrix: [\r\n       1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\r\n       -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\r\n       -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\r\n       0, 0, 0, 1, 0\r\n      ]\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.ColorMatrix = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'ColorMatrix',\r\n\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'uniform mat4 uColorMatrix;\\n' +\r\n      'uniform vec4 uConstants;\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n        'color *= uColorMatrix;\\n' +\r\n        'color += uConstants;\\n' +\r\n        'gl_FragColor = color;\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Colormatrix for pixels.\r\n     * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\r\n     * outside the -1, 1 range.\r\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\r\n     * @param {Array} matrix array of 20 numbers.\r\n     * @default\r\n     */\r\n    matrix: [\r\n      1, 0, 0, 0, 0,\r\n      0, 1, 0, 0, 0,\r\n      0, 0, 1, 0, 0,\r\n      0, 0, 0, 1, 0\r\n    ],\r\n\r\n    mainParameter: 'matrix',\r\n\r\n    /**\r\n     * Lock the colormatrix on the color part, skipping alpha, mainly for non webgl scenario\r\n     * to save some calculation\r\n     * @type Boolean\r\n     * @default true\r\n     */\r\n    colorsOnly: true,\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} [options] Options object\r\n     */\r\n    initialize: function(options) {\r\n      this.callSuper('initialize', options);\r\n      // create a new array instead mutating the prototype with push\r\n      this.matrix = this.matrix.slice(0);\r\n    },\r\n\r\n    /**\r\n     * Apply the ColorMatrix operation to a Uint8Array representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          data = imageData.data,\r\n          iLen = data.length,\r\n          m = this.matrix,\r\n          r, g, b, a, i, colorsOnly = this.colorsOnly;\r\n\r\n      for (i = 0; i < iLen; i += 4) {\r\n        r = data[i];\r\n        g = data[i + 1];\r\n        b = data[i + 2];\r\n        if (colorsOnly) {\r\n          data[i] = r * m[0] + g * m[1] + b * m[2] + m[4] * 255;\r\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + m[9] * 255;\r\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + m[14] * 255;\r\n        }\r\n        else {\r\n          a = data[i + 3];\r\n          data[i] = r * m[0] + g * m[1] + b * m[2] + a * m[3] + m[4] * 255;\r\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + a * m[8] + m[9] * 255;\r\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + a * m[13] + m[14] * 255;\r\n          data[i + 3] = r * m[15] + g * m[16] + b * m[17] + a * m[18] + m[19] * 255;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uColorMatrix: gl.getUniformLocation(program, 'uColorMatrix'),\r\n        uConstants: gl.getUniformLocation(program, 'uConstants'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      var m = this.matrix,\r\n          matrix = [\r\n            m[0], m[1], m[2], m[3],\r\n            m[5], m[6], m[7], m[8],\r\n            m[10], m[11], m[12], m[13],\r\n            m[15], m[16], m[17], m[18]\r\n          ],\r\n          constants = [m[4], m[9], m[14], m[19]];\r\n      gl.uniformMatrix4fv(uniformLocations.uColorMatrix, false, matrix);\r\n      gl.uniform4fv(uniformLocations.uConstants, constants);\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] function to invoke after filter creation\r\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\r\n   */\r\n  fabric.Image.filters.ColorMatrix.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Brightness filter class\r\n   * @class fabric.Image.filters.Brightness\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Brightness({\r\n   *   brightness: 0.05\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.Brightness = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Brightness',\r\n\r\n    /**\r\n     * Fragment source for the brightness program\r\n     */\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform float uBrightness;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n        'color.rgb += uBrightness;\\n' +\r\n        'gl_FragColor = color;\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Brightness value, from -1 to 1.\r\n     * translated to -255 to 255 for 2d\r\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\r\n     * @param {Number} brightness\r\n     * @default\r\n     */\r\n    brightness: 0,\r\n\r\n    /**\r\n     * Describe the property that is the filter parameter\r\n     * @param {String} m\r\n     * @default\r\n     */\r\n    mainParameter: 'brightness',\r\n\r\n    /**\r\n    * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\r\n    *\r\n    * @param {Object} options\r\n    * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\r\n    */\r\n    applyTo2d: function(options) {\r\n      if (this.brightness === 0) {\r\n        return;\r\n      }\r\n      var imageData = options.imageData,\r\n          data = imageData.data, i, len = data.length,\r\n          brightness = Math.round(this.brightness * 255);\r\n      for (i = 0; i < len; i += 4) {\r\n        data[i] = data[i] + brightness;\r\n        data[i + 1] = data[i + 1] + brightness;\r\n        data[i + 2] = data[i + 2] + brightness;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uBrightness: gl.getUniformLocation(program, 'uBrightness'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform1f(uniformLocations.uBrightness, this.brightness);\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\r\n   */\r\n  fabric.Image.filters.Brightness.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      extend = fabric.util.object.extend,\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\r\n   * @class fabric.Image.filters.Convolute\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example <caption>Sharpen filter</caption>\r\n   * var filter = new fabric.Image.filters.Convolute({\r\n   *   matrix: [ 0, -1,  0,\r\n   *            -1,  5, -1,\r\n   *             0, -1,  0 ]\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   * @example <caption>Blur filter</caption>\r\n   * var filter = new fabric.Image.filters.Convolute({\r\n   *   matrix: [ 1/9, 1/9, 1/9,\r\n   *             1/9, 1/9, 1/9,\r\n   *             1/9, 1/9, 1/9 ]\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   * @example <caption>Emboss filter</caption>\r\n   * var filter = new fabric.Image.filters.Convolute({\r\n   *   matrix: [ 1,   1,  1,\r\n   *             1, 0.7, -1,\r\n   *            -1,  -1, -1 ]\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   * @example <caption>Emboss filter with opaqueness</caption>\r\n   * var filter = new fabric.Image.filters.Convolute({\r\n   *   opaque: true,\r\n   *   matrix: [ 1,   1,  1,\r\n   *             1, 0.7, -1,\r\n   *            -1,  -1, -1 ]\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   */\r\n  filters.Convolute = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Convolute',\r\n\r\n    /*\r\n     * Opaque value (true/false)\r\n     */\r\n    opaque: false,\r\n\r\n    /*\r\n     * matrix for the filter, max 9x9\r\n     */\r\n    matrix: [0, 0, 0, 0, 1, 0, 0, 0, 0],\r\n\r\n    /**\r\n     * Fragment source for the brightness program\r\n     */\r\n    fragmentSource: {\r\n      Convolute_3_1: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform float uMatrix[9];\\n' +\r\n        'uniform float uStepW;\\n' +\r\n        'uniform float uStepH;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\r\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\r\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\r\n              'vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\\n' +\r\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\\n' +\r\n            '}\\n' +\r\n          '}\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n        '}',\r\n      Convolute_3_0: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform float uMatrix[9];\\n' +\r\n        'uniform float uStepW;\\n' +\r\n        'uniform float uStepH;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\r\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\r\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\r\n              'vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\\n' +\r\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\\n' +\r\n            '}\\n' +\r\n          '}\\n' +\r\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n          'gl_FragColor.a = alpha;\\n' +\r\n        '}',\r\n      Convolute_5_1: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform float uMatrix[25];\\n' +\r\n        'uniform float uStepW;\\n' +\r\n        'uniform float uStepH;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\r\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\r\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\r\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\r\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\\n' +\r\n            '}\\n' +\r\n          '}\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n        '}',\r\n      Convolute_5_0: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform float uMatrix[25];\\n' +\r\n        'uniform float uStepW;\\n' +\r\n        'uniform float uStepH;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\r\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\r\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\r\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\r\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\\n' +\r\n            '}\\n' +\r\n          '}\\n' +\r\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n          'gl_FragColor.a = alpha;\\n' +\r\n        '}',\r\n      Convolute_7_1: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform float uMatrix[49];\\n' +\r\n        'uniform float uStepW;\\n' +\r\n        'uniform float uStepH;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\r\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\r\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\r\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\r\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\\n' +\r\n            '}\\n' +\r\n          '}\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n        '}',\r\n      Convolute_7_0: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform float uMatrix[49];\\n' +\r\n        'uniform float uStepW;\\n' +\r\n        'uniform float uStepH;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\r\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\r\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\r\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\r\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\\n' +\r\n            '}\\n' +\r\n          '}\\n' +\r\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n          'gl_FragColor.a = alpha;\\n' +\r\n        '}',\r\n      Convolute_9_1: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform float uMatrix[81];\\n' +\r\n        'uniform float uStepW;\\n' +\r\n        'uniform float uStepH;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\r\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\r\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\r\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\r\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\\n' +\r\n            '}\\n' +\r\n          '}\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n        '}',\r\n      Convolute_9_0: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform float uMatrix[81];\\n' +\r\n        'uniform float uStepW;\\n' +\r\n        'uniform float uStepH;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\r\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\r\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\r\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\r\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\\n' +\r\n            '}\\n' +\r\n          '}\\n' +\r\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n          'gl_FragColor.a = alpha;\\n' +\r\n        '}',\r\n    },\r\n\r\n    /**\r\n     * Constructor\r\n     * @memberOf fabric.Image.filters.Convolute.prototype\r\n     * @param {Object} [options] Options object\r\n     * @param {Boolean} [options.opaque=false] Opaque value (true/false)\r\n     * @param {Array} [options.matrix] Filter matrix\r\n     */\r\n\r\n\r\n    /**\r\n    * Retrieves the cached shader.\r\n    * @param {Object} options\r\n    * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n    * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n    */\r\n    retrieveShader: function(options) {\r\n      var size = Math.sqrt(this.matrix.length);\r\n      var cacheKey = this.type + '_' + size + '_' + (this.opaque ? 1 : 0);\r\n      var shaderSource = this.fragmentSource[cacheKey];\r\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\r\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\r\n      }\r\n      return options.programCache[cacheKey];\r\n    },\r\n\r\n    /**\r\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          data = imageData.data,\r\n          weights = this.matrix,\r\n          side = Math.round(Math.sqrt(weights.length)),\r\n          halfSide = Math.floor(side / 2),\r\n          sw = imageData.width,\r\n          sh = imageData.height,\r\n          output = options.ctx.createImageData(sw, sh),\r\n          dst = output.data,\r\n          // go through the destination image pixels\r\n          alphaFac = this.opaque ? 1 : 0,\r\n          r, g, b, a, dstOff,\r\n          scx, scy, srcOff, wt,\r\n          x, y, cx, cy;\r\n\r\n      for (y = 0; y < sh; y++) {\r\n        for (x = 0; x < sw; x++) {\r\n          dstOff = (y * sw + x) * 4;\r\n          // calculate the weighed sum of the source image pixels that\r\n          // fall under the convolution matrix\r\n          r = 0; g = 0; b = 0; a = 0;\r\n\r\n          for (cy = 0; cy < side; cy++) {\r\n            for (cx = 0; cx < side; cx++) {\r\n              scy = y + cy - halfSide;\r\n              scx = x + cx - halfSide;\r\n\r\n              // eslint-disable-next-line max-depth\r\n              if (scy < 0 || scy >= sh || scx < 0 || scx >= sw) {\r\n                continue;\r\n              }\r\n\r\n              srcOff = (scy * sw + scx) * 4;\r\n              wt = weights[cy * side + cx];\r\n\r\n              r += data[srcOff] * wt;\r\n              g += data[srcOff + 1] * wt;\r\n              b += data[srcOff + 2] * wt;\r\n              // eslint-disable-next-line max-depth\r\n              if (!alphaFac) {\r\n                a += data[srcOff + 3] * wt;\r\n              }\r\n            }\r\n          }\r\n          dst[dstOff] = r;\r\n          dst[dstOff + 1] = g;\r\n          dst[dstOff + 2] = b;\r\n          if (!alphaFac) {\r\n            dst[dstOff + 3] = a;\r\n          }\r\n          else {\r\n            dst[dstOff + 3] = data[dstOff + 3];\r\n          }\r\n        }\r\n      }\r\n      options.imageData = output;\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uMatrix: gl.getUniformLocation(program, 'uMatrix'),\r\n        uOpaque: gl.getUniformLocation(program, 'uOpaque'),\r\n        uHalfSize: gl.getUniformLocation(program, 'uHalfSize'),\r\n        uSize: gl.getUniformLocation(program, 'uSize'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform1fv(uniformLocations.uMatrix, this.matrix);\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function() {\r\n      return extend(this.callSuper('toObject'), {\r\n        opaque: this.opaque,\r\n        matrix: this.matrix\r\n      });\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\r\n   */\r\n  fabric.Image.filters.Convolute.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Grayscale image filter class\r\n   * @class fabric.Image.filters.Grayscale\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Grayscale();\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.Grayscale = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Grayscale',\r\n\r\n    fragmentSource: {\r\n      average: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n          'float average = (color.r + color.b + color.g) / 3.0;\\n' +\r\n          'gl_FragColor = vec4(average, average, average, color.a);\\n' +\r\n        '}',\r\n      lightness: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform int uMode;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\r\n          'float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\\n' +\r\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\r\n        '}',\r\n      luminosity: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform int uMode;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\r\n          'float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\\n' +\r\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\r\n        '}',\r\n    },\r\n\r\n\r\n    /**\r\n     * Grayscale mode, between 'average', 'lightness', 'luminosity'\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    mode: 'average',\r\n\r\n    mainParameter: 'mode',\r\n\r\n    /**\r\n     * Apply the Grayscale operation to a Uint8Array representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          data = imageData.data, i,\r\n          len = data.length, value,\r\n          mode = this.mode;\r\n      for (i = 0; i < len; i += 4) {\r\n        if (mode === 'average') {\r\n          value = (data[i] + data[i + 1] + data[i + 2]) / 3;\r\n        }\r\n        else if (mode === 'lightness') {\r\n          value = (Math.min(data[i], data[i + 1], data[i + 2]) +\r\n            Math.max(data[i], data[i + 1], data[i + 2])) / 2;\r\n        }\r\n        else if (mode === 'luminosity') {\r\n          value = 0.21 * data[i] + 0.72 * data[i + 1] + 0.07 * data[i + 2];\r\n        }\r\n        data[i] = value;\r\n        data[i + 1] = value;\r\n        data[i + 2] = value;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Retrieves the cached shader.\r\n     * @param {Object} options\r\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n     */\r\n    retrieveShader: function(options) {\r\n      var cacheKey = this.type + '_' + this.mode;\r\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\r\n        var shaderSource = this.fragmentSource[this.mode];\r\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\r\n      }\r\n      return options.programCache[cacheKey];\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uMode: gl.getUniformLocation(program, 'uMode'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      // default average mode.\r\n      var mode = 1;\r\n      gl.uniform1i(uniformLocations.uMode, mode);\r\n    },\r\n\r\n    /**\r\n     * Grayscale filter isNeutralState implementation\r\n     * The filter is never neutral\r\n     * on the image\r\n     **/\r\n    isNeutralState: function() {\r\n      return false;\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\r\n   */\r\n  fabric.Image.filters.Grayscale.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Invert filter class\r\n   * @class fabric.Image.filters.Invert\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Invert();\r\n   * object.filters.push(filter);\r\n   * object.applyFilters(canvas.renderAll.bind(canvas));\r\n   */\r\n  filters.Invert = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Invert',\r\n\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform int uInvert;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n        'if (uInvert == 1) {\\n' +\r\n          'gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\\n' +\r\n        '} else {\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n        '}\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Filter invert. if false, does nothing\r\n     * @param {Boolean} invert\r\n     * @default\r\n     */\r\n    invert: true,\r\n\r\n    mainParameter: 'invert',\r\n\r\n    /**\r\n     * Apply the Invert operation to a Uint8Array representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          data = imageData.data, i,\r\n          len = data.length;\r\n      for (i = 0; i < len; i += 4) {\r\n        data[i] = 255 - data[i];\r\n        data[i + 1] = 255 - data[i + 1];\r\n        data[i + 2] = 255 - data[i + 2];\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Invert filter isNeutralState implementation\r\n     * Used only in image applyFilters to discard filters that will not have an effect\r\n     * on the image\r\n     * @param {Object} options\r\n     **/\r\n    isNeutralState: function() {\r\n      return !this.invert;\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uInvert: gl.getUniformLocation(program, 'uInvert'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform1i(uniformLocations.uInvert, this.invert);\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\r\n   */\r\n  fabric.Image.filters.Invert.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      extend = fabric.util.object.extend,\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Noise filter class\r\n   * @class fabric.Image.filters.Noise\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Noise({\r\n   *   noise: 700\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   */\r\n  filters.Noise = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Noise',\r\n\r\n    /**\r\n     * Fragment source for the noise program\r\n     */\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform float uStepH;\\n' +\r\n      'uniform float uNoise;\\n' +\r\n      'uniform float uSeed;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'float rand(vec2 co, float seed, float vScale) {\\n' +\r\n        'return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\\n' +\r\n      '}\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n        'color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\\n' +\r\n        'gl_FragColor = color;\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Describe the property that is the filter parameter\r\n     * @param {String} m\r\n     * @default\r\n     */\r\n    mainParameter: 'noise',\r\n\r\n    /**\r\n     * Noise value, from\r\n     * @param {Number} noise\r\n     * @default\r\n     */\r\n    noise: 0,\r\n\r\n    /**\r\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      if (this.noise === 0) {\r\n        return;\r\n      }\r\n      var imageData = options.imageData,\r\n          data = imageData.data, i, len = data.length,\r\n          noise = this.noise, rand;\r\n\r\n      for (i = 0, len = data.length; i < len; i += 4) {\r\n\r\n        rand = (0.5 - Math.random()) * noise;\r\n\r\n        data[i] += rand;\r\n        data[i + 1] += rand;\r\n        data[i + 2] += rand;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uNoise: gl.getUniformLocation(program, 'uNoise'),\r\n        uSeed: gl.getUniformLocation(program, 'uSeed'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform1f(uniformLocations.uNoise, this.noise / 255);\r\n      gl.uniform1f(uniformLocations.uSeed, Math.random());\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function() {\r\n      return extend(this.callSuper('toObject'), {\r\n        noise: this.noise\r\n      });\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\r\n   */\r\n  fabric.Image.filters.Noise.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Pixelate filter class\r\n   * @class fabric.Image.filters.Pixelate\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Pixelate({\r\n   *   blocksize: 8\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.Pixelate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Pixelate',\r\n\r\n    blocksize: 4,\r\n\r\n    mainParameter: 'blocksize',\r\n\r\n    /**\r\n     * Fragment source for the Pixelate program\r\n     */\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform float uBlocksize;\\n' +\r\n      'uniform float uStepW;\\n' +\r\n      'uniform float uStepH;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'void main() {\\n' +\r\n        'float blockW = uBlocksize * uStepW;\\n' +\r\n        'float blockH = uBlocksize * uStepW;\\n' +\r\n        'int posX = int(vTexCoord.x / blockW);\\n' +\r\n        'int posY = int(vTexCoord.y / blockH);\\n' +\r\n        'float fposX = float(posX);\\n' +\r\n        'float fposY = float(posY);\\n' +\r\n        'vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\\n' +\r\n        'vec4 color = texture2D(uTexture, squareCoords);\\n' +\r\n        'gl_FragColor = color;\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Apply the Pixelate operation to a Uint8ClampedArray representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          data = imageData.data,\r\n          iLen = imageData.height,\r\n          jLen = imageData.width,\r\n          index, i, j, r, g, b, a,\r\n          _i, _j, _iLen, _jLen;\r\n\r\n      for (i = 0; i < iLen; i += this.blocksize) {\r\n        for (j = 0; j < jLen; j += this.blocksize) {\r\n\r\n          index = (i * 4) * jLen + (j * 4);\r\n\r\n          r = data[index];\r\n          g = data[index + 1];\r\n          b = data[index + 2];\r\n          a = data[index + 3];\r\n\r\n          _iLen = Math.min(i + this.blocksize, iLen);\r\n          _jLen = Math.min(j + this.blocksize, jLen);\r\n          for (_i = i; _i < _iLen; _i++) {\r\n            for (_j = j; _j < _jLen; _j++) {\r\n              index = (_i * 4) * jLen + (_j * 4);\r\n              data[index] = r;\r\n              data[index + 1] = g;\r\n              data[index + 2] = b;\r\n              data[index + 3] = a;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Indicate when the filter is not gonna apply changes to the image\r\n     **/\r\n    isNeutralState: function() {\r\n      return this.blocksize === 1;\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uBlocksize: gl.getUniformLocation(program, 'uBlocksize'),\r\n        uStepW: gl.getUniformLocation(program, 'uStepW'),\r\n        uStepH: gl.getUniformLocation(program, 'uStepH'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform1f(uniformLocations.uBlocksize, this.blocksize);\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\r\n   */\r\n  fabric.Image.filters.Pixelate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      extend = fabric.util.object.extend,\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Remove white filter class\r\n   * @class fabric.Image.filters.RemoveColor\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.RemoveColor#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.RemoveColor({\r\n   *   threshold: 0.2,\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   */\r\n  filters.RemoveColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.RemoveColor.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'RemoveColor',\r\n\r\n    /**\r\n     * Color to remove, in any format understood by fabric.Color.\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    color: '#FFFFFF',\r\n\r\n    /**\r\n     * Fragment source for the brightness program\r\n     */\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform vec4 uLow;\\n' +\r\n      'uniform vec4 uHigh;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'void main() {\\n' +\r\n        'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\r\n        'if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\\n' +\r\n          'gl_FragColor.a = 0.0;\\n' +\r\n        '}\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * distance to actual color, as value up or down from each r,g,b\r\n     * between 0 and 1\r\n     **/\r\n    distance: 0.02,\r\n\r\n    /**\r\n     * For color to remove inside distance, use alpha channel for a smoother deletion\r\n     * NOT IMPLEMENTED YET\r\n     **/\r\n    useAlpha: false,\r\n\r\n    /**\r\n     * Constructor\r\n     * @memberOf fabric.Image.filters.RemoveWhite.prototype\r\n     * @param {Object} [options] Options object\r\n     * @param {Number} [options.color=#RRGGBB] Threshold value\r\n     * @param {Number} [options.distance=10] Distance value\r\n     */\r\n\r\n    /**\r\n     * Applies filter to canvas element\r\n     * @param {Object} canvasEl Canvas element to apply filter to\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          data = imageData.data, i,\r\n          distance = this.distance * 255,\r\n          r, g, b,\r\n          source = new fabric.Color(this.color).getSource(),\r\n          lowC = [\r\n            source[0] - distance,\r\n            source[1] - distance,\r\n            source[2] - distance,\r\n          ],\r\n          highC = [\r\n            source[0] + distance,\r\n            source[1] + distance,\r\n            source[2] + distance,\r\n          ];\r\n\r\n\r\n      for (i = 0; i < data.length; i += 4) {\r\n        r = data[i];\r\n        g = data[i + 1];\r\n        b = data[i + 2];\r\n\r\n        if (r > lowC[0] &&\r\n            g > lowC[1] &&\r\n            b > lowC[2] &&\r\n            r < highC[0] &&\r\n            g < highC[1] &&\r\n            b < highC[2]) {\r\n          data[i + 3] = 0;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uLow: gl.getUniformLocation(program, 'uLow'),\r\n        uHigh: gl.getUniformLocation(program, 'uHigh'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      var source = new fabric.Color(this.color).getSource(),\r\n          distance = parseFloat(this.distance),\r\n          lowC = [\r\n            0 + source[0] / 255 - distance,\r\n            0 + source[1] / 255 - distance,\r\n            0 + source[2] / 255 - distance,\r\n            1\r\n          ],\r\n          highC = [\r\n            source[0] / 255 + distance,\r\n            source[1] / 255 + distance,\r\n            source[2] / 255 + distance,\r\n            1\r\n          ];\r\n      gl.uniform4fv(uniformLocations.uLow, lowC);\r\n      gl.uniform4fv(uniformLocations.uHigh, highC);\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function() {\r\n      return extend(this.callSuper('toObject'), {\r\n        color: this.color,\r\n        distance: this.distance\r\n      });\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.RemoveColor} Instance of fabric.Image.filters.RemoveWhite\r\n   */\r\n  fabric.Image.filters.RemoveColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  var matrices = {\r\n    Brownie: [\r\n      0.59970,0.34553,-0.27082,0,0.186,\r\n      -0.03770,0.86095,0.15059,0,-0.1449,\r\n      0.24113,-0.07441,0.44972,0,-0.02965,\r\n      0,0,0,1,0\r\n    ],\r\n    Vintage: [\r\n      0.62793,0.32021,-0.03965,0,0.03784,\r\n      0.02578,0.64411,0.03259,0,0.02926,\r\n      0.04660,-0.08512,0.52416,0,0.02023,\r\n      0,0,0,1,0\r\n    ],\r\n    Kodachrome: [\r\n      1.12855,-0.39673,-0.03992,0,0.24991,\r\n      -0.16404,1.08352,-0.05498,0,0.09698,\r\n      -0.16786,-0.56034,1.60148,0,0.13972,\r\n      0,0,0,1,0\r\n    ],\r\n    Technicolor: [\r\n      1.91252,-0.85453,-0.09155,0,0.04624,\r\n      -0.30878,1.76589,-0.10601,0,-0.27589,\r\n      -0.23110,-0.75018,1.84759,0,0.12137,\r\n      0,0,0,1,0\r\n    ],\r\n    Polaroid: [\r\n      1.438,-0.062,-0.062,0,0,\r\n      -0.122,1.378,-0.122,0,0,\r\n      -0.016,-0.016,1.483,0,0,\r\n      0,0,0,1,0\r\n    ],\r\n    Sepia: [\r\n      0.393, 0.769, 0.189, 0, 0,\r\n      0.349, 0.686, 0.168, 0, 0,\r\n      0.272, 0.534, 0.131, 0, 0,\r\n      0, 0, 0, 1, 0\r\n    ],\r\n    BlackWhite: [\r\n      1.5, 1.5, 1.5, 0, -1,\r\n      1.5, 1.5, 1.5, 0, -1,\r\n      1.5, 1.5, 1.5, 0, -1,\r\n      0, 0, 0, 1, 0,\r\n    ]\r\n  };\r\n\r\n  for (var key in matrices) {\r\n    filters[key] = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.Sepia.prototype */ {\r\n\r\n      /**\r\n       * Filter type\r\n       * @param {String} type\r\n       * @default\r\n       */\r\n      type: key,\r\n\r\n      /**\r\n       * Colormatrix for the effect\r\n       * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\r\n       * outside the -1, 1 range.\r\n       * @param {Array} matrix array of 20 numbers.\r\n       * @default\r\n       */\r\n      matrix: matrices[key],\r\n\r\n      /**\r\n       * Lock the matrix export for this kind of static, parameter less filters.\r\n       */\r\n      mainParameter: false,\r\n      /**\r\n       * Lock the colormatrix on the color part, skipping alpha\r\n       */\r\n      colorsOnly: true,\r\n\r\n    });\r\n    fabric.Image.filters[key].fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n  }\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n  'use strict';\r\n\r\n  var fabric = global.fabric,\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Color Blend filter class\r\n   * @class fabric.Image.filter.BlendColor\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @example\r\n   * var filter = new fabric.Image.filters.BlendColor({\r\n   *  color: '#000',\r\n   *  mode: 'multiply'\r\n   * });\r\n   *\r\n   * var filter = new fabric.Image.filters.BlendImage({\r\n   *  image: fabricImageObject,\r\n   *  mode: 'multiply',\r\n   *  alpha: 0.5\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   */\r\n\r\n  filters.BlendColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blend.prototype */ {\r\n    type: 'BlendColor',\r\n\r\n    /**\r\n     * Color to make the blend operation with. default to a reddish color since black or white\r\n     * gives always strong result.\r\n     * @type String\r\n     * @default\r\n     **/\r\n    color: '#F95C63',\r\n\r\n    /**\r\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\r\n     * darken, lighten, overlay, exclusion, tint.\r\n     * @type String\r\n     * @default\r\n     **/\r\n    mode: 'multiply',\r\n\r\n    /**\r\n     * alpha value. represent the strength of the blend color operation.\r\n     * @type Number\r\n     * @default\r\n     **/\r\n    alpha: 1,\r\n\r\n    /**\r\n     * Fragment source for the Multiply program\r\n     */\r\n    fragmentSource: {\r\n      multiply: 'gl_FragColor.rgb *= uColor.rgb;\\n',\r\n      screen: 'gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\\n',\r\n      add: 'gl_FragColor.rgb += uColor.rgb;\\n',\r\n      diff: 'gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\\n',\r\n      subtract: 'gl_FragColor.rgb -= uColor.rgb;\\n',\r\n      lighten: 'gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\\n',\r\n      darken: 'gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\\n',\r\n      exclusion: 'gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\\n',\r\n      overlay: 'if (uColor.r < 0.5) {\\n' +\r\n          'gl_FragColor.r *= 2.0 * uColor.r;\\n' +\r\n        '} else {\\n' +\r\n          'gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\\n' +\r\n        '}\\n' +\r\n        'if (uColor.g < 0.5) {\\n' +\r\n          'gl_FragColor.g *= 2.0 * uColor.g;\\n' +\r\n        '} else {\\n' +\r\n          'gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\\n' +\r\n        '}\\n' +\r\n        'if (uColor.b < 0.5) {\\n' +\r\n          'gl_FragColor.b *= 2.0 * uColor.b;\\n' +\r\n        '} else {\\n' +\r\n          'gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\\n' +\r\n        '}\\n',\r\n      tint: 'gl_FragColor.rgb *= (1.0 - uColor.a);\\n' +\r\n        'gl_FragColor.rgb += uColor.rgb;\\n',\r\n    },\r\n\r\n    /**\r\n     * build the fragment source for the filters, joining the common part with\r\n     * the specific one.\r\n     * @param {String} mode the mode of the filter, a key of this.fragmentSource\r\n     * @return {String} the source to be compiled\r\n     * @private\r\n     */\r\n    buildSource: function(mode) {\r\n      return 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform vec4 uColor;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n          'if (color.a > 0.0) {\\n' +\r\n            this.fragmentSource[mode] +\r\n          '}\\n' +\r\n        '}';\r\n    },\r\n\r\n    /**\r\n     * Retrieves the cached shader.\r\n     * @param {Object} options\r\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n     */\r\n    retrieveShader: function(options) {\r\n      var cacheKey = this.type + '_' + this.mode, shaderSource;\r\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\r\n        shaderSource = this.buildSource(this.mode);\r\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\r\n      }\r\n      return options.programCache[cacheKey];\r\n    },\r\n\r\n    /**\r\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          data = imageData.data, iLen = data.length,\r\n          tr, tg, tb,\r\n          r, g, b,\r\n          source, alpha1 = 1 - this.alpha;\r\n\r\n      source = new fabric.Color(this.color).getSource();\r\n      tr = source[0] * this.alpha;\r\n      tg = source[1] * this.alpha;\r\n      tb = source[2] * this.alpha;\r\n\r\n      for (var i = 0; i < iLen; i += 4) {\r\n\r\n        r = data[i];\r\n        g = data[i + 1];\r\n        b = data[i + 2];\r\n\r\n        switch (this.mode) {\r\n          case 'multiply':\r\n            data[i] = r * tr / 255;\r\n            data[i + 1] = g * tg / 255;\r\n            data[i + 2] = b * tb / 255;\r\n            break;\r\n          case 'screen':\r\n            data[i] = 255 - (255 - r) * (255 - tr) / 255;\r\n            data[i + 1] = 255 - (255 - g) * (255 - tg) / 255;\r\n            data[i + 2] = 255 - (255 - b) * (255 - tb) / 255;\r\n            break;\r\n          case 'add':\r\n            data[i] = r + tr;\r\n            data[i + 1] = g + tg;\r\n            data[i + 2] = b + tb;\r\n            break;\r\n          case 'diff':\r\n          case 'difference':\r\n            data[i] = Math.abs(r - tr);\r\n            data[i + 1] = Math.abs(g - tg);\r\n            data[i + 2] = Math.abs(b - tb);\r\n            break;\r\n          case 'subtract':\r\n            data[i] = r - tr;\r\n            data[i + 1] = g - tg;\r\n            data[i + 2] = b - tb;\r\n            break;\r\n          case 'darken':\r\n            data[i] = Math.min(r, tr);\r\n            data[i + 1] = Math.min(g, tg);\r\n            data[i + 2] = Math.min(b, tb);\r\n            break;\r\n          case 'lighten':\r\n            data[i] = Math.max(r, tr);\r\n            data[i + 1] = Math.max(g, tg);\r\n            data[i + 2] = Math.max(b, tb);\r\n            break;\r\n          case 'overlay':\r\n            data[i] = tr < 128 ? (2 * r * tr / 255) : (255 - 2 * (255 - r) * (255 - tr) / 255);\r\n            data[i + 1] = tg < 128 ? (2 * g * tg / 255) : (255 - 2 * (255 - g) * (255 - tg) / 255);\r\n            data[i + 2] = tb < 128 ? (2 * b * tb / 255) : (255 - 2 * (255 - b) * (255 - tb) / 255);\r\n            break;\r\n          case 'exclusion':\r\n            data[i] = tr + r - ((2 * tr * r) / 255);\r\n            data[i + 1] = tg + g - ((2 * tg * g) / 255);\r\n            data[i + 2] = tb + b - ((2 * tb * b) / 255);\r\n            break;\r\n          case 'tint':\r\n            data[i] = tr + r * alpha1;\r\n            data[i + 1] = tg + g * alpha1;\r\n            data[i + 2] = tb + b * alpha1;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uColor: gl.getUniformLocation(program, 'uColor'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      var source = new fabric.Color(this.color).getSource();\r\n      source[0] = this.alpha * source[0] / 255;\r\n      source[1] = this.alpha * source[1] / 255;\r\n      source[2] = this.alpha * source[2] / 255;\r\n      source[3] = this.alpha;\r\n      gl.uniform4fv(uniformLocations.uColor, source);\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function() {\r\n      return {\r\n        type: this.type,\r\n        color: this.color,\r\n        mode: this.mode,\r\n        alpha: this.alpha\r\n      };\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.BlendColor} Instance of fabric.Image.filters.BlendColor\r\n   */\r\n  fabric.Image.filters.BlendColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n  'use strict';\r\n\r\n  var fabric = global.fabric,\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Image Blend filter class\r\n   * @class fabric.Image.filter.BlendImage\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @example\r\n   * var filter = new fabric.Image.filters.BlendColor({\r\n   *  color: '#000',\r\n   *  mode: 'multiply'\r\n   * });\r\n   *\r\n   * var filter = new fabric.Image.filters.BlendImage({\r\n   *  image: fabricImageObject,\r\n   *  mode: 'multiply',\r\n   *  alpha: 0.5\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   */\r\n\r\n  filters.BlendImage = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.BlendImage.prototype */ {\r\n    type: 'BlendImage',\r\n\r\n    /**\r\n     * Color to make the blend operation with. default to a reddish color since black or white\r\n     * gives always strong result.\r\n     **/\r\n    image: null,\r\n\r\n    /**\r\n     * Blend mode for the filter (one of \"multiply\", \"mask\")\r\n     * @type String\r\n     * @default\r\n     **/\r\n    mode: 'multiply',\r\n\r\n    /**\r\n     * alpha value. represent the strength of the blend image operation.\r\n     * not implemented.\r\n     **/\r\n    alpha: 1,\r\n\r\n    vertexSource: 'attribute vec2 aPosition;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'varying vec2 vTexCoord2;\\n' +\r\n      'uniform mat3 uTransformMatrix;\\n' +\r\n      'void main() {\\n' +\r\n        'vTexCoord = aPosition;\\n' +\r\n        'vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\\n' +\r\n        'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Fragment source for the Multiply program\r\n     */\r\n    fragmentSource: {\r\n      multiply: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform sampler2D uImage;\\n' +\r\n        'uniform vec4 uColor;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'varying vec2 vTexCoord2;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\r\n          'color.rgba *= color2.rgba;\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n        '}',\r\n      mask: 'precision highp float;\\n' +\r\n        'uniform sampler2D uTexture;\\n' +\r\n        'uniform sampler2D uImage;\\n' +\r\n        'uniform vec4 uColor;\\n' +\r\n        'varying vec2 vTexCoord;\\n' +\r\n        'varying vec2 vTexCoord2;\\n' +\r\n        'void main() {\\n' +\r\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\r\n          'color.a = color2.a;\\n' +\r\n          'gl_FragColor = color;\\n' +\r\n        '}',\r\n    },\r\n\r\n    /**\r\n     * Retrieves the cached shader.\r\n     * @param {Object} options\r\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n     */\r\n    retrieveShader: function(options) {\r\n      var cacheKey = this.type + '_' + this.mode;\r\n      var shaderSource = this.fragmentSource[this.mode];\r\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\r\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\r\n      }\r\n      return options.programCache[cacheKey];\r\n    },\r\n\r\n    applyToWebGL: function(options) {\r\n      // load texture to blend.\r\n      var gl = options.context,\r\n          texture = this.createTexture(options.filterBackend, this.image);\r\n      this.bindAdditionalTexture(gl, texture, gl.TEXTURE1);\r\n      this.callSuper('applyToWebGL', options);\r\n      this.unbindAdditionalTexture(gl, gl.TEXTURE1);\r\n    },\r\n\r\n    createTexture: function(backend, image) {\r\n      return backend.getCachedTexture(image.cacheKey, image._element);\r\n    },\r\n\r\n    /**\r\n     * Calculate a transformMatrix to adapt the image to blend over\r\n     * @param {Object} options\r\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n     */\r\n    calculateMatrix: function() {\r\n      var image = this.image,\r\n          width = image._element.width,\r\n          height = image._element.height;\r\n      return [\r\n        1 / image.scaleX, 0, 0,\r\n        0, 1 / image.scaleY, 0,\r\n        -image.left / width, -image.top / height, 1\r\n      ];\r\n    },\r\n\r\n    /**\r\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          resources = options.filterBackend.resources,\r\n          data = imageData.data, iLen = data.length,\r\n          width = imageData.width,\r\n          height = imageData.height,\r\n          tr, tg, tb, ta,\r\n          r, g, b, a,\r\n          canvas1, context, image = this.image, blendData;\r\n\r\n      if (!resources.blendImage) {\r\n        resources.blendImage = fabric.util.createCanvasElement();\r\n      }\r\n      canvas1 = resources.blendImage;\r\n      context = canvas1.getContext('2d');\r\n      if (canvas1.width !== width || canvas1.height !== height) {\r\n        canvas1.width = width;\r\n        canvas1.height = height;\r\n      }\r\n      else {\r\n        context.clearRect(0, 0, width, height);\r\n      }\r\n      context.setTransform(image.scaleX, 0, 0, image.scaleY, image.left, image.top);\r\n      context.drawImage(image._element, 0, 0, width, height);\r\n      blendData = context.getImageData(0, 0, width, height).data;\r\n      for (var i = 0; i < iLen; i += 4) {\r\n\r\n        r = data[i];\r\n        g = data[i + 1];\r\n        b = data[i + 2];\r\n        a = data[i + 3];\r\n\r\n        tr = blendData[i];\r\n        tg = blendData[i + 1];\r\n        tb = blendData[i + 2];\r\n        ta = blendData[i + 3];\r\n\r\n        switch (this.mode) {\r\n          case 'multiply':\r\n            data[i] = r * tr / 255;\r\n            data[i + 1] = g * tg / 255;\r\n            data[i + 2] = b * tb / 255;\r\n            data[i + 3] = a * ta / 255;\r\n            break;\r\n          case 'mask':\r\n            data[i + 3] = ta;\r\n            break;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uTransformMatrix: gl.getUniformLocation(program, 'uTransformMatrix'),\r\n        uImage: gl.getUniformLocation(program, 'uImage'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      var matrix = this.calculateMatrix();\r\n      gl.uniform1i(uniformLocations.uImage, 1); // texture unit 1.\r\n      gl.uniformMatrix3fv(uniformLocations.uTransformMatrix, false, matrix);\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function() {\r\n      return {\r\n        type: this.type,\r\n        image: this.image && this.image.toObject(),\r\n        mode: this.mode,\r\n        alpha: this.alpha\r\n      };\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} callback to be invoked after filter creation\r\n   * @return {fabric.Image.filters.BlendImage} Instance of fabric.Image.filters.BlendImage\r\n   */\r\n  fabric.Image.filters.BlendImage.fromObject = function(object, callback) {\r\n    fabric.Image.fromObject(object.image, function(image) {\r\n      var options = fabric.util.object.clone(object);\r\n      options.image = image;\r\n      callback(new fabric.Image.filters.BlendImage(options));\r\n    });\r\n  };\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,\r\n      sqrt = Math.sqrt, abs = Math.abs, round = Math.round, sin = Math.sin,\r\n      ceil = Math.ceil,\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Resize image filter class\r\n   * @class fabric.Image.filters.Resize\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Resize();\r\n   * object.filters.push(filter);\r\n   * object.applyFilters(canvas.renderAll.bind(canvas));\r\n   */\r\n  filters.Resize = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Resize',\r\n\r\n    /**\r\n     * Resize type\r\n     * for webgl resizeType is just lanczos, for canvas2d can be:\r\n     * bilinear, hermite, sliceHack, lanczos.\r\n     * @param {String} resizeType\r\n     * @default\r\n     */\r\n    resizeType: 'hermite',\r\n\r\n    /**\r\n     * Scale factor for resizing, x axis\r\n     * @param {Number} scaleX\r\n     * @default\r\n     */\r\n    scaleX: 1,\r\n\r\n    /**\r\n     * Scale factor for resizing, y axis\r\n     * @param {Number} scaleY\r\n     * @default\r\n     */\r\n    scaleY: 1,\r\n\r\n    /**\r\n     * LanczosLobes parameter for lanczos filter, valid for resizeType lanczos\r\n     * @param {Number} lanczosLobes\r\n     * @default\r\n     */\r\n    lanczosLobes: 3,\r\n\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uDelta: gl.getUniformLocation(program, 'uDelta'),\r\n        uTaps: gl.getUniformLocation(program, 'uTaps'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform2fv(uniformLocations.uDelta, this.horizontal ? [1 / this.width, 0] : [0, 1 / this.height]);\r\n      gl.uniform1fv(uniformLocations.uTaps, this.taps);\r\n    },\r\n\r\n    /**\r\n     * Retrieves the cached shader.\r\n     * @param {Object} options\r\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n     */\r\n    retrieveShader: function(options) {\r\n      var filterWindow = this.getFilterWindow(), cacheKey = this.type + '_' + filterWindow;\r\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\r\n        var fragmentShader = this.generateShader(filterWindow);\r\n        options.programCache[cacheKey] = this.createProgram(options.context, fragmentShader);\r\n      }\r\n      return options.programCache[cacheKey];\r\n    },\r\n\r\n    getFilterWindow: function() {\r\n      var scale = this.tempScale;\r\n      return Math.ceil(this.lanczosLobes / scale);\r\n    },\r\n\r\n    getTaps: function() {\r\n      var lobeFunction = this.lanczosCreate(this.lanczosLobes), scale = this.tempScale,\r\n          filterWindow = this.getFilterWindow(), taps = new Array(filterWindow);\r\n      for (var i = 1; i <= filterWindow; i++) {\r\n        taps[i - 1] = lobeFunction(i * scale);\r\n      }\r\n      return taps;\r\n    },\r\n\r\n    /**\r\n     * Generate vertex and shader sources from the necessary steps numbers\r\n     * @param {Number} filterWindow\r\n     */\r\n    generateShader: function(filterWindow) {\r\n      var offsets = new Array(filterWindow),\r\n          fragmentShader = this.fragmentSourceTOP, filterWindow;\r\n\r\n      for (var i = 1; i <= filterWindow; i++) {\r\n        offsets[i - 1] = i + '.0 * uDelta';\r\n      }\r\n\r\n      fragmentShader += 'uniform float uTaps[' + filterWindow + '];\\n';\r\n      fragmentShader += 'void main() {\\n';\r\n      fragmentShader += '  vec4 color = texture2D(uTexture, vTexCoord);\\n';\r\n      fragmentShader += '  float sum = 1.0;\\n';\r\n\r\n      offsets.forEach(function(offset, i) {\r\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord + ' + offset + ') * uTaps[' + i + '];\\n';\r\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord - ' + offset + ') * uTaps[' + i + '];\\n';\r\n        fragmentShader += '  sum += 2.0 * uTaps[' + i + '];\\n';\r\n      });\r\n      fragmentShader += '  gl_FragColor = color / sum;\\n';\r\n      fragmentShader += '}';\r\n      return fragmentShader;\r\n    },\r\n\r\n    fragmentSourceTOP: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform vec2 uDelta;\\n' +\r\n      'varying vec2 vTexCoord;\\n',\r\n\r\n    /**\r\n     * Apply the resize filter to the image\r\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\r\n     *\r\n     * @param {Object} options\r\n     * @param {Number} options.passes The number of filters remaining to be executed\r\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\r\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\r\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\r\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n     */\r\n    applyTo: function(options) {\r\n      if (options.webgl) {\r\n        options.passes++;\r\n        this.width = options.sourceWidth;\r\n        this.horizontal = true;\r\n        this.dW = Math.round(this.width * this.scaleX);\r\n        this.dH = options.sourceHeight;\r\n        this.tempScale = this.dW / this.width;\r\n        this.taps = this.getTaps();\r\n        options.destinationWidth = this.dW;\r\n        this._setupFrameBuffer(options);\r\n        this.applyToWebGL(options);\r\n        this._swapTextures(options);\r\n        options.sourceWidth = options.destinationWidth;\r\n\r\n        this.height = options.sourceHeight;\r\n        this.horizontal = false;\r\n        this.dH = Math.round(this.height * this.scaleY);\r\n        this.tempScale = this.dH / this.height;\r\n        this.taps = this.getTaps();\r\n        options.destinationHeight = this.dH;\r\n        this._setupFrameBuffer(options);\r\n        this.applyToWebGL(options);\r\n        this._swapTextures(options);\r\n        options.sourceHeight = options.destinationHeight;\r\n      }\r\n      else {\r\n        this.applyTo2d(options);\r\n      }\r\n    },\r\n\r\n    isNeutralState: function() {\r\n      return this.scaleX === 1 && this.scaleY === 1;\r\n    },\r\n\r\n    lanczosCreate: function(lobes) {\r\n      return function(x) {\r\n        if (x >= lobes || x <= -lobes) {\r\n          return 0.0;\r\n        }\r\n        if (x < 1.19209290E-07 && x > -1.19209290E-07) {\r\n          return 1.0;\r\n        }\r\n        x *= Math.PI;\r\n        var xx = x / lobes;\r\n        return (sin(x) / x) * sin(xx) / xx;\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Applies filter to canvas element\r\n     * @memberOf fabric.Image.filters.Resize.prototype\r\n     * @param {Object} canvasEl Canvas element to apply filter to\r\n     * @param {Number} scaleX\r\n     * @param {Number} scaleY\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData,\r\n          scaleX = this.scaleX,\r\n          scaleY = this.scaleY;\r\n\r\n      this.rcpScaleX = 1 / scaleX;\r\n      this.rcpScaleY = 1 / scaleY;\r\n\r\n      var oW = imageData.width, oH = imageData.height,\r\n          dW = round(oW * scaleX), dH = round(oH * scaleY),\r\n          newData;\r\n\r\n      if (this.resizeType === 'sliceHack') {\r\n        newData = this.sliceByTwo(options, oW, oH, dW, dH);\r\n      }\r\n      else if (this.resizeType === 'hermite') {\r\n        newData = this.hermiteFastResize(options, oW, oH, dW, dH);\r\n      }\r\n      else if (this.resizeType === 'bilinear') {\r\n        newData = this.bilinearFiltering(options, oW, oH, dW, dH);\r\n      }\r\n      else if (this.resizeType === 'lanczos') {\r\n        newData = this.lanczosResize(options, oW, oH, dW, dH);\r\n      }\r\n      options.imageData = newData;\r\n    },\r\n\r\n    /**\r\n     * Filter sliceByTwo\r\n     * @param {Object} canvasEl Canvas element to apply filter to\r\n     * @param {Number} oW Original Width\r\n     * @param {Number} oH Original Height\r\n     * @param {Number} dW Destination Width\r\n     * @param {Number} dH Destination Height\r\n     * @returns {ImageData}\r\n     */\r\n    sliceByTwo: function(options, oW, oH, dW, dH) {\r\n      var imageData = options.imageData,\r\n          mult = 0.5, doneW = false, doneH = false, stepW = oW * mult,\r\n          stepH = oH * mult, resources = fabric.filterBackend.resources,\r\n          tmpCanvas, ctx, sX = 0, sY = 0, dX = oW, dY = 0;\r\n      if (!resources.sliceByTwo) {\r\n        resources.sliceByTwo = document.createElement('canvas');\r\n      }\r\n      tmpCanvas = resources.sliceByTwo;\r\n      if (tmpCanvas.width < oW * 1.5 || tmpCanvas.height < oH) {\r\n        tmpCanvas.width = oW * 1.5;\r\n        tmpCanvas.height = oH;\r\n      }\r\n      ctx = tmpCanvas.getContext('2d');\r\n      ctx.clearRect(0, 0, oW * 1.5, oH);\r\n      ctx.putImageData(imageData, 0, 0);\r\n\r\n      dW = floor(dW);\r\n      dH = floor(dH);\r\n\r\n      while (!doneW || !doneH) {\r\n        oW = stepW;\r\n        oH = stepH;\r\n        if (dW < floor(stepW * mult)) {\r\n          stepW = floor(stepW * mult);\r\n        }\r\n        else {\r\n          stepW = dW;\r\n          doneW = true;\r\n        }\r\n        if (dH < floor(stepH * mult)) {\r\n          stepH = floor(stepH * mult);\r\n        }\r\n        else {\r\n          stepH = dH;\r\n          doneH = true;\r\n        }\r\n        ctx.drawImage(tmpCanvas, sX, sY, oW, oH, dX, dY, stepW, stepH);\r\n        sX = dX;\r\n        sY = dY;\r\n        dY += stepH;\r\n      }\r\n      return ctx.getImageData(sX, sY, dW, dH);\r\n    },\r\n\r\n    /**\r\n     * Filter lanczosResize\r\n     * @param {Object} canvasEl Canvas element to apply filter to\r\n     * @param {Number} oW Original Width\r\n     * @param {Number} oH Original Height\r\n     * @param {Number} dW Destination Width\r\n     * @param {Number} dH Destination Height\r\n     * @returns {ImageData}\r\n     */\r\n    lanczosResize: function(options, oW, oH, dW, dH) {\r\n\r\n      function process(u) {\r\n        var v, i, weight, idx, a, red, green,\r\n            blue, alpha, fX, fY;\r\n        center.x = (u + 0.5) * ratioX;\r\n        icenter.x = floor(center.x);\r\n        for (v = 0; v < dH; v++) {\r\n          center.y = (v + 0.5) * ratioY;\r\n          icenter.y = floor(center.y);\r\n          a = 0; red = 0; green = 0; blue = 0; alpha = 0;\r\n          for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\r\n            if (i < 0 || i >= oW) {\r\n              continue;\r\n            }\r\n            fX = floor(1000 * abs(i - center.x));\r\n            if (!cacheLanc[fX]) {\r\n              cacheLanc[fX] = { };\r\n            }\r\n            for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\r\n              if (j < 0 || j >= oH) {\r\n                continue;\r\n              }\r\n              fY = floor(1000 * abs(j - center.y));\r\n              if (!cacheLanc[fX][fY]) {\r\n                cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);\r\n              }\r\n              weight = cacheLanc[fX][fY];\r\n              if (weight > 0) {\r\n                idx = (j * oW + i) * 4;\r\n                a += weight;\r\n                red += weight * srcData[idx];\r\n                green += weight * srcData[idx + 1];\r\n                blue += weight * srcData[idx + 2];\r\n                alpha += weight * srcData[idx + 3];\r\n              }\r\n            }\r\n          }\r\n          idx = (v * dW + u) * 4;\r\n          destData[idx] = red / a;\r\n          destData[idx + 1] = green / a;\r\n          destData[idx + 2] = blue / a;\r\n          destData[idx + 3] = alpha / a;\r\n        }\r\n\r\n        if (++u < dW) {\r\n          return process(u);\r\n        }\r\n        else {\r\n          return destImg;\r\n        }\r\n      }\r\n\r\n      var srcData = options.imageData.data,\r\n          destImg = options.ctx.createImageData(dW, dH),\r\n          destData = destImg.data,\r\n          lanczos = this.lanczosCreate(this.lanczosLobes),\r\n          ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,\r\n          rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,\r\n          range2X = ceil(ratioX * this.lanczosLobes / 2),\r\n          range2Y = ceil(ratioY * this.lanczosLobes / 2),\r\n          cacheLanc = { }, center = { }, icenter = { };\r\n\r\n      return process(0);\r\n    },\r\n\r\n    /**\r\n     * bilinearFiltering\r\n     * @param {Object} canvasEl Canvas element to apply filter to\r\n     * @param {Number} oW Original Width\r\n     * @param {Number} oH Original Height\r\n     * @param {Number} dW Destination Width\r\n     * @param {Number} dH Destination Height\r\n     * @returns {ImageData}\r\n     */\r\n    bilinearFiltering: function(options, oW, oH, dW, dH) {\r\n      var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,\r\n          color, offset = 0, origPix, ratioX = this.rcpScaleX,\r\n          ratioY = this.rcpScaleY,\r\n          w4 = 4 * (oW - 1), img = options.imageData,\r\n          pixels = img.data, destImage = options.ctx.createImageData(dW, dH),\r\n          destPixels = destImage.data;\r\n      for (i = 0; i < dH; i++) {\r\n        for (j = 0; j < dW; j++) {\r\n          x = floor(ratioX * j);\r\n          y = floor(ratioY * i);\r\n          xDiff = ratioX * j - x;\r\n          yDiff = ratioY * i - y;\r\n          origPix = 4 * (y * oW + x);\r\n\r\n          for (chnl = 0; chnl < 4; chnl++) {\r\n            a = pixels[origPix + chnl];\r\n            b = pixels[origPix + 4 + chnl];\r\n            c = pixels[origPix + w4 + chnl];\r\n            d = pixels[origPix + w4 + 4 + chnl];\r\n            color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +\r\n                    c * yDiff * (1 - xDiff) + d * xDiff * yDiff;\r\n            destPixels[offset++] = color;\r\n          }\r\n        }\r\n      }\r\n      return destImage;\r\n    },\r\n\r\n    /**\r\n     * hermiteFastResize\r\n     * @param {Object} canvasEl Canvas element to apply filter to\r\n     * @param {Number} oW Original Width\r\n     * @param {Number} oH Original Height\r\n     * @param {Number} dW Destination Width\r\n     * @param {Number} dH Destination Height\r\n     * @returns {ImageData}\r\n     */\r\n    hermiteFastResize: function(options, oW, oH, dW, dH) {\r\n      var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,\r\n          ratioWHalf = ceil(ratioW / 2),\r\n          ratioHHalf = ceil(ratioH / 2),\r\n          img = options.imageData, data = img.data,\r\n          img2 = options.ctx.createImageData(dW, dH), data2 = img2.data;\r\n      for (var j = 0; j < dH; j++) {\r\n        for (var i = 0; i < dW; i++) {\r\n          var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,\r\n              gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;\r\n          for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\r\n            var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\r\n                centerX = (i + 0.5) * ratioW, w0 = dy * dy;\r\n            for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\r\n              var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\r\n                  w = sqrt(w0 + dx * dx);\r\n              /* eslint-disable max-depth */\r\n              if (w > 1 && w < -1) {\r\n                continue;\r\n              }\r\n              //hermite filter\r\n              weight = 2 * w * w * w - 3 * w * w + 1;\r\n              if (weight > 0) {\r\n                dx = 4 * (xx + yy * oW);\r\n                //alpha\r\n                gxA += weight * data[dx + 3];\r\n                weightsAlpha += weight;\r\n                //colors\r\n                if (data[dx + 3] < 255) {\r\n                  weight = weight * data[dx + 3] / 250;\r\n                }\r\n                gxR += weight * data[dx];\r\n                gxG += weight * data[dx + 1];\r\n                gxB += weight * data[dx + 2];\r\n                weights += weight;\r\n              }\r\n              /* eslint-enable max-depth */\r\n            }\r\n          }\r\n          data2[x2] = gxR / weights;\r\n          data2[x2 + 1] = gxG / weights;\r\n          data2[x2 + 2] = gxB / weights;\r\n          data2[x2 + 3] = gxA / weightsAlpha;\r\n        }\r\n      }\r\n      return img2;\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function() {\r\n      return {\r\n        type: this.type,\r\n        scaleX: this.scaleX,\r\n        scaleY: this.scaleY,\r\n        resizeType: this.resizeType,\r\n        lanczosLobes: this.lanczosLobes\r\n      };\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\r\n   */\r\n  fabric.Image.filters.Resize.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Contrast filter class\r\n   * @class fabric.Image.filters.Contrast\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Contrast({\r\n   *   contrast: 0.25\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.Contrast = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Contrast.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Contrast',\r\n\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform float uContrast;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n        'float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\\n' +\r\n        'color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\\n' +\r\n        'gl_FragColor = color;\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * contrast value, range from -1 to 1.\r\n     * @param {Number} contrast\r\n     * @default 0\r\n     */\r\n    contrast: 0,\r\n\r\n    mainParameter: 'contrast',\r\n\r\n    /**\r\n     * Constructor\r\n     * @memberOf fabric.Image.filters.Contrast.prototype\r\n     * @param {Object} [options] Options object\r\n     * @param {Number} [options.contrast=0] Value to contrast the image up (-1...1)\r\n     */\r\n\r\n    /**\r\n      * Apply the Contrast operation to a Uint8Array representing the pixels of an image.\r\n      *\r\n      * @param {Object} options\r\n      * @param {ImageData} options.imageData The Uint8Array to be filtered.\r\n      */\r\n    applyTo2d: function(options) {\r\n      if (this.contrast === 0) {\r\n        return;\r\n      }\r\n      var imageData = options.imageData, i, len,\r\n          data = imageData.data, len = data.length,\r\n          contrast = Math.floor(this.contrast * 255),\r\n          contrastF = 259 * (contrast + 255) / (255 * (259 - contrast));\r\n\r\n      for (i = 0; i < len; i += 4) {\r\n        data[i] = contrastF * (data[i] - 128) + 128;\r\n        data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\r\n        data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uContrast: gl.getUniformLocation(program, 'uContrast'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform1f(uniformLocations.uContrast, this.contrast);\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\r\n   */\r\n  fabric.Image.filters.Contrast.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Saturate filter class\r\n   * @class fabric.Image.filters.Saturation\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Saturation#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Saturation({\r\n   *   saturation: 1\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.Saturation = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Saturation.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Saturation',\r\n\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform float uSaturation;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n        'float rgMax = max(color.r, color.g);\\n' +\r\n        'float rgbMax = max(rgMax, color.b);\\n' +\r\n        'color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\\n' +\r\n        'color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\\n' +\r\n        'color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\\n' +\r\n        'gl_FragColor = color;\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Saturation value, from -1 to 1.\r\n     * Increases/decreases the color saturation.\r\n     * A value of 0 has no effect.\r\n     * \r\n     * @param {Number} saturation\r\n     * @default\r\n     */\r\n    saturation: 0,\r\n\r\n    mainParameter: 'saturation',\r\n\r\n    /**\r\n     * Constructor\r\n     * @memberOf fabric.Image.filters.Saturate.prototype\r\n     * @param {Object} [options] Options object\r\n     * @param {Number} [options.saturate=0] Value to saturate the image (-1...1)\r\n     */\r\n\r\n    /**\r\n     * Apply the Saturation operation to a Uint8ClampedArray representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      if (this.saturation === 0) {\r\n        return;\r\n      }\r\n      var imageData = options.imageData,\r\n          data = imageData.data, len = data.length,\r\n          adjust = -this.saturation, i, max;\r\n\r\n      for (i = 0; i < len; i += 4) {\r\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\r\n        data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\r\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\r\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uSaturation: gl.getUniformLocation(program, 'uSaturation'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform1f(uniformLocations.uSaturation, -this.saturation);\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Saturation} Instance of fabric.Image.filters.Saturate\r\n   */\r\n  fabric.Image.filters.Saturation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Vibrance filter class\r\n   * @class fabric.Image.filters.Vibrance\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Vibrance#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Vibrance({\r\n   *   vibrance: 1\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.Vibrance = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Vibrance.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Vibrance',\r\n\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform float uVibrance;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n        'float max = max(color.r, max(color.g, color.b));\\n' +\r\n        'float avg = (color.r + color.g + color.b) / 3.0;\\n' +\r\n        'float amt = (abs(max - avg) * 2.0) * uVibrance;\\n' +\r\n        'color.r += max != color.r ? (max - color.r) * amt : 0.00;\\n' +\r\n        'color.g += max != color.g ? (max - color.g) * amt : 0.00;\\n' +\r\n        'color.b += max != color.b ? (max - color.b) * amt : 0.00;\\n' +\r\n        'gl_FragColor = color;\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Vibrance value, from -1 to 1.\r\n     * Increases/decreases the saturation of more muted colors with less effect on saturated colors.\r\n     * A value of 0 has no effect.\r\n     * \r\n     * @param {Number} vibrance\r\n     * @default\r\n     */\r\n    vibrance: 0,\r\n\r\n    mainParameter: 'vibrance',\r\n\r\n    /**\r\n     * Constructor\r\n     * @memberOf fabric.Image.filters.Vibrance.prototype\r\n     * @param {Object} [options] Options object\r\n     * @param {Number} [options.vibrance=0] Vibrance value for the image (between -1 and 1)\r\n     */\r\n\r\n    /**\r\n     * Apply the Vibrance operation to a Uint8ClampedArray representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      if (this.vibrance === 0) {\r\n        return;\r\n      }\r\n      var imageData = options.imageData,\r\n          data = imageData.data, len = data.length,\r\n          adjust = -this.vibrance, i, max, avg, amt;\r\n\r\n      for (i = 0; i < len; i += 4) {\r\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\r\n        avg = (data[i] + data[i + 1] + data[i + 2]) / 3;\r\n        amt = ((Math.abs(max - avg) * 2 / 255) * adjust);\r\n        data[i] += max !== data[i] ? (max - data[i]) * amt : 0;\r\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * amt : 0;\r\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * amt : 0;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uVibrance: gl.getUniformLocation(program, 'uVibrance'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform1f(uniformLocations.uVibrance, -this.vibrance);\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Vibrance} Instance of fabric.Image.filters.Vibrance\r\n   */\r\n  fabric.Image.filters.Vibrance.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Blur filter class\r\n   * @class fabric.Image.filters.Blur\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Blur#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Blur({\r\n   *   blur: 0.5\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   * canvas.renderAll();\r\n   */\r\n  filters.Blur = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blur.prototype */ {\r\n\r\n    type: 'Blur',\r\n\r\n    /*\r\n'gl_FragColor = vec4(0.0);',\r\n'gl_FragColor += texture2D(texture, vTexCoord + -7 * uDelta)*0.0044299121055113265;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + -6 * uDelta)*0.00895781211794;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + -5 * uDelta)*0.0215963866053;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + -4 * uDelta)*0.0443683338718;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + -3 * uDelta)*0.0776744219933;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + -2 * uDelta)*0.115876621105;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + -1 * uDelta)*0.147308056121;',\r\n'gl_FragColor += texture2D(texture, vTexCoord              )*0.159576912161;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + 1 * uDelta)*0.147308056121;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + 2 * uDelta)*0.115876621105;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + 3 * uDelta)*0.0776744219933;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + 4 * uDelta)*0.0443683338718;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + 5 * uDelta)*0.0215963866053;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + 6 * uDelta)*0.00895781211794;',\r\n'gl_FragColor += texture2D(texture, vTexCoord + 7 * uDelta)*0.0044299121055113265;',\r\n*/\r\n\r\n    /* eslint-disable max-len */\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform vec2 uDelta;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'const float nSamples = 15.0;\\n' +\r\n      'vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\\n' +\r\n      'float random(vec3 scale) {\\n' +\r\n        /* use the fragment position for a different seed per-pixel */\r\n        'return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\\n' +\r\n      '}\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = vec4(0.0);\\n' +\r\n        'float total = 0.0;\\n' +\r\n        'float offset = random(v3offset);\\n' +\r\n        'for (float t = -nSamples; t <= nSamples; t++) {\\n' +\r\n          'float percent = (t + offset - 0.5) / nSamples;\\n' +\r\n          'float weight = 1.0 - abs(percent);\\n' +\r\n          'color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\\n' +\r\n          'total += weight;\\n' +\r\n        '}\\n' +\r\n        'gl_FragColor = color / total;\\n' +\r\n      '}',\r\n    /* eslint-enable max-len */\r\n\r\n    /**\r\n     * blur value, in percentage of image dimensions.\r\n     * specific to keep the image blur constant at different resolutions\r\n     * range between 0 and 1.\r\n     * @type Number\r\n     * @default\r\n     */\r\n    blur: 0,\r\n\r\n    mainParameter: 'blur',\r\n\r\n    applyTo: function(options) {\r\n      if (options.webgl) {\r\n        // this aspectRatio is used to give the same blur to vertical and horizontal\r\n        this.aspectRatio = options.sourceWidth / options.sourceHeight;\r\n        options.passes++;\r\n        this._setupFrameBuffer(options);\r\n        this.horizontal = true;\r\n        this.applyToWebGL(options);\r\n        this._swapTextures(options);\r\n        this._setupFrameBuffer(options);\r\n        this.horizontal = false;\r\n        this.applyToWebGL(options);\r\n        this._swapTextures(options);\r\n      }\r\n      else {\r\n        this.applyTo2d(options);\r\n      }\r\n    },\r\n\r\n    applyTo2d: function(options) {\r\n      // paint canvasEl with current image data.\r\n      //options.ctx.putImageData(options.imageData, 0, 0);\r\n      options.imageData = this.simpleBlur(options);\r\n    },\r\n\r\n    simpleBlur: function(options) {\r\n      var resources = options.filterBackend.resources, canvas1, canvas2,\r\n          width = options.imageData.width,\r\n          height = options.imageData.height;\r\n\r\n      if (!resources.blurLayer1) {\r\n        resources.blurLayer1 = fabric.util.createCanvasElement();\r\n        resources.blurLayer2 = fabric.util.createCanvasElement();\r\n      }\r\n      canvas1 = resources.blurLayer1;\r\n      canvas2 = resources.blurLayer2;\r\n      if (canvas1.width !== width || canvas1.height !== height) {\r\n        canvas2.width = canvas1.width = width;\r\n        canvas2.height = canvas1.height = height;\r\n      }\r\n      var ctx1 = canvas1.getContext('2d'),\r\n          ctx2 = canvas2.getContext('2d'),\r\n          nSamples = 15,\r\n          random, percent, j, i,\r\n          blur = this.blur * 0.06 * 0.5;\r\n\r\n      // load first canvas\r\n      ctx1.putImageData(options.imageData, 0, 0);\r\n      ctx2.clearRect(0, 0, width, height);\r\n\r\n      for (i = -nSamples; i <= nSamples; i++) {\r\n        random = (Math.random() - 0.5) / 4;\r\n        percent = i / nSamples;\r\n        j = blur * percent * width + random;\r\n        ctx2.globalAlpha = 1 - Math.abs(percent);\r\n        ctx2.drawImage(canvas1, j, random);\r\n        ctx1.drawImage(canvas2, 0, 0);\r\n        ctx2.globalAlpha = 1;\r\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\r\n      }\r\n      for (i = -nSamples; i <= nSamples; i++) {\r\n        random = (Math.random() - 0.5) / 4;\r\n        percent = i / nSamples;\r\n        j = blur * percent * height + random;\r\n        ctx2.globalAlpha = 1 - Math.abs(percent);\r\n        ctx2.drawImage(canvas1, random, j);\r\n        ctx1.drawImage(canvas2, 0, 0);\r\n        ctx2.globalAlpha = 1;\r\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\r\n      }\r\n      options.ctx.drawImage(canvas1, 0, 0);\r\n      var newImageData = options.ctx.getImageData(0, 0, canvas1.width, canvas1.height);\r\n      ctx1.globalAlpha = 1;\r\n      ctx1.clearRect(0, 0, canvas1.width, canvas1.height);\r\n      return newImageData;\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        delta: gl.getUniformLocation(program, 'uDelta'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      var delta = this.chooseRightDelta();\r\n      gl.uniform2fv(uniformLocations.delta, delta);\r\n    },\r\n\r\n    /**\r\n     * choose right value of image percentage to blur with\r\n     * @returns {Array} a numeric array with delta values\r\n     */\r\n    chooseRightDelta: function() {\r\n      var blurScale = 1, delta = [0, 0], blur;\r\n      if (this.horizontal) {\r\n        if (this.aspectRatio > 1) {\r\n          // image is wide, i want to shrink radius horizontal\r\n          blurScale = 1 / this.aspectRatio;\r\n        }\r\n      }\r\n      else {\r\n        if (this.aspectRatio < 1) {\r\n          // image is tall, i want to shrink radius vertical\r\n          blurScale = this.aspectRatio;\r\n        }\r\n      }\r\n      blur = blurScale * this.blur * 0.12;\r\n      if (this.horizontal) {\r\n        delta[0] = blur;\r\n      }\r\n      else {\r\n        delta[1] = blur;\r\n      }\r\n      return delta;\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Deserialize a JSON definition of a BlurFilter into a concrete instance.\r\n   */\r\n  filters.Blur.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * Gamma filter class\r\n   * @class fabric.Image.filters.Gamma\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.Gamma#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.Gamma({\r\n   *   gamma: [1, 0.5, 2.1]\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.Gamma = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Gamma.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'Gamma',\r\n\r\n    fragmentSource: 'precision highp float;\\n' +\r\n      'uniform sampler2D uTexture;\\n' +\r\n      'uniform vec3 uGamma;\\n' +\r\n      'varying vec2 vTexCoord;\\n' +\r\n      'void main() {\\n' +\r\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\r\n        'vec3 correction = (1.0 / uGamma);\\n' +\r\n        'color.r = pow(color.r, correction.r);\\n' +\r\n        'color.g = pow(color.g, correction.g);\\n' +\r\n        'color.b = pow(color.b, correction.b);\\n' +\r\n        'gl_FragColor = color;\\n' +\r\n        'gl_FragColor.rgb *= color.a;\\n' +\r\n      '}',\r\n\r\n    /**\r\n     * Gamma array value, from 0.01 to 2.2.\r\n     * @param {Array} gamma\r\n     * @default\r\n     */\r\n    gamma: [1, 1, 1],\r\n\r\n    /**\r\n     * Describe the property that is the filter parameter\r\n     * @param {String} m\r\n     * @default\r\n     */\r\n    mainParameter: 'gamma',\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} [options] Options object\r\n     */\r\n    initialize: function(options) {\r\n      this.gamma = [1, 1, 1];\r\n      filters.BaseFilter.prototype.initialize.call(this, options);\r\n    },\r\n\r\n    /**\r\n     * Apply the Gamma operation to a Uint8Array representing the pixels of an image.\r\n     *\r\n     * @param {Object} options\r\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\r\n     */\r\n    applyTo2d: function(options) {\r\n      var imageData = options.imageData, data = imageData.data,\r\n          gamma = this.gamma, len = data.length,\r\n          rInv = 1 / gamma[0], gInv = 1 / gamma[1],\r\n          bInv = 1 / gamma[2], i;\r\n\r\n      if (!this.rVals) {\r\n        // eslint-disable-next-line\r\n        this.rVals = new Uint8Array(256);\r\n        // eslint-disable-next-line\r\n        this.gVals = new Uint8Array(256);\r\n        // eslint-disable-next-line\r\n        this.bVals = new Uint8Array(256);\r\n      }\r\n\r\n      // This is an optimization - pre-compute a look-up table for each color channel\r\n      // instead of performing these pow calls for each pixel in the image.\r\n      for (i = 0, len = 256; i < len; i++) {\r\n        this.rVals[i] = Math.pow(i / 255, rInv) * 255;\r\n        this.gVals[i] = Math.pow(i / 255, gInv) * 255;\r\n        this.bVals[i] = Math.pow(i / 255, bInv) * 255;\r\n      }\r\n      for (i = 0, len = data.length; i < len; i += 4) {\r\n        data[i] = this.rVals[data[i]];\r\n        data[i + 1] = this.gVals[data[i + 1]];\r\n        data[i + 2] = this.bVals[data[i + 2]];\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return WebGL uniform locations for this filter's shader.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\r\n     */\r\n    getUniformLocations: function(gl, program) {\r\n      return {\r\n        uGamma: gl.getUniformLocation(program, 'uGamma'),\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Send data from this filter to its shader program's uniforms.\r\n     *\r\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\r\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\r\n     */\r\n    sendUniformData: function(gl, uniformLocations) {\r\n      gl.uniform3fv(uniformLocations.uGamma, this.gamma);\r\n    },\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.Gamma} Instance of fabric.Image.filters.Gamma\r\n   */\r\n  fabric.Image.filters.Gamma.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * A container class that knows how to apply a sequence of filters to an input image.\r\n   */\r\n  filters.Composed = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Composed.prototype */ {\r\n\r\n    type: 'Composed',\r\n\r\n    /**\r\n     * A non sparse array of filters to apply\r\n     */\r\n    subFilters: [],\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {Object} [options] Options object\r\n     */\r\n    initialize: function(options) {\r\n      this.callSuper('initialize', options);\r\n      // create a new array instead mutating the prototype with push\r\n      this.subFilters = this.subFilters.slice(0);\r\n    },\r\n\r\n    /**\r\n     * Apply this container's filters to the input image provided.\r\n     *\r\n     * @param {Object} options\r\n     * @param {Number} options.passes The number of filters remaining to be applied.\r\n     */\r\n    applyTo: function(options) {\r\n      options.passes += this.subFilters.length - 1;\r\n      this.subFilters.forEach(function(filter) {\r\n        filter.applyTo(options);\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Serialize this filter into JSON.\r\n     *\r\n     * @returns {Object} A JSON representation of this filter.\r\n     */\r\n    toObject: function() {\r\n      return fabric.util.object.extend(this.callSuper('toObject'), {\r\n        subFilters: this.subFilters.map(function(filter) { return filter.toObject(); }),\r\n      });\r\n    },\r\n\r\n    isNeutralState: function() {\r\n      return !this.subFilters.some(function(filter) { return !filter.isNeutralState(); });\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Deserialize a JSON definition of a ComposedFilter into a concrete instance.\r\n   */\r\n  fabric.Image.filters.Composed.fromObject = function(object, callback) {\r\n    var filters = object.subFilters || [],\r\n        subFilters = filters.map(function(filter) {\r\n          return new fabric.Image.filters[filter.type](filter);\r\n        }),\r\n        instance = new fabric.Image.filters.Composed({ subFilters: subFilters });\r\n    callback && callback(instance);\r\n    return instance;\r\n  };\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric  = global.fabric || (global.fabric = { }),\r\n      filters = fabric.Image.filters,\r\n      createClass = fabric.util.createClass;\r\n\r\n  /**\r\n   * HueRotation filter class\r\n   * @class fabric.Image.filters.HueRotation\r\n   * @memberOf fabric.Image.filters\r\n   * @extends fabric.Image.filters.BaseFilter\r\n   * @see {@link fabric.Image.filters.HueRotation#initialize} for constructor definition\r\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\r\n   * @example\r\n   * var filter = new fabric.Image.filters.HueRotation({\r\n   *   rotation: -0.5\r\n   * });\r\n   * object.filters.push(filter);\r\n   * object.applyFilters();\r\n   */\r\n  filters.HueRotation = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.HueRotation.prototype */ {\r\n\r\n    /**\r\n     * Filter type\r\n     * @param {String} type\r\n     * @default\r\n     */\r\n    type: 'HueRotation',\r\n\r\n    /**\r\n     * HueRotation value, from -1 to 1.\r\n     * the unit is radians\r\n     * @param {Number} myParameter\r\n     * @default\r\n     */\r\n    rotation: 0,\r\n\r\n    /**\r\n     * Describe the property that is the filter parameter\r\n     * @param {String} m\r\n     * @default\r\n     */\r\n    mainParameter: 'rotation',\r\n\r\n    calculateMatrix: function() {\r\n      var rad = this.rotation * Math.PI, cos = fabric.util.cos(rad), sin = fabric.util.sin(rad),\r\n          aThird = 1 / 3, aThirdSqtSin = Math.sqrt(aThird) * sin, OneMinusCos = 1 - cos;\r\n      this.matrix = [\r\n        1, 0, 0, 0, 0,\r\n        0, 1, 0, 0, 0,\r\n        0, 0, 1, 0, 0,\r\n        0, 0, 0, 1, 0\r\n      ];\r\n      this.matrix[0] = cos + OneMinusCos / 3;\r\n      this.matrix[1] = aThird * OneMinusCos - aThirdSqtSin;\r\n      this.matrix[2] = aThird * OneMinusCos + aThirdSqtSin;\r\n      this.matrix[5] = aThird * OneMinusCos + aThirdSqtSin;\r\n      this.matrix[6] = cos + aThird * OneMinusCos;\r\n      this.matrix[7] = aThird * OneMinusCos - aThirdSqtSin;\r\n      this.matrix[10] = aThird * OneMinusCos - aThirdSqtSin;\r\n      this.matrix[11] = aThird * OneMinusCos + aThirdSqtSin;\r\n      this.matrix[12] = cos + aThird * OneMinusCos;\r\n    },\r\n\r\n    /**\r\n     * HueRotation isNeutralState implementation\r\n     * Used only in image applyFilters to discard filters that will not have an effect\r\n     * on the image\r\n     * @param {Object} options\r\n     **/\r\n    isNeutralState: function(options) {\r\n      this.calculateMatrix();\r\n      return filters.BaseFilter.prototype.isNeutralState.call(this, options);\r\n    },\r\n\r\n    /**\r\n     * Apply this filter to the input image data provided.\r\n     *\r\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\r\n     *\r\n     * @param {Object} options\r\n     * @param {Number} options.passes The number of filters remaining to be executed\r\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\r\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\r\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\r\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\r\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\r\n     */\r\n    applyTo: function(options) {\r\n      this.calculateMatrix();\r\n      filters.BaseFilter.prototype.applyTo.call(this, options);\r\n    },\r\n\r\n  });\r\n\r\n  /**\r\n   * Returns filter instance from an object representation\r\n   * @static\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] to be invoked after filter creation\r\n   * @return {fabric.Image.filters.HueRotation} Instance of fabric.Image.filters.HueRotation\r\n   */\r\n  fabric.Image.filters.HueRotation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = { }),\r\n      clone = fabric.util.object.clone;\r\n\r\n  if (fabric.Text) {\r\n    fabric.warn('fabric.Text is already defined');\r\n    return;\r\n  }\r\n\r\n  var additionalProps =\r\n    ('fontFamily fontWeight fontSize text underline overline linethrough' +\r\n    ' textAlign fontStyle lineHeight textBackgroundColor charSpacing styles' +\r\n    ' direction path pathStartOffset pathSide pathAlign').split(' ');\r\n\r\n  /**\r\n   * Text class\r\n   * @class fabric.Text\r\n   * @extends fabric.Object\r\n   * @return {fabric.Text} thisArg\r\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\r\n   * @see {@link fabric.Text#initialize} for constructor definition\r\n   */\r\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {\r\n\r\n    /**\r\n     * Properties which when set cause object to change dimensions\r\n     * @type Array\r\n     * @private\r\n     */\r\n    _dimensionAffectingProps: [\r\n      'fontSize',\r\n      'fontWeight',\r\n      'fontFamily',\r\n      'fontStyle',\r\n      'lineHeight',\r\n      'text',\r\n      'charSpacing',\r\n      'textAlign',\r\n      'styles',\r\n      'path',\r\n      'pathStartOffset',\r\n      'pathSide',\r\n      'pathAlign'\r\n    ],\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _reNewline: /\\r?\\n/,\r\n\r\n    /**\r\n     * Use this regular expression to filter for whitespaces that is not a new line.\r\n     * Mostly used when text is 'justify' aligned.\r\n     * @private\r\n     */\r\n    _reSpacesAndTabs: /[ \\t\\r]/g,\r\n\r\n    /**\r\n     * Use this regular expression to filter for whitespace that is not a new line.\r\n     * Mostly used when text is 'justify' aligned.\r\n     * @private\r\n     */\r\n    _reSpaceAndTab: /[ \\t\\r]/,\r\n\r\n    /**\r\n     * Use this regular expression to filter consecutive groups of non spaces.\r\n     * Mostly used when text is 'justify' aligned.\r\n     * @private\r\n     */\r\n    _reWords: /\\S+/g,\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type:                 'text',\r\n\r\n    /**\r\n     * Font size (in pixels)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    fontSize:             40,\r\n\r\n    /**\r\n     * Font weight (e.g. bold, normal, 400, 600, 800)\r\n     * @type {(Number|String)}\r\n     * @default\r\n     */\r\n    fontWeight:           'normal',\r\n\r\n    /**\r\n     * Font family\r\n     * @type String\r\n     * @default\r\n     */\r\n    fontFamily:           'Times New Roman',\r\n\r\n    /**\r\n     * Text decoration underline.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    underline:       false,\r\n\r\n    /**\r\n     * Text decoration overline.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    overline:       false,\r\n\r\n    /**\r\n     * Text decoration linethrough.\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    linethrough:       false,\r\n\r\n    /**\r\n     * Text alignment. Possible values: \"left\", \"center\", \"right\", \"justify\",\r\n     * \"justify-left\", \"justify-center\" or \"justify-right\".\r\n     * @type String\r\n     * @default\r\n     */\r\n    textAlign:            'left',\r\n\r\n    /**\r\n     * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\r\n     * @type String\r\n     * @default\r\n     */\r\n    fontStyle:            'normal',\r\n\r\n    /**\r\n     * Line height\r\n     * @type Number\r\n     * @default\r\n     */\r\n    lineHeight:           1.16,\r\n\r\n    /**\r\n     * Superscript schema object (minimum overlap)\r\n     * @type {Object}\r\n     * @default\r\n     */\r\n    superscript: {\r\n      size:      0.60, // fontSize factor\r\n      baseline: -0.35  // baseline-shift factor (upwards)\r\n    },\r\n\r\n    /**\r\n     * Subscript schema object (minimum overlap)\r\n     * @type {Object}\r\n     * @default\r\n     */\r\n    subscript: {\r\n      size:      0.60, // fontSize factor\r\n      baseline:  0.11  // baseline-shift factor (downwards)\r\n    },\r\n\r\n    /**\r\n     * Background color of text lines\r\n     * @type String\r\n     * @default\r\n     */\r\n    textBackgroundColor:  '',\r\n\r\n    /**\r\n     * List of properties to consider when checking if\r\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\r\n     * as well as for history (undo/redo) purposes\r\n     * @type Array\r\n     */\r\n    stateProperties: fabric.Object.prototype.stateProperties.concat(additionalProps),\r\n\r\n    /**\r\n     * List of properties to consider when checking if cache needs refresh\r\n     * @type Array\r\n     */\r\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat(additionalProps),\r\n\r\n    /**\r\n     * When defined, an object is rendered via stroke and this property specifies its color.\r\n     * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\r\n     * @type String\r\n     * @default\r\n     */\r\n    stroke:               null,\r\n\r\n    /**\r\n     * Shadow object representing shadow of this shape.\r\n     * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\r\n     * @type fabric.Shadow\r\n     * @default\r\n     */\r\n    shadow:               null,\r\n\r\n    /**\r\n     * fabric.Path that the text should follow.\r\n     * since 4.6.0 the path will be drawn automatically.\r\n     * if you want to make the path visible, give it a stroke and strokeWidth or fill value\r\n     * if you want it to be hidden, assign visible = false to the path.\r\n     * This feature is in BETA, and SVG import/export is not yet supported.\r\n     * @type fabric.Path\r\n     * @example\r\n     * var textPath = new fabric.Text('Text on a path', {\r\n     *     top: 150,\r\n     *     left: 150,\r\n     *     textAlign: 'center',\r\n     *     charSpacing: -50,\r\n     *     path: new fabric.Path('M 0 0 C 50 -100 150 -100 200 0', {\r\n     *         strokeWidth: 1,\r\n     *         visible: false\r\n     *     }),\r\n     *     pathSide: 'left',\r\n     *     pathStartOffset: 0\r\n     * });\r\n     * @default\r\n     */\r\n    path:               null,\r\n\r\n    /**\r\n     * Offset amount for text path starting position\r\n     * Only used when text has a path\r\n     * @type Number\r\n     * @default\r\n     */\r\n    pathStartOffset:               0,\r\n\r\n    /**\r\n     * Which side of the path the text should be drawn on.\r\n     * Only used when text has a path\r\n     * @type {String} 'left|right'\r\n     * @default\r\n     */\r\n    pathSide:               'left',\r\n\r\n    /**\r\n     * How text is aligned to the path. This property determines\r\n     * the perpendicular position of each character relative to the path.\r\n     * (one of \"baseline\", \"center\", \"ascender\", \"descender\")\r\n     * This feature is in BETA, and its behavior may change\r\n     * @type String\r\n     * @default\r\n     */\r\n    pathAlign:               'baseline',\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _fontSizeFraction: 0.222,\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    offsets: {\r\n      underline: 0.10,\r\n      linethrough: -0.315,\r\n      overline: -0.88\r\n    },\r\n\r\n    /**\r\n     * Text Line proportion to font Size (in pixels)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    _fontSizeMult:             1.13,\r\n\r\n    /**\r\n     * additional space between characters\r\n     * expressed in thousands of em unit\r\n     * @type Number\r\n     * @default\r\n     */\r\n    charSpacing:             0,\r\n\r\n    /**\r\n     * Object containing character styles - top-level properties -> line numbers,\r\n     * 2nd-level properties - character numbers\r\n     * @type Object\r\n     * @default\r\n     */\r\n    styles: null,\r\n\r\n    /**\r\n     * Reference to a context to measure text char or couple of chars\r\n     * the cacheContext of the canvas will be used or a freshly created one if the object is not on canvas\r\n     * once created it will be referenced on fabric._measuringContext to avoid creating a canvas for every\r\n     * text object created.\r\n     * @type {CanvasRenderingContext2D}\r\n     * @default\r\n     */\r\n    _measuringContext: null,\r\n\r\n    /**\r\n     * Baseline shift, styles only, keep at 0 for the main text object\r\n     * @type {Number}\r\n     * @default\r\n     */\r\n    deltaY: 0,\r\n\r\n    /**\r\n     * WARNING: EXPERIMENTAL. NOT SUPPORTED YET\r\n     * determine the direction of the text.\r\n     * This has to be set manually together with textAlign and originX for proper\r\n     * experience.\r\n     * some interesting link for the future\r\n     * https://www.w3.org/International/questions/qa-bidi-unicode-controls\r\n     * @since 4.5.0\r\n     * @type {String} 'ltr|rtl'\r\n     * @default\r\n     */\r\n    direction: 'ltr',\r\n\r\n    /**\r\n     * Array of properties that define a style unit (of 'styles').\r\n     * @type {Array}\r\n     * @default\r\n     */\r\n    _styleProperties: [\r\n      'stroke',\r\n      'strokeWidth',\r\n      'fill',\r\n      'fontFamily',\r\n      'fontSize',\r\n      'fontWeight',\r\n      'fontStyle',\r\n      'underline',\r\n      'overline',\r\n      'linethrough',\r\n      'deltaY',\r\n      'textBackgroundColor',\r\n    ],\r\n\r\n    /**\r\n     * contains characters bounding boxes\r\n     */\r\n    __charBounds: [],\r\n\r\n    /**\r\n     * use this size when measuring text. To avoid IE11 rounding errors\r\n     * @type {Number}\r\n     * @default\r\n     * @readonly\r\n     * @private\r\n     */\r\n    CACHE_FONT_SIZE: 400,\r\n\r\n    /**\r\n     * contains the min text width to avoid getting 0\r\n     * @type {Number}\r\n     * @default\r\n     */\r\n    MIN_TEXT_WIDTH: 2,\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {String} text Text string\r\n     * @param {Object} [options] Options object\r\n     * @return {fabric.Text} thisArg\r\n     */\r\n    initialize: function(text, options) {\r\n      this.styles = options ? (options.styles || { }) : { };\r\n      this.text = text;\r\n      this.__skipDimension = true;\r\n      this.callSuper('initialize', options);\r\n      if (this.path) {\r\n        this.setPathInfo();\r\n      }\r\n      this.__skipDimension = false;\r\n      this.initDimensions();\r\n      this.setCoords();\r\n      this.setupState({ propertySet: '_dimensionAffectingProps' });\r\n    },\r\n\r\n    /**\r\n     * If text has a path, it will add the extra information needed\r\n     * for path and text calculations\r\n     * @return {fabric.Text} thisArg\r\n     */\r\n    setPathInfo: function() {\r\n      var path = this.path;\r\n      if (path) {\r\n        path.segmentsInfo = fabric.util.getPathSegmentsInfo(path.path);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Return a context for measurement of text string.\r\n     * if created it gets stored for reuse\r\n     * this is for internal use, please do not use it\r\n     * @private\r\n     * @param {String} text Text string\r\n     * @param {Object} [options] Options object\r\n     * @return {fabric.Text} thisArg\r\n     */\r\n    getMeasuringContext: function() {\r\n      // if we did not return we have to measure something.\r\n      if (!fabric._measuringContext) {\r\n        fabric._measuringContext = this.canvas && this.canvas.contextCache ||\r\n          fabric.util.createCanvasElement().getContext('2d');\r\n      }\r\n      return fabric._measuringContext;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * Divides text into lines of text and lines of graphemes.\r\n     */\r\n    _splitText: function() {\r\n      var newLines = this._splitTextIntoLines(this.text);\r\n      this.textLines = newLines.lines;\r\n      this._textLines = newLines.graphemeLines;\r\n      this._unwrappedTextLines = newLines._unwrappedLines;\r\n      this._text = newLines.graphemeText;\r\n      return newLines;\r\n    },\r\n\r\n    /**\r\n     * Initialize or update text dimensions.\r\n     * Updates this.width and this.height with the proper values.\r\n     * Does not return dimensions.\r\n     */\r\n    initDimensions: function() {\r\n      if (this.__skipDimension) {\r\n        return;\r\n      }\r\n      this._splitText();\r\n      this._clearCache();\r\n      if (this.path) {\r\n        this.width = this.path.width;\r\n        this.height = this.path.height;\r\n      }\r\n      else {\r\n        this.width = this.calcTextWidth() || this.cursorWidth || this.MIN_TEXT_WIDTH;\r\n        this.height = this.calcTextHeight();\r\n      }\r\n      if (this.textAlign.indexOf('justify') !== -1) {\r\n        // once text is measured we need to make space fatter to make justified text.\r\n        this.enlargeSpaces();\r\n      }\r\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\r\n    },\r\n\r\n    /**\r\n     * Enlarge space boxes and shift the others\r\n     */\r\n    enlargeSpaces: function() {\r\n      var diffSpace, currentLineWidth, numberOfSpaces, accumulatedSpace, line, charBound, spaces;\r\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\r\n        if (this.textAlign !== 'justify' && (i === len - 1 || this.isEndOfWrapping(i))) {\r\n          continue;\r\n        }\r\n        accumulatedSpace = 0;\r\n        line = this._textLines[i];\r\n        currentLineWidth = this.getLineWidth(i);\r\n        if (currentLineWidth < this.width && (spaces = this.textLines[i].match(this._reSpacesAndTabs))) {\r\n          numberOfSpaces = spaces.length;\r\n          diffSpace = (this.width - currentLineWidth) / numberOfSpaces;\r\n          for (var j = 0, jlen = line.length; j <= jlen; j++) {\r\n            charBound = this.__charBounds[i][j];\r\n            if (this._reSpaceAndTab.test(line[j])) {\r\n              charBound.width += diffSpace;\r\n              charBound.kernedWidth += diffSpace;\r\n              charBound.left += accumulatedSpace;\r\n              accumulatedSpace += diffSpace;\r\n            }\r\n            else {\r\n              charBound.left += accumulatedSpace;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Detect if the text line is ended with an hard break\r\n     * text and itext do not have wrapping, return false\r\n     * @return {Boolean}\r\n     */\r\n    isEndOfWrapping: function(lineIndex) {\r\n      return lineIndex === this._textLines.length - 1;\r\n    },\r\n\r\n    /**\r\n     * Detect if a line has a linebreak and so we need to account for it when moving\r\n     * and counting style.\r\n     * It return always for text and Itext.\r\n     * @return Number\r\n     */\r\n    missingNewlineOffset: function() {\r\n      return 1;\r\n    },\r\n\r\n    /**\r\n     * Returns string representation of an instance\r\n     * @return {String} String representation of text object\r\n     */\r\n    toString: function() {\r\n      return '#<fabric.Text (' + this.complexity() +\r\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\r\n    },\r\n\r\n    /**\r\n     * Return the dimension and the zoom level needed to create a cache canvas\r\n     * big enough to host the object to be cached.\r\n     * @private\r\n     * @param {Object} dim.x width of object to be cached\r\n     * @param {Object} dim.y height of object to be cached\r\n     * @return {Object}.width width of canvas\r\n     * @return {Object}.height height of canvas\r\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\r\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\r\n     */\r\n    _getCacheCanvasDimensions: function() {\r\n      var dims = this.callSuper('_getCacheCanvasDimensions');\r\n      var fontSize = this.fontSize;\r\n      dims.width += fontSize * dims.zoomX;\r\n      dims.height += fontSize * dims.zoomY;\r\n      return dims;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      var path = this.path;\r\n      path && !path.isNotVisible() && path._render(ctx);\r\n      this._setTextStyles(ctx);\r\n      this._renderTextLinesBackground(ctx);\r\n      this._renderTextDecoration(ctx, 'underline');\r\n      this._renderText(ctx);\r\n      this._renderTextDecoration(ctx, 'overline');\r\n      this._renderTextDecoration(ctx, 'linethrough');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderText: function(ctx) {\r\n      if (this.paintFirst === 'stroke') {\r\n        this._renderTextStroke(ctx);\r\n        this._renderTextFill(ctx);\r\n      }\r\n      else {\r\n        this._renderTextFill(ctx);\r\n        this._renderTextStroke(ctx);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Set the font parameter of the context with the object properties or with charStyle\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {Object} [charStyle] object with font style properties\r\n     * @param {String} [charStyle.fontFamily] Font Family\r\n     * @param {Number} [charStyle.fontSize] Font size in pixels. ( without px suffix )\r\n     * @param {String} [charStyle.fontWeight] Font weight\r\n     * @param {String} [charStyle.fontStyle] Font style (italic|normal)\r\n     */\r\n    _setTextStyles: function(ctx, charStyle, forMeasuring) {\r\n      ctx.textBaseline = 'alphabetical';\r\n      if (this.path) {\r\n        switch (this.pathAlign) {\r\n          case 'center':\r\n            ctx.textBaseline = 'middle';\r\n            break;\r\n          case 'ascender':\r\n            ctx.textBaseline = 'top';\r\n            break;\r\n          case 'descender':\r\n            ctx.textBaseline = 'bottom';\r\n            break;\r\n        }\r\n      }\r\n      ctx.font = this._getFontDeclaration(charStyle, forMeasuring);\r\n    },\r\n\r\n    /**\r\n     * calculate and return the text Width measuring each line.\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @return {Number} Maximum width of fabric.Text object\r\n     */\r\n    calcTextWidth: function() {\r\n      var maxWidth = this.getLineWidth(0);\r\n\r\n      for (var i = 1, len = this._textLines.length; i < len; i++) {\r\n        var currentLineWidth = this.getLineWidth(i);\r\n        if (currentLineWidth > maxWidth) {\r\n          maxWidth = currentLineWidth;\r\n        }\r\n      }\r\n      return maxWidth;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {String} line Text to render\r\n     * @param {Number} left Left position of text\r\n     * @param {Number} top Top position of text\r\n     * @param {Number} lineIndex Index of a line in a text\r\n     */\r\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\r\n      this._renderChars(method, ctx, line, left, top, lineIndex);\r\n    },\r\n\r\n    /**\r\n     * Renders the text background for lines, taking care of style\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderTextLinesBackground: function(ctx) {\r\n      if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor')) {\r\n        return;\r\n      }\r\n      var heightOfLine,\r\n          lineLeftOffset, originalFill = ctx.fillStyle,\r\n          line, lastColor,\r\n          leftOffset = this._getLeftOffset(),\r\n          lineTopOffset = this._getTopOffset(),\r\n          boxStart = 0, boxWidth = 0, charBox, currentColor, path = this.path,\r\n          drawStart;\r\n\r\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\r\n        heightOfLine = this.getHeightOfLine(i);\r\n        if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor', i)) {\r\n          lineTopOffset += heightOfLine;\r\n          continue;\r\n        }\r\n        line = this._textLines[i];\r\n        lineLeftOffset = this._getLineLeftOffset(i);\r\n        boxWidth = 0;\r\n        boxStart = 0;\r\n        lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\r\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\r\n          charBox = this.__charBounds[i][j];\r\n          currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\r\n          if (path) {\r\n            ctx.save();\r\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\r\n            ctx.rotate(charBox.angle);\r\n            ctx.fillStyle = currentColor;\r\n            currentColor && ctx.fillRect(\r\n              -charBox.width / 2,\r\n              -heightOfLine / this.lineHeight * (1 - this._fontSizeFraction),\r\n              charBox.width,\r\n              heightOfLine / this.lineHeight\r\n            );\r\n            ctx.restore();\r\n          }\r\n          else if (currentColor !== lastColor) {\r\n            drawStart = leftOffset + lineLeftOffset + boxStart;\r\n            if (this.direction === 'rtl') {\r\n              drawStart = this.width - drawStart - boxWidth;\r\n            }\r\n            ctx.fillStyle = lastColor;\r\n            lastColor && ctx.fillRect(\r\n              drawStart,\r\n              lineTopOffset,\r\n              boxWidth,\r\n              heightOfLine / this.lineHeight\r\n            );\r\n            boxStart = charBox.left;\r\n            boxWidth = charBox.width;\r\n            lastColor = currentColor;\r\n          }\r\n          else {\r\n            boxWidth += charBox.kernedWidth;\r\n          }\r\n        }\r\n        if (currentColor && !path) {\r\n          drawStart = leftOffset + lineLeftOffset + boxStart;\r\n          if (this.direction === 'rtl') {\r\n            drawStart = this.width - drawStart - boxWidth;\r\n          }\r\n          ctx.fillStyle = currentColor;\r\n          ctx.fillRect(\r\n            drawStart,\r\n            lineTopOffset,\r\n            boxWidth,\r\n            heightOfLine / this.lineHeight\r\n          );\r\n        }\r\n        lineTopOffset += heightOfLine;\r\n      }\r\n      ctx.fillStyle = originalFill;\r\n      // if there is text background color no\r\n      // other shadows should be casted\r\n      this._removeShadow(ctx);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} decl style declaration for cache\r\n     * @param {String} decl.fontFamily fontFamily\r\n     * @param {String} decl.fontStyle fontStyle\r\n     * @param {String} decl.fontWeight fontWeight\r\n     * @return {Object} reference to cache\r\n     */\r\n    getFontCache: function(decl) {\r\n      var fontFamily = decl.fontFamily.toLowerCase();\r\n      if (!fabric.charWidthsCache[fontFamily]) {\r\n        fabric.charWidthsCache[fontFamily] = { };\r\n      }\r\n      var cache = fabric.charWidthsCache[fontFamily],\r\n          cacheProp = decl.fontStyle.toLowerCase() + '_' + (decl.fontWeight + '').toLowerCase();\r\n      if (!cache[cacheProp]) {\r\n        cache[cacheProp] = { };\r\n      }\r\n      return cache[cacheProp];\r\n    },\r\n\r\n    /**\r\n     * measure and return the width of a single character.\r\n     * possibly overridden to accommodate different measure logic or\r\n     * to hook some external lib for character measurement\r\n     * @private\r\n     * @param {String} _char, char to be measured\r\n     * @param {Object} charStyle style of char to be measured\r\n     * @param {String} [previousChar] previous char\r\n     * @param {Object} [prevCharStyle] style of previous char\r\n     */\r\n    _measureChar: function(_char, charStyle, previousChar, prevCharStyle) {\r\n      // first i try to return from cache\r\n      var fontCache = this.getFontCache(charStyle), fontDeclaration = this._getFontDeclaration(charStyle),\r\n          previousFontDeclaration = this._getFontDeclaration(prevCharStyle), couple = previousChar + _char,\r\n          stylesAreEqual = fontDeclaration === previousFontDeclaration, width, coupleWidth, previousWidth,\r\n          fontMultiplier = charStyle.fontSize / this.CACHE_FONT_SIZE, kernedWidth;\r\n\r\n      if (previousChar && fontCache[previousChar] !== undefined) {\r\n        previousWidth = fontCache[previousChar];\r\n      }\r\n      if (fontCache[_char] !== undefined) {\r\n        kernedWidth = width = fontCache[_char];\r\n      }\r\n      if (stylesAreEqual && fontCache[couple] !== undefined) {\r\n        coupleWidth = fontCache[couple];\r\n        kernedWidth = coupleWidth - previousWidth;\r\n      }\r\n      if (width === undefined || previousWidth === undefined || coupleWidth === undefined) {\r\n        var ctx = this.getMeasuringContext();\r\n        // send a TRUE to specify measuring font size CACHE_FONT_SIZE\r\n        this._setTextStyles(ctx, charStyle, true);\r\n      }\r\n      if (width === undefined) {\r\n        kernedWidth = width = ctx.measureText(_char).width;\r\n        fontCache[_char] = width;\r\n      }\r\n      if (previousWidth === undefined && stylesAreEqual && previousChar) {\r\n        previousWidth = ctx.measureText(previousChar).width;\r\n        fontCache[previousChar] = previousWidth;\r\n      }\r\n      if (stylesAreEqual && coupleWidth === undefined) {\r\n        // we can measure the kerning couple and subtract the width of the previous character\r\n        coupleWidth = ctx.measureText(couple).width;\r\n        fontCache[couple] = coupleWidth;\r\n        kernedWidth = coupleWidth - previousWidth;\r\n      }\r\n      return { width: width * fontMultiplier, kernedWidth: kernedWidth * fontMultiplier };\r\n    },\r\n\r\n    /**\r\n     * Computes height of character at given position\r\n     * @param {Number} line the line index number\r\n     * @param {Number} _char the character index number\r\n     * @return {Number} fontSize of the character\r\n     */\r\n    getHeightOfChar: function(line, _char) {\r\n      return this.getValueOfPropertyAt(line, _char, 'fontSize');\r\n    },\r\n\r\n    /**\r\n     * measure a text line measuring all characters.\r\n     * @param {Number} lineIndex line number\r\n     * @return {Number} Line width\r\n     */\r\n    measureLine: function(lineIndex) {\r\n      var lineInfo = this._measureLine(lineIndex);\r\n      if (this.charSpacing !== 0) {\r\n        lineInfo.width -= this._getWidthOfCharSpacing();\r\n      }\r\n      if (lineInfo.width < 0) {\r\n        lineInfo.width = 0;\r\n      }\r\n      return lineInfo;\r\n    },\r\n\r\n    /**\r\n     * measure every grapheme of a line, populating __charBounds\r\n     * @param {Number} lineIndex\r\n     * @return {Object} object.width total width of characters\r\n     * @return {Object} object.widthOfSpaces length of chars that match this._reSpacesAndTabs\r\n     */\r\n    _measureLine: function(lineIndex) {\r\n      var width = 0, i, grapheme, line = this._textLines[lineIndex], prevGrapheme,\r\n          graphemeInfo, numOfSpaces = 0, lineBounds = new Array(line.length),\r\n          positionInPath = 0, startingPoint, totalPathLength, path = this.path,\r\n          reverse = this.pathSide === 'right';\r\n\r\n      this.__charBounds[lineIndex] = lineBounds;\r\n      for (i = 0; i < line.length; i++) {\r\n        grapheme = line[i];\r\n        graphemeInfo = this._getGraphemeBox(grapheme, lineIndex, i, prevGrapheme);\r\n        lineBounds[i] = graphemeInfo;\r\n        width += graphemeInfo.kernedWidth;\r\n        prevGrapheme = grapheme;\r\n      }\r\n      // this latest bound box represent the last character of the line\r\n      // to simplify cursor handling in interactive mode.\r\n      lineBounds[i] = {\r\n        left: graphemeInfo ? graphemeInfo.left + graphemeInfo.width : 0,\r\n        width: 0,\r\n        kernedWidth: 0,\r\n        height: this.fontSize\r\n      };\r\n      if (path) {\r\n        totalPathLength = path.segmentsInfo[path.segmentsInfo.length - 1].length;\r\n        startingPoint = fabric.util.getPointOnPath(path.path, 0, path.segmentsInfo);\r\n        startingPoint.x += path.pathOffset.x;\r\n        startingPoint.y += path.pathOffset.y;\r\n        switch (this.textAlign) {\r\n          case 'left':\r\n            positionInPath = reverse ? (totalPathLength - width) : 0;\r\n            break;\r\n          case 'center':\r\n            positionInPath = (totalPathLength - width) / 2;\r\n            break;\r\n          case 'right':\r\n            positionInPath = reverse ? 0 : (totalPathLength - width);\r\n            break;\r\n          //todo - add support for justify\r\n        }\r\n        positionInPath += this.pathStartOffset * (reverse ? -1 : 1);\r\n        for (i = reverse ? line.length - 1 : 0;\r\n          reverse ? i >= 0 : i < line.length;\r\n          reverse ? i-- : i++) {\r\n          graphemeInfo = lineBounds[i];\r\n          if (positionInPath > totalPathLength) {\r\n            positionInPath %= totalPathLength;\r\n          }\r\n          else if (positionInPath < 0) {\r\n            positionInPath += totalPathLength;\r\n          }\r\n          // it would probably much faster to send all the grapheme position for a line\r\n          // and calculate path position/angle at once.\r\n          this._setGraphemeOnPath(positionInPath, graphemeInfo, startingPoint);\r\n          positionInPath += graphemeInfo.kernedWidth;\r\n        }\r\n      }\r\n      return { width: width, numOfSpaces: numOfSpaces };\r\n    },\r\n\r\n    /**\r\n     * Calculate the angle  and the left,top position of the char that follow a path.\r\n     * It appends it to graphemeInfo to be reused later at rendering\r\n     * @private\r\n     * @param {Number} positionInPath to be measured\r\n     * @param {Object} graphemeInfo current grapheme box information\r\n     * @param {Object} startingPoint position of the point\r\n     */\r\n    _setGraphemeOnPath: function(positionInPath, graphemeInfo, startingPoint) {\r\n      var centerPosition = positionInPath + graphemeInfo.kernedWidth / 2,\r\n          path = this.path;\r\n\r\n      // we are at currentPositionOnPath. we want to know what point on the path is.\r\n      var info = fabric.util.getPointOnPath(path.path, centerPosition, path.segmentsInfo);\r\n      graphemeInfo.renderLeft = info.x - startingPoint.x;\r\n      graphemeInfo.renderTop = info.y - startingPoint.y;\r\n      graphemeInfo.angle = info.angle + (this.pathSide ===  'right' ? Math.PI : 0);\r\n    },\r\n\r\n    /**\r\n     * Measure and return the info of a single grapheme.\r\n     * needs the the info of previous graphemes already filled\r\n     * @private\r\n     * @param {String} grapheme to be measured\r\n     * @param {Number} lineIndex index of the line where the char is\r\n     * @param {Number} charIndex position in the line\r\n     * @param {String} [prevGrapheme] character preceding the one to be measured\r\n     */\r\n    _getGraphemeBox: function(grapheme, lineIndex, charIndex, prevGrapheme, skipLeft) {\r\n      var style = this.getCompleteStyleDeclaration(lineIndex, charIndex),\r\n          prevStyle = prevGrapheme ? this.getCompleteStyleDeclaration(lineIndex, charIndex - 1) : { },\r\n          info = this._measureChar(grapheme, style, prevGrapheme, prevStyle),\r\n          kernedWidth = info.kernedWidth,\r\n          width = info.width, charSpacing;\r\n\r\n      if (this.charSpacing !== 0) {\r\n        charSpacing = this._getWidthOfCharSpacing();\r\n        width += charSpacing;\r\n        kernedWidth += charSpacing;\r\n      }\r\n\r\n      var box = {\r\n        width: width,\r\n        left: 0,\r\n        height: style.fontSize,\r\n        kernedWidth: kernedWidth,\r\n        deltaY: style.deltaY,\r\n      };\r\n      if (charIndex > 0 && !skipLeft) {\r\n        var previousBox = this.__charBounds[lineIndex][charIndex - 1];\r\n        box.left = previousBox.left + previousBox.width + info.kernedWidth - info.width;\r\n      }\r\n      return box;\r\n    },\r\n\r\n    /**\r\n     * Calculate height of line at 'lineIndex'\r\n     * @param {Number} lineIndex index of line to calculate\r\n     * @return {Number}\r\n     */\r\n    getHeightOfLine: function(lineIndex) {\r\n      if (this.__lineHeights[lineIndex]) {\r\n        return this.__lineHeights[lineIndex];\r\n      }\r\n\r\n      var line = this._textLines[lineIndex],\r\n          // char 0 is measured before the line cycle because it nneds to char\r\n          // emptylines\r\n          maxHeight = this.getHeightOfChar(lineIndex, 0);\r\n      for (var i = 1, len = line.length; i < len; i++) {\r\n        maxHeight = Math.max(this.getHeightOfChar(lineIndex, i), maxHeight);\r\n      }\r\n\r\n      return this.__lineHeights[lineIndex] = maxHeight * this.lineHeight * this._fontSizeMult;\r\n    },\r\n\r\n    /**\r\n     * Calculate text box height\r\n     */\r\n    calcTextHeight: function() {\r\n      var lineHeight, height = 0;\r\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\r\n        lineHeight = this.getHeightOfLine(i);\r\n        height += (i === len - 1 ? lineHeight / this.lineHeight : lineHeight);\r\n      }\r\n      return height;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @return {Number} Left offset\r\n     */\r\n    _getLeftOffset: function() {\r\n      return this.direction === 'ltr' ? -this.width / 2 : this.width / 2;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @return {Number} Top offset\r\n     */\r\n    _getTopOffset: function() {\r\n      return -this.height / 2;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\r\n     */\r\n    _renderTextCommon: function(ctx, method) {\r\n      ctx.save();\r\n      var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset();\r\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\r\n        var heightOfLine = this.getHeightOfLine(i),\r\n            maxHeight = heightOfLine / this.lineHeight,\r\n            leftOffset = this._getLineLeftOffset(i);\r\n        this._renderTextLine(\r\n          method,\r\n          ctx,\r\n          this._textLines[i],\r\n          left + leftOffset,\r\n          top + lineHeights + maxHeight,\r\n          i\r\n        );\r\n        lineHeights += heightOfLine;\r\n      }\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderTextFill: function(ctx) {\r\n      if (!this.fill && !this.styleHas('fill')) {\r\n        return;\r\n      }\r\n\r\n      this._renderTextCommon(ctx, 'fillText');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderTextStroke: function(ctx) {\r\n      if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\r\n        return;\r\n      }\r\n\r\n      if (this.shadow && !this.shadow.affectStroke) {\r\n        this._removeShadow(ctx);\r\n      }\r\n\r\n      ctx.save();\r\n      this._setLineDash(ctx, this.strokeDashArray);\r\n      ctx.beginPath();\r\n      this._renderTextCommon(ctx, 'strokeText');\r\n      ctx.closePath();\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} method fillText or strokeText.\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {Array} line Content of the line, splitted in an array by grapheme\r\n     * @param {Number} left\r\n     * @param {Number} top\r\n     * @param {Number} lineIndex\r\n     */\r\n    _renderChars: function(method, ctx, line, left, top, lineIndex) {\r\n      // set proper line offset\r\n      var lineHeight = this.getHeightOfLine(lineIndex),\r\n          isJustify = this.textAlign.indexOf('justify') !== -1,\r\n          actualStyle,\r\n          nextStyle,\r\n          charsToRender = '',\r\n          charBox,\r\n          boxWidth = 0,\r\n          timeToRender,\r\n          path = this.path,\r\n          shortCut = !isJustify && this.charSpacing === 0 && this.isEmptyStyles(lineIndex) && !path,\r\n          isLtr = this.direction === 'ltr', sign = this.direction === 'ltr' ? 1 : -1,\r\n          drawingLeft, currentDirection = ctx.canvas.getAttribute('dir');\r\n      ctx.save();\r\n      if (currentDirection !== this.direction) {\r\n        ctx.canvas.setAttribute('dir', isLtr ? 'ltr' : 'rtl');\r\n        ctx.direction = isLtr ? 'ltr' : 'rtl';\r\n        ctx.textAlign = isLtr ? 'left' : 'right';\r\n      }\r\n      top -= lineHeight * this._fontSizeFraction / this.lineHeight;\r\n      if (shortCut) {\r\n        // render all the line in one pass without checking\r\n        // drawingLeft = isLtr ? left : left - this.getLineWidth(lineIndex);\r\n        this._renderChar(method, ctx, lineIndex, 0, line.join(''), left, top, lineHeight);\r\n        ctx.restore();\r\n        return;\r\n      }\r\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\r\n        timeToRender = i === len || this.charSpacing || path;\r\n        charsToRender += line[i];\r\n        charBox = this.__charBounds[lineIndex][i];\r\n        if (boxWidth === 0) {\r\n          left += sign * (charBox.kernedWidth - charBox.width);\r\n          boxWidth += charBox.width;\r\n        }\r\n        else {\r\n          boxWidth += charBox.kernedWidth;\r\n        }\r\n        if (isJustify && !timeToRender) {\r\n          if (this._reSpaceAndTab.test(line[i])) {\r\n            timeToRender = true;\r\n          }\r\n        }\r\n        if (!timeToRender) {\r\n          // if we have charSpacing, we render char by char\r\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\r\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\r\n          timeToRender = this._hasStyleChanged(actualStyle, nextStyle);\r\n        }\r\n        if (timeToRender) {\r\n          if (path) {\r\n            ctx.save();\r\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\r\n            ctx.rotate(charBox.angle);\r\n            this._renderChar(method, ctx, lineIndex, i, charsToRender, -boxWidth / 2, 0, lineHeight);\r\n            ctx.restore();\r\n          }\r\n          else {\r\n            drawingLeft = left;\r\n            this._renderChar(method, ctx, lineIndex, i, charsToRender, drawingLeft, top, lineHeight);\r\n          }\r\n          charsToRender = '';\r\n          actualStyle = nextStyle;\r\n          left += sign * boxWidth;\r\n          boxWidth = 0;\r\n        }\r\n      }\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * This function try to patch the missing gradientTransform on canvas gradients.\r\n     * transforming a context to transform the gradient, is going to transform the stroke too.\r\n     * we want to transform the gradient but not the stroke operation, so we create\r\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\r\n     * this method has drawbacks: is slow, is in low resolution, needs a patch for when the size\r\n     * is limited.\r\n     * @private\r\n     * @param {fabric.Gradient} filler a fabric gradient instance\r\n     * @return {CanvasPattern} a pattern to use as fill/stroke style\r\n     */\r\n    _applyPatternGradientTransformText: function(filler) {\r\n      var pCanvas = fabric.util.createCanvasElement(), pCtx,\r\n          // TODO: verify compatibility with strokeUniform\r\n          width = this.width + this.strokeWidth, height = this.height + this.strokeWidth;\r\n      pCanvas.width = width;\r\n      pCanvas.height = height;\r\n      pCtx = pCanvas.getContext('2d');\r\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\r\n      pCtx.lineTo(0, height); pCtx.closePath();\r\n      pCtx.translate(width / 2, height / 2);\r\n      pCtx.fillStyle = filler.toLive(pCtx);\r\n      this._applyPatternGradientTransform(pCtx, filler);\r\n      pCtx.fill();\r\n      return pCtx.createPattern(pCanvas, 'no-repeat');\r\n    },\r\n\r\n    handleFiller: function(ctx, property, filler) {\r\n      var offsetX, offsetY;\r\n      if (filler.toLive) {\r\n        if (filler.gradientUnits === 'percentage' || filler.gradientTransform || filler.patternTransform) {\r\n          // need to transform gradient in a pattern.\r\n          // this is a slow process. If you are hitting this codepath, and the object\r\n          // is not using caching, you should consider switching it on.\r\n          // we need a canvas as big as the current object caching canvas.\r\n          offsetX = -this.width / 2;\r\n          offsetY = -this.height / 2;\r\n          ctx.translate(offsetX, offsetY);\r\n          ctx[property] = this._applyPatternGradientTransformText(filler);\r\n          return { offsetX: offsetX, offsetY: offsetY };\r\n        }\r\n        else {\r\n          // is a simple gradient or pattern\r\n          ctx[property] = filler.toLive(ctx, this);\r\n          return this._applyPatternGradientTransform(ctx, filler);\r\n        }\r\n      }\r\n      else {\r\n        // is a color\r\n        ctx[property] = filler;\r\n      }\r\n      return { offsetX: 0, offsetY: 0 };\r\n    },\r\n\r\n    _setStrokeStyles: function(ctx, decl) {\r\n      ctx.lineWidth = decl.strokeWidth;\r\n      ctx.lineCap = this.strokeLineCap;\r\n      ctx.lineDashOffset = this.strokeDashOffset;\r\n      ctx.lineJoin = this.strokeLineJoin;\r\n      ctx.miterLimit = this.strokeMiterLimit;\r\n      return this.handleFiller(ctx, 'strokeStyle', decl.stroke);\r\n    },\r\n\r\n    _setFillStyles: function(ctx, decl) {\r\n      return this.handleFiller(ctx, 'fillStyle', decl.fill);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} method\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     * @param {Number} lineIndex\r\n     * @param {Number} charIndex\r\n     * @param {String} _char\r\n     * @param {Number} left Left coordinate\r\n     * @param {Number} top Top coordinate\r\n     * @param {Number} lineHeight Height of the line\r\n     */\r\n    _renderChar: function(method, ctx, lineIndex, charIndex, _char, left, top) {\r\n      var decl = this._getStyleDeclaration(lineIndex, charIndex),\r\n          fullDecl = this.getCompleteStyleDeclaration(lineIndex, charIndex),\r\n          shouldFill = method === 'fillText' && fullDecl.fill,\r\n          shouldStroke = method === 'strokeText' && fullDecl.stroke && fullDecl.strokeWidth,\r\n          fillOffsets, strokeOffsets;\r\n\r\n      if (!shouldStroke && !shouldFill) {\r\n        return;\r\n      }\r\n      ctx.save();\r\n\r\n      shouldFill && (fillOffsets = this._setFillStyles(ctx, fullDecl));\r\n      shouldStroke && (strokeOffsets = this._setStrokeStyles(ctx, fullDecl));\r\n\r\n      ctx.font = this._getFontDeclaration(fullDecl);\r\n\r\n\r\n      if (decl && decl.textBackgroundColor) {\r\n        this._removeShadow(ctx);\r\n      }\r\n      if (decl && decl.deltaY) {\r\n        top += decl.deltaY;\r\n      }\r\n      shouldFill && ctx.fillText(_char, left - fillOffsets.offsetX, top - fillOffsets.offsetY);\r\n      shouldStroke && ctx.strokeText(_char, left - strokeOffsets.offsetX, top - strokeOffsets.offsetY);\r\n      ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * Turns the character into a 'superior figure' (i.e. 'superscript')\r\n     * @param {Number} start selection start\r\n     * @param {Number} end selection end\r\n     * @returns {fabric.Text} thisArg\r\n     * @chainable\r\n     */\r\n    setSuperscript: function(start, end) {\r\n      return this._setScript(start, end, this.superscript);\r\n    },\r\n\r\n    /**\r\n     * Turns the character into an 'inferior figure' (i.e. 'subscript')\r\n     * @param {Number} start selection start\r\n     * @param {Number} end selection end\r\n     * @returns {fabric.Text} thisArg\r\n     * @chainable\r\n     */\r\n    setSubscript: function(start, end) {\r\n      return this._setScript(start, end, this.subscript);\r\n    },\r\n\r\n    /**\r\n     * Applies 'schema' at given position\r\n     * @private\r\n     * @param {Number} start selection start\r\n     * @param {Number} end selection end\r\n     * @param {Number} schema\r\n     * @returns {fabric.Text} thisArg\r\n     * @chainable\r\n     */\r\n    _setScript: function(start, end, schema) {\r\n      var loc = this.get2DCursorLocation(start, true),\r\n          fontSize = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'fontSize'),\r\n          dy = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'deltaY'),\r\n          style = { fontSize: fontSize * schema.size, deltaY: dy + fontSize * schema.baseline };\r\n      this.setSelectionStyles(style, start, end);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} prevStyle\r\n     * @param {Object} thisStyle\r\n     */\r\n    _hasStyleChanged: function(prevStyle, thisStyle) {\r\n      return prevStyle.fill !== thisStyle.fill ||\r\n              prevStyle.stroke !== thisStyle.stroke ||\r\n              prevStyle.strokeWidth !== thisStyle.strokeWidth ||\r\n              prevStyle.fontSize !== thisStyle.fontSize ||\r\n              prevStyle.fontFamily !== thisStyle.fontFamily ||\r\n              prevStyle.fontWeight !== thisStyle.fontWeight ||\r\n              prevStyle.fontStyle !== thisStyle.fontStyle ||\r\n              prevStyle.deltaY !== thisStyle.deltaY;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Object} prevStyle\r\n     * @param {Object} thisStyle\r\n     */\r\n    _hasStyleChangedForSvg: function(prevStyle, thisStyle) {\r\n      return this._hasStyleChanged(prevStyle, thisStyle) ||\r\n        prevStyle.overline !== thisStyle.overline ||\r\n        prevStyle.underline !== thisStyle.underline ||\r\n        prevStyle.linethrough !== thisStyle.linethrough;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Number} lineIndex index text line\r\n     * @return {Number} Line left offset\r\n     */\r\n    _getLineLeftOffset: function(lineIndex) {\r\n      var lineWidth = this.getLineWidth(lineIndex),\r\n          lineDiff = this.width - lineWidth, textAlign = this.textAlign, direction = this.direction,\r\n          isEndOfWrapping, leftOffset = 0, isEndOfWrapping = this.isEndOfWrapping(lineIndex);\r\n      if (textAlign === 'justify'\r\n        || (textAlign === 'justify-center' && !isEndOfWrapping)\r\n        || (textAlign === 'justify-right' && !isEndOfWrapping)\r\n        || (textAlign === 'justify-left' && !isEndOfWrapping)\r\n      ) {\r\n        return 0;\r\n      }\r\n      if (textAlign === 'center') {\r\n        leftOffset = lineDiff / 2;\r\n      }\r\n      if (textAlign === 'right') {\r\n        leftOffset = lineDiff;\r\n      }\r\n      if (textAlign === 'justify-center') {\r\n        leftOffset = lineDiff / 2;\r\n      }\r\n      if (textAlign === 'justify-right') {\r\n        leftOffset = lineDiff;\r\n      }\r\n      if (direction === 'rtl') {\r\n        leftOffset -= lineDiff;\r\n      }\r\n      return leftOffset;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _clearCache: function() {\r\n      this.__lineWidths = [];\r\n      this.__lineHeights = [];\r\n      this.__charBounds = [];\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _shouldClearDimensionCache: function() {\r\n      var shouldClear = this._forceClearCache;\r\n      shouldClear || (shouldClear = this.hasStateChanged('_dimensionAffectingProps'));\r\n      if (shouldClear) {\r\n        this.dirty = true;\r\n        this._forceClearCache = false;\r\n      }\r\n      return shouldClear;\r\n    },\r\n\r\n    /**\r\n     * Measure a single line given its index. Used to calculate the initial\r\n     * text bounding box. The values are calculated and stored in __lineWidths cache.\r\n     * @private\r\n     * @param {Number} lineIndex line number\r\n     * @return {Number} Line width\r\n     */\r\n    getLineWidth: function(lineIndex) {\r\n      if (this.__lineWidths[lineIndex] !== undefined) {\r\n        return this.__lineWidths[lineIndex];\r\n      }\r\n\r\n      var lineInfo = this.measureLine(lineIndex);\r\n      var width = lineInfo.width;\r\n      this.__lineWidths[lineIndex] = width;\r\n      return width;\r\n    },\r\n\r\n    _getWidthOfCharSpacing: function() {\r\n      if (this.charSpacing !== 0) {\r\n        return this.fontSize * this.charSpacing / 1000;\r\n      }\r\n      return 0;\r\n    },\r\n\r\n    /**\r\n     * Retrieves the value of property at given character position\r\n     * @param {Number} lineIndex the line number\r\n     * @param {Number} charIndex the character number\r\n     * @param {String} property the property name\r\n     * @returns the value of 'property'\r\n     */\r\n    getValueOfPropertyAt: function(lineIndex, charIndex, property) {\r\n      var charStyle = this._getStyleDeclaration(lineIndex, charIndex);\r\n      if (charStyle && typeof charStyle[property] !== 'undefined') {\r\n        return charStyle[property];\r\n      }\r\n      return this[property];\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _renderTextDecoration: function(ctx, type) {\r\n      if (!this[type] && !this.styleHas(type)) {\r\n        return;\r\n      }\r\n      var heightOfLine, size, _size,\r\n          lineLeftOffset, dy, _dy,\r\n          line, lastDecoration,\r\n          leftOffset = this._getLeftOffset(),\r\n          topOffset = this._getTopOffset(), top,\r\n          boxStart, boxWidth, charBox, currentDecoration,\r\n          maxHeight, currentFill, lastFill, path = this.path,\r\n          charSpacing = this._getWidthOfCharSpacing(),\r\n          offsetY = this.offsets[type];\r\n\r\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\r\n        heightOfLine = this.getHeightOfLine(i);\r\n        if (!this[type] && !this.styleHas(type, i)) {\r\n          topOffset += heightOfLine;\r\n          continue;\r\n        }\r\n        line = this._textLines[i];\r\n        maxHeight = heightOfLine / this.lineHeight;\r\n        lineLeftOffset = this._getLineLeftOffset(i);\r\n        boxStart = 0;\r\n        boxWidth = 0;\r\n        lastDecoration = this.getValueOfPropertyAt(i, 0, type);\r\n        lastFill = this.getValueOfPropertyAt(i, 0, 'fill');\r\n        top = topOffset + maxHeight * (1 - this._fontSizeFraction);\r\n        size = this.getHeightOfChar(i, 0);\r\n        dy = this.getValueOfPropertyAt(i, 0, 'deltaY');\r\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\r\n          charBox = this.__charBounds[i][j];\r\n          currentDecoration = this.getValueOfPropertyAt(i, j, type);\r\n          currentFill = this.getValueOfPropertyAt(i, j, 'fill');\r\n          _size = this.getHeightOfChar(i, j);\r\n          _dy = this.getValueOfPropertyAt(i, j, 'deltaY');\r\n          if (path && currentDecoration && currentFill) {\r\n            ctx.save();\r\n            ctx.fillStyle = lastFill;\r\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\r\n            ctx.rotate(charBox.angle);\r\n            ctx.fillRect(\r\n              -charBox.kernedWidth / 2,\r\n              offsetY * _size + _dy,\r\n              charBox.kernedWidth,\r\n              this.fontSize / 15\r\n            );\r\n            ctx.restore();\r\n          }\r\n          else if (\r\n            (currentDecoration !== lastDecoration || currentFill !== lastFill || _size !== size || _dy !== dy)\r\n            && boxWidth > 0\r\n          ) {\r\n            var drawStart = leftOffset + lineLeftOffset + boxStart;\r\n            if (this.direction === 'rtl') {\r\n              drawStart = this.width - drawStart - boxWidth;\r\n            }\r\n            if (lastDecoration && lastFill) {\r\n              ctx.fillStyle = lastFill;\r\n              ctx.fillRect(\r\n                drawStart,\r\n                top + offsetY * size + dy,\r\n                boxWidth,\r\n                this.fontSize / 15\r\n              );\r\n            }\r\n            boxStart = charBox.left;\r\n            boxWidth = charBox.width;\r\n            lastDecoration = currentDecoration;\r\n            lastFill = currentFill;\r\n            size = _size;\r\n            dy = _dy;\r\n          }\r\n          else {\r\n            boxWidth += charBox.kernedWidth;\r\n          }\r\n        }\r\n        var drawStart = leftOffset + lineLeftOffset + boxStart;\r\n        if (this.direction === 'rtl') {\r\n          drawStart = this.width - drawStart - boxWidth;\r\n        }\r\n        ctx.fillStyle = currentFill;\r\n        currentDecoration && currentFill && ctx.fillRect(\r\n          drawStart,\r\n          top + offsetY * size + dy,\r\n          boxWidth - charSpacing,\r\n          this.fontSize / 15\r\n        );\r\n        topOffset += heightOfLine;\r\n      }\r\n      // if there is text background color no\r\n      // other shadows should be casted\r\n      this._removeShadow(ctx);\r\n    },\r\n\r\n    /**\r\n     * return font declaration string for canvas context\r\n     * @param {Object} [styleObject] object\r\n     * @returns {String} font declaration formatted for canvas context.\r\n     */\r\n    _getFontDeclaration: function(styleObject, forMeasuring) {\r\n      var style = styleObject || this, family = this.fontFamily,\r\n          fontIsGeneric = fabric.Text.genericFonts.indexOf(family.toLowerCase()) > -1;\r\n      var fontFamily = family === undefined ||\r\n      family.indexOf('\\'') > -1 || family.indexOf(',') > -1 ||\r\n      family.indexOf('\"') > -1 || fontIsGeneric\r\n        ? style.fontFamily : '\"' + style.fontFamily + '\"';\r\n      return [\r\n        // node-canvas needs \"weight style\", while browsers need \"style weight\"\r\n        // verify if this can be fixed in JSDOM\r\n        (fabric.isLikelyNode ? style.fontWeight : style.fontStyle),\r\n        (fabric.isLikelyNode ? style.fontStyle : style.fontWeight),\r\n        forMeasuring ? this.CACHE_FONT_SIZE + 'px' : style.fontSize + 'px',\r\n        fontFamily\r\n      ].join(' ');\r\n    },\r\n\r\n    /**\r\n     * Renders text instance on a specified context\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    render: function(ctx) {\r\n      // do not render if object is not visible\r\n      if (!this.visible) {\r\n        return;\r\n      }\r\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\r\n        return;\r\n      }\r\n      if (this._shouldClearDimensionCache()) {\r\n        this.initDimensions();\r\n      }\r\n      this.callSuper('render', ctx);\r\n    },\r\n\r\n    /**\r\n     * Returns the text as an array of lines.\r\n     * @param {String} text text to split\r\n     * @returns {Array} Lines in the text\r\n     */\r\n    _splitTextIntoLines: function(text) {\r\n      var lines = text.split(this._reNewline),\r\n          newLines = new Array(lines.length),\r\n          newLine = ['\\n'],\r\n          newText = [];\r\n      for (var i = 0; i < lines.length; i++) {\r\n        newLines[i] = fabric.util.string.graphemeSplit(lines[i]);\r\n        newText = newText.concat(newLines[i], newLine);\r\n      }\r\n      newText.pop();\r\n      return { _unwrappedLines: newLines, lines: lines, graphemeText: newText, graphemeLines: newLines };\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} Object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      var allProperties = additionalProps.concat(propertiesToInclude);\r\n      var obj = this.callSuper('toObject', allProperties);\r\n      // styles will be overridden with a properly cloned structure\r\n      obj.styles = clone(this.styles, true);\r\n      if (obj.path) {\r\n        obj.path = this.path.toObject();\r\n      }\r\n      return obj;\r\n    },\r\n\r\n    /**\r\n     * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\r\n     * @param {String|Object} key Property name or object (if object, iterate over the object properties)\r\n     * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\r\n     * @return {fabric.Object} thisArg\r\n     * @chainable\r\n     */\r\n    set: function(key, value) {\r\n      this.callSuper('set', key, value);\r\n      var needsDims = false;\r\n      var isAddingPath = false;\r\n      if (typeof key === 'object') {\r\n        for (var _key in key) {\r\n          if (_key === 'path') {\r\n            this.setPathInfo();\r\n          }\r\n          needsDims = needsDims || this._dimensionAffectingProps.indexOf(_key) !== -1;\r\n          isAddingPath = isAddingPath || _key === 'path';\r\n        }\r\n      }\r\n      else {\r\n        needsDims = this._dimensionAffectingProps.indexOf(key) !== -1;\r\n        isAddingPath = key === 'path';\r\n      }\r\n      if (isAddingPath) {\r\n        this.setPathInfo();\r\n      }\r\n      if (needsDims) {\r\n        this.initDimensions();\r\n        this.setCoords();\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns complexity of an instance\r\n     * @return {Number} complexity\r\n     */\r\n    complexity: function() {\r\n      return 1;\r\n    }\r\n  });\r\n\r\n  /* _FROM_SVG_START_ */\r\n  /**\r\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\r\n   * @static\r\n   * @memberOf fabric.Text\r\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\r\n   */\r\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\r\n    'x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor'.split(' '));\r\n\r\n  /**\r\n   * Default SVG font size\r\n   * @static\r\n   * @memberOf fabric.Text\r\n   */\r\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\r\n\r\n  /**\r\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\r\n   * @static\r\n   * @memberOf fabric.Text\r\n   * @param {SVGElement} element Element to parse\r\n   * @param {Function} callback callback function invoked after parsing\r\n   * @param {Object} [options] Options object\r\n   */\r\n  fabric.Text.fromElement = function(element, callback, options) {\r\n    if (!element) {\r\n      return callback(null);\r\n    }\r\n\r\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES),\r\n        parsedAnchor = parsedAttributes.textAnchor || 'left';\r\n    options = fabric.util.object.extend((options ? clone(options) : { }), parsedAttributes);\r\n\r\n    options.top = options.top || 0;\r\n    options.left = options.left || 0;\r\n    if (parsedAttributes.textDecoration) {\r\n      var textDecoration = parsedAttributes.textDecoration;\r\n      if (textDecoration.indexOf('underline') !== -1) {\r\n        options.underline = true;\r\n      }\r\n      if (textDecoration.indexOf('overline') !== -1) {\r\n        options.overline = true;\r\n      }\r\n      if (textDecoration.indexOf('line-through') !== -1) {\r\n        options.linethrough = true;\r\n      }\r\n      delete options.textDecoration;\r\n    }\r\n    if ('dx' in parsedAttributes) {\r\n      options.left += parsedAttributes.dx;\r\n    }\r\n    if ('dy' in parsedAttributes) {\r\n      options.top += parsedAttributes.dy;\r\n    }\r\n    if (!('fontSize' in options)) {\r\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\r\n    }\r\n\r\n    var textContent = '';\r\n\r\n    // The XML is not properly parsed in IE9 so a workaround to get\r\n    // textContent is through firstChild.data. Another workaround would be\r\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\r\n    if (!('textContent' in element)) {\r\n      if ('firstChild' in element && element.firstChild !== null) {\r\n        if ('data' in element.firstChild && element.firstChild.data !== null) {\r\n          textContent = element.firstChild.data;\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      textContent = element.textContent;\r\n    }\r\n\r\n    textContent = textContent.replace(/^\\s+|\\s+$|\\n+/g, '').replace(/\\s+/g, ' ');\r\n    var originalStrokeWidth = options.strokeWidth;\r\n    options.strokeWidth = 0;\r\n\r\n    var text = new fabric.Text(textContent, options),\r\n        textHeightScaleFactor = text.getScaledHeight() / text.height,\r\n        lineHeightDiff = (text.height + text.strokeWidth) * text.lineHeight - text.height,\r\n        scaledDiff = lineHeightDiff * textHeightScaleFactor,\r\n        textHeight = text.getScaledHeight() + scaledDiff,\r\n        offX = 0;\r\n    /*\r\n      Adjust positioning:\r\n        x/y attributes in SVG correspond to the bottom-left corner of text bounding box\r\n        fabric output by default at top, left.\r\n    */\r\n    if (parsedAnchor === 'center') {\r\n      offX = text.getScaledWidth() / 2;\r\n    }\r\n    if (parsedAnchor === 'right') {\r\n      offX = text.getScaledWidth();\r\n    }\r\n    text.set({\r\n      left: text.left - offX,\r\n      top: text.top - (textHeight - text.fontSize * (0.07 + text._fontSizeFraction)) / text.lineHeight,\r\n      strokeWidth: typeof originalStrokeWidth !== 'undefined' ? originalStrokeWidth : 1,\r\n    });\r\n    callback(text);\r\n  };\r\n  /* _FROM_SVG_END_ */\r\n\r\n  /**\r\n   * Returns fabric.Text instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Text\r\n   * @param {Object} object plain js Object to create an instance from\r\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\r\n   */\r\n  fabric.Text.fromObject = function(object, callback) {\r\n    var objectCopy = clone(object), path = object.path;\r\n    delete objectCopy.path;\r\n    return fabric.Object._fromObject('Text', objectCopy, function(textInstance) {\r\n      if (path) {\r\n        fabric.Object._fromObject('Path', path, function(pathInstance) {\r\n          textInstance.set('path', pathInstance);\r\n          callback(textInstance);\r\n        }, 'path');\r\n      }\r\n      else {\r\n        callback(textInstance);\r\n      }\r\n    }, 'text');\r\n  };\r\n\r\n  fabric.Text.genericFonts = ['sans-serif', 'serif', 'cursive', 'fantasy', 'monospace'];\r\n\r\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Text);\r\n\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function() {\r\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\r\n    /**\r\n     * Returns true if object has no styling or no styling in a line\r\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\r\n     * @return {Boolean}\r\n     */\r\n    isEmptyStyles: function(lineIndex) {\r\n      if (!this.styles) {\r\n        return true;\r\n      }\r\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\r\n        return true;\r\n      }\r\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\r\n      for (var p1 in obj) {\r\n        for (var p2 in obj[p1]) {\r\n          // eslint-disable-next-line no-unused-vars\r\n          for (var p3 in obj[p1][p2]) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * Returns true if object has a style property or has it ina specified line\r\n     * This function is used to detect if a text will use a particular property or not.\r\n     * @param {String} property to check for\r\n     * @param {Number} lineIndex to check the style on\r\n     * @return {Boolean}\r\n     */\r\n    styleHas: function(property, lineIndex) {\r\n      if (!this.styles || !property || property === '') {\r\n        return false;\r\n      }\r\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\r\n        return false;\r\n      }\r\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { 0: this.styles[lineIndex] };\r\n      // eslint-disable-next-line\r\n      for (var p1 in obj) {\r\n        // eslint-disable-next-line\r\n        for (var p2 in obj[p1]) {\r\n          if (typeof obj[p1][p2][property] !== 'undefined') {\r\n            return true;\r\n          }\r\n        }\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Check if characters in a text have a value for a property\r\n     * whose value matches the textbox's value for that property.  If so,\r\n     * the character-level property is deleted.  If the character\r\n     * has no other properties, then it is also deleted.  Finally,\r\n     * if the line containing that character has no other characters\r\n     * then it also is deleted.\r\n     *\r\n     * @param {string} property The property to compare between characters and text.\r\n     */\r\n    cleanStyle: function(property) {\r\n      if (!this.styles || !property || property === '') {\r\n        return false;\r\n      }\r\n      var obj = this.styles, stylesCount = 0, letterCount, stylePropertyValue,\r\n          allStyleObjectPropertiesMatch = true, graphemeCount = 0, styleObject;\r\n      // eslint-disable-next-line\r\n      for (var p1 in obj) {\r\n        letterCount = 0;\r\n        // eslint-disable-next-line\r\n        for (var p2 in obj[p1]) {\r\n          var styleObject = obj[p1][p2],\r\n              stylePropertyHasBeenSet = styleObject.hasOwnProperty(property);\r\n\r\n          stylesCount++;\r\n\r\n          if (stylePropertyHasBeenSet) {\r\n            if (!stylePropertyValue) {\r\n              stylePropertyValue = styleObject[property];\r\n            }\r\n            else if (styleObject[property] !== stylePropertyValue) {\r\n              allStyleObjectPropertiesMatch = false;\r\n            }\r\n\r\n            if (styleObject[property] === this[property]) {\r\n              delete styleObject[property];\r\n            }\r\n          }\r\n          else {\r\n            allStyleObjectPropertiesMatch = false;\r\n          }\r\n\r\n          if (Object.keys(styleObject).length !== 0) {\r\n            letterCount++;\r\n          }\r\n          else {\r\n            delete obj[p1][p2];\r\n          }\r\n        }\r\n\r\n        if (letterCount === 0) {\r\n          delete obj[p1];\r\n        }\r\n      }\r\n      // if every grapheme has the same style set then\r\n      // delete those styles and set it on the parent\r\n      for (var i = 0; i < this._textLines.length; i++) {\r\n        graphemeCount += this._textLines[i].length;\r\n      }\r\n      if (allStyleObjectPropertiesMatch && stylesCount === graphemeCount) {\r\n        this[property] = stylePropertyValue;\r\n        this.removeStyle(property);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Remove a style property or properties from all individual character styles\r\n     * in a text object.  Deletes the character style object if it contains no other style\r\n     * props.  Deletes a line style object if it contains no other character styles.\r\n     *\r\n     * @param {String} props The property to remove from character styles.\r\n     */\r\n    removeStyle: function(property) {\r\n      if (!this.styles || !property || property === '') {\r\n        return;\r\n      }\r\n      var obj = this.styles, line, lineNum, charNum;\r\n      for (lineNum in obj) {\r\n        line = obj[lineNum];\r\n        for (charNum in line) {\r\n          delete line[charNum][property];\r\n          if (Object.keys(line[charNum]).length === 0) {\r\n            delete line[charNum];\r\n          }\r\n        }\r\n        if (Object.keys(line).length === 0) {\r\n          delete obj[lineNum];\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _extendStyles: function(index, styles) {\r\n      var loc = this.get2DCursorLocation(index);\r\n\r\n      if (!this._getLineStyle(loc.lineIndex)) {\r\n        this._setLineStyle(loc.lineIndex);\r\n      }\r\n\r\n      if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\r\n        this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\r\n      }\r\n\r\n      fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex, loc.charIndex), styles);\r\n    },\r\n\r\n    /**\r\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\r\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\r\n     * @param {Boolean} [skipWrapping] consider the location for unwrapped lines. useful to manage styles.\r\n     */\r\n    get2DCursorLocation: function(selectionStart, skipWrapping) {\r\n      if (typeof selectionStart === 'undefined') {\r\n        selectionStart = this.selectionStart;\r\n      }\r\n      var lines = skipWrapping ? this._unwrappedTextLines : this._textLines,\r\n          len = lines.length;\r\n      for (var i = 0; i < len; i++) {\r\n        if (selectionStart <= lines[i].length) {\r\n          return {\r\n            lineIndex: i,\r\n            charIndex: selectionStart\r\n          };\r\n        }\r\n        selectionStart -= lines[i].length + this.missingNewlineOffset(i);\r\n      }\r\n      return {\r\n        lineIndex: i - 1,\r\n        charIndex: lines[i - 1].length < selectionStart ? lines[i - 1].length : selectionStart\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Gets style of a current selection/cursor (at the start position)\r\n     * if startIndex or endIndex are not provided, selectionStart or selectionEnd will be used.\r\n     * @param {Number} [startIndex] Start index to get styles at\r\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\r\n     * @param {Boolean} [complete] get full style or not\r\n     * @return {Array} styles an array with one, zero or more Style objects\r\n     */\r\n    getSelectionStyles: function(startIndex, endIndex, complete) {\r\n      if (typeof startIndex === 'undefined') {\r\n        startIndex = this.selectionStart || 0;\r\n      }\r\n      if (typeof endIndex === 'undefined') {\r\n        endIndex = this.selectionEnd || startIndex;\r\n      }\r\n      var styles = [];\r\n      for (var i = startIndex; i < endIndex; i++) {\r\n        styles.push(this.getStyleAtPosition(i, complete));\r\n      }\r\n      return styles;\r\n    },\r\n\r\n    /**\r\n     * Gets style of a current selection/cursor position\r\n     * @param {Number} position  to get styles at\r\n     * @param {Boolean} [complete] full style if true\r\n     * @return {Object} style Style object at a specified index\r\n     * @private\r\n     */\r\n    getStyleAtPosition: function(position, complete) {\r\n      var loc = this.get2DCursorLocation(position),\r\n          style = complete ? this.getCompleteStyleDeclaration(loc.lineIndex, loc.charIndex) :\r\n            this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\r\n      return style || {};\r\n    },\r\n\r\n    /**\r\n     * Sets style of a current selection, if no selection exist, do not set anything.\r\n     * @param {Object} [styles] Styles object\r\n     * @param {Number} [startIndex] Start index to get styles at\r\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\r\n     * @return {fabric.IText} thisArg\r\n     * @chainable\r\n     */\r\n    setSelectionStyles: function(styles, startIndex, endIndex) {\r\n      if (typeof startIndex === 'undefined') {\r\n        startIndex = this.selectionStart || 0;\r\n      }\r\n      if (typeof endIndex === 'undefined') {\r\n        endIndex = this.selectionEnd || startIndex;\r\n      }\r\n      for (var i = startIndex; i < endIndex; i++) {\r\n        this._extendStyles(i, styles);\r\n      }\r\n      /* not included in _extendStyles to avoid clearing cache more than once */\r\n      this._forceClearCache = true;\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * get the reference, not a clone, of the style object for a given character\r\n     * @param {Number} lineIndex\r\n     * @param {Number} charIndex\r\n     * @return {Object} style object\r\n     */\r\n    _getStyleDeclaration: function(lineIndex, charIndex) {\r\n      var lineStyle = this.styles && this.styles[lineIndex];\r\n      if (!lineStyle) {\r\n        return null;\r\n      }\r\n      return lineStyle[charIndex];\r\n    },\r\n\r\n    /**\r\n     * return a new object that contains all the style property for a character\r\n     * the object returned is newly created\r\n     * @param {Number} lineIndex of the line where the character is\r\n     * @param {Number} charIndex position of the character on the line\r\n     * @return {Object} style object\r\n     */\r\n    getCompleteStyleDeclaration: function(lineIndex, charIndex) {\r\n      var style = this._getStyleDeclaration(lineIndex, charIndex) || { },\r\n          styleObject = { }, prop;\r\n      for (var i = 0; i < this._styleProperties.length; i++) {\r\n        prop = this._styleProperties[i];\r\n        styleObject[prop] = typeof style[prop] === 'undefined' ? this[prop] : style[prop];\r\n      }\r\n      return styleObject;\r\n    },\r\n\r\n    /**\r\n     * @param {Number} lineIndex\r\n     * @param {Number} charIndex\r\n     * @param {Object} style\r\n     * @private\r\n     */\r\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\r\n      this.styles[lineIndex][charIndex] = style;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param {Number} lineIndex\r\n     * @param {Number} charIndex\r\n     * @private\r\n     */\r\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\r\n      delete this.styles[lineIndex][charIndex];\r\n    },\r\n\r\n    /**\r\n     * @param {Number} lineIndex\r\n     * @return {Boolean} if the line exists or not\r\n     * @private\r\n     */\r\n    _getLineStyle: function(lineIndex) {\r\n      return !!this.styles[lineIndex];\r\n    },\r\n\r\n    /**\r\n     * Set the line style to an empty object so that is initialized\r\n     * @param {Number} lineIndex\r\n     * @private\r\n     */\r\n    _setLineStyle: function(lineIndex) {\r\n      this.styles[lineIndex] = {};\r\n    },\r\n\r\n    /**\r\n     * @param {Number} lineIndex\r\n     * @private\r\n     */\r\n    _deleteLineStyle: function(lineIndex) {\r\n      delete this.styles[lineIndex];\r\n    }\r\n  });\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  function parseDecoration(object) {\r\n    if (object.textDecoration) {\r\n      object.textDecoration.indexOf('underline') > -1 && (object.underline = true);\r\n      object.textDecoration.indexOf('line-through') > -1 && (object.linethrough = true);\r\n      object.textDecoration.indexOf('overline') > -1 && (object.overline = true);\r\n      delete object.textDecoration;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\r\n   * prefix when observing canvas.\r\n   * @class fabric.IText\r\n   * @extends fabric.Text\r\n   * @mixes fabric.Observable\r\n   *\r\n   * @fires changed\r\n   * @fires selection:changed\r\n   * @fires editing:entered\r\n   * @fires editing:exited\r\n   *\r\n   * @return {fabric.IText} thisArg\r\n   * @see {@link fabric.IText#initialize} for constructor definition\r\n   *\r\n   * <p>Supported key combinations:</p>\r\n   * <pre>\r\n   *   Move cursor:                    left, right, up, down\r\n   *   Select character:               shift + left, shift + right\r\n   *   Select text vertically:         shift + up, shift + down\r\n   *   Move cursor by word:            alt + left, alt + right\r\n   *   Select words:                   shift + alt + left, shift + alt + right\r\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\r\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\r\n   *   Jump to start/end of text:      cmd + up, cmd + down\r\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\r\n   *   Delete character:               backspace\r\n   *   Delete word:                    alt + backspace\r\n   *   Delete line:                    cmd + backspace\r\n   *   Forward delete:                 delete\r\n   *   Copy text:                      ctrl/cmd + c\r\n   *   Paste text:                     ctrl/cmd + v\r\n   *   Cut text:                       ctrl/cmd + x\r\n   *   Select entire text:             ctrl/cmd + a\r\n   *   Quit editing                    tab or esc\r\n   * </pre>\r\n   *\r\n   * <p>Supported mouse/touch combination</p>\r\n   * <pre>\r\n   *   Position cursor:                click/touch\r\n   *   Create selection:               click/touch & drag\r\n   *   Create selection:               click & shift + click\r\n   *   Select word:                    double click\r\n   *   Select line:                    triple click\r\n   * </pre>\r\n   */\r\n  fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'i-text',\r\n\r\n    /**\r\n     * Index where text selection starts (or where cursor is when there is no selection)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    selectionStart: 0,\r\n\r\n    /**\r\n     * Index where text selection ends\r\n     * @type Number\r\n     * @default\r\n     */\r\n    selectionEnd: 0,\r\n\r\n    /**\r\n     * Color of text selection\r\n     * @type String\r\n     * @default\r\n     */\r\n    selectionColor: 'rgba(17,119,255,0.3)',\r\n\r\n    /**\r\n     * Indicates whether text is in editing mode\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    isEditing: false,\r\n\r\n    /**\r\n     * Indicates whether a text can be edited\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    editable: true,\r\n\r\n    /**\r\n     * Border color of text object while it's in editing mode\r\n     * @type String\r\n     * @default\r\n     */\r\n    editingBorderColor: 'rgba(102,153,255,0.25)',\r\n\r\n    /**\r\n     * Width of cursor (in px)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    cursorWidth: 2,\r\n\r\n    /**\r\n     * Color of text cursor color in editing mode.\r\n     * if not set (default) will take color from the text.\r\n     * if set to a color value that fabric can understand, it will\r\n     * be used instead of the color of the text at the current position.\r\n     * @type String\r\n     * @default\r\n     */\r\n    cursorColor: '',\r\n\r\n    /**\r\n     * Delay between cursor blink (in ms)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    cursorDelay: 1000,\r\n\r\n    /**\r\n     * Duration of cursor fadein (in ms)\r\n     * @type Number\r\n     * @default\r\n     */\r\n    cursorDuration: 600,\r\n\r\n    /**\r\n     * Indicates whether internal text char widths can be cached\r\n     * @type Boolean\r\n     * @default\r\n     */\r\n    caching: true,\r\n\r\n    /**\r\n     * DOM container to append the hiddenTextarea.\r\n     * An alternative to attaching to the document.body.\r\n     * Useful to reduce laggish redraw of the full document.body tree and\r\n     * also with modals event capturing that won't let the textarea take focus.\r\n     * @type HTMLElement\r\n     * @default\r\n     */\r\n    hiddenTextareaContainer: null,\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _reSpace: /\\s|\\n/,\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _currentCursorOpacity: 0,\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _selectionDirection: null,\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _abortCursorAnimation: false,\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    __widthOfSpace: [],\r\n\r\n    /**\r\n     * Helps determining when the text is in composition, so that the cursor\r\n     * rendering is altered.\r\n     */\r\n    inCompositionMode: false,\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {String} text Text string\r\n     * @param {Object} [options] Options object\r\n     * @return {fabric.IText} thisArg\r\n     */\r\n    initialize: function(text, options) {\r\n      this.callSuper('initialize', text, options);\r\n      this.initBehavior();\r\n    },\r\n\r\n    /**\r\n     * Sets selection start (left boundary of a selection)\r\n     * @param {Number} index Index to set selection start to\r\n     */\r\n    setSelectionStart: function(index) {\r\n      index = Math.max(index, 0);\r\n      this._updateAndFire('selectionStart', index);\r\n    },\r\n\r\n    /**\r\n     * Sets selection end (right boundary of a selection)\r\n     * @param {Number} index Index to set selection end to\r\n     */\r\n    setSelectionEnd: function(index) {\r\n      index = Math.min(index, this.text.length);\r\n      this._updateAndFire('selectionEnd', index);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {String} property 'selectionStart' or 'selectionEnd'\r\n     * @param {Number} index new position of property\r\n     */\r\n    _updateAndFire: function(property, index) {\r\n      if (this[property] !== index) {\r\n        this._fireSelectionChanged();\r\n        this[property] = index;\r\n      }\r\n      this._updateTextarea();\r\n    },\r\n\r\n    /**\r\n     * Fires the even of selection changed\r\n     * @private\r\n     */\r\n    _fireSelectionChanged: function() {\r\n      this.fire('selection:changed');\r\n      this.canvas && this.canvas.fire('text:selection:changed', { target: this });\r\n    },\r\n\r\n    /**\r\n     * Initialize text dimensions. Render all text on given context\r\n     * or on a offscreen canvas to get the text width with measureText.\r\n     * Updates this.width and this.height with the proper values.\r\n     * Does not return dimensions.\r\n     * @private\r\n     */\r\n    initDimensions: function() {\r\n      this.isEditing && this.initDelayedCursor();\r\n      this.clearContextTop();\r\n      this.callSuper('initDimensions');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    render: function(ctx) {\r\n      this.clearContextTop();\r\n      this.callSuper('render', ctx);\r\n      // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\r\n      // the correct position but not at every cursor animation.\r\n      this.cursorOffsetCache = { };\r\n      this.renderCursorOrSelection();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {CanvasRenderingContext2D} ctx Context to render on\r\n     */\r\n    _render: function(ctx) {\r\n      this.callSuper('_render', ctx);\r\n    },\r\n\r\n    /**\r\n     * Prepare and clean the contextTop\r\n     */\r\n    clearContextTop: function(skipRestore) {\r\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\r\n        return;\r\n      }\r\n      var ctx = this.canvas.contextTop, v = this.canvas.viewportTransform;\r\n      ctx.save();\r\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\r\n      this.transform(ctx);\r\n      this._clearTextArea(ctx);\r\n      skipRestore || ctx.restore();\r\n    },\r\n    /**\r\n     * Renders cursor or selection (depending on what exists)\r\n     * it does on the contextTop. If contextTop is not available, do nothing.\r\n     */\r\n    renderCursorOrSelection: function() {\r\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\r\n        return;\r\n      }\r\n      var boundaries = this._getCursorBoundaries(),\r\n          ctx = this.canvas.contextTop;\r\n      this.clearContextTop(true);\r\n      if (this.selectionStart === this.selectionEnd) {\r\n        this.renderCursor(boundaries, ctx);\r\n      }\r\n      else {\r\n        this.renderSelection(boundaries, ctx);\r\n      }\r\n      ctx.restore();\r\n    },\r\n\r\n    _clearTextArea: function(ctx) {\r\n      // we add 4 pixel, to be sure to do not leave any pixel out\r\n      var width = this.width + 4, height = this.height + 4;\r\n      ctx.clearRect(-width / 2, -height / 2, width, height);\r\n    },\r\n\r\n    /**\r\n     * Returns cursor boundaries (left, top, leftOffset, topOffset)\r\n     * @private\r\n     * @param {Array} chars Array of characters\r\n     * @param {String} typeOfBoundaries\r\n     */\r\n    _getCursorBoundaries: function(position) {\r\n\r\n      // left/top are left/top of entire text box\r\n      // leftOffset/topOffset are offset from that left/top point of a text box\r\n\r\n      if (typeof position === 'undefined') {\r\n        position = this.selectionStart;\r\n      }\r\n\r\n      var left = this._getLeftOffset(),\r\n          top = this._getTopOffset(),\r\n          offsets = this._getCursorBoundariesOffsets(position);\r\n      return {\r\n        left: left,\r\n        top: top,\r\n        leftOffset: offsets.left,\r\n        topOffset: offsets.top\r\n      };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _getCursorBoundariesOffsets: function(position) {\r\n      if (this.cursorOffsetCache && 'top' in this.cursorOffsetCache) {\r\n        return this.cursorOffsetCache;\r\n      }\r\n      var lineLeftOffset,\r\n          lineIndex,\r\n          charIndex,\r\n          topOffset = 0,\r\n          leftOffset = 0,\r\n          boundaries,\r\n          cursorPosition = this.get2DCursorLocation(position);\r\n      charIndex = cursorPosition.charIndex;\r\n      lineIndex = cursorPosition.lineIndex;\r\n      for (var i = 0; i < lineIndex; i++) {\r\n        topOffset += this.getHeightOfLine(i);\r\n      }\r\n      lineLeftOffset = this._getLineLeftOffset(lineIndex);\r\n      var bound = this.__charBounds[lineIndex][charIndex];\r\n      bound && (leftOffset = bound.left);\r\n      if (this.charSpacing !== 0 && charIndex === this._textLines[lineIndex].length) {\r\n        leftOffset -= this._getWidthOfCharSpacing();\r\n      }\r\n      boundaries = {\r\n        top: topOffset,\r\n        left: lineLeftOffset + (leftOffset > 0 ? leftOffset : 0),\r\n      };\r\n      if (this.direction === 'rtl') {\r\n        boundaries.left *= -1;\r\n      }\r\n      this.cursorOffsetCache = boundaries;\r\n      return this.cursorOffsetCache;\r\n    },\r\n\r\n    /**\r\n     * Renders cursor\r\n     * @param {Object} boundaries\r\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\r\n     */\r\n    renderCursor: function(boundaries, ctx) {\r\n      var cursorLocation = this.get2DCursorLocation(),\r\n          lineIndex = cursorLocation.lineIndex,\r\n          charIndex = cursorLocation.charIndex > 0 ? cursorLocation.charIndex - 1 : 0,\r\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize'),\r\n          multiplier = this.scaleX * this.canvas.getZoom(),\r\n          cursorWidth = this.cursorWidth / multiplier,\r\n          topOffset = boundaries.topOffset,\r\n          dy = this.getValueOfPropertyAt(lineIndex, charIndex, 'deltaY');\r\n      topOffset += (1 - this._fontSizeFraction) * this.getHeightOfLine(lineIndex) / this.lineHeight\r\n        - charHeight * (1 - this._fontSizeFraction);\r\n\r\n      if (this.inCompositionMode) {\r\n        this.renderSelection(boundaries, ctx);\r\n      }\r\n      ctx.fillStyle = this.cursorColor || this.getValueOfPropertyAt(lineIndex, charIndex, 'fill');\r\n      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\r\n      ctx.fillRect(\r\n        boundaries.left + boundaries.leftOffset - cursorWidth / 2,\r\n        topOffset + boundaries.top + dy,\r\n        cursorWidth,\r\n        charHeight);\r\n    },\r\n\r\n    /**\r\n     * Renders text selection\r\n     * @param {Object} boundaries Object with left/top/leftOffset/topOffset\r\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\r\n     */\r\n    renderSelection: function(boundaries, ctx) {\r\n\r\n      var selectionStart = this.inCompositionMode ? this.hiddenTextarea.selectionStart : this.selectionStart,\r\n          selectionEnd = this.inCompositionMode ? this.hiddenTextarea.selectionEnd : this.selectionEnd,\r\n          isJustify = this.textAlign.indexOf('justify') !== -1,\r\n          start = this.get2DCursorLocation(selectionStart),\r\n          end = this.get2DCursorLocation(selectionEnd),\r\n          startLine = start.lineIndex,\r\n          endLine = end.lineIndex,\r\n          startChar = start.charIndex < 0 ? 0 : start.charIndex,\r\n          endChar = end.charIndex < 0 ? 0 : end.charIndex;\r\n\r\n      for (var i = startLine; i <= endLine; i++) {\r\n        var lineOffset = this._getLineLeftOffset(i) || 0,\r\n            lineHeight = this.getHeightOfLine(i),\r\n            realLineHeight = 0, boxStart = 0, boxEnd = 0;\r\n\r\n        if (i === startLine) {\r\n          boxStart = this.__charBounds[startLine][startChar].left;\r\n        }\r\n        if (i >= startLine && i < endLine) {\r\n          boxEnd = isJustify && !this.isEndOfWrapping(i) ? this.width : this.getLineWidth(i) || 5; // WTF is this 5?\r\n        }\r\n        else if (i === endLine) {\r\n          if (endChar === 0) {\r\n            boxEnd = this.__charBounds[endLine][endChar].left;\r\n          }\r\n          else {\r\n            var charSpacing = this._getWidthOfCharSpacing();\r\n            boxEnd = this.__charBounds[endLine][endChar - 1].left\r\n              + this.__charBounds[endLine][endChar - 1].width - charSpacing;\r\n          }\r\n        }\r\n        realLineHeight = lineHeight;\r\n        if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\r\n          lineHeight /= this.lineHeight;\r\n        }\r\n        var drawStart = boundaries.left + lineOffset + boxStart,\r\n            drawWidth = boxEnd - boxStart,\r\n            drawHeight = lineHeight, extraTop = 0;\r\n        if (this.inCompositionMode) {\r\n          ctx.fillStyle = this.compositionColor || 'black';\r\n          drawHeight = 1;\r\n          extraTop = lineHeight;\r\n        }\r\n        else {\r\n          ctx.fillStyle = this.selectionColor;\r\n        }\r\n        if (this.direction === 'rtl') {\r\n          drawStart = this.width - drawStart - drawWidth;\r\n        }\r\n        ctx.fillRect(\r\n          drawStart,\r\n          boundaries.top + boundaries.topOffset + extraTop,\r\n          drawWidth,\r\n          drawHeight);\r\n        boundaries.topOffset += realLineHeight;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * High level function to know the height of the cursor.\r\n     * the currentChar is the one that precedes the cursor\r\n     * Returns fontSize of char at the current cursor\r\n     * Unused from the library, is for the end user\r\n     * @return {Number} Character font size\r\n     */\r\n    getCurrentCharFontSize: function() {\r\n      var cp = this._getCurrentCharIndex();\r\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fontSize');\r\n    },\r\n\r\n    /**\r\n     * High level function to know the color of the cursor.\r\n     * the currentChar is the one that precedes the cursor\r\n     * Returns color (fill) of char at the current cursor\r\n     * if the text object has a pattern or gradient for filler, it will return that.\r\n     * Unused by the library, is for the end user\r\n     * @return {String | fabric.Gradient | fabric.Pattern} Character color (fill)\r\n     */\r\n    getCurrentCharColor: function() {\r\n      var cp = this._getCurrentCharIndex();\r\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fill');\r\n    },\r\n\r\n    /**\r\n     * Returns the cursor position for the getCurrent.. functions\r\n     * @private\r\n     */\r\n    _getCurrentCharIndex: function() {\r\n      var cursorPosition = this.get2DCursorLocation(this.selectionStart, true),\r\n          charIndex = cursorPosition.charIndex > 0 ? cursorPosition.charIndex - 1 : 0;\r\n      return { l: cursorPosition.lineIndex, c: charIndex };\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns fabric.IText instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.IText\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {function} [callback] invoked with new instance as argument\r\n   */\r\n  fabric.IText.fromObject = function(object, callback) {\r\n    parseDecoration(object);\r\n    if (object.styles) {\r\n      for (var i in object.styles) {\r\n        for (var j in object.styles[i]) {\r\n          parseDecoration(object.styles[i][j]);\r\n        }\r\n      }\r\n    }\r\n    fabric.Object._fromObject('IText', object, callback, 'text');\r\n  };\r\n})();\r\n\r\n\r\n(function() {\r\n\r\n  var clone = fabric.util.object.clone;\r\n\r\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\r\n\r\n    /**\r\n     * Initializes all the interactive behavior of IText\r\n     */\r\n    initBehavior: function() {\r\n      this.initAddedHandler();\r\n      this.initRemovedHandler();\r\n      this.initCursorSelectionHandlers();\r\n      this.initDoubleClickSimulation();\r\n      this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\r\n    },\r\n\r\n    onDeselect: function() {\r\n      this.isEditing && this.exitEditing();\r\n      this.selected = false;\r\n    },\r\n\r\n    /**\r\n     * Initializes \"added\" event handler\r\n     */\r\n    initAddedHandler: function() {\r\n      var _this = this;\r\n      this.on('added', function() {\r\n        var canvas = _this.canvas;\r\n        if (canvas) {\r\n          if (!canvas._hasITextHandlers) {\r\n            canvas._hasITextHandlers = true;\r\n            _this._initCanvasHandlers(canvas);\r\n          }\r\n          canvas._iTextInstances = canvas._iTextInstances || [];\r\n          canvas._iTextInstances.push(_this);\r\n        }\r\n      });\r\n    },\r\n\r\n    initRemovedHandler: function() {\r\n      var _this = this;\r\n      this.on('removed', function() {\r\n        var canvas = _this.canvas;\r\n        if (canvas) {\r\n          canvas._iTextInstances = canvas._iTextInstances || [];\r\n          fabric.util.removeFromArray(canvas._iTextInstances, _this);\r\n          if (canvas._iTextInstances.length === 0) {\r\n            canvas._hasITextHandlers = false;\r\n            _this._removeCanvasHandlers(canvas);\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    /**\r\n     * register canvas event to manage exiting on other instances\r\n     * @private\r\n     */\r\n    _initCanvasHandlers: function(canvas) {\r\n      canvas._mouseUpITextHandler = function() {\r\n        if (canvas._iTextInstances) {\r\n          canvas._iTextInstances.forEach(function(obj) {\r\n            obj.__isMousedown = false;\r\n          });\r\n        }\r\n      };\r\n      canvas.on('mouse:up', canvas._mouseUpITextHandler);\r\n    },\r\n\r\n    /**\r\n     * remove canvas event to manage exiting on other instances\r\n     * @private\r\n     */\r\n    _removeCanvasHandlers: function(canvas) {\r\n      canvas.off('mouse:up', canvas._mouseUpITextHandler);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _tick: function() {\r\n      this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, '_onTickComplete');\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _animateCursor: function(obj, targetOpacity, duration, completeMethod) {\r\n\r\n      var tickState;\r\n\r\n      tickState = {\r\n        isAborted: false,\r\n        abort: function() {\r\n          this.isAborted = true;\r\n        },\r\n      };\r\n\r\n      obj.animate('_currentCursorOpacity', targetOpacity, {\r\n        duration: duration,\r\n        onComplete: function() {\r\n          if (!tickState.isAborted) {\r\n            obj[completeMethod]();\r\n          }\r\n        },\r\n        onChange: function() {\r\n          // we do not want to animate a selection, only cursor\r\n          if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\r\n            obj.renderCursorOrSelection();\r\n          }\r\n        },\r\n        abort: function() {\r\n          return tickState.isAborted;\r\n        }\r\n      });\r\n      return tickState;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _onTickComplete: function() {\r\n\r\n      var _this = this;\r\n\r\n      if (this._cursorTimeout1) {\r\n        clearTimeout(this._cursorTimeout1);\r\n      }\r\n      this._cursorTimeout1 = setTimeout(function() {\r\n        _this._currentTickCompleteState = _this._animateCursor(_this, 0, this.cursorDuration / 2, '_tick');\r\n      }, 100);\r\n    },\r\n\r\n    /**\r\n     * Initializes delayed cursor\r\n     */\r\n    initDelayedCursor: function(restart) {\r\n      var _this = this,\r\n          delay = restart ? 0 : this.cursorDelay;\r\n\r\n      this.abortCursorAnimation();\r\n      this._currentCursorOpacity = 1;\r\n      this._cursorTimeout2 = setTimeout(function() {\r\n        _this._tick();\r\n      }, delay);\r\n    },\r\n\r\n    /**\r\n     * Aborts cursor animation and clears all timeouts\r\n     */\r\n    abortCursorAnimation: function() {\r\n      var shouldClear = this._currentTickState || this._currentTickCompleteState,\r\n          canvas = this.canvas;\r\n      this._currentTickState && this._currentTickState.abort();\r\n      this._currentTickCompleteState && this._currentTickCompleteState.abort();\r\n\r\n      clearTimeout(this._cursorTimeout1);\r\n      clearTimeout(this._cursorTimeout2);\r\n\r\n      this._currentCursorOpacity = 0;\r\n      // to clear just itext area we need to transform the context\r\n      // it may not be worth it\r\n      if (shouldClear && canvas) {\r\n        canvas.clearContext(canvas.contextTop || canvas.contextContainer);\r\n      }\r\n\r\n    },\r\n\r\n    /**\r\n     * Selects entire text\r\n     * @return {fabric.IText} thisArg\r\n     * @chainable\r\n     */\r\n    selectAll: function() {\r\n      this.selectionStart = 0;\r\n      this.selectionEnd = this._text.length;\r\n      this._fireSelectionChanged();\r\n      this._updateTextarea();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Returns selected text\r\n     * @return {String}\r\n     */\r\n    getSelectedText: function() {\r\n      return this._text.slice(this.selectionStart, this.selectionEnd).join('');\r\n    },\r\n\r\n    /**\r\n     * Find new selection index representing start of current word according to current selection index\r\n     * @param {Number} startFrom Current selection index\r\n     * @return {Number} New selection index\r\n     */\r\n    findWordBoundaryLeft: function(startFrom) {\r\n      var offset = 0, index = startFrom - 1;\r\n\r\n      // remove space before cursor first\r\n      if (this._reSpace.test(this._text[index])) {\r\n        while (this._reSpace.test(this._text[index])) {\r\n          offset++;\r\n          index--;\r\n        }\r\n      }\r\n      while (/\\S/.test(this._text[index]) && index > -1) {\r\n        offset++;\r\n        index--;\r\n      }\r\n\r\n      return startFrom - offset;\r\n    },\r\n\r\n    /**\r\n     * Find new selection index representing end of current word according to current selection index\r\n     * @param {Number} startFrom Current selection index\r\n     * @return {Number} New selection index\r\n     */\r\n    findWordBoundaryRight: function(startFrom) {\r\n      var offset = 0, index = startFrom;\r\n\r\n      // remove space after cursor first\r\n      if (this._reSpace.test(this._text[index])) {\r\n        while (this._reSpace.test(this._text[index])) {\r\n          offset++;\r\n          index++;\r\n        }\r\n      }\r\n      while (/\\S/.test(this._text[index]) && index < this._text.length) {\r\n        offset++;\r\n        index++;\r\n      }\r\n\r\n      return startFrom + offset;\r\n    },\r\n\r\n    /**\r\n     * Find new selection index representing start of current line according to current selection index\r\n     * @param {Number} startFrom Current selection index\r\n     * @return {Number} New selection index\r\n     */\r\n    findLineBoundaryLeft: function(startFrom) {\r\n      var offset = 0, index = startFrom - 1;\r\n\r\n      while (!/\\n/.test(this._text[index]) && index > -1) {\r\n        offset++;\r\n        index--;\r\n      }\r\n\r\n      return startFrom - offset;\r\n    },\r\n\r\n    /**\r\n     * Find new selection index representing end of current line according to current selection index\r\n     * @param {Number} startFrom Current selection index\r\n     * @return {Number} New selection index\r\n     */\r\n    findLineBoundaryRight: function(startFrom) {\r\n      var offset = 0, index = startFrom;\r\n\r\n      while (!/\\n/.test(this._text[index]) && index < this._text.length) {\r\n        offset++;\r\n        index++;\r\n      }\r\n\r\n      return startFrom + offset;\r\n    },\r\n\r\n    /**\r\n     * Finds index corresponding to beginning or end of a word\r\n     * @param {Number} selectionStart Index of a character\r\n     * @param {Number} direction 1 or -1\r\n     * @return {Number} Index of the beginning or end of a word\r\n     */\r\n    searchWordBoundary: function(selectionStart, direction) {\r\n      var text = this._text,\r\n          index     = this._reSpace.test(text[selectionStart]) ? selectionStart - 1 : selectionStart,\r\n          _char     = text[index],\r\n          // wrong\r\n          reNonWord = fabric.reNonWord;\r\n\r\n      while (!reNonWord.test(_char) && index > 0 && index < text.length) {\r\n        index += direction;\r\n        _char = text[index];\r\n      }\r\n      if (reNonWord.test(_char)) {\r\n        index += direction === 1 ? 0 : 1;\r\n      }\r\n      return index;\r\n    },\r\n\r\n    /**\r\n     * Selects a word based on the index\r\n     * @param {Number} selectionStart Index of a character\r\n     */\r\n    selectWord: function(selectionStart) {\r\n      selectionStart = selectionStart || this.selectionStart;\r\n      var newSelectionStart = this.searchWordBoundary(selectionStart, -1), /* search backwards */\r\n          newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */\r\n\r\n      this.selectionStart = newSelectionStart;\r\n      this.selectionEnd = newSelectionEnd;\r\n      this._fireSelectionChanged();\r\n      this._updateTextarea();\r\n      this.renderCursorOrSelection();\r\n    },\r\n\r\n    /**\r\n     * Selects a line based on the index\r\n     * @param {Number} selectionStart Index of a character\r\n     * @return {fabric.IText} thisArg\r\n     * @chainable\r\n     */\r\n    selectLine: function(selectionStart) {\r\n      selectionStart = selectionStart || this.selectionStart;\r\n      var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\r\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\r\n\r\n      this.selectionStart = newSelectionStart;\r\n      this.selectionEnd = newSelectionEnd;\r\n      this._fireSelectionChanged();\r\n      this._updateTextarea();\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Enters editing state\r\n     * @return {fabric.IText} thisArg\r\n     * @chainable\r\n     */\r\n    enterEditing: function(e) {\r\n      if (this.isEditing || !this.editable) {\r\n        return;\r\n      }\r\n\r\n      if (this.canvas) {\r\n        this.canvas.calcOffset();\r\n        this.exitEditingOnOthers(this.canvas);\r\n      }\r\n\r\n      this.isEditing = true;\r\n\r\n      this.initHiddenTextarea(e);\r\n      this.hiddenTextarea.focus();\r\n      this.hiddenTextarea.value = this.text;\r\n      this._updateTextarea();\r\n      this._saveEditingProps();\r\n      this._setEditingProps();\r\n      this._textBeforeEdit = this.text;\r\n\r\n      this._tick();\r\n      this.fire('editing:entered');\r\n      this._fireSelectionChanged();\r\n      if (!this.canvas) {\r\n        return this;\r\n      }\r\n      this.canvas.fire('text:editing:entered', { target: this });\r\n      this.initMouseMoveHandler();\r\n      this.canvas.requestRenderAll();\r\n      return this;\r\n    },\r\n\r\n    exitEditingOnOthers: function(canvas) {\r\n      if (canvas._iTextInstances) {\r\n        canvas._iTextInstances.forEach(function(obj) {\r\n          obj.selected = false;\r\n          if (obj.isEditing) {\r\n            obj.exitEditing();\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Initializes \"mousemove\" event handler\r\n     */\r\n    initMouseMoveHandler: function() {\r\n      this.canvas.on('mouse:move', this.mouseMoveHandler);\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    mouseMoveHandler: function(options) {\r\n      if (!this.__isMousedown || !this.isEditing) {\r\n        return;\r\n      }\r\n\r\n      var newSelectionStart = this.getSelectionStartFromPointer(options.e),\r\n          currentStart = this.selectionStart,\r\n          currentEnd = this.selectionEnd;\r\n      if (\r\n        (newSelectionStart !== this.__selectionStartOnMouseDown || currentStart === currentEnd)\r\n        &&\r\n        (currentStart === newSelectionStart || currentEnd === newSelectionStart)\r\n      ) {\r\n        return;\r\n      }\r\n      if (newSelectionStart > this.__selectionStartOnMouseDown) {\r\n        this.selectionStart = this.__selectionStartOnMouseDown;\r\n        this.selectionEnd = newSelectionStart;\r\n      }\r\n      else {\r\n        this.selectionStart = newSelectionStart;\r\n        this.selectionEnd = this.__selectionStartOnMouseDown;\r\n      }\r\n      if (this.selectionStart !== currentStart || this.selectionEnd !== currentEnd) {\r\n        this.restartCursorIfNeeded();\r\n        this._fireSelectionChanged();\r\n        this._updateTextarea();\r\n        this.renderCursorOrSelection();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _setEditingProps: function() {\r\n      this.hoverCursor = 'text';\r\n\r\n      if (this.canvas) {\r\n        this.canvas.defaultCursor = this.canvas.moveCursor = 'text';\r\n      }\r\n\r\n      this.borderColor = this.editingBorderColor;\r\n      this.hasControls = this.selectable = false;\r\n      this.lockMovementX = this.lockMovementY = true;\r\n    },\r\n\r\n    /**\r\n     * convert from textarea to grapheme indexes\r\n     */\r\n    fromStringToGraphemeSelection: function(start, end, text) {\r\n      var smallerTextStart = text.slice(0, start),\r\n          graphemeStart = fabric.util.string.graphemeSplit(smallerTextStart).length;\r\n      if (start === end) {\r\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\r\n      }\r\n      var smallerTextEnd = text.slice(start, end),\r\n          graphemeEnd = fabric.util.string.graphemeSplit(smallerTextEnd).length;\r\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\r\n    },\r\n\r\n    /**\r\n     * convert from fabric to textarea values\r\n     */\r\n    fromGraphemeToStringSelection: function(start, end, _text) {\r\n      var smallerTextStart = _text.slice(0, start),\r\n          graphemeStart = smallerTextStart.join('').length;\r\n      if (start === end) {\r\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\r\n      }\r\n      var smallerTextEnd = _text.slice(start, end),\r\n          graphemeEnd = smallerTextEnd.join('').length;\r\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _updateTextarea: function() {\r\n      this.cursorOffsetCache = { };\r\n      if (!this.hiddenTextarea) {\r\n        return;\r\n      }\r\n      if (!this.inCompositionMode) {\r\n        var newSelection = this.fromGraphemeToStringSelection(this.selectionStart, this.selectionEnd, this._text);\r\n        this.hiddenTextarea.selectionStart = newSelection.selectionStart;\r\n        this.hiddenTextarea.selectionEnd = newSelection.selectionEnd;\r\n      }\r\n      this.updateTextareaPosition();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    updateFromTextArea: function() {\r\n      if (!this.hiddenTextarea) {\r\n        return;\r\n      }\r\n      this.cursorOffsetCache = { };\r\n      this.text = this.hiddenTextarea.value;\r\n      if (this._shouldClearDimensionCache()) {\r\n        this.initDimensions();\r\n        this.setCoords();\r\n      }\r\n      var newSelection = this.fromStringToGraphemeSelection(\r\n        this.hiddenTextarea.selectionStart, this.hiddenTextarea.selectionEnd, this.hiddenTextarea.value);\r\n      this.selectionEnd = this.selectionStart = newSelection.selectionEnd;\r\n      if (!this.inCompositionMode) {\r\n        this.selectionStart = newSelection.selectionStart;\r\n      }\r\n      this.updateTextareaPosition();\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    updateTextareaPosition: function() {\r\n      if (this.selectionStart === this.selectionEnd) {\r\n        var style = this._calcTextareaPosition();\r\n        this.hiddenTextarea.style.left = style.left;\r\n        this.hiddenTextarea.style.top = style.top;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @return {Object} style contains style for hiddenTextarea\r\n     */\r\n    _calcTextareaPosition: function() {\r\n      if (!this.canvas) {\r\n        return { x: 1, y: 1 };\r\n      }\r\n      var desiredPosition = this.inCompositionMode ? this.compositionStart : this.selectionStart,\r\n          boundaries = this._getCursorBoundaries(desiredPosition),\r\n          cursorLocation = this.get2DCursorLocation(desiredPosition),\r\n          lineIndex = cursorLocation.lineIndex,\r\n          charIndex = cursorLocation.charIndex,\r\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize') * this.lineHeight,\r\n          leftOffset = boundaries.leftOffset,\r\n          m = this.calcTransformMatrix(),\r\n          p = {\r\n            x: boundaries.left + leftOffset,\r\n            y: boundaries.top + boundaries.topOffset + charHeight\r\n          },\r\n          retinaScaling = this.canvas.getRetinaScaling(),\r\n          upperCanvas = this.canvas.upperCanvasEl,\r\n          upperCanvasWidth = upperCanvas.width / retinaScaling,\r\n          upperCanvasHeight = upperCanvas.height / retinaScaling,\r\n          maxWidth = upperCanvasWidth - charHeight,\r\n          maxHeight = upperCanvasHeight - charHeight,\r\n          scaleX = upperCanvas.clientWidth / upperCanvasWidth,\r\n          scaleY = upperCanvas.clientHeight / upperCanvasHeight;\r\n\r\n      p = fabric.util.transformPoint(p, m);\r\n      p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\r\n      p.x *= scaleX;\r\n      p.y *= scaleY;\r\n      if (p.x < 0) {\r\n        p.x = 0;\r\n      }\r\n      if (p.x > maxWidth) {\r\n        p.x = maxWidth;\r\n      }\r\n      if (p.y < 0) {\r\n        p.y = 0;\r\n      }\r\n      if (p.y > maxHeight) {\r\n        p.y = maxHeight;\r\n      }\r\n\r\n      // add canvas offset on document\r\n      p.x += this.canvas._offset.left;\r\n      p.y += this.canvas._offset.top;\r\n\r\n      return { left: p.x + 'px', top: p.y + 'px', fontSize: charHeight + 'px', charHeight: charHeight };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _saveEditingProps: function() {\r\n      this._savedProps = {\r\n        hasControls: this.hasControls,\r\n        borderColor: this.borderColor,\r\n        lockMovementX: this.lockMovementX,\r\n        lockMovementY: this.lockMovementY,\r\n        hoverCursor: this.hoverCursor,\r\n        selectable: this.selectable,\r\n        defaultCursor: this.canvas && this.canvas.defaultCursor,\r\n        moveCursor: this.canvas && this.canvas.moveCursor\r\n      };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _restoreEditingProps: function() {\r\n      if (!this._savedProps) {\r\n        return;\r\n      }\r\n\r\n      this.hoverCursor = this._savedProps.hoverCursor;\r\n      this.hasControls = this._savedProps.hasControls;\r\n      this.borderColor = this._savedProps.borderColor;\r\n      this.selectable = this._savedProps.selectable;\r\n      this.lockMovementX = this._savedProps.lockMovementX;\r\n      this.lockMovementY = this._savedProps.lockMovementY;\r\n\r\n      if (this.canvas) {\r\n        this.canvas.defaultCursor = this._savedProps.defaultCursor;\r\n        this.canvas.moveCursor = this._savedProps.moveCursor;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Exits from editing state\r\n     * @return {fabric.IText} thisArg\r\n     * @chainable\r\n     */\r\n    exitEditing: function() {\r\n      var isTextChanged = (this._textBeforeEdit !== this.text);\r\n      var hiddenTextarea = this.hiddenTextarea;\r\n      this.selected = false;\r\n      this.isEditing = false;\r\n\r\n      this.selectionEnd = this.selectionStart;\r\n\r\n      if (hiddenTextarea) {\r\n        hiddenTextarea.blur && hiddenTextarea.blur();\r\n        hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\r\n      }\r\n      this.hiddenTextarea = null;\r\n      this.abortCursorAnimation();\r\n      this._restoreEditingProps();\r\n      this._currentCursorOpacity = 0;\r\n      if (this._shouldClearDimensionCache()) {\r\n        this.initDimensions();\r\n        this.setCoords();\r\n      }\r\n      this.fire('editing:exited');\r\n      isTextChanged && this.fire('modified');\r\n      if (this.canvas) {\r\n        this.canvas.off('mouse:move', this.mouseMoveHandler);\r\n        this.canvas.fire('text:editing:exited', { target: this });\r\n        isTextChanged && this.canvas.fire('object:modified', { target: this });\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _removeExtraneousStyles: function() {\r\n      for (var prop in this.styles) {\r\n        if (!this._textLines[prop]) {\r\n          delete this.styles[prop];\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * remove and reflow a style block from start to end.\r\n     * @param {Number} start linear start position for removal (included in removal)\r\n     * @param {Number} end linear end position for removal ( excluded from removal )\r\n     */\r\n    removeStyleFromTo: function(start, end) {\r\n      var cursorStart = this.get2DCursorLocation(start, true),\r\n          cursorEnd = this.get2DCursorLocation(end, true),\r\n          lineStart = cursorStart.lineIndex,\r\n          charStart = cursorStart.charIndex,\r\n          lineEnd = cursorEnd.lineIndex,\r\n          charEnd = cursorEnd.charIndex,\r\n          i, styleObj;\r\n      if (lineStart !== lineEnd) {\r\n        // step1 remove the trailing of lineStart\r\n        if (this.styles[lineStart]) {\r\n          for (i = charStart; i < this._unwrappedTextLines[lineStart].length; i++) {\r\n            delete this.styles[lineStart][i];\r\n          }\r\n        }\r\n        // step2 move the trailing of lineEnd to lineStart if needed\r\n        if (this.styles[lineEnd]) {\r\n          for (i = charEnd; i < this._unwrappedTextLines[lineEnd].length; i++) {\r\n            styleObj = this.styles[lineEnd][i];\r\n            if (styleObj) {\r\n              this.styles[lineStart] || (this.styles[lineStart] = { });\r\n              this.styles[lineStart][charStart + i - charEnd] = styleObj;\r\n            }\r\n          }\r\n        }\r\n        // step3 detects lines will be completely removed.\r\n        for (i = lineStart + 1; i <= lineEnd; i++) {\r\n          delete this.styles[i];\r\n        }\r\n        // step4 shift remaining lines.\r\n        this.shiftLineStyles(lineEnd, lineStart - lineEnd);\r\n      }\r\n      else {\r\n        // remove and shift left on the same line\r\n        if (this.styles[lineStart]) {\r\n          styleObj = this.styles[lineStart];\r\n          var diff = charEnd - charStart, numericChar, _char;\r\n          for (i = charStart; i < charEnd; i++) {\r\n            delete styleObj[i];\r\n          }\r\n          for (_char in this.styles[lineStart]) {\r\n            numericChar = parseInt(_char, 10);\r\n            if (numericChar >= charEnd) {\r\n              styleObj[numericChar - diff] = styleObj[_char];\r\n              delete styleObj[_char];\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Shifts line styles up or down\r\n     * @param {Number} lineIndex Index of a line\r\n     * @param {Number} offset Can any number?\r\n     */\r\n    shiftLineStyles: function(lineIndex, offset) {\r\n      // shift all line styles by offset upward or downward\r\n      // do not clone deep. we need new array, not new style objects\r\n      var clonedStyles = clone(this.styles);\r\n      for (var line in this.styles) {\r\n        var numericLine = parseInt(line, 10);\r\n        if (numericLine > lineIndex) {\r\n          this.styles[numericLine + offset] = clonedStyles[numericLine];\r\n          if (!clonedStyles[numericLine - offset]) {\r\n            delete this.styles[numericLine];\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    restartCursorIfNeeded: function() {\r\n      if (!this._currentTickState || this._currentTickState.isAborted\r\n        || !this._currentTickCompleteState || this._currentTickCompleteState.isAborted\r\n      ) {\r\n        this.initDelayedCursor();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Handle insertion of more consecutive style lines for when one or more\r\n     * newlines gets added to the text. Since current style needs to be shifted\r\n     * first we shift the current style of the number lines needed, then we add\r\n     * new lines from the last to the first.\r\n     * @param {Number} lineIndex Index of a line\r\n     * @param {Number} charIndex Index of a char\r\n     * @param {Number} qty number of lines to add\r\n     * @param {Array} copiedStyle Array of objects styles\r\n     */\r\n    insertNewlineStyleObject: function(lineIndex, charIndex, qty, copiedStyle) {\r\n      var currentCharStyle,\r\n          newLineStyles = {},\r\n          somethingAdded = false,\r\n          isEndOfLine = this._unwrappedTextLines[lineIndex].length === charIndex;\r\n\r\n      qty || (qty = 1);\r\n      this.shiftLineStyles(lineIndex, qty);\r\n      if (this.styles[lineIndex]) {\r\n        currentCharStyle = this.styles[lineIndex][charIndex === 0 ? charIndex : charIndex - 1];\r\n      }\r\n      // we clone styles of all chars\r\n      // after cursor onto the current line\r\n      for (var index in this.styles[lineIndex]) {\r\n        var numIndex = parseInt(index, 10);\r\n        if (numIndex >= charIndex) {\r\n          somethingAdded = true;\r\n          newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\r\n          // remove lines from the previous line since they're on a new line now\r\n          if (!(isEndOfLine && charIndex === 0)) {\r\n            delete this.styles[lineIndex][index];\r\n          }\r\n        }\r\n      }\r\n      var styleCarriedOver = false;\r\n      if (somethingAdded && !isEndOfLine) {\r\n        // if is end of line, the extra style we copied\r\n        // is probably not something we want\r\n        this.styles[lineIndex + qty] = newLineStyles;\r\n        styleCarriedOver = true;\r\n      }\r\n      if (styleCarriedOver) {\r\n        // skip the last line of since we already prepared it.\r\n        qty--;\r\n      }\r\n      // for the all the lines or all the other lines\r\n      // we clone current char style onto the next (otherwise empty) line\r\n      while (qty > 0) {\r\n        if (copiedStyle && copiedStyle[qty - 1]) {\r\n          this.styles[lineIndex + qty] = { 0: clone(copiedStyle[qty - 1]) };\r\n        }\r\n        else if (currentCharStyle) {\r\n          this.styles[lineIndex + qty] = { 0: clone(currentCharStyle) };\r\n        }\r\n        else {\r\n          delete this.styles[lineIndex + qty];\r\n        }\r\n        qty--;\r\n      }\r\n      this._forceClearCache = true;\r\n    },\r\n\r\n    /**\r\n     * Inserts style object for a given line/char index\r\n     * @param {Number} lineIndex Index of a line\r\n     * @param {Number} charIndex Index of a char\r\n     * @param {Number} quantity number Style object to insert, if given\r\n     * @param {Array} copiedStyle array of style objects\r\n     */\r\n    insertCharStyleObject: function(lineIndex, charIndex, quantity, copiedStyle) {\r\n      if (!this.styles) {\r\n        this.styles = {};\r\n      }\r\n      var currentLineStyles       = this.styles[lineIndex],\r\n          currentLineStylesCloned = currentLineStyles ? clone(currentLineStyles) : {};\r\n\r\n      quantity || (quantity = 1);\r\n      // shift all char styles by quantity forward\r\n      // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\r\n      for (var index in currentLineStylesCloned) {\r\n        var numericIndex = parseInt(index, 10);\r\n        if (numericIndex >= charIndex) {\r\n          currentLineStyles[numericIndex + quantity] = currentLineStylesCloned[numericIndex];\r\n          // only delete the style if there was nothing moved there\r\n          if (!currentLineStylesCloned[numericIndex - quantity]) {\r\n            delete currentLineStyles[numericIndex];\r\n          }\r\n        }\r\n      }\r\n      this._forceClearCache = true;\r\n      if (copiedStyle) {\r\n        while (quantity--) {\r\n          if (!Object.keys(copiedStyle[quantity]).length) {\r\n            continue;\r\n          }\r\n          if (!this.styles[lineIndex]) {\r\n            this.styles[lineIndex] = {};\r\n          }\r\n          this.styles[lineIndex][charIndex + quantity] = clone(copiedStyle[quantity]);\r\n        }\r\n        return;\r\n      }\r\n      if (!currentLineStyles) {\r\n        return;\r\n      }\r\n      var newStyle = currentLineStyles[charIndex ? charIndex - 1 : 1];\r\n      while (newStyle && quantity--) {\r\n        this.styles[lineIndex][charIndex + quantity] = clone(newStyle);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Inserts style object(s)\r\n     * @param {Array} insertedText Characters at the location where style is inserted\r\n     * @param {Number} start cursor index for inserting style\r\n     * @param {Array} [copiedStyle] array of style objects to insert.\r\n     */\r\n    insertNewStyleBlock: function(insertedText, start, copiedStyle) {\r\n      var cursorLoc = this.get2DCursorLocation(start, true),\r\n          addedLines = [0], linesLength = 0;\r\n      // get an array of how many char per lines are being added.\r\n      for (var i = 0; i < insertedText.length; i++) {\r\n        if (insertedText[i] === '\\n') {\r\n          linesLength++;\r\n          addedLines[linesLength] = 0;\r\n        }\r\n        else {\r\n          addedLines[linesLength]++;\r\n        }\r\n      }\r\n      // for the first line copy the style from the current char position.\r\n      if (addedLines[0] > 0) {\r\n        this.insertCharStyleObject(cursorLoc.lineIndex, cursorLoc.charIndex, addedLines[0], copiedStyle);\r\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[0] + 1);\r\n      }\r\n      linesLength && this.insertNewlineStyleObject(\r\n        cursorLoc.lineIndex, cursorLoc.charIndex + addedLines[0], linesLength);\r\n      for (var i = 1; i < linesLength; i++) {\r\n        if (addedLines[i] > 0) {\r\n          this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\r\n        }\r\n        else if (copiedStyle) {\r\n          // this test is required in order to close #6841\r\n          // when a pasted buffer begins with a newline then\r\n          // this.styles[cursorLoc.lineIndex + i] and copiedStyle[0]\r\n          // may be undefined for some reason\r\n          if (this.styles[cursorLoc.lineIndex + i] && copiedStyle[0]) {\r\n            this.styles[cursorLoc.lineIndex + i][0] = copiedStyle[0];\r\n          }\r\n        }\r\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[i] + 1);\r\n      }\r\n      // we use i outside the loop to get it like linesLength\r\n      if (addedLines[i] > 0) {\r\n        this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Set the selectionStart and selectionEnd according to the new position of cursor\r\n     * mimic the key - mouse navigation when shift is pressed.\r\n     */\r\n    setSelectionStartEndWithShift: function(start, end, newSelection) {\r\n      if (newSelection <= start) {\r\n        if (end === start) {\r\n          this._selectionDirection = 'left';\r\n        }\r\n        else if (this._selectionDirection === 'right') {\r\n          this._selectionDirection = 'left';\r\n          this.selectionEnd = start;\r\n        }\r\n        this.selectionStart = newSelection;\r\n      }\r\n      else if (newSelection > start && newSelection < end) {\r\n        if (this._selectionDirection === 'right') {\r\n          this.selectionEnd = newSelection;\r\n        }\r\n        else {\r\n          this.selectionStart = newSelection;\r\n        }\r\n      }\r\n      else {\r\n        // newSelection is > selection start and end\r\n        if (end === start) {\r\n          this._selectionDirection = 'right';\r\n        }\r\n        else if (this._selectionDirection === 'left') {\r\n          this._selectionDirection = 'right';\r\n          this.selectionStart = end;\r\n        }\r\n        this.selectionEnd = newSelection;\r\n      }\r\n    },\r\n\r\n    setSelectionInBoundaries: function() {\r\n      var length = this.text.length;\r\n      if (this.selectionStart > length) {\r\n        this.selectionStart = length;\r\n      }\r\n      else if (this.selectionStart < 0) {\r\n        this.selectionStart = 0;\r\n      }\r\n      if (this.selectionEnd > length) {\r\n        this.selectionEnd = length;\r\n      }\r\n      else if (this.selectionEnd < 0) {\r\n        this.selectionEnd = 0;\r\n      }\r\n    }\r\n  });\r\n})();\r\n\r\n\r\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\r\n  /**\r\n   * Initializes \"dbclick\" event handler\r\n   */\r\n  initDoubleClickSimulation: function() {\r\n\r\n    // for double click\r\n    this.__lastClickTime = +new Date();\r\n\r\n    // for triple click\r\n    this.__lastLastClickTime = +new Date();\r\n\r\n    this.__lastPointer = { };\r\n\r\n    this.on('mousedown', this.onMouseDown);\r\n  },\r\n\r\n  /**\r\n   * Default event handler to simulate triple click\r\n   * @private\r\n   */\r\n  onMouseDown: function(options) {\r\n    if (!this.canvas) {\r\n      return;\r\n    }\r\n    this.__newClickTime = +new Date();\r\n    var newPointer = options.pointer;\r\n    if (this.isTripleClick(newPointer)) {\r\n      this.fire('tripleclick', options);\r\n      this._stopEvent(options.e);\r\n    }\r\n    this.__lastLastClickTime = this.__lastClickTime;\r\n    this.__lastClickTime = this.__newClickTime;\r\n    this.__lastPointer = newPointer;\r\n    this.__lastIsEditing = this.isEditing;\r\n    this.__lastSelected = this.selected;\r\n  },\r\n\r\n  isTripleClick: function(newPointer) {\r\n    return this.__newClickTime - this.__lastClickTime < 500 &&\r\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\r\n        this.__lastPointer.x === newPointer.x &&\r\n        this.__lastPointer.y === newPointer.y;\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  _stopEvent: function(e) {\r\n    e.preventDefault && e.preventDefault();\r\n    e.stopPropagation && e.stopPropagation();\r\n  },\r\n\r\n  /**\r\n   * Initializes event handlers related to cursor or selection\r\n   */\r\n  initCursorSelectionHandlers: function() {\r\n    this.initMousedownHandler();\r\n    this.initMouseupHandler();\r\n    this.initClicks();\r\n  },\r\n\r\n  /**\r\n   * Default handler for double click, select a word\r\n   */\r\n  doubleClickHandler: function(options) {\r\n    if (!this.isEditing) {\r\n      return;\r\n    }\r\n    this.selectWord(this.getSelectionStartFromPointer(options.e));\r\n  },\r\n\r\n  /**\r\n   * Default handler for triple click, select a line\r\n   */\r\n  tripleClickHandler: function(options) {\r\n    if (!this.isEditing) {\r\n      return;\r\n    }\r\n    this.selectLine(this.getSelectionStartFromPointer(options.e));\r\n  },\r\n\r\n  /**\r\n   * Initializes double and triple click event handlers\r\n   */\r\n  initClicks: function() {\r\n    this.on('mousedblclick', this.doubleClickHandler);\r\n    this.on('tripleclick', this.tripleClickHandler);\r\n  },\r\n\r\n  /**\r\n   * Default event handler for the basic functionalities needed on _mouseDown\r\n   * can be overridden to do something different.\r\n   * Scope of this implementation is: find the click position, set selectionStart\r\n   * find selectionEnd, initialize the drawing of either cursor or selection area\r\n   * initializing a mousedDown on a text area will cancel fabricjs knowledge of\r\n   * current compositionMode. It will be set to false.\r\n   */\r\n  _mouseDownHandler: function(options) {\r\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\r\n      return;\r\n    }\r\n\r\n    this.__isMousedown = true;\r\n\r\n    if (this.selected) {\r\n      this.inCompositionMode = false;\r\n      this.setCursorByClick(options.e);\r\n    }\r\n\r\n    if (this.isEditing) {\r\n      this.__selectionStartOnMouseDown = this.selectionStart;\r\n      if (this.selectionStart === this.selectionEnd) {\r\n        this.abortCursorAnimation();\r\n      }\r\n      this.renderCursorOrSelection();\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Default event handler for the basic functionalities needed on mousedown:before\r\n   * can be overridden to do something different.\r\n   * Scope of this implementation is: verify the object is already selected when mousing down\r\n   */\r\n  _mouseDownHandlerBefore: function(options) {\r\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\r\n      return;\r\n    }\r\n    // we want to avoid that an object that was selected and then becomes unselectable,\r\n    // may trigger editing mode in some way.\r\n    this.selected = this === this.canvas._activeObject;\r\n  },\r\n\r\n  /**\r\n   * Initializes \"mousedown\" event handler\r\n   */\r\n  initMousedownHandler: function() {\r\n    this.on('mousedown', this._mouseDownHandler);\r\n    this.on('mousedown:before', this._mouseDownHandlerBefore);\r\n  },\r\n\r\n  /**\r\n   * Initializes \"mouseup\" event handler\r\n   */\r\n  initMouseupHandler: function() {\r\n    this.on('mouseup', this.mouseUpHandler);\r\n  },\r\n\r\n  /**\r\n   * standard handler for mouse up, overridable\r\n   * @private\r\n   */\r\n  mouseUpHandler: function(options) {\r\n    this.__isMousedown = false;\r\n    if (!this.editable || this.group ||\r\n      (options.transform && options.transform.actionPerformed) ||\r\n      (options.e.button && options.e.button !== 1)) {\r\n      return;\r\n    }\r\n\r\n    if (this.canvas) {\r\n      var currentActive = this.canvas._activeObject;\r\n      if (currentActive && currentActive !== this) {\r\n        // avoid running this logic when there is an active object\r\n        // this because is possible with shift click and fast clicks,\r\n        // to rapidly deselect and reselect this object and trigger an enterEdit\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (this.__lastSelected && !this.__corner) {\r\n      this.selected = false;\r\n      this.__lastSelected = false;\r\n      this.enterEditing(options.e);\r\n      if (this.selectionStart === this.selectionEnd) {\r\n        this.initDelayedCursor(true);\r\n      }\r\n      else {\r\n        this.renderCursorOrSelection();\r\n      }\r\n    }\r\n    else {\r\n      this.selected = true;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Changes cursor location in a text depending on passed pointer (x/y) object\r\n   * @param {Event} e Event object\r\n   */\r\n  setCursorByClick: function(e) {\r\n    var newSelection = this.getSelectionStartFromPointer(e),\r\n        start = this.selectionStart, end = this.selectionEnd;\r\n    if (e.shiftKey) {\r\n      this.setSelectionStartEndWithShift(start, end, newSelection);\r\n    }\r\n    else {\r\n      this.selectionStart = newSelection;\r\n      this.selectionEnd = newSelection;\r\n    }\r\n    if (this.isEditing) {\r\n      this._fireSelectionChanged();\r\n      this._updateTextarea();\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Returns index of a character corresponding to where an object was clicked\r\n   * @param {Event} e Event object\r\n   * @return {Number} Index of a character\r\n   */\r\n  getSelectionStartFromPointer: function(e) {\r\n    var mouseOffset = this.getLocalPointer(e),\r\n        prevWidth = 0,\r\n        width = 0,\r\n        height = 0,\r\n        charIndex = 0,\r\n        lineIndex = 0,\r\n        lineLeftOffset,\r\n        line;\r\n    for (var i = 0, len = this._textLines.length; i < len; i++) {\r\n      if (height <= mouseOffset.y) {\r\n        height += this.getHeightOfLine(i) * this.scaleY;\r\n        lineIndex = i;\r\n        if (i > 0) {\r\n          charIndex += this._textLines[i - 1].length + this.missingNewlineOffset(i - 1);\r\n        }\r\n      }\r\n      else {\r\n        break;\r\n      }\r\n    }\r\n    lineLeftOffset = this._getLineLeftOffset(lineIndex);\r\n    width = lineLeftOffset * this.scaleX;\r\n    line = this._textLines[lineIndex];\r\n    // handling of RTL: in order to get things work correctly,\r\n    // we assume RTL writing is mirrored compared to LTR writing.\r\n    // so in position detection we mirror the X offset, and when is time\r\n    // of rendering it, we mirror it again.\r\n    if (this.direction === 'rtl') {\r\n      mouseOffset.x = this.width * this.scaleX - mouseOffset.x + width;\r\n    }\r\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\r\n      prevWidth = width;\r\n      // i removed something about flipX here, check.\r\n      width += this.__charBounds[lineIndex][j].kernedWidth * this.scaleX;\r\n      if (width <= mouseOffset.x) {\r\n        charIndex++;\r\n      }\r\n      else {\r\n        break;\r\n      }\r\n    }\r\n    return this._getNewSelectionStartFromOffset(mouseOffset, prevWidth, width, charIndex, jlen);\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  _getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {\r\n    // we need Math.abs because when width is after the last char, the offset is given as 1, while is 0\r\n    var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\r\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\r\n        offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ||\r\n          distanceBtwNextCharAndCursor < 0 ? 0 : 1,\r\n        newSelectionStart = index + offset;\r\n    // if object is horizontally flipped, mirror cursor location from the end\r\n    if (this.flipX) {\r\n      newSelectionStart = jlen - newSelectionStart;\r\n    }\r\n\r\n    if (newSelectionStart > this._text.length) {\r\n      newSelectionStart = this._text.length;\r\n    }\r\n\r\n    return newSelectionStart;\r\n  }\r\n});\r\n\r\n\r\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\r\n\r\n  /**\r\n   * Initializes hidden textarea (needed to bring up keyboard in iOS)\r\n   */\r\n  initHiddenTextarea: function() {\r\n    this.hiddenTextarea = fabric.document.createElement('textarea');\r\n    this.hiddenTextarea.setAttribute('autocapitalize', 'off');\r\n    this.hiddenTextarea.setAttribute('autocorrect', 'off');\r\n    this.hiddenTextarea.setAttribute('autocomplete', 'off');\r\n    this.hiddenTextarea.setAttribute('spellcheck', 'false');\r\n    this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea', '');\r\n    this.hiddenTextarea.setAttribute('wrap', 'off');\r\n    var style = this._calcTextareaPosition();\r\n    // line-height: 1px; was removed from the style to fix this:\r\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=870966\r\n    this.hiddenTextarea.style.cssText = 'position: absolute; top: ' + style.top +\r\n    '; left: ' + style.left + '; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;' +\r\n    ' paddingtop: ' + style.fontSize + ';';\r\n\r\n    if (this.hiddenTextareaContainer) {\r\n      this.hiddenTextareaContainer.appendChild(this.hiddenTextarea);\r\n    }\r\n    else {\r\n      fabric.document.body.appendChild(this.hiddenTextarea);\r\n    }\r\n\r\n    fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));\r\n    fabric.util.addListener(this.hiddenTextarea, 'keyup', this.onKeyUp.bind(this));\r\n    fabric.util.addListener(this.hiddenTextarea, 'input', this.onInput.bind(this));\r\n    fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));\r\n    fabric.util.addListener(this.hiddenTextarea, 'cut', this.copy.bind(this));\r\n    fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));\r\n    fabric.util.addListener(this.hiddenTextarea, 'compositionstart', this.onCompositionStart.bind(this));\r\n    fabric.util.addListener(this.hiddenTextarea, 'compositionupdate', this.onCompositionUpdate.bind(this));\r\n    fabric.util.addListener(this.hiddenTextarea, 'compositionend', this.onCompositionEnd.bind(this));\r\n\r\n    if (!this._clickHandlerInitialized && this.canvas) {\r\n      fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));\r\n      this._clickHandlerInitialized = true;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * For functionalities on keyDown\r\n   * Map a special key to a function of the instance/prototype\r\n   * If you need different behaviour for ESC or TAB or arrows, you have to change\r\n   * this map setting the name of a function that you build on the fabric.Itext or\r\n   * your prototype.\r\n   * the map change will affect all Instances unless you need for only some text Instances\r\n   * in that case you have to clone this object and assign your Instance.\r\n   * this.keysMap = fabric.util.object.clone(this.keysMap);\r\n   * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\r\n   */\r\n  keysMap: {\r\n    9:  'exitEditing',\r\n    27: 'exitEditing',\r\n    33: 'moveCursorUp',\r\n    34: 'moveCursorDown',\r\n    35: 'moveCursorRight',\r\n    36: 'moveCursorLeft',\r\n    37: 'moveCursorLeft',\r\n    38: 'moveCursorUp',\r\n    39: 'moveCursorRight',\r\n    40: 'moveCursorDown',\r\n  },\r\n\r\n  keysMapRtl: {\r\n    9:  'exitEditing',\r\n    27: 'exitEditing',\r\n    33: 'moveCursorUp',\r\n    34: 'moveCursorDown',\r\n    35: 'moveCursorLeft',\r\n    36: 'moveCursorRight',\r\n    37: 'moveCursorRight',\r\n    38: 'moveCursorUp',\r\n    39: 'moveCursorLeft',\r\n    40: 'moveCursorDown',\r\n  },\r\n\r\n  /**\r\n   * For functionalities on keyUp + ctrl || cmd\r\n   */\r\n  ctrlKeysMapUp: {\r\n    67: 'copy',\r\n    88: 'cut'\r\n  },\r\n\r\n  /**\r\n   * For functionalities on keyDown + ctrl || cmd\r\n   */\r\n  ctrlKeysMapDown: {\r\n    65: 'selectAll'\r\n  },\r\n\r\n  onClick: function() {\r\n    // No need to trigger click event here, focus is enough to have the keyboard appear on Android\r\n    this.hiddenTextarea && this.hiddenTextarea.focus();\r\n  },\r\n\r\n  /**\r\n   * Handles keydown event\r\n   * only used for arrows and combination of modifier keys.\r\n   * @param {Event} e Event object\r\n   */\r\n  onKeyDown: function(e) {\r\n    if (!this.isEditing) {\r\n      return;\r\n    }\r\n    var keyMap = this.direction === 'rtl' ? this.keysMapRtl : this.keysMap;\r\n    if (e.keyCode in keyMap) {\r\n      this[keyMap[e.keyCode]](e);\r\n    }\r\n    else if ((e.keyCode in this.ctrlKeysMapDown) && (e.ctrlKey || e.metaKey)) {\r\n      this[this.ctrlKeysMapDown[e.keyCode]](e);\r\n    }\r\n    else {\r\n      return;\r\n    }\r\n    e.stopImmediatePropagation();\r\n    e.preventDefault();\r\n    if (e.keyCode >= 33 && e.keyCode <= 40) {\r\n      // if i press an arrow key just update selection\r\n      this.inCompositionMode = false;\r\n      this.clearContextTop();\r\n      this.renderCursorOrSelection();\r\n    }\r\n    else {\r\n      this.canvas && this.canvas.requestRenderAll();\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Handles keyup event\r\n   * We handle KeyUp because ie11 and edge have difficulties copy/pasting\r\n   * if a copy/cut event fired, keyup is dismissed\r\n   * @param {Event} e Event object\r\n   */\r\n  onKeyUp: function(e) {\r\n    if (!this.isEditing || this._copyDone || this.inCompositionMode) {\r\n      this._copyDone = false;\r\n      return;\r\n    }\r\n    if ((e.keyCode in this.ctrlKeysMapUp) && (e.ctrlKey || e.metaKey)) {\r\n      this[this.ctrlKeysMapUp[e.keyCode]](e);\r\n    }\r\n    else {\r\n      return;\r\n    }\r\n    e.stopImmediatePropagation();\r\n    e.preventDefault();\r\n    this.canvas && this.canvas.requestRenderAll();\r\n  },\r\n\r\n  /**\r\n   * Handles onInput event\r\n   * @param {Event} e Event object\r\n   */\r\n  onInput: function(e) {\r\n    var fromPaste = this.fromPaste;\r\n    this.fromPaste = false;\r\n    e && e.stopPropagation();\r\n    if (!this.isEditing) {\r\n      return;\r\n    }\r\n    // decisions about style changes.\r\n    var nextText = this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,\r\n        charCount = this._text.length,\r\n        nextCharCount = nextText.length,\r\n        removedText, insertedText,\r\n        charDiff = nextCharCount - charCount,\r\n        selectionStart = this.selectionStart, selectionEnd = this.selectionEnd,\r\n        selection = selectionStart !== selectionEnd,\r\n        copiedStyle, removeFrom, removeTo;\r\n    if (this.hiddenTextarea.value === '') {\r\n      this.styles = { };\r\n      this.updateFromTextArea();\r\n      this.fire('changed');\r\n      if (this.canvas) {\r\n        this.canvas.fire('text:changed', { target: this });\r\n        this.canvas.requestRenderAll();\r\n      }\r\n      return;\r\n    }\r\n\r\n    var textareaSelection = this.fromStringToGraphemeSelection(\r\n      this.hiddenTextarea.selectionStart,\r\n      this.hiddenTextarea.selectionEnd,\r\n      this.hiddenTextarea.value\r\n    );\r\n    var backDelete = selectionStart > textareaSelection.selectionStart;\r\n\r\n    if (selection) {\r\n      removedText = this._text.slice(selectionStart, selectionEnd);\r\n      charDiff += selectionEnd - selectionStart;\r\n    }\r\n    else if (nextCharCount < charCount) {\r\n      if (backDelete) {\r\n        removedText = this._text.slice(selectionEnd + charDiff, selectionEnd);\r\n      }\r\n      else {\r\n        removedText = this._text.slice(selectionStart, selectionStart - charDiff);\r\n      }\r\n    }\r\n    insertedText = nextText.slice(textareaSelection.selectionEnd - charDiff, textareaSelection.selectionEnd);\r\n    if (removedText && removedText.length) {\r\n      if (insertedText.length) {\r\n        // let's copy some style before deleting.\r\n        // we want to copy the style before the cursor OR the style at the cursor if selection\r\n        // is bigger than 0.\r\n        copiedStyle = this.getSelectionStyles(selectionStart, selectionStart + 1, false);\r\n        // now duplicate the style one for each inserted text.\r\n        copiedStyle = insertedText.map(function() {\r\n          // this return an array of references, but that is fine since we are\r\n          // copying the style later.\r\n          return copiedStyle[0];\r\n        });\r\n      }\r\n      if (selection) {\r\n        removeFrom = selectionStart;\r\n        removeTo = selectionEnd;\r\n      }\r\n      else if (backDelete) {\r\n        // detect differences between forwardDelete and backDelete\r\n        removeFrom = selectionEnd - removedText.length;\r\n        removeTo = selectionEnd;\r\n      }\r\n      else {\r\n        removeFrom = selectionEnd;\r\n        removeTo = selectionEnd + removedText.length;\r\n      }\r\n      this.removeStyleFromTo(removeFrom, removeTo);\r\n    }\r\n    if (insertedText.length) {\r\n      if (fromPaste && insertedText.join('') === fabric.copiedText && !fabric.disableStyleCopyPaste) {\r\n        copiedStyle = fabric.copiedTextStyle;\r\n      }\r\n      this.insertNewStyleBlock(insertedText, selectionStart, copiedStyle);\r\n    }\r\n    this.updateFromTextArea();\r\n    this.fire('changed');\r\n    if (this.canvas) {\r\n      this.canvas.fire('text:changed', { target: this });\r\n      this.canvas.requestRenderAll();\r\n    }\r\n  },\r\n  /**\r\n   * Composition start\r\n   */\r\n  onCompositionStart: function() {\r\n    this.inCompositionMode = true;\r\n  },\r\n\r\n  /**\r\n   * Composition end\r\n   */\r\n  onCompositionEnd: function() {\r\n    this.inCompositionMode = false;\r\n  },\r\n\r\n  // /**\r\n  //  * Composition update\r\n  //  */\r\n  onCompositionUpdate: function(e) {\r\n    this.compositionStart = e.target.selectionStart;\r\n    this.compositionEnd = e.target.selectionEnd;\r\n    this.updateTextareaPosition();\r\n  },\r\n\r\n  /**\r\n   * Copies selected text\r\n   * @param {Event} e Event object\r\n   */\r\n  copy: function() {\r\n    if (this.selectionStart === this.selectionEnd) {\r\n      //do not cut-copy if no selection\r\n      return;\r\n    }\r\n\r\n    fabric.copiedText = this.getSelectedText();\r\n    if (!fabric.disableStyleCopyPaste) {\r\n      fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd, true);\r\n    }\r\n    else {\r\n      fabric.copiedTextStyle = null;\r\n    }\r\n    this._copyDone = true;\r\n  },\r\n\r\n  /**\r\n   * Pastes text\r\n   * @param {Event} e Event object\r\n   */\r\n  paste: function() {\r\n    this.fromPaste = true;\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @param {Event} e Event object\r\n   * @return {Object} Clipboard data object\r\n   */\r\n  _getClipboardData: function(e) {\r\n    return (e && e.clipboardData) || fabric.window.clipboardData;\r\n  },\r\n\r\n  /**\r\n   * Finds the width in pixels before the cursor on the same line\r\n   * @private\r\n   * @param {Number} lineIndex\r\n   * @param {Number} charIndex\r\n   * @return {Number} widthBeforeCursor width before cursor\r\n   */\r\n  _getWidthBeforeCursor: function(lineIndex, charIndex) {\r\n    var widthBeforeCursor = this._getLineLeftOffset(lineIndex), bound;\r\n\r\n    if (charIndex > 0) {\r\n      bound = this.__charBounds[lineIndex][charIndex - 1];\r\n      widthBeforeCursor += bound.left + bound.width;\r\n    }\r\n    return widthBeforeCursor;\r\n  },\r\n\r\n  /**\r\n   * Gets start offset of a selection\r\n   * @param {Event} e Event object\r\n   * @param {Boolean} isRight\r\n   * @return {Number}\r\n   */\r\n  getDownCursorOffset: function(e, isRight) {\r\n    var selectionProp = this._getSelectionForOffset(e, isRight),\r\n        cursorLocation = this.get2DCursorLocation(selectionProp),\r\n        lineIndex = cursorLocation.lineIndex;\r\n    // if on last line, down cursor goes to end of line\r\n    if (lineIndex === this._textLines.length - 1 || e.metaKey || e.keyCode === 34) {\r\n      // move to the end of a text\r\n      return this._text.length - selectionProp;\r\n    }\r\n    var charIndex = cursorLocation.charIndex,\r\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\r\n        indexOnOtherLine = this._getIndexOnLine(lineIndex + 1, widthBeforeCursor),\r\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\r\n    return textAfterCursor.length + indexOnOtherLine + 1 + this.missingNewlineOffset(lineIndex);\r\n  },\r\n\r\n  /**\r\n   * private\r\n   * Helps finding if the offset should be counted from Start or End\r\n   * @param {Event} e Event object\r\n   * @param {Boolean} isRight\r\n   * @return {Number}\r\n   */\r\n  _getSelectionForOffset: function(e, isRight) {\r\n    if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\r\n      return this.selectionEnd;\r\n    }\r\n    else {\r\n      return this.selectionStart;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @param {Event} e Event object\r\n   * @param {Boolean} isRight\r\n   * @return {Number}\r\n   */\r\n  getUpCursorOffset: function(e, isRight) {\r\n    var selectionProp = this._getSelectionForOffset(e, isRight),\r\n        cursorLocation = this.get2DCursorLocation(selectionProp),\r\n        lineIndex = cursorLocation.lineIndex;\r\n    if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\r\n      // if on first line, up cursor goes to start of line\r\n      return -selectionProp;\r\n    }\r\n    var charIndex = cursorLocation.charIndex,\r\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\r\n        indexOnOtherLine = this._getIndexOnLine(lineIndex - 1, widthBeforeCursor),\r\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex),\r\n        missingNewlineOffset = this.missingNewlineOffset(lineIndex - 1);\r\n    // return a negative offset\r\n    return -this._textLines[lineIndex - 1].length\r\n     + indexOnOtherLine - textBeforeCursor.length + (1 - missingNewlineOffset);\r\n  },\r\n\r\n  /**\r\n   * for a given width it founds the matching character.\r\n   * @private\r\n   */\r\n  _getIndexOnLine: function(lineIndex, width) {\r\n\r\n    var line = this._textLines[lineIndex],\r\n        lineLeftOffset = this._getLineLeftOffset(lineIndex),\r\n        widthOfCharsOnLine = lineLeftOffset,\r\n        indexOnLine = 0, charWidth, foundMatch;\r\n\r\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\r\n      charWidth = this.__charBounds[lineIndex][j].width;\r\n      widthOfCharsOnLine += charWidth;\r\n      if (widthOfCharsOnLine > width) {\r\n        foundMatch = true;\r\n        var leftEdge = widthOfCharsOnLine - charWidth,\r\n            rightEdge = widthOfCharsOnLine,\r\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\r\n            offsetFromRightEdge = Math.abs(rightEdge - width);\r\n\r\n        indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);\r\n        break;\r\n      }\r\n    }\r\n\r\n    // reached end\r\n    if (!foundMatch) {\r\n      indexOnLine = line.length - 1;\r\n    }\r\n\r\n    return indexOnLine;\r\n  },\r\n\r\n\r\n  /**\r\n   * Moves cursor down\r\n   * @param {Event} e Event object\r\n   */\r\n  moveCursorDown: function(e) {\r\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\r\n      return;\r\n    }\r\n    this._moveCursorUpOrDown('Down', e);\r\n  },\r\n\r\n  /**\r\n   * Moves cursor up\r\n   * @param {Event} e Event object\r\n   */\r\n  moveCursorUp: function(e) {\r\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\r\n      return;\r\n    }\r\n    this._moveCursorUpOrDown('Up', e);\r\n  },\r\n\r\n  /**\r\n   * Moves cursor up or down, fires the events\r\n   * @param {String} direction 'Up' or 'Down'\r\n   * @param {Event} e Event object\r\n   */\r\n  _moveCursorUpOrDown: function(direction, e) {\r\n    // getUpCursorOffset\r\n    // getDownCursorOffset\r\n    var action = 'get' + direction + 'CursorOffset',\r\n        offset = this[action](e, this._selectionDirection === 'right');\r\n    if (e.shiftKey) {\r\n      this.moveCursorWithShift(offset);\r\n    }\r\n    else {\r\n      this.moveCursorWithoutShift(offset);\r\n    }\r\n    if (offset !== 0) {\r\n      this.setSelectionInBoundaries();\r\n      this.abortCursorAnimation();\r\n      this._currentCursorOpacity = 1;\r\n      this.initDelayedCursor();\r\n      this._fireSelectionChanged();\r\n      this._updateTextarea();\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Moves cursor with shift\r\n   * @param {Number} offset\r\n   */\r\n  moveCursorWithShift: function(offset) {\r\n    var newSelection = this._selectionDirection === 'left'\r\n      ? this.selectionStart + offset\r\n      : this.selectionEnd + offset;\r\n    this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, newSelection);\r\n    return offset !== 0;\r\n  },\r\n\r\n  /**\r\n   * Moves cursor up without shift\r\n   * @param {Number} offset\r\n   */\r\n  moveCursorWithoutShift: function(offset) {\r\n    if (offset < 0) {\r\n      this.selectionStart += offset;\r\n      this.selectionEnd = this.selectionStart;\r\n    }\r\n    else {\r\n      this.selectionEnd += offset;\r\n      this.selectionStart = this.selectionEnd;\r\n    }\r\n    return offset !== 0;\r\n  },\r\n\r\n  /**\r\n   * Moves cursor left\r\n   * @param {Event} e Event object\r\n   */\r\n  moveCursorLeft: function(e) {\r\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\r\n      return;\r\n    }\r\n    this._moveCursorLeftOrRight('Left', e);\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   * @return {Boolean} true if a change happened\r\n   */\r\n  _move: function(e, prop, direction) {\r\n    var newValue;\r\n    if (e.altKey) {\r\n      newValue = this['findWordBoundary' + direction](this[prop]);\r\n    }\r\n    else if (e.metaKey || e.keyCode === 35 ||  e.keyCode === 36 ) {\r\n      newValue = this['findLineBoundary' + direction](this[prop]);\r\n    }\r\n    else {\r\n      this[prop] += direction === 'Left' ? -1 : 1;\r\n      return true;\r\n    }\r\n    if (typeof newValue !== undefined && this[prop] !== newValue) {\r\n      this[prop] = newValue;\r\n      return true;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  _moveLeft: function(e, prop) {\r\n    return this._move(e, prop, 'Left');\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  _moveRight: function(e, prop) {\r\n    return this._move(e, prop, 'Right');\r\n  },\r\n\r\n  /**\r\n   * Moves cursor left without keeping selection\r\n   * @param {Event} e\r\n   */\r\n  moveCursorLeftWithoutShift: function(e) {\r\n    var change = true;\r\n    this._selectionDirection = 'left';\r\n\r\n    // only move cursor when there is no selection,\r\n    // otherwise we discard it, and leave cursor on same place\r\n    if (this.selectionEnd === this.selectionStart && this.selectionStart !== 0) {\r\n      change = this._moveLeft(e, 'selectionStart');\r\n\r\n    }\r\n    this.selectionEnd = this.selectionStart;\r\n    return change;\r\n  },\r\n\r\n  /**\r\n   * Moves cursor left while keeping selection\r\n   * @param {Event} e\r\n   */\r\n  moveCursorLeftWithShift: function(e) {\r\n    if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {\r\n      return this._moveLeft(e, 'selectionEnd');\r\n    }\r\n    else if (this.selectionStart !== 0){\r\n      this._selectionDirection = 'left';\r\n      return this._moveLeft(e, 'selectionStart');\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Moves cursor right\r\n   * @param {Event} e Event object\r\n   */\r\n  moveCursorRight: function(e) {\r\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\r\n      return;\r\n    }\r\n    this._moveCursorLeftOrRight('Right', e);\r\n  },\r\n\r\n  /**\r\n   * Moves cursor right or Left, fires event\r\n   * @param {String} direction 'Left', 'Right'\r\n   * @param {Event} e Event object\r\n   */\r\n  _moveCursorLeftOrRight: function(direction, e) {\r\n    var actionName = 'moveCursor' + direction + 'With';\r\n    this._currentCursorOpacity = 1;\r\n\r\n    if (e.shiftKey) {\r\n      actionName += 'Shift';\r\n    }\r\n    else {\r\n      actionName += 'outShift';\r\n    }\r\n    if (this[actionName](e)) {\r\n      this.abortCursorAnimation();\r\n      this.initDelayedCursor();\r\n      this._fireSelectionChanged();\r\n      this._updateTextarea();\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Moves cursor right while keeping selection\r\n   * @param {Event} e\r\n   */\r\n  moveCursorRightWithShift: function(e) {\r\n    if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {\r\n      return this._moveRight(e, 'selectionStart');\r\n    }\r\n    else if (this.selectionEnd !== this._text.length) {\r\n      this._selectionDirection = 'right';\r\n      return this._moveRight(e, 'selectionEnd');\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Moves cursor right without keeping selection\r\n   * @param {Event} e Event object\r\n   */\r\n  moveCursorRightWithoutShift: function(e) {\r\n    var changed = true;\r\n    this._selectionDirection = 'right';\r\n\r\n    if (this.selectionStart === this.selectionEnd) {\r\n      changed = this._moveRight(e, 'selectionStart');\r\n      this.selectionEnd = this.selectionStart;\r\n    }\r\n    else {\r\n      this.selectionStart = this.selectionEnd;\r\n    }\r\n    return changed;\r\n  },\r\n\r\n  /**\r\n   * Removes characters from start/end\r\n   * start/end ar per grapheme position in _text array.\r\n   *\r\n   * @param {Number} start\r\n   * @param {Number} end default to start + 1\r\n   */\r\n  removeChars: function(start, end) {\r\n    if (typeof end === 'undefined') {\r\n      end = start + 1;\r\n    }\r\n    this.removeStyleFromTo(start, end);\r\n    this._text.splice(start, end - start);\r\n    this.text = this._text.join('');\r\n    this.set('dirty', true);\r\n    if (this._shouldClearDimensionCache()) {\r\n      this.initDimensions();\r\n      this.setCoords();\r\n    }\r\n    this._removeExtraneousStyles();\r\n  },\r\n\r\n  /**\r\n   * insert characters at start position, before start position.\r\n   * start  equal 1 it means the text get inserted between actual grapheme 0 and 1\r\n   * if style array is provided, it must be as the same length of text in graphemes\r\n   * if end is provided and is bigger than start, old text is replaced.\r\n   * start/end ar per grapheme position in _text array.\r\n   *\r\n   * @param {String} text text to insert\r\n   * @param {Array} style array of style objects\r\n   * @param {Number} start\r\n   * @param {Number} end default to start + 1\r\n   */\r\n  insertChars: function(text, style, start, end) {\r\n    if (typeof end === 'undefined') {\r\n      end = start;\r\n    }\r\n    if (end > start) {\r\n      this.removeStyleFromTo(start, end);\r\n    }\r\n    var graphemes = fabric.util.string.graphemeSplit(text);\r\n    this.insertNewStyleBlock(graphemes, start, style);\r\n    this._text = [].concat(this._text.slice(0, start), graphemes, this._text.slice(end));\r\n    this.text = this._text.join('');\r\n    this.set('dirty', true);\r\n    if (this._shouldClearDimensionCache()) {\r\n      this.initDimensions();\r\n      this.setCoords();\r\n    }\r\n    this._removeExtraneousStyles();\r\n  },\r\n\r\n});\r\n\r\n\r\n/* _TO_SVG_START_ */\r\n(function() {\r\n  var toFixed = fabric.util.toFixed,\r\n      multipleSpacesRegex = /  +/g;\r\n\r\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\r\n\r\n    /**\r\n     * Returns SVG representation of an instance\r\n     * @param {Function} [reviver] Method for further parsing of svg representation.\r\n     * @return {String} svg representation of an instance\r\n     */\r\n    _toSVG: function() {\r\n      var offsets = this._getSVGLeftTopOffsets(),\r\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft);\r\n      return this._wrapSVGTextAndBg(textAndBg);\r\n    },\r\n\r\n    /**\r\n     * Returns svg representation of an instance\r\n     * @param {Function} [reviver] Method for further parsing of svg representation.\r\n     * @return {String} svg representation of an instance\r\n     */\r\n    toSVG: function(reviver) {\r\n      return this._createBaseSVGMarkup(\r\n        this._toSVG(),\r\n        { reviver: reviver, noStyle: true, withShadow: true }\r\n      );\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _getSVGLeftTopOffsets: function() {\r\n      return {\r\n        textLeft: -this.width / 2,\r\n        textTop: -this.height / 2,\r\n        lineTop: this.getHeightOfLine(0)\r\n      };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _wrapSVGTextAndBg: function(textAndBg) {\r\n      var noShadow = true,\r\n          textDecoration = this.getSvgTextDecoration(this);\r\n      return [\r\n        textAndBg.textBgRects.join(''),\r\n        '\\t\\t<text xml:space=\"preserve\" ',\r\n        (this.fontFamily ? 'font-family=\"' + this.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\r\n        (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : ''),\r\n        (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : ''),\r\n        (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : ''),\r\n        (textDecoration ? 'text-decoration=\"' + textDecoration + '\" ' : ''),\r\n        'style=\"', this.getSvgStyles(noShadow), '\"', this.addPaintOrder(), ' >',\r\n        textAndBg.textSpans.join(''),\r\n        '</text>\\n'\r\n      ];\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     * @param {Number} textTopOffset Text top offset\r\n     * @param {Number} textLeftOffset Text left offset\r\n     * @return {Object}\r\n     */\r\n    _getSVGTextAndBg: function(textTopOffset, textLeftOffset) {\r\n      var textSpans = [],\r\n          textBgRects = [],\r\n          height = textTopOffset, lineOffset;\r\n      // bounding-box background\r\n      this._setSVGBg(textBgRects);\r\n\r\n      // text and text-background\r\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\r\n        lineOffset = this._getLineLeftOffset(i);\r\n        if (this.textBackgroundColor || this.styleHas('textBackgroundColor', i)) {\r\n          this._setSVGTextLineBg(textBgRects, i, textLeftOffset + lineOffset, height);\r\n        }\r\n        this._setSVGTextLineText(textSpans, i, textLeftOffset + lineOffset, height);\r\n        height += this.getHeightOfLine(i);\r\n      }\r\n\r\n      return {\r\n        textSpans: textSpans,\r\n        textBgRects: textBgRects\r\n      };\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _createTextCharSpan: function(_char, styleDecl, left, top) {\r\n      var shouldUseWhitespace = _char !== _char.trim() || _char.match(multipleSpacesRegex),\r\n          styleProps = this.getSvgSpanStyles(styleDecl, shouldUseWhitespace),\r\n          fillStyles = styleProps ? 'style=\"' + styleProps + '\"' : '',\r\n          dy = styleDecl.deltaY, dySpan = '',\r\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\r\n      if (dy) {\r\n        dySpan = ' dy=\"' + toFixed(dy, NUM_FRACTION_DIGITS) + '\" ';\r\n      }\r\n      return [\r\n        '<tspan x=\"', toFixed(left, NUM_FRACTION_DIGITS), '\" y=\"',\r\n        toFixed(top, NUM_FRACTION_DIGITS), '\" ', dySpan,\r\n        fillStyles, '>',\r\n        fabric.util.string.escapeXml(_char),\r\n        '</tspan>'\r\n      ].join('');\r\n    },\r\n\r\n    _setSVGTextLineText: function(textSpans, lineIndex, textLeftOffset, textTopOffset) {\r\n      // set proper line offset\r\n      var lineHeight = this.getHeightOfLine(lineIndex),\r\n          isJustify = this.textAlign.indexOf('justify') !== -1,\r\n          actualStyle,\r\n          nextStyle,\r\n          charsToRender = '',\r\n          charBox, style,\r\n          boxWidth = 0,\r\n          line = this._textLines[lineIndex],\r\n          timeToRender;\r\n\r\n      textTopOffset += lineHeight * (1 - this._fontSizeFraction) / this.lineHeight;\r\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\r\n        timeToRender = i === len || this.charSpacing;\r\n        charsToRender += line[i];\r\n        charBox = this.__charBounds[lineIndex][i];\r\n        if (boxWidth === 0) {\r\n          textLeftOffset += charBox.kernedWidth - charBox.width;\r\n          boxWidth += charBox.width;\r\n        }\r\n        else {\r\n          boxWidth += charBox.kernedWidth;\r\n        }\r\n        if (isJustify && !timeToRender) {\r\n          if (this._reSpaceAndTab.test(line[i])) {\r\n            timeToRender = true;\r\n          }\r\n        }\r\n        if (!timeToRender) {\r\n          // if we have charSpacing, we render char by char\r\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\r\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\r\n          timeToRender = this._hasStyleChangedForSvg(actualStyle, nextStyle);\r\n        }\r\n        if (timeToRender) {\r\n          style = this._getStyleDeclaration(lineIndex, i) || { };\r\n          textSpans.push(this._createTextCharSpan(charsToRender, style, textLeftOffset, textTopOffset));\r\n          charsToRender = '';\r\n          actualStyle = nextStyle;\r\n          textLeftOffset += boxWidth;\r\n          boxWidth = 0;\r\n        }\r\n      }\r\n    },\r\n\r\n    _pushTextBgRect: function(textBgRects, color, left, top, width, height) {\r\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\r\n      textBgRects.push(\r\n        '\\t\\t<rect ',\r\n        this._getFillAttributes(color),\r\n        ' x=\"',\r\n        toFixed(left, NUM_FRACTION_DIGITS),\r\n        '\" y=\"',\r\n        toFixed(top, NUM_FRACTION_DIGITS),\r\n        '\" width=\"',\r\n        toFixed(width, NUM_FRACTION_DIGITS),\r\n        '\" height=\"',\r\n        toFixed(height, NUM_FRACTION_DIGITS),\r\n        '\"></rect>\\n');\r\n    },\r\n\r\n    _setSVGTextLineBg: function(textBgRects, i, leftOffset, textTopOffset) {\r\n      var line = this._textLines[i],\r\n          heightOfLine = this.getHeightOfLine(i) / this.lineHeight,\r\n          boxWidth = 0,\r\n          boxStart = 0,\r\n          charBox, currentColor,\r\n          lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\r\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\r\n        charBox = this.__charBounds[i][j];\r\n        currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\r\n        if (currentColor !== lastColor) {\r\n          lastColor && this._pushTextBgRect(textBgRects, lastColor, leftOffset + boxStart,\r\n            textTopOffset, boxWidth, heightOfLine);\r\n          boxStart = charBox.left;\r\n          boxWidth = charBox.width;\r\n          lastColor = currentColor;\r\n        }\r\n        else {\r\n          boxWidth += charBox.kernedWidth;\r\n        }\r\n      }\r\n      currentColor && this._pushTextBgRect(textBgRects, currentColor, leftOffset + boxStart,\r\n        textTopOffset, boxWidth, heightOfLine);\r\n    },\r\n\r\n    /**\r\n     * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\r\n     * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\r\n     *\r\n     * @private\r\n     * @param {*} value\r\n     * @return {String}\r\n     */\r\n    _getFillAttributes: function(value) {\r\n      var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';\r\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\r\n        return 'fill=\"' + value + '\"';\r\n      }\r\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\r\n    },\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    _getSVGLineTopOffset: function(lineIndex) {\r\n      var lineTopOffset = 0, lastHeight = 0;\r\n      for (var j = 0; j < lineIndex; j++) {\r\n        lineTopOffset += this.getHeightOfLine(j);\r\n      }\r\n      lastHeight = this.getHeightOfLine(j);\r\n      return {\r\n        lineTop: lineTopOffset,\r\n        offset: (this._fontSizeMult - this._fontSizeFraction) * lastHeight / (this.lineHeight * this._fontSizeMult)\r\n      };\r\n    },\r\n\r\n    /**\r\n     * Returns styles-string for svg-export\r\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\r\n     * @return {String}\r\n     */\r\n    getSvgStyles: function(skipShadow) {\r\n      var svgStyle = fabric.Object.prototype.getSvgStyles.call(this, skipShadow);\r\n      return svgStyle + ' white-space: pre;';\r\n    },\r\n  });\r\n})();\r\n/* _TO_SVG_END_ */\r\n\r\n\r\n(function(global) {\r\n\r\n  'use strict';\r\n\r\n  var fabric = global.fabric || (global.fabric = {});\r\n\r\n  /**\r\n   * Textbox class, based on IText, allows the user to resize the text rectangle\r\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\r\n   * user can only change width. Height is adjusted automatically based on the\r\n   * wrapping of lines.\r\n   * @class fabric.Textbox\r\n   * @extends fabric.IText\r\n   * @mixes fabric.Observable\r\n   * @return {fabric.Textbox} thisArg\r\n   * @see {@link fabric.Textbox#initialize} for constructor definition\r\n   */\r\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\r\n\r\n    /**\r\n     * Type of an object\r\n     * @type String\r\n     * @default\r\n     */\r\n    type: 'textbox',\r\n\r\n    /**\r\n     * Minimum width of textbox, in pixels.\r\n     * @type Number\r\n     * @default\r\n     */\r\n    minWidth: 20,\r\n\r\n    /**\r\n     * Minimum calculated width of a textbox, in pixels.\r\n     * fixed to 2 so that an empty textbox cannot go to 0\r\n     * and is still selectable without text.\r\n     * @type Number\r\n     * @default\r\n     */\r\n    dynamicMinWidth: 2,\r\n\r\n    /**\r\n     * Cached array of text wrapping.\r\n     * @type Array\r\n     */\r\n    __cachedLines: null,\r\n\r\n    /**\r\n     * Override standard Object class values\r\n     */\r\n    lockScalingFlip: true,\r\n\r\n    /**\r\n     * Override standard Object class values\r\n     * Textbox needs this on false\r\n     */\r\n    noScaleCache: false,\r\n\r\n    /**\r\n     * Properties which when set cause object to change dimensions\r\n     * @type Object\r\n     * @private\r\n     */\r\n    _dimensionAffectingProps: fabric.Text.prototype._dimensionAffectingProps.concat('width'),\r\n\r\n    /**\r\n     * Use this regular expression to split strings in breakable lines\r\n     * @private\r\n     */\r\n    _wordJoiners: /[ \\t\\r]/,\r\n\r\n    /**\r\n     * Use this boolean property in order to split strings that have no white space concept.\r\n     * this is a cheap way to help with chinese/japanese\r\n     * @type Boolean\r\n     * @since 2.6.0\r\n     */\r\n    splitByGrapheme: false,\r\n\r\n    /**\r\n     * Unlike superclass's version of this function, Textbox does not update\r\n     * its width.\r\n     * @private\r\n     * @override\r\n     */\r\n    initDimensions: function() {\r\n      if (this.__skipDimension) {\r\n        return;\r\n      }\r\n      this.isEditing && this.initDelayedCursor();\r\n      this.clearContextTop();\r\n      this._clearCache();\r\n      // clear dynamicMinWidth as it will be different after we re-wrap line\r\n      this.dynamicMinWidth = 0;\r\n      // wrap lines\r\n      this._styleMap = this._generateStyleMap(this._splitText());\r\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\r\n      if (this.dynamicMinWidth > this.width) {\r\n        this._set('width', this.dynamicMinWidth);\r\n      }\r\n      if (this.textAlign.indexOf('justify') !== -1) {\r\n        // once text is measured we need to make space fatter to make justified text.\r\n        this.enlargeSpaces();\r\n      }\r\n      // clear cache and re-calculate height\r\n      this.height = this.calcTextHeight();\r\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\r\n    },\r\n\r\n    /**\r\n     * Generate an object that translates the style object so that it is\r\n     * broken up by visual lines (new lines and automatic wrapping).\r\n     * The original text styles object is broken up by actual lines (new lines only),\r\n     * which is only sufficient for Text / IText\r\n     * @private\r\n     */\r\n    _generateStyleMap: function(textInfo) {\r\n      var realLineCount     = 0,\r\n          realLineCharCount = 0,\r\n          charCount         = 0,\r\n          map               = {};\r\n\r\n      for (var i = 0; i < textInfo.graphemeLines.length; i++) {\r\n        if (textInfo.graphemeText[charCount] === '\\n' && i > 0) {\r\n          realLineCharCount = 0;\r\n          charCount++;\r\n          realLineCount++;\r\n        }\r\n        else if (!this.splitByGrapheme && this._reSpaceAndTab.test(textInfo.graphemeText[charCount]) && i > 0) {\r\n          // this case deals with space's that are removed from end of lines when wrapping\r\n          realLineCharCount++;\r\n          charCount++;\r\n        }\r\n\r\n        map[i] = { line: realLineCount, offset: realLineCharCount };\r\n\r\n        charCount += textInfo.graphemeLines[i].length;\r\n        realLineCharCount += textInfo.graphemeLines[i].length;\r\n      }\r\n\r\n      return map;\r\n    },\r\n\r\n    /**\r\n     * Returns true if object has a style property or has it on a specified line\r\n     * @param {Number} lineIndex\r\n     * @return {Boolean}\r\n     */\r\n    styleHas: function(property, lineIndex) {\r\n      if (this._styleMap && !this.isWrapping) {\r\n        var map = this._styleMap[lineIndex];\r\n        if (map) {\r\n          lineIndex = map.line;\r\n        }\r\n      }\r\n      return fabric.Text.prototype.styleHas.call(this, property, lineIndex);\r\n    },\r\n\r\n    /**\r\n     * Returns true if object has no styling or no styling in a line\r\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\r\n     * @return {Boolean}\r\n     */\r\n    isEmptyStyles: function(lineIndex) {\r\n      if (!this.styles) {\r\n        return true;\r\n      }\r\n      var offset = 0, nextLineIndex = lineIndex + 1, nextOffset, obj, shouldLimit = false,\r\n          map = this._styleMap[lineIndex], mapNextLine = this._styleMap[lineIndex + 1];\r\n      if (map) {\r\n        lineIndex = map.line;\r\n        offset = map.offset;\r\n      }\r\n      if (mapNextLine) {\r\n        nextLineIndex = mapNextLine.line;\r\n        shouldLimit = nextLineIndex === lineIndex;\r\n        nextOffset = mapNextLine.offset;\r\n      }\r\n      obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\r\n      for (var p1 in obj) {\r\n        for (var p2 in obj[p1]) {\r\n          if (p2 >= offset && (!shouldLimit || p2 < nextOffset)) {\r\n            // eslint-disable-next-line no-unused-vars\r\n            for (var p3 in obj[p1][p2]) {\r\n              return false;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * @param {Number} lineIndex\r\n     * @param {Number} charIndex\r\n     * @private\r\n     */\r\n    _getStyleDeclaration: function(lineIndex, charIndex) {\r\n      if (this._styleMap && !this.isWrapping) {\r\n        var map = this._styleMap[lineIndex];\r\n        if (!map) {\r\n          return null;\r\n        }\r\n        lineIndex = map.line;\r\n        charIndex = map.offset + charIndex;\r\n      }\r\n      return this.callSuper('_getStyleDeclaration', lineIndex, charIndex);\r\n    },\r\n\r\n    /**\r\n     * @param {Number} lineIndex\r\n     * @param {Number} charIndex\r\n     * @param {Object} style\r\n     * @private\r\n     */\r\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\r\n      var map = this._styleMap[lineIndex];\r\n      lineIndex = map.line;\r\n      charIndex = map.offset + charIndex;\r\n\r\n      this.styles[lineIndex][charIndex] = style;\r\n    },\r\n\r\n    /**\r\n     * @param {Number} lineIndex\r\n     * @param {Number} charIndex\r\n     * @private\r\n     */\r\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\r\n      var map = this._styleMap[lineIndex];\r\n      lineIndex = map.line;\r\n      charIndex = map.offset + charIndex;\r\n      delete this.styles[lineIndex][charIndex];\r\n    },\r\n\r\n    /**\r\n     * probably broken need a fix\r\n     * Returns the real style line that correspond to the wrapped lineIndex line\r\n     * Used just to verify if the line does exist or not.\r\n     * @param {Number} lineIndex\r\n     * @returns {Boolean} if the line exists or not\r\n     * @private\r\n     */\r\n    _getLineStyle: function(lineIndex) {\r\n      var map = this._styleMap[lineIndex];\r\n      return !!this.styles[map.line];\r\n    },\r\n\r\n    /**\r\n     * Set the line style to an empty object so that is initialized\r\n     * @param {Number} lineIndex\r\n     * @param {Object} style\r\n     * @private\r\n     */\r\n    _setLineStyle: function(lineIndex) {\r\n      var map = this._styleMap[lineIndex];\r\n      this.styles[map.line] = {};\r\n    },\r\n\r\n    /**\r\n     * Wraps text using the 'width' property of Textbox. First this function\r\n     * splits text on newlines, so we preserve newlines entered by the user.\r\n     * Then it wraps each line using the width of the Textbox by calling\r\n     * _wrapLine().\r\n     * @param {Array} lines The string array of text that is split into lines\r\n     * @param {Number} desiredWidth width you want to wrap to\r\n     * @returns {Array} Array of lines\r\n     */\r\n    _wrapText: function(lines, desiredWidth) {\r\n      var wrapped = [], i;\r\n      this.isWrapping = true;\r\n      for (i = 0; i < lines.length; i++) {\r\n        wrapped = wrapped.concat(this._wrapLine(lines[i], i, desiredWidth));\r\n      }\r\n      this.isWrapping = false;\r\n      return wrapped;\r\n    },\r\n\r\n    /**\r\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\r\n     * it gets called when charBounds are not available yet.\r\n     * @param {CanvasRenderingContext2D} ctx\r\n     * @param {String} text\r\n     * @param {number} lineIndex\r\n     * @param {number} charOffset\r\n     * @returns {number}\r\n     * @private\r\n     */\r\n    _measureWord: function(word, lineIndex, charOffset) {\r\n      var width = 0, prevGrapheme, skipLeft = true;\r\n      charOffset = charOffset || 0;\r\n      for (var i = 0, len = word.length; i < len; i++) {\r\n        var box = this._getGraphemeBox(word[i], lineIndex, i + charOffset, prevGrapheme, skipLeft);\r\n        width += box.kernedWidth;\r\n        prevGrapheme = word[i];\r\n      }\r\n      return width;\r\n    },\r\n\r\n    /**\r\n     * Wraps a line of text using the width of the Textbox and a context.\r\n     * @param {Array} line The grapheme array that represent the line\r\n     * @param {Number} lineIndex\r\n     * @param {Number} desiredWidth width you want to wrap the line to\r\n     * @param {Number} reservedSpace space to remove from wrapping for custom functionalities\r\n     * @returns {Array} Array of line(s) into which the given text is wrapped\r\n     * to.\r\n     */\r\n    _wrapLine: function(_line, lineIndex, desiredWidth, reservedSpace) {\r\n      var lineWidth = 0,\r\n          splitByGrapheme = this.splitByGrapheme,\r\n          graphemeLines = [],\r\n          line = [],\r\n          // spaces in different languages?\r\n          words = splitByGrapheme ? fabric.util.string.graphemeSplit(_line) : _line.split(this._wordJoiners),\r\n          word = '',\r\n          offset = 0,\r\n          infix = splitByGrapheme ? '' : ' ',\r\n          wordWidth = 0,\r\n          infixWidth = 0,\r\n          largestWordWidth = 0,\r\n          lineJustStarted = true,\r\n          additionalSpace = this._getWidthOfCharSpacing(),\r\n          reservedSpace = reservedSpace || 0;\r\n      // fix a difference between split and graphemeSplit\r\n      if (words.length === 0) {\r\n        words.push([]);\r\n      }\r\n      desiredWidth -= reservedSpace;\r\n      for (var i = 0; i < words.length; i++) {\r\n        // if using splitByGrapheme words are already in graphemes.\r\n        word = splitByGrapheme ? words[i] : fabric.util.string.graphemeSplit(words[i]);\r\n        wordWidth = this._measureWord(word, lineIndex, offset);\r\n        offset += word.length;\r\n\r\n        lineWidth += infixWidth + wordWidth - additionalSpace;\r\n        if (lineWidth > desiredWidth && !lineJustStarted) {\r\n          graphemeLines.push(line);\r\n          line = [];\r\n          lineWidth = wordWidth;\r\n          lineJustStarted = true;\r\n        }\r\n        else {\r\n          lineWidth += additionalSpace;\r\n        }\r\n\r\n        if (!lineJustStarted && !splitByGrapheme) {\r\n          line.push(infix);\r\n        }\r\n        line = line.concat(word);\r\n\r\n        infixWidth = splitByGrapheme ? 0 : this._measureWord([infix], lineIndex, offset);\r\n        offset++;\r\n        lineJustStarted = false;\r\n        // keep track of largest word\r\n        if (wordWidth > largestWordWidth) {\r\n          largestWordWidth = wordWidth;\r\n        }\r\n      }\r\n\r\n      i && graphemeLines.push(line);\r\n\r\n      if (largestWordWidth + reservedSpace > this.dynamicMinWidth) {\r\n        this.dynamicMinWidth = largestWordWidth - additionalSpace + reservedSpace;\r\n      }\r\n      return graphemeLines;\r\n    },\r\n\r\n    /**\r\n     * Detect if the text line is ended with an hard break\r\n     * text and itext do not have wrapping, return false\r\n     * @param {Number} lineIndex text to split\r\n     * @return {Boolean}\r\n     */\r\n    isEndOfWrapping: function(lineIndex) {\r\n      if (!this._styleMap[lineIndex + 1]) {\r\n        // is last line, return true;\r\n        return true;\r\n      }\r\n      if (this._styleMap[lineIndex + 1].line !== this._styleMap[lineIndex].line) {\r\n        // this is last line before a line break, return true;\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n\r\n    /**\r\n     * Detect if a line has a linebreak and so we need to account for it when moving\r\n     * and counting style.\r\n     * @return Number\r\n     */\r\n    missingNewlineOffset: function(lineIndex) {\r\n      if (this.splitByGrapheme) {\r\n        return this.isEndOfWrapping(lineIndex) ? 1 : 0;\r\n      }\r\n      return 1;\r\n    },\r\n\r\n    /**\r\n    * Gets lines of text to render in the Textbox. This function calculates\r\n    * text wrapping on the fly every time it is called.\r\n    * @param {String} text text to split\r\n    * @returns {Array} Array of lines in the Textbox.\r\n    * @override\r\n    */\r\n    _splitTextIntoLines: function(text) {\r\n      var newText = fabric.Text.prototype._splitTextIntoLines.call(this, text),\r\n          graphemeLines = this._wrapText(newText.lines, this.width),\r\n          lines = new Array(graphemeLines.length);\r\n      for (var i = 0; i < graphemeLines.length; i++) {\r\n        lines[i] = graphemeLines[i].join('');\r\n      }\r\n      newText.lines = lines;\r\n      newText.graphemeLines = graphemeLines;\r\n      return newText;\r\n    },\r\n\r\n    getMinWidth: function() {\r\n      return Math.max(this.minWidth, this.dynamicMinWidth);\r\n    },\r\n\r\n    _removeExtraneousStyles: function() {\r\n      var linesToKeep = {};\r\n      for (var prop in this._styleMap) {\r\n        if (this._textLines[prop]) {\r\n          linesToKeep[this._styleMap[prop].line] = 1;\r\n        }\r\n      }\r\n      for (var prop in this.styles) {\r\n        if (!linesToKeep[prop]) {\r\n          delete this.styles[prop];\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Returns object representation of an instance\r\n     * @method toObject\r\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\r\n     * @return {Object} object representation of an instance\r\n     */\r\n    toObject: function(propertiesToInclude) {\r\n      return this.callSuper('toObject', ['minWidth', 'splitByGrapheme'].concat(propertiesToInclude));\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Returns fabric.Textbox instance from an object representation\r\n   * @static\r\n   * @memberOf fabric.Textbox\r\n   * @param {Object} object Object to create an instance from\r\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\r\n   */\r\n  fabric.Textbox.fromObject = function(object, callback) {\r\n    return fabric.Object._fromObject('Textbox', object, callback, 'text');\r\n  };\r\n})(typeof exports !== 'undefined' ? exports : this);\r\n\r\n\r\n(function() {\r\n\r\n  var controlsUtils = fabric.controlsUtils,\r\n      scaleSkewStyleHandler = controlsUtils.scaleSkewCursorStyleHandler,\r\n      scaleStyleHandler = controlsUtils.scaleCursorStyleHandler,\r\n      scalingEqually = controlsUtils.scalingEqually,\r\n      scalingYOrSkewingX = controlsUtils.scalingYOrSkewingX,\r\n      scalingXOrSkewingY = controlsUtils.scalingXOrSkewingY,\r\n      scaleOrSkewActionName = controlsUtils.scaleOrSkewActionName,\r\n      objectControls = fabric.Object.prototype.controls;\r\n\r\n  objectControls.ml = new fabric.Control({\r\n    x: -0.5,\r\n    y: 0,\r\n    cursorStyleHandler: scaleSkewStyleHandler,\r\n    actionHandler: scalingXOrSkewingY,\r\n    getActionName: scaleOrSkewActionName,\r\n  });\r\n\r\n  objectControls.mr = new fabric.Control({\r\n    x: 0.5,\r\n    y: 0,\r\n    cursorStyleHandler: scaleSkewStyleHandler,\r\n    actionHandler: scalingXOrSkewingY,\r\n    getActionName: scaleOrSkewActionName,\r\n  });\r\n\r\n  objectControls.mb = new fabric.Control({\r\n    x: 0,\r\n    y: 0.5,\r\n    cursorStyleHandler: scaleSkewStyleHandler,\r\n    actionHandler: scalingYOrSkewingX,\r\n    getActionName: scaleOrSkewActionName,\r\n  });\r\n\r\n  objectControls.mt = new fabric.Control({\r\n    x: 0,\r\n    y: -0.5,\r\n    cursorStyleHandler: scaleSkewStyleHandler,\r\n    actionHandler: scalingYOrSkewingX,\r\n    getActionName: scaleOrSkewActionName,\r\n  });\r\n\r\n  objectControls.tl = new fabric.Control({\r\n    x: -0.5,\r\n    y: -0.5,\r\n    cursorStyleHandler: scaleStyleHandler,\r\n    actionHandler: scalingEqually\r\n  });\r\n\r\n  objectControls.tr = new fabric.Control({\r\n    x: 0.5,\r\n    y: -0.5,\r\n    cursorStyleHandler: scaleStyleHandler,\r\n    actionHandler: scalingEqually\r\n  });\r\n\r\n  objectControls.bl = new fabric.Control({\r\n    x: -0.5,\r\n    y: 0.5,\r\n    cursorStyleHandler: scaleStyleHandler,\r\n    actionHandler: scalingEqually\r\n  });\r\n\r\n  objectControls.br = new fabric.Control({\r\n    x: 0.5,\r\n    y: 0.5,\r\n    cursorStyleHandler: scaleStyleHandler,\r\n    actionHandler: scalingEqually\r\n  });\r\n\r\n  objectControls.mtr = new fabric.Control({\r\n    x: 0,\r\n    y: -0.5,\r\n    actionHandler: controlsUtils.rotationWithSnapping,\r\n    cursorStyleHandler: controlsUtils.rotationStyleHandler,\r\n    offsetY: -40,\r\n    withConnection: true,\r\n    actionName: 'rotate',\r\n  });\r\n\r\n  if (fabric.Textbox) {\r\n    // this is breaking the prototype inheritance, no time / ideas to fix it.\r\n    // is important to document that if you want to have all objects to have a\r\n    // specific custom control, you have to add it to Object prototype and to Textbox\r\n    // prototype. The controls are shared as references. So changes to control `tr`\r\n    // can still apply to all objects if needed.\r\n    var textBoxControls = fabric.Textbox.prototype.controls = { };\r\n\r\n    textBoxControls.mtr = objectControls.mtr;\r\n    textBoxControls.tr = objectControls.tr;\r\n    textBoxControls.br = objectControls.br;\r\n    textBoxControls.tl = objectControls.tl;\r\n    textBoxControls.bl = objectControls.bl;\r\n    textBoxControls.mt = objectControls.mt;\r\n    textBoxControls.mb = objectControls.mb;\r\n\r\n    textBoxControls.mr = new fabric.Control({\r\n      x: 0.5,\r\n      y: 0,\r\n      actionHandler: controlsUtils.changeWidth,\r\n      cursorStyleHandler: scaleSkewStyleHandler,\r\n      actionName: 'resizing',\r\n    });\r\n\r\n    textBoxControls.ml = new fabric.Control({\r\n      x: -0.5,\r\n      y: 0,\r\n      actionHandler: controlsUtils.changeWidth,\r\n      cursorStyleHandler: scaleSkewStyleHandler,\r\n      actionName: 'resizing',\r\n    });\r\n  }\r\n})();\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const fabric = require(\"./fabric.js\").fabric;\r\nexport { fabric };"],"names":["global","sqrt","atan2","pow","PiBy180","PiBy2","couldUseAttachEvent","touchEvents","parseEl","supportsOpacity","supportsFilters","reOpacity","setOpacity","proto","toFixed","min","max","degreesToRadians","originXOffset","originYOffset","clone","fabric","version","exports","document","window","HTMLDocument","Document","implementation","createHTMLDocument","virtualWindow","JSDOM","decodeURIComponent","features","FetchExternalResources","resources","jsdomImplForWrapper","nodeCanvas","DOMParser","copyGLTo2DDrawImage","gl","pipelineState","glCanvas","canvas","targetCanvas","ctx","getContext","translate","height","scale","sourceY","drawImage","width","copyGLTo2DPutImageData","dWidth","destinationWidth","dHeight","destinationHeight","numBytes","u8","Uint8Array","this","imageBuffer","u8Clamped","Uint8ClampedArray","readPixels","RGBA","UNSIGNED_BYTE","imgData","ImageData","putImageData","isTouchSupported","navigator","maxTouchPoints","isLikelyNode","Buffer","SHARED_ATTRIBUTES","DPI","reNum","commaWsp","rePathCommand","reNonWord","fontPaths","iMatrix","svgNS","perfLimitSizeTotal","maxCacheSideLimit","minCacheSideLimit","charWidthsCache","textureSize","disableStyleCopyPaste","enableGLFiltering","devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio","browserShadowBlurConstant","arcToSegmentsCache","boundsOfCurveCache","cachesBoundsOfCurve","forceGLPutImageData","initFilterBackend","isWebglSupported","console","log","maxTextureSize","WebglFilterBackend","tileSize","Canvas2dFilterBackend","_removeEventListener","eventName","handler","__eventListeners","eventListener","indexOf","util","array","fill","_once","_handler","apply","arguments","off","bind","on","Observable","fire","options","listenersForEvent","i","len","length","call","filter","value","prop","push","once","Collection","_objects","add","_onObjectAdded","renderOnAddRemove","requestRenderAll","insertAt","object","index","nonSplicing","objects","splice","remove","somethingRemoved","_onObjectRemoved","forEachObject","callback","context","getObjects","type","concat","o","item","isEmpty","size","contains","deep","some","obj","complexity","reduce","memo","current","CommonMethods","_setOptions","set","_initGradient","filler","property","colorStops","Gradient","_initPattern","source","Pattern","_setObject","_set","key","toggle","get","Math","PI","cos","angle","sin","sign","removeFromArray","idx","getRandomInt","floor","random","degrees","radiansToDegrees","radians","rotatePoint","point","origin","newPoint","Point","x","y","v","rotateVector","addEquals","vector","createVector","from","to","calcAngleBetweenVectors","a","b","acos","hypot","getHatVector","multiply","getBisector","A","B","C","AB","AC","alpha","phi","projectStrokeOnPoints","points","openPath","coords","s","strokeWidth","strokeUniformScalar","strokeUniform","scaleX","scaleY","getStrokeHatVector","scalar","forEach","p","miterVector","bisector","bisectorVector","strokeLineJoin","strokeMiterLimit","subtract","SQRT2","transformPoint","t","ignoreOffset","makeBoundingBoxFromPoints","transform","xPoints","minX","yPoints","minY","left","top","invertTransform","r","number","fractionDigits","parseFloat","Number","parseUnit","fontSize","unit","exec","Text","DEFAULT_SVG_FONT_SIZE","falseFunction","getKlass","namespace","string","camelize","charAt","toUpperCase","slice","resolveNamespace","getSvgAttributes","attributes","parts","split","loadImage","url","crossOrigin","img","createImage","onLoadCallback","onload","onerror","src","substring","loadImageInDom","div","createElement","style","position","appendChild","querySelector","parentNode","removeChild","enlivenObjects","reviver","enlivenedObjects","numLoadedObjects","numTotalObjects","onLoaded","fromObject","error","enlivenObjectEnlivables","enlivenProps","Object","ENLIVEN_PROPS","map","enlivedProps","enlivenPatterns","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","pattern","groupSVGElements","elements","path","centerPoint","Group","sourcePath","populateWithProperties","destination","properties","Array","isArray","createCanvasElement","copyCanvasElement","newCanvas","toDataURL","canvasEl","format","quality","multiplyTransformMatrices","is2x2","qrDecompose","denom","skewX","skewY","translateX","translateY","calcRotateMatrix","theta","calcDimensionsMatrix","scaleMatrix","flipX","flipY","tan","composeMatrix","matrix","resetObjectTransform","target","rotate","saveObjectTransform","isTransparent","tolerance","_isTransparent","imageData","getImageData","l","data","parsePreserveAspectRatioAttribute","attribute","align","meetOrSlice","aspectRatioAttrs","pop","alignX","alignY","clearFabricFontCache","fontFamily","toLowerCase","limitDimsByArea","ar","maximumArea","roughWidth","perfLimitSizeY","capValue","findScaleToFit","findScaleToCover","matrixToSVG","NUM_FRACTION_DIGITS","join","removeTransformFromObject","inverted","finalTransform","calcOwnMatrix","applyTransformToObject","addTransformToObject","center","setPositionByOrigin","sizeAfterTransform","dimX","dimY","transformMatrix","bbox","mergeClipPaths","c1","c2","calcTransformMatrix","clipPath","_join","prototype","commandLengths","m","h","c","q","repeatedCommands","M","segmentToBezier","th2","th3","cosTh","sinTh","rx","ry","cx1","cy1","mT","fromX","fromY","costh2","sinth2","costh3","sinth3","toX","toY","calcVectorAngle","ux","uy","vx","vy","ta","tb","fromArcToBeziers","fx","fy","rot","large","sweep","segsNorm","rotateX","th","px","py","rx2","abs","ry2","py2","px2","pl","root","cx","cy","mTheta","dtheta","segments","ceil","result","mDelta","arcToSegments","calcLineLength","x1","y1","x2","y2","getPointOnCubicBezierIterator","p1x","p1y","p2x","p2y","p3x","p3y","p4x","p4y","pct","CB2","c3","CB3","c4","CB4","getTangentCubicIterator","invT","tangentX","tangentY","getPointOnQuadraticBezierIterator","QB2","QB3","getTangentQuadraticIterator","pathIterator","iterator","perc","tempP","tmpLen","getPathSegmentsInfo","tempInfo","angleFinder","totalLength","info","command","destX","destY","joinPath","pathData","segment","parsePath","pathString","currentPath","parsed","match","coordsStr","re","rNumber","rNumberCommaWsp","rFlagCommaWsp","regArcArgumentSequence","RegExp","coordsParsed","trim","args","j","jlen","isNaN","commandLength","repeatedCommand","k","klen","makePathSimpler","converted","previous","controlX","controlY","destinationPath","getSmoothPathFromPoints","correction","p1","p2","multSignX","multSignY","manyPoints","eq","midPoint","midPointFrom","getBoundsOfCurve","x0","y0","x3","y3","argsString","t1","t2","b2ac","sqrtb2ac","tvalues","bounds","mt","getPointOnPath","distance","infos","segInfo","segPercent","lerp","nextLen","lastPerc","nextStep","findPercentageForDistance","transformPath","pathOffset","pathSegment","newSegment","find","byProperty","condition","invoke","method","value1","value2","extend","Element","hasOwnProperty","getWholeChar","str","code","charCodeAt","next","prev","replace","character","capitalize","firstLetterOnly","escapeXml","graphemeSplit","textstring","chr","graphemes","emptyFunction","IS_DONTENUM_BUGGY","toString","addMethods","klass","parent","superclass","constructor","returnValue","valueOf","Subclass","callSuper","methodName","parentMethod","_this","superClassMethod","createClass","initialize","shift","subclasses","attachEvent","addListener","element","addEventListener","removeListener","removeEventListener","getPointer","event","scroll","getScrollLeftTop","_evt","touchProp","changedTouches","getTouchInfo","clientX","clientY","isTouchEvent","pointerType","opacity","es","currentStyle","hasLayout","zoom","test","setStyle","styles","elementStyle","cssText","styleFloat","sliceCanConvertNodelists","getElementStyle","selectProp","_slice","toArray","arrayLike","childNodes","err","makeElement","tagName","el","className","htmlFor","setAttribute","docElement","documentElement","body","scrollLeft","scrollTop","host","nodeType","arr","defaultView","getComputedStyle","attr","undefined","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","setImageSmoothing","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","getById","id","getElementById","addClass","wrapElement","wrapper","replaceChild","getElementOffset","docElem","scrollLeftTop","doc","ownerDocument","box","offset","offsetAttributes","borderLeftWidth","borderTopWidth","paddingLeft","paddingTop","parseInt","getBoundingClientRect","clientLeft","clientTop","getNodeCanvas","impl","_canvas","_image","cleanUpJsdomNode","_currentSrc","_attributes","_classList","emptyFn","request","onComplete","xhr","XMLHttpRequest","parameters","onreadystatechange","readyState","param","addParamToUrl","open","setRequestHeader","send","warn","RUNNING_ANIMATIONS","noop","defaultEasing","d","cancelAll","animations","animation","cancel","cancelByCanvas","cancelled","cancelByTarget","findAnimationsByTarget","findAnimationIndex","cancelFunc","findAnimation","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","_cancelAnimFrame","cancelAnimationFrame","clearTimeout","requestAnimFrame","animate","removeFromRegistry","runningAnimations","currentValue","startValue","completionRate","durationRate","timestamp","time","start","Date","duration","finish","onChange","abort","easing","isMany","endValue","byValue","onStart","tick","ticktime","currentTime","timePerc","_value","valuePerc","cancelAnimFrame","calculateColor","begin","end","pos","color","animateColor","fromColor","toColor","startColor","Color","getSource","endColor","originalOnComplete","originalOnChange","colorEasing","normalize","asin","elastic","opts","easeInBounce","easeOutBounce","ease","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInOutBounce","attributesMap","display","visibility","colorAttributes","stroke","fSize","cPath","normalizeAttr","normalizeValue","parentAttributes","parseTransformAttribute","visible","fillIndex","strokeIndex","getSvgRegex","_getMultipleNodes","nodeNames","nodeName","nodeList","nodeArray","getElementsByTagName","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","selector","doesSomeParentMatch","matcher","classNames","getAttribute","elementById","node","nodelist","svgValidTagNamesRegEx","svgViewBoxElementsRegEx","svgInvalidAncestorsRegEx","svgValidParentsRegEx","cssRules","gradientDefs","clipPaths","skewMatrix","reTransformList","reTransform","attributeValue","matrices","operation","translateMatrix","rotateMatrix","multiplierX","multiplierY","combinedMatrix","reViewBoxAttrValue","applyViewboxTransform","viewBoxWidth","viewBoxHeight","viewBoxAttr","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","missingDimAttr","toBeParsed","parsedDim","widthDiff","heightDiff","removeAttribute","createElementNS","firstChild","recursivelyParseGradientsXlink","gradient","xlinkAttr","referencedGradient","hasAttribute","children","referenceClone","cloneNode","parseSVGDocument","parsingOptions","xlinkAttribute","attrs","xlink","el2","currentTrans","oldLength","el3","setAttributeNS","nodeValue","parseUseDirectives","svgUid","__uid","descendants","selectNodes","hasAncestorWithNodeName","getGradientDefs","getCSSRules","parseElements","instances","reFontDeclaration","parseFontDeclaration","oStyle","fontStyle","fontWeight","lineHeight","elList","parseAttributes","parentFontSize","ownAttributes","cssAttrs","rule","getGlobalStylesForElement","parseStyleAttribute","normalizedAttr","normalizedValue","normalizedStyle","font","mergedAttrs","setAlpha","getAlpha","toRgba","_setStrokeFillOpacity","ElementsParser","parse","chunk","pair","parseStyleString","parseStyleObject","parsePointsAttribute","parsedPoints","allRules","styleContents","textContent","ruleObj","propertyValuePairs","_rule","loadSVGFromURL","xml","responseXML","results","_options","allElements","loadSVGFromString","parseFromString","regexUrl","numElements","createObjects","createObject","findTag","fromElement","createCallback","checkIfDone","resolveGradient","Image","_originalElement","_removeTransformMatrix","resolveClipPath","extractPropertyDefinition","storage","regex","lastIndex","gradientDef","opacityAttr","createClipPathCallback","container","_newObj","fillRule","clipRule","usingElement","objTransformInv","gTransform","clipPathTag","clipPathOwner","that","scalarAdd","scalarAddEquals","subtractEquals","scalarSubtract","scalarSubtractEquals","multiplyEquals","divide","divideEquals","lt","lte","gt","gte","distanceFrom","dx","dy","setXY","setX","setY","setFromPoint","swap","Intersection","status","appendPoint","appendPoints","intersectLineLine","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","_tryParsingColor","setSource","hue2rgb","colorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","_rgbToHsl","g","round","_source","toRgb","toHsl","hsl","toHsla","toHex","toHexa","toGrayscale","average","currentAlpha","toBlackWhite","threshold","overlayWith","otherColor","otherSource","reRGBa","reHSLa","reHex","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","fromRgb","fromSource","fromRgba","fromHsl","fromHsla","fromHex","isShortNotation","isRGBa","oColor","scaleMap","skewMap","controls","LEFT","TOP","RIGHT","BOTTOM","CENTER","opposite","bottom","right","findCornerQuadrant","fabricObject","control","cornerAngle","fireEvent","canvasOptions","scaleIsProportional","eventData","uniformIsToggled","uniScaleKey","uniformScaling","isTransformCentered","originX","originY","scalingIsForbidden","by","scaleProportionally","lockX","lockScalingX","lockY","lockScalingY","commonEventInfo","e","pointer","wrapWithFixedAnchor","actionHandler","getCenterPoint","constraint","translateToOriginPoint","actionPerformed","wrapWithFireEvent","getLocalPoint","corner","getZoom","padding","localPoint","toLocalPoint","offsetX","offsetY","targetHasOneFlip","compensateScaleForSkew","oppositeSkew","scaleToCompensate","axis","reference","newValue","_getTransformedDimensions","skewObjectX","newSkew","dimNoSkew","totalSkewSize","currentSkew","hasSkewed","dimBeforeSkewing","skewObjectY","scaleObject","dim","signX","signY","forbidScaling","gestureScale","lockScalingFlip","original","oldScaleX","oldScaleY","scaleCursorStyleHandler","n","skewCursorStyleHandler","notAllowed","lockSkewingY","lockSkewingX","scaleSkewCursorStyleHandler","altActionKey","rotationWithSnapping","pivotPoint","lockRotation","hasRotated","lastAngle","ey","ex","curAngle","snapAngle","snapThreshold","rightAngleLocked","leftAngleLocked","scalingEqually","scalingX","scalingY","scalingYOrSkewingX","skewHandlerX","scalingXOrSkewingY","skewHandlerY","changeWidth","strokePadding","multiplier","oldWidth","newWidth","finalHandler","dragHandler","newLeft","newTop","moveX","moveY","scaleOrSkewActionName","isAlternative","rotationStyleHandler","cursorStyle","controlsUtils","renderCircleControl","styleOverride","xSize","sizeX","cornerSize","ySize","sizeY","transparentCorners","cornerStrokeColor","myLeft","myTop","save","fillStyle","cornerColor","strokeStyle","lineWidth","beginPath","arc","restore","renderSquareControl","xSizeBy2","ySizeBy2","strokeRect","Control","actionName","touchSizeX","touchSizeY","withConnection","mouseDownHandler","mouseUpHandler","getActionHandler","getMouseDownHandler","getMouseUpHandler","cursorStyleHandler","getActionName","getVisibility","controlKey","objectVisibility","_controlsVisibility","setVisibility","positionHandler","finalMatrix","calcCornerCoords","objectAngle","objectCornerSize","centerX","centerY","isTouch","cosHalfOffset","sinHalfOffset","cosHalfOffsetComp","sinHalfOffsetComp","controlTriangleAngle","cornerHypotenuse","newTheta","newThetaComp","tl","tr","bl","br","render","cornerStyle","getColorStop","colorAlpha","keyValuePairs","gradientTransform","gradientUnits","keys","option","addColorStop","toObject","propertiesToInclude","toSVG","markup","commonAttributes","needsSwap","withViewport","additionalTransform","sort","reverse","minRadius","percentageShift","colorStop","toLive","createLinearGradient","createRadialGradient","instance","svgOptions","colorStopEls","getLinearCoords","getRadialCoords","propValue","finalValue","__convertPercentUnitsToValues","repeat","patternTransform","setOptions","isError","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","complete","naturalWidth","naturalHeight","createPattern","Shadow","blur","affectStroke","includeDefaultValues","nonScaling","_parseShadow","shadow","shadowStr","offsetsAndBlur","reOffsetsAndBlur","fBoxX","fBoxY","StaticCanvas","CANVAS_INIT_ERROR","Error","renderAndResetBound","renderAndReset","requestRenderAllBound","_initStatic","backgroundColor","backgroundImage","overlayColor","overlayImage","stateful","controlsAboveOverlay","allowTouchScrolling","viewportTransform","backgroundVpt","overlayVpt","enableRetinaScaling","vptCoords","skipOffscreen","cb","_createLowerCanvas","_initOptions","interactive","_initRetinaScaling","setOverlayImage","setBackgroundImage","setBackgroundColor","setOverlayColor","calcOffset","_isRetinaScaling","getRetinaScaling","scaleRatio","__initRetinaScaling","lowerCanvasEl","contextContainer","upperCanvasEl","contextTop","_offset","image","__setBgOverlayImage","__setBgOverlayColor","_createCanvasElement","_originalCanvasStyle","_applyCanvasStyle","getWidth","getHeight","setWidth","setDimensions","setHeight","dimensions","cssValue","cssOnly","_setBackstoreDimension","hasLostContext","backstoreOnly","_setCssDimension","_isCurrentlyDrawing","freeDrawingBrush","_setBrushStyles","cacheCanvasEl","wrapperEl","setViewportTransform","vpt","activeObject","_activeObject","backgroundObject","overlayObject","group","setCoords","calcViewportBoundaries","zoomToPoint","before","after","setZoom","absolutePan","relativePan","getElement","setupState","clearContext","clearRect","clear","_hasITextHandlers","_mouseUpITextHandler","_iTextInstances","renderAll","canvasToDrawOn","renderCanvas","isRendering","iVpt","cancelRequestedRender","_renderBackground","_renderObjects","drawControls","shouldCache","_transformDone","renderCache","forClipping","drawClipPathOnCanvas","_renderOverlay","globalCompositeOperation","zoomX","zoomY","_cacheCanvas","cacheTranslationX","cacheTranslationY","_renderBackgroundOrOverlay","needsVpt","moveTo","lineTo","closePath","getCenter","centerObjectH","_centerObject","centerObjectV","centerObject","viewportCenterObject","vpCenter","getVpCenter","viewportCenterObjectH","viewportCenterObjectV","toDatalessJSON","toDatalessObject","_toObjectMethod","_toObjects","excludeFromExport","_toObject","__serializeBgOverlay","originalValue","bgImage","bgColor","background","overlay","svgViewportTransformation","_setSVGPreamble","_setSVGHeader","clipPathId","_setSVGBgOverlayColor","_setSVGBgOverlayImage","_setSVGObjects","suppressPreamble","encoding","viewBox","createSVGFontFacesMarkup","createSVGRefElementsMarkup","createSVGClipPathMarkup","toClipPathSVG","shouldTransform","row","rowIndex","charIndex","fontList","_setSVGObject","finalWidth","finalHeight","sendToBack","objs","activeSelection","unshift","bringToFront","sendBackwards","intersecting","newIdx","objsMoved","_findNewLowerIndex","intersectsWithObject","isContainedWithinObject","bringForward","_findNewUpperIndex","dispose","classList","DataURLExporter","EMPTY_JSON","supports","setLineDash","toJSON","createPNGStream","createJPEGStream","BaseBrush","strokeLineCap","strokeDashArray","limitedToCanvasSize","lineCap","miterLimit","lineJoin","_saveAndTransform","_setShadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","needsFullRender","_resetShadow","_isOutSideCanvas","PencilBrush","decimate","drawStraightLine","straightLineKey","_points","_hasStraightLine","_drawSegment","quadraticCurveTo","onMouseDown","_isMainEvent","_prepareForDrawing","_captureDrawingPath","_render","onMouseMove","oldEnd","onMouseUp","_finalizeAndAddPath","_reset","_addPoint","pointerPoint","convertPointsToSVGPath","_isEmptySVGPath","createPath","Path","decimatePoints","adjustedDistance","lastPoint","newPoints","CircleBrush","drawDot","addPoint","dot","radius","originalRenderOnAddRemove","circles","circle","Circle","circleRadius","circleColor","SprayBrush","density","dotWidth","dotWidthVariance","randomOpacity","optimizeOverlapping","sprayChunks","addSprayChunk","sprayChunkPoints","rects","ilen","sprayChunk","rect","Rect","_getOptimizedRects","uniqueRects","uniqueRectsArray","globalAlpha","fillRect","PatternBrush","getPatternSrc","patternCanvas","patternCtx","getPatternSrcFunction","String","getPattern","topLeft","_getLeftTopCoords","Canvas","_initInteractive","_createCacheCanvas","centeredScaling","centeredRotation","centeredKey","selection","selectionKey","altSelectionKey","selectionColor","selectionDashArray","selectionBorderColor","selectionLineWidth","selectionFullyContained","hoverCursor","moveCursor","defaultCursor","freeDrawingCursor","notAllowedCursor","containerClass","perPixelTargetFind","targetFindTolerance","skipTargetFind","isDrawingMode","preserveObjectStacking","stopContextMenu","fireRightClick","fireMiddleClick","targets","enablePointerEvents","_hoveredTarget","_hoveredTargets","_currentTransform","_groupSelector","_initWrapperElement","_createUpperCanvas","_initEventListeners","_chooseObjectsToRender","objsToRender","activeGroupObjects","activeObjects","getActiveObjects","contextTopDirty","renderTopLayer","_drawSelection","renderTop","_normalizePointer","invertedM","vptPointer","restorePointerVpt","isTargetTransparent","normalizedPointer","targetRelativeX","targetRelativeY","_cacheContext","contextCache","originalColor","selectionBackgroundColor","_isSelectionKeyPressed","_shouldClearSelection","evented","selectable","_shouldCenterTransform","action","altKey","centerTransform","_getOriginFromCorner","_getActionFromCorner","alreadySelected","_setupCurrentTransform","__corner","lastX","lastY","shiftKey","_beforeTransform","setCursor","cursor","viewportStart","viewportExtent","extent","maxX","maxY","strokeOffset","_setLineDash","findTarget","skipGroup","activeTarget","activeTargetSubs","aObjects","shouldLookForActive","_findTargetCorner","_searchPossibleTargets","_checkTarget","globalPointer","containsPoint","isEditing","subTarget","objToCheck","pointerToUse","subTargetCheck","ignoreZoom","_absolutePointer","_pointer","cssScale","boundsWidth","boundsHeight","retinaScaling","lowerCanvasClass","_copyCanvasStyle","getTopContext","fromEl","toEl","getSelectionContext","getSelectionElement","getActiveObject","active","_discardActiveObject","_fireSelectionEvents","oldObjects","somethingChanged","added","removed","oldObject","selected","deselected","setActiveObject","currentActives","_setActiveObject","onSelect","onDeselect","discardActiveObject","removeListeners","_renderControls","originalProperties","_realizeGroupTransformOnObject","_unwindGroupTransformOnObject","originalValues","clearContextTop","addEventOptions","passive","checkClick","button","mainTouchId","_bindEvents","addOrRemove","_getEventPrefix","functor","eventjsFunctor","canvasElement","eventTypePrefix","_onResize","_onMouseDown","_onMouseMove","_onMouseOut","_onMouseEnter","_onMouseWheel","_onContextMenu","_onDoubleClick","_onDragOver","_onDragEnter","_onDragLeave","_onDrop","_onTouchStart","eventjs","_onGesture","_onDrag","_onOrientationChange","_onShake","_onLongPress","_onMouseUp","_onTouchEnd","eventsBound","_simpleEventHandler","self","__onTransformGesture","__onDrag","__onMouseWheel","_target","hiddenTextarea","focus","__onOrientationChange","__onShake","__onLongPress","preventDefault","_fireEnterLeaveEvents","stopPropagation","_cacheTransformEventData","_handleEvent","_resetTransformEventData","getPointerId","evt","identifier","pointerId","isPrimary","touches","__onMouseDown","__onMouseUp","_willAddMouseDown","__onMouseMove","_shouldRender","groupSelector","shouldRender","isClick","_onMouseUpInDrawingMode","_finalizeCurrentTransform","targetWasActive","_maybeGroupObjects","activeOn","isMoving","originalControl","originalMouseUpHandler","_setCursorFromEvent","eventType","subTargets","absolutePointer","currentTarget","currentSubTargets","_scaling","hasStateChanged","_fire","_onMouseDownInDrawingMode","_onMouseMoveInDrawingMode","_previousPointer","shouldGroup","_shouldGroup","_handleGrouping","saveState","_transformObject","_fireOverOutEvents","fireSyntheticInOutEvents","oldTarget","evtOut","canvasEvtOut","evtIn","canvasEvtIn","_draggedoverTarget","config","inOpt","outOpt","inFires","targetChanged","previousTarget","nextTarget","reset","_performTransformAction","getCornerCursor","_updateActiveSelection","_createActiveSelection","currentActiveObjects","removeWithUpdate","addWithUpdate","_createGroup","groupObjects","exitEditing","ActiveSelection","_groupSelectedObjects","aGroup","_collectObjects","currentObject","selectionX1Y1","selectionX2Y2","allowIntersect","intersectsWithRect","isContainedWithinRect","toCanvasElement","cropping","scaledWidth","scaledHeight","originalWidth","originalHeight","newZoom","vp","originalInteractive","newVp","originalRetina","originalContextTop","loadFromJSON","json","serialized","JSON","_enlivenObjects","_setBgOverlay","enlivenedCanvasClip","__setupCanvas","loaded","cbIfLoaded","__setBgOverlay","enlivedObject","_toDataURL","_toDataURLWithMultiplier","toDataURLWithMultiplier","stringify","cloneWithoutData","backgroundImageOpacity","backgroundImageStretch","objectCaching","touchCornerSize","borderColor","borderDashArray","cornerDashArray","strokeDashOffset","borderOpacityWhenMoving","borderScaleFactor","minScaleLimit","hasControls","hasBorders","lockMovementX","lockMovementY","statefullCache","noScaleCache","dirty","paintFirst","stateProperties","cacheProperties","colorProperties","absolutePositioned","_cacheProperties","_updateCacheCanvas","_limitCacheSize","dims","limitedDims","capped","_getCacheCanvasDimensions","objectScale","getTotalObjectScaling","neededX","neededY","drawingWidth","drawingHeight","minCacheSize","dimensionsChanged","cacheWidth","cacheHeight","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","getHeightOfLine","setTransform","needFullTransform","_removeDefaultValues","getObjectScaling","retina","getObjectOpacity","shouldConstrainValue","isChanged","groupNeedsUpdate","_constrainScale","isOnACache","setOnGroup","getViewportTransform","isNotVisible","isOnScreen","_setupCompositeOperation","drawSelectionBackground","_setOpacity","drawCacheOnCanvas","_removeCacheCanvas","drawObject","propertySet","isCacheDirty","hasStroke","hasFill","needsItsOwnCache","ownCaching","willDrawShadow","drawClipPathOnCache","originalFill","originalStroke","_setClippingProperties","_drawClipPath","skipCanvas","_getNonTransformedDimensions","_removeShadow","_setStrokeStyles","decl","lineDashOffset","_applyPatternForTransformedGradient","_applyPatternGradientTransform","_setFillStyles","dashArray","drawBorders","forActiveSelection","drawBordersInGroup","scaling","multX","multY","_renderPaintInOrder","_renderStroke","_renderFill","pCtx","pCanvas","_findCenterFromElement","_assignTransformMatrixProps","preserveAspectRatioOptions","cropX","cropY","offsetLeft","offsetTop","objectForm","_fromObject","cloneAsImage","utils","origParams","originalGroup","originalShadow","withoutTransform","withoutShadow","boundingRect","getBoundingRect","shadowOffset","originalCanvas","isType","includes","shouldCenterOrigin","_setOriginToCenter","_resetOrigin","centerH","viewportCenterH","centerV","viewportCenterV","viewportCenter","getLocalPointer","pClicked","objectLeftTop","createAccessors","extraParam","translateToGivenOrigin","fromOriginX","fromOriginY","toOriginX","toOriginY","translateToCenterPoint","leftTop","getPointByOrigin","adjustPosition","offsetFrom","offsetTo","hypotFull","getScaledWidth","xFull","yFull","_originalOriginX","_originalOriginY","originPoint","multiplyMatrices","oCoords","aCoords","lineCoords","ownMatrixCache","matrixCache","_getCoords","absolute","calculate","calcACoords","calcLineCoords","getCoords","pointTL","pointBR","other","otherCoords","lines","_getImageLines","_findCrossPoints","_containsCenterOfCanvas","isPartiallyOnScreen","every","topline","rightline","bottomline","leftline","xi","iLine","xcount","lineKey","getScaledHeight","scaleToWidth","boundingRectFactor","scaleToHeight","cosP","sinP","cosPSinP","cosPMinusSinP","calcOCoords","_calcRotateMatrix","_calcTranslateMatrix","startMatrix","_calculateCurrentDimensions","forEachControl","w","skipCorners","_setCornerCoords","transformMatrixKey","sep","prefix","cache","tMatrix","noSkew","_finalizeDimensions","getSvgColorString","getSvgStyles","skipShadow","getSvgFilter","getSvgSpanStyles","useWhiteSpace","term","textDecoration","getSvgTextDecoration","deltaY","decoration","getSvgCommons","getSvgTransform","full","_setSVGBg","textBgRects","_getFillAttributes","_createBaseSVGMarkup","_toSVG","_createBaseClipPathSVGMarkup","objectMarkup","commonPieces","clipPathMarkup","noStyle","styleInfo","shadowInfo","withShadow","vectorEffect","absoluteClipPath","addPaintOrder","originalSet","saveProps","props","tmpObj","_isEqual","origValue","firstPass","dashedPropertySet","forTouch","isControlVisible","touchCorner","fn","controlObject","wh","shouldStroke","setControlVisible","setControlsVisibility","FX_DURATION","fxCenterObjectH","callbacks","empty","fxCenterObjectV","fxRemove","skipCallbacks","propsToAnimate","out","_animate","propPair","propIsColor","valueProgress","timeProgress","coordProps","makeEdgeToOriginGetter","propertyNames","originValues","axis1","axis2","dimension","nearest","farthest","Line","_setWidthHeight","_getLeftToOriginX","_getTopToOriginY","calcLinePoints","origStrokeStyle","xMult","yMult","ATTRIBUTE_NAMES","parsedAttributes","startAngle","endAngle","setRadius","svgString","getRadiusX","getRadiusY","Triangle","widthBy2","heightBy2","piBy2","Ellipse","getRx","getRy","_initRxRy","isRounded","bezierCurveTo","Polyline","exactBoundingBox","_setPositionDimensions","_projectStrokeOnPoints","correctLeftTop","calcDim","_calcDimensions","correctSize","fromSVG","diffX","diffY","commonRender","fromElementGenerator","_class","Polygon","_setPath","_renderPathCommands","subpathStartX","subpathStartY","_getOffsetTransform","digits","aX","aY","pathUrl","useSetOnGroup","isAlreadyGrouped","_updateObjectsACoords","_calcBounds","_updateObjectsCoords","_updateObjectCoords","objectLeft","objectTop","nested","_restoreObjectsState","_includeDefaultValues","objsToObject","originalDefaults","_obj","ownCache","groupMatrix","destroy","toActiveSelection","ungroupOnCanvas","setObjectsCoords","onlyWidthHeight","iLen","jLen","_getBounds","minXY","maxXY","toGroup","newGroup","childrenOverride","srcFromAttribute","_lastScaleX","_lastScaleY","_filterScalingX","_filterScalingY","minimumScaleTrigger","cacheKey","imageSmoothing","filters","_initElement","_element","setElement","removeTexture","_initConfig","applyFilters","resizeFilter","applyResizeFilters","backend","filterBackend","evictCachesForKey","getCrossOrigin","getOriginalSize","_stroke","filterObj","getSrc","hasCrop","strokeSvg","imageMarkup","imageRendering","getSvgSrc","origFill","filtered","setSrc","minimumScale","elementToFilter","_filteredEl","sourceWidth","sourceHeight","isNeutralState","imgElement","_needsResize","elementToDraw","elWidth","elHeight","sX","sY","sW","sH","maxDestW","maxDestH","_resetWidthHeight","CSS_CANVAS","_initFilters","pAR","rWidth","rHeight","pWidth","pHeight","_object","resizeFilters","fromURL","imgOptions","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","testPrecision","precision","fragmentSource","fragmentShader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","setupGLContext","captureGPUInfo","isSupported","getParameter","MAX_TEXTURE_SIZE","precisions","webGlPrecision","createWebGLCanvas","aPosition","Float32Array","chooseFastestCopyGLTo2DMethod","canUseImageData","canMeasurePerf","performance","canUseArrayBuffer","ArrayBuffer","canUseUint8Clamped","copyGLTo2D","startTime","drawImageTime","testContext","now","glOptions","premultipliedAlpha","depth","stencil","antialias","clearColor","cachedTexture","getCachedTexture","sourceTexture","createTexture","targetTexture","originalTexture","passes","webgl","programCache","pass","tempFbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","applyTo","resizeCanvasIfNeeded","bindTexture","TEXTURE_2D","deleteTexture","deleteFramebuffer","clearWebGLCaches","textureCache","textureImageSource","texture","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","uniqueId","gpuInfo","renderer","vendor","ext","getExtension","UNMASKED_RENDERER_WEBGL","UNMASKED_VENDOR_WEBGL","sourceElement","originalEl","originalImageData","BaseFilter","vertexSource","createProgram","vertexShader","VERTEX_SHADER","getShaderInfoLog","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attributeLocations","getAttributeLocations","uniformLocations","getUniformLocations","uStepW","getUniformLocation","uStepH","getAttribLocation","sendAttributeData","aPositionData","attributeLocation","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","enableVertexAttribArray","vertexAttribPointer","FLOAT","bufferData","STATIC_DRAW","_setupFrameBuffer","framebufferTexture2D","COLOR_ATTACHMENT0","_swapTextures","temp","main","mainParameter","applyToWebGL","applyTo2d","retrieveShader","shader","useProgram","uniform1f","sendUniformData","viewport","drawArrays","TRIANGLE_STRIP","bindAdditionalTexture","textureUnit","activeTexture","TEXTURE0","unbindAdditionalTexture","getMainParameter","setMainParameter","createHelpLayer","helpLayer","mainP","ColorMatrix","colorsOnly","uColorMatrix","uConstants","constants","uniformMatrix4fv","uniform4fv","Brightness","brightness","uBrightness","Convolute","opaque","Convolute_3_1","Convolute_3_0","Convolute_5_1","Convolute_5_0","Convolute_7_1","Convolute_7_0","Convolute_9_1","Convolute_9_0","dstOff","scx","scy","srcOff","wt","weights","side","halfSide","sw","sh","output","createImageData","dst","alphaFac","uMatrix","uOpaque","uHalfSize","uSize","uniform1fv","Grayscale","lightness","luminosity","mode","uMode","uniform1i","Invert","invert","uInvert","Noise","noise","rand","uNoise","uSeed","Pixelate","blocksize","_i","_j","_iLen","_jLen","uBlocksize","RemoveColor","useAlpha","lowC","highC","uLow","uHigh","Brownie","Vintage","Kodachrome","Technicolor","Polaroid","Sepia","BlackWhite","BlendColor","screen","diff","lighten","darken","exclusion","tint","buildSource","tg","alpha1","uColor","BlendImage","mask","TEXTURE1","calculateMatrix","canvas1","blendData","blendImage","uTransformMatrix","uImage","uniformMatrix3fv","Resize","resizeType","lanczosLobes","uDelta","uTaps","uniform2fv","horizontal","taps","filterWindow","getFilterWindow","generateShader","tempScale","getTaps","lobeFunction","lanczosCreate","offsets","fragmentSourceTOP","dW","dH","lobes","xx","rcpScaleX","rcpScaleY","newData","oW","oH","sliceByTwo","hermiteFastResize","bilinearFiltering","lanczosResize","tmpCanvas","mult","doneW","doneH","stepW","stepH","dX","dY","srcData","destImg","destData","lanczos","ratioX","ratioY","rcpRatioX","rcpRatioY","range2X","range2Y","cacheLanc","icenter","process","u","weight","fX","fY","xDiff","yDiff","chnl","origPix","w4","pixels","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","yy","w0","Contrast","contrast","contrastF","uContrast","Saturation","saturation","adjust","uSaturation","Vibrance","vibrance","avg","amt","uVibrance","Blur","aspectRatio","simpleBlur","canvas2","blurLayer1","blurLayer2","percent","ctx1","ctx2","newImageData","delta","chooseRightDelta","blurScale","Gamma","gamma","rInv","gInv","bInv","rVals","gVals","bVals","uGamma","uniform3fv","Composed","subFilters","HueRotation","rotation","rad","aThird","aThirdSqtSin","OneMinusCos","additionalProps","_dimensionAffectingProps","_reNewline","_reSpacesAndTabs","_reSpaceAndTab","_reWords","underline","overline","linethrough","textAlign","superscript","baseline","subscript","textBackgroundColor","pathStartOffset","pathSide","pathAlign","_fontSizeFraction","_fontSizeMult","charSpacing","_measuringContext","direction","_styleProperties","__charBounds","CACHE_FONT_SIZE","MIN_TEXT_WIDTH","text","__skipDimension","setPathInfo","initDimensions","segmentsInfo","getMeasuringContext","_splitText","newLines","_splitTextIntoLines","textLines","_textLines","graphemeLines","_unwrappedTextLines","_unwrappedLines","_text","graphemeText","_clearCache","calcTextWidth","cursorWidth","calcTextHeight","enlargeSpaces","diffSpace","currentLineWidth","numberOfSpaces","accumulatedSpace","line","charBound","spaces","isEndOfWrapping","getLineWidth","kernedWidth","lineIndex","missingNewlineOffset","_setTextStyles","_renderTextLinesBackground","_renderTextDecoration","_renderText","_renderTextStroke","_renderTextFill","charStyle","forMeasuring","textBaseline","_getFontDeclaration","maxWidth","_renderTextLine","_renderChars","styleHas","heightOfLine","lineLeftOffset","lastColor","charBox","currentColor","drawStart","leftOffset","_getLeftOffset","lineTopOffset","_getTopOffset","boxStart","boxWidth","_getLineLeftOffset","getValueOfPropertyAt","renderLeft","getFontCache","cacheProp","_measureChar","_char","previousChar","prevCharStyle","coupleWidth","previousWidth","fontCache","couple","stylesAreEqual","fontMultiplier","measureText","getHeightOfChar","measureLine","lineInfo","_measureLine","_getWidthOfCharSpacing","grapheme","prevGrapheme","graphemeInfo","startingPoint","totalPathLength","lineBounds","positionInPath","_getGraphemeBox","_setGraphemeOnPath","numOfSpaces","centerPosition","skipLeft","getCompleteStyleDeclaration","prevStyle","previousBox","__lineHeights","maxHeight","_renderTextCommon","lineHeights","isEmptyStyles","actualStyle","nextStyle","timeToRender","drawingLeft","isJustify","charsToRender","shortCut","isLtr","currentDirection","_renderChar","_hasStyleChanged","_applyPatternGradientTransformText","handleFiller","fillOffsets","strokeOffsets","_getStyleDeclaration","fullDecl","shouldFill","fillText","strokeText","setSuperscript","_setScript","setSubscript","schema","loc","get2DCursorLocation","setSelectionStyles","thisStyle","_hasStyleChangedForSvg","lineDiff","__lineWidths","_shouldClearDimensionCache","shouldClear","_forceClearCache","_size","_dy","lastDecoration","currentDecoration","currentFill","lastFill","topOffset","styleObject","family","fontIsGeneric","genericFonts","newLine","newText","allProperties","needsDims","isAddingPath","_key","parsedAnchor","textAnchor","originalStrokeWidth","textHeightScaleFactor","scaledDiff","textHeight","offX","objectCopy","textInstance","pathInstance","p3","cleanStyle","letterCount","stylePropertyValue","stylesCount","allStyleObjectPropertiesMatch","graphemeCount","removeStyle","lineNum","charNum","_extendStyles","_getLineStyle","_setLineStyle","_setStyleDeclaration","selectionStart","skipWrapping","getSelectionStyles","startIndex","endIndex","selectionEnd","getStyleAtPosition","lineStyle","_deleteStyleDeclaration","_deleteLineStyle","parseDecoration","IText","editable","editingBorderColor","cursorColor","cursorDelay","cursorDuration","caching","hiddenTextareaContainer","_reSpace","_currentCursorOpacity","_selectionDirection","_abortCursorAnimation","__widthOfSpace","inCompositionMode","initBehavior","setSelectionStart","_updateAndFire","setSelectionEnd","_fireSelectionChanged","_updateTextarea","initDelayedCursor","cursorOffsetCache","renderCursorOrSelection","skipRestore","_clearTextArea","boundaries","_getCursorBoundaries","renderCursor","renderSelection","_getCursorBoundariesOffsets","cursorPosition","bound","cursorLocation","charHeight","__isMousedown","startLine","endLine","startChar","endChar","realLineHeight","lineOffset","boxEnd","drawWidth","drawHeight","extraTop","compositionColor","getCurrentCharFontSize","cp","_getCurrentCharIndex","getCurrentCharColor","initAddedHandler","initRemovedHandler","initCursorSelectionHandlers","initDoubleClickSimulation","mouseMoveHandler","_initCanvasHandlers","_removeCanvasHandlers","_tick","_currentTickState","_animateCursor","targetOpacity","completeMethod","tickState","isAborted","_onTickComplete","_cursorTimeout1","_currentTickCompleteState","restart","delay","abortCursorAnimation","_cursorTimeout2","selectAll","getSelectedText","findWordBoundaryLeft","startFrom","findWordBoundaryRight","findLineBoundaryLeft","findLineBoundaryRight","searchWordBoundary","selectWord","newSelectionStart","newSelectionEnd","selectLine","enterEditing","exitEditingOnOthers","initHiddenTextarea","_saveEditingProps","_setEditingProps","_textBeforeEdit","initMouseMoveHandler","getSelectionStartFromPointer","currentStart","currentEnd","__selectionStartOnMouseDown","restartCursorIfNeeded","fromStringToGraphemeSelection","smallerTextStart","graphemeStart","smallerTextEnd","fromGraphemeToStringSelection","newSelection","updateTextareaPosition","updateFromTextArea","_calcTextareaPosition","desiredPosition","compositionStart","upperCanvas","upperCanvasWidth","upperCanvasHeight","clientWidth","clientHeight","_savedProps","_restoreEditingProps","isTextChanged","_removeExtraneousStyles","removeStyleFromTo","styleObj","cursorStart","cursorEnd","lineStart","charStart","lineEnd","charEnd","shiftLineStyles","numericChar","clonedStyles","numericLine","insertNewlineStyleObject","qty","copiedStyle","currentCharStyle","newLineStyles","somethingAdded","isEndOfLine","numIndex","styleCarriedOver","insertCharStyleObject","quantity","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","insertNewStyleBlock","insertedText","cursorLoc","addedLines","linesLength","setSelectionStartEndWithShift","setSelectionInBoundaries","__lastClickTime","__lastLastClickTime","__lastPointer","__newClickTime","newPointer","isTripleClick","_stopEvent","__lastIsEditing","__lastSelected","initMousedownHandler","initMouseupHandler","initClicks","doubleClickHandler","tripleClickHandler","_mouseDownHandler","setCursorByClick","_mouseDownHandlerBefore","currentActive","mouseOffset","prevWidth","_getNewSelectionStartFromOffset","distanceBtwLastCharAndCursor","distanceBtwNextCharAndCursor","onKeyDown","onKeyUp","onInput","copy","paste","onCompositionStart","onCompositionUpdate","onCompositionEnd","_clickHandlerInitialized","onClick","keysMap","keysMapRtl","ctrlKeysMapUp","ctrlKeysMapDown","keyMap","keyCode","ctrlKey","metaKey","stopImmediatePropagation","_copyDone","fromPaste","removedText","removeFrom","removeTo","nextText","charCount","nextCharCount","charDiff","textareaSelection","backDelete","copiedText","copiedTextStyle","compositionEnd","_getClipboardData","clipboardData","_getWidthBeforeCursor","widthBeforeCursor","getDownCursorOffset","isRight","selectionProp","_getSelectionForOffset","indexOnOtherLine","_getIndexOnLine","getUpCursorOffset","textBeforeCursor","charWidth","foundMatch","widthOfCharsOnLine","indexOnLine","leftEdge","rightEdge","offsetFromLeftEdge","moveCursorDown","_moveCursorUpOrDown","moveCursorUp","moveCursorWithShift","moveCursorWithoutShift","moveCursorLeft","_moveCursorLeftOrRight","_move","_moveLeft","_moveRight","moveCursorLeftWithoutShift","change","moveCursorLeftWithShift","moveCursorRight","moveCursorRightWithShift","moveCursorRightWithoutShift","changed","removeChars","insertChars","multipleSpacesRegex","_getSVGLeftTopOffsets","textAndBg","_getSVGTextAndBg","textTop","textLeft","_wrapSVGTextAndBg","lineTop","textSpans","textTopOffset","textLeftOffset","_setSVGTextLineBg","_setSVGTextLineText","_createTextCharSpan","styleDecl","shouldUseWhitespace","styleProps","fillStyles","dySpan","_pushTextBgRect","fillColor","_getSVGLineTopOffset","lastHeight","Textbox","minWidth","dynamicMinWidth","__cachedLines","_wordJoiners","splitByGrapheme","_styleMap","_generateStyleMap","textInfo","realLineCount","realLineCharCount","isWrapping","nextOffset","shouldLimit","mapNextLine","_wrapText","desiredWidth","wrapped","_wrapLine","_measureWord","word","charOffset","_line","reservedSpace","words","infix","wordWidth","infixWidth","largestWordWidth","lineJustStarted","additionalSpace","getMinWidth","linesToKeep","scaleSkewStyleHandler","scaleStyleHandler","objectControls","ml","mr","mb","mtr","textBoxControls","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","definition","defineProperty","enumerable"],"sourceRoot":""}